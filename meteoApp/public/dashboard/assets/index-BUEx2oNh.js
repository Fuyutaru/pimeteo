var v2=Object.defineProperty;var w2=(s,e,n)=>e in s?v2(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var _e=(s,e,n)=>w2(s,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))c(h);new MutationObserver(h=>{for(const p of h)if(p.type==="childList")for(const f of p.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function n(h){const p={};return h.integrity&&(p.integrity=h.integrity),h.referrerPolicy&&(p.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?p.credentials="include":h.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(h){if(h.ep)return;h.ep=!0;const p=n(h);fetch(h.href,p)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Ig(s){const e=Object.create(null);for(const n of s.split(","))e[n]=1;return n=>n in e}const Vi={},ic=[],wr=()=>{},S2=()=>!1,tp=s=>s.charCodeAt(0)===111&&s.charCodeAt(1)===110&&(s.charCodeAt(2)>122||s.charCodeAt(2)<97),Dg=s=>s.startsWith("onUpdate:"),Ks=Object.assign,Ag=(s,e)=>{const n=s.indexOf(e);n>-1&&s.splice(n,1)},T2=Object.prototype.hasOwnProperty,Pi=(s,e)=>T2.call(s,e),Ue=Array.isArray,sc=s=>Au(s)==="[object Map]",ep=s=>Au(s)==="[object Set]",Ky=s=>Au(s)==="[object Date]",Ye=s=>typeof s=="function",Ss=s=>typeof s=="string",or=s=>typeof s=="symbol",qi=s=>s!==null&&typeof s=="object",mv=s=>(qi(s)||Ye(s))&&Ye(s.then)&&Ye(s.catch),gv=Object.prototype.toString,Au=s=>gv.call(s),M2=s=>Au(s).slice(8,-1),_v=s=>Au(s)==="[object Object]",Eg=s=>Ss(s)&&s!=="NaN"&&s[0]!=="-"&&""+parseInt(s,10)===s,eu=Ig(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ip=s=>{const e=Object.create(null);return n=>e[n]||(e[n]=s(n))},P2=/-(\w)/g,$n=ip(s=>s.replace(P2,(e,n)=>n?n.toUpperCase():"")),C2=/\B([A-Z])/g,Ya=ip(s=>s.replace(C2,"-$1").toLowerCase()),sp=ip(s=>s.charAt(0).toUpperCase()+s.slice(1)),km=ip(s=>s?`on${sp(s)}`:""),Go=(s,e)=>!Object.is(s,e),vf=(s,...e)=>{for(let n=0;n<s.length;n++)s[n](...e)},yv=(s,e,n,c=!1)=>{Object.defineProperty(s,e,{configurable:!0,enumerable:!1,writable:c,value:n})},k2=s=>{const e=parseFloat(s);return isNaN(e)?s:e};let Yy;const np=()=>Yy||(Yy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function zg(s){if(Ue(s)){const e={};for(let n=0;n<s.length;n++){const c=s[n],h=Ss(c)?E2(c):zg(c);if(h)for(const p in h)e[p]=h[p]}return e}else if(Ss(s)||qi(s))return s}const I2=/;(?![^(]*\))/g,D2=/:([^]+)/,A2=/\/\*[^]*?\*\//g;function E2(s){const e={};return s.replace(A2,"").split(I2).forEach(n=>{if(n){const c=n.split(D2);c.length>1&&(e[c[0].trim()]=c[1].trim())}}),e}function Yr(s){let e="";if(Ss(s))e=s;else if(Ue(s))for(let n=0;n<s.length;n++){const c=Yr(s[n]);c&&(e+=c+" ")}else if(qi(s))for(const n in s)s[n]&&(e+=n+" ");return e.trim()}const z2="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",R2=Ig(z2);function xv(s){return!!s||s===""}function L2(s,e){if(s.length!==e.length)return!1;let n=!0;for(let c=0;n&&c<s.length;c++)n=hc(s[c],e[c]);return n}function hc(s,e){if(s===e)return!0;let n=Ky(s),c=Ky(e);if(n||c)return n&&c?s.getTime()===e.getTime():!1;if(n=or(s),c=or(e),n||c)return s===e;if(n=Ue(s),c=Ue(e),n||c)return n&&c?L2(s,e):!1;if(n=qi(s),c=qi(e),n||c){if(!n||!c)return!1;const h=Object.keys(s).length,p=Object.keys(e).length;if(h!==p)return!1;for(const f in s){const a=s.hasOwnProperty(f),w=e.hasOwnProperty(f);if(a&&!w||!a&&w||!hc(s[f],e[f]))return!1}}return String(s)===String(e)}function bv(s,e){return s.findIndex(n=>hc(n,e))}const vv=s=>!!(s&&s.__v_isRef===!0),Nn=s=>Ss(s)?s:s==null?"":Ue(s)||qi(s)&&(s.toString===gv||!Ye(s.toString))?vv(s)?Nn(s.value):JSON.stringify(s,wv,2):String(s),wv=(s,e)=>vv(e)?wv(s,e.value):sc(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((n,[c,h],p)=>(n[Im(c,p)+" =>"]=h,n),{})}:ep(e)?{[`Set(${e.size})`]:[...e.values()].map(n=>Im(n))}:or(e)?Im(e):qi(e)&&!Ue(e)&&!_v(e)?String(e):e,Im=(s,e="")=>{var n;return or(s)?`Symbol(${(n=s.description)!=null?n:e})`:s};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Dn;class F2{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Dn,!e&&Dn&&(this.index=(Dn.scopes||(Dn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,n;if(this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].pause();for(e=0,n=this.effects.length;e<n;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,n;if(this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].resume();for(e=0,n=this.effects.length;e<n;e++)this.effects[e].resume()}}run(e){if(this._active){const n=Dn;try{return Dn=this,e()}finally{Dn=n}}}on(){Dn=this}off(){Dn=this.parent}stop(e){if(this._active){this._active=!1;let n,c;for(n=0,c=this.effects.length;n<c;n++)this.effects[n].stop();for(this.effects.length=0,n=0,c=this.cleanups.length;n<c;n++)this.cleanups[n]();if(this.cleanups.length=0,this.scopes){for(n=0,c=this.scopes.length;n<c;n++)this.scopes[n].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const h=this.parent.scopes.pop();h&&h!==this&&(this.parent.scopes[this.index]=h,h.index=this.index)}this.parent=void 0}}}function O2(){return Dn}let Zi;const Dm=new WeakSet;class Sv{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Dn&&Dn.active&&Dn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Dm.has(this)&&(Dm.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Mv(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Jy(this),Pv(this);const e=Zi,n=sr;Zi=this,sr=!0;try{return this.fn()}finally{Cv(this),Zi=e,sr=n,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Fg(e);this.deps=this.depsTail=void 0,Jy(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Dm.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Qm(this)&&this.run()}get dirty(){return Qm(this)}}let Tv=0,iu,su;function Mv(s,e=!1){if(s.flags|=8,e){s.next=su,su=s;return}s.next=iu,iu=s}function Rg(){Tv++}function Lg(){if(--Tv>0)return;if(su){let e=su;for(su=void 0;e;){const n=e.next;e.next=void 0,e.flags&=-9,e=n}}let s;for(;iu;){let e=iu;for(iu=void 0;e;){const n=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(c){s||(s=c)}e=n}}if(s)throw s}function Pv(s){for(let e=s.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Cv(s){let e,n=s.depsTail,c=n;for(;c;){const h=c.prevDep;c.version===-1?(c===n&&(n=h),Fg(c),B2(c)):e=c,c.dep.activeLink=c.prevActiveLink,c.prevActiveLink=void 0,c=h}s.deps=e,s.depsTail=n}function Qm(s){for(let e=s.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(kv(e.dep.computed)||e.dep.version!==e.version))return!0;return!!s._dirty}function kv(s){if(s.flags&4&&!(s.flags&16)||(s.flags&=-17,s.globalVersion===mu))return;s.globalVersion=mu;const e=s.dep;if(s.flags|=2,e.version>0&&!s.isSSR&&s.deps&&!Qm(s)){s.flags&=-3;return}const n=Zi,c=sr;Zi=s,sr=!0;try{Pv(s);const h=s.fn(s._value);(e.version===0||Go(h,s._value))&&(s._value=h,e.version++)}catch(h){throw e.version++,h}finally{Zi=n,sr=c,Cv(s),s.flags&=-3}}function Fg(s,e=!1){const{dep:n,prevSub:c,nextSub:h}=s;if(c&&(c.nextSub=h,s.prevSub=void 0),h&&(h.prevSub=c,s.nextSub=void 0),n.subs===s&&(n.subs=c,!c&&n.computed)){n.computed.flags&=-5;for(let p=n.computed.deps;p;p=p.nextDep)Fg(p,!0)}!e&&!--n.sc&&n.map&&n.map.delete(n.key)}function B2(s){const{prevDep:e,nextDep:n}=s;e&&(e.nextDep=n,s.prevDep=void 0),n&&(n.prevDep=e,s.nextDep=void 0)}let sr=!0;const Iv=[];function Yo(){Iv.push(sr),sr=!1}function Jo(){const s=Iv.pop();sr=s===void 0?!0:s}function Jy(s){const{cleanup:e}=s;if(s.cleanup=void 0,e){const n=Zi;Zi=void 0;try{e()}finally{Zi=n}}}let mu=0;class j2{constructor(e,n){this.sub=e,this.dep=n,this.version=n.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Og{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!Zi||!sr||Zi===this.computed)return;let n=this.activeLink;if(n===void 0||n.sub!==Zi)n=this.activeLink=new j2(Zi,this),Zi.deps?(n.prevDep=Zi.depsTail,Zi.depsTail.nextDep=n,Zi.depsTail=n):Zi.deps=Zi.depsTail=n,Dv(n);else if(n.version===-1&&(n.version=this.version,n.nextDep)){const c=n.nextDep;c.prevDep=n.prevDep,n.prevDep&&(n.prevDep.nextDep=c),n.prevDep=Zi.depsTail,n.nextDep=void 0,Zi.depsTail.nextDep=n,Zi.depsTail=n,Zi.deps===n&&(Zi.deps=c)}return n}trigger(e){this.version++,mu++,this.notify(e)}notify(e){Rg();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{Lg()}}}function Dv(s){if(s.dep.sc++,s.sub.flags&4){const e=s.dep.computed;if(e&&!s.dep.subs){e.flags|=20;for(let c=e.deps;c;c=c.nextDep)Dv(c)}const n=s.dep.subs;n!==s&&(s.prevSub=n,n&&(n.nextSub=s)),s.dep.subs=s}}const tg=new WeakMap,Ha=Symbol(""),eg=Symbol(""),gu=Symbol("");function Hs(s,e,n){if(sr&&Zi){let c=tg.get(s);c||tg.set(s,c=new Map);let h=c.get(n);h||(c.set(n,h=new Og),h.map=c,h.key=n),h.track()}}function to(s,e,n,c,h,p){const f=tg.get(s);if(!f){mu++;return}const a=w=>{w&&w.trigger()};if(Rg(),e==="clear")f.forEach(a);else{const w=Ue(s),P=w&&Eg(n);if(w&&n==="length"){const k=Number(c);f.forEach((E,F)=>{(F==="length"||F===gu||!or(F)&&F>=k)&&a(E)})}else switch((n!==void 0||f.has(void 0))&&a(f.get(n)),P&&a(f.get(gu)),e){case"add":w?P&&a(f.get("length")):(a(f.get(Ha)),sc(s)&&a(f.get(eg)));break;case"delete":w||(a(f.get(Ha)),sc(s)&&a(f.get(eg)));break;case"set":sc(s)&&a(f.get(Ha));break}}Lg()}function Yl(s){const e=Mi(s);return e===s?e:(Hs(e,"iterate",gu),Vn(s)?e:e.map(Zs))}function rp(s){return Hs(s=Mi(s),"iterate",gu),s}const N2={__proto__:null,[Symbol.iterator](){return Am(this,Symbol.iterator,Zs)},concat(...s){return Yl(this).concat(...s.map(e=>Ue(e)?Yl(e):e))},entries(){return Am(this,"entries",s=>(s[1]=Zs(s[1]),s))},every(s,e){return Zr(this,"every",s,e,void 0,arguments)},filter(s,e){return Zr(this,"filter",s,e,n=>n.map(Zs),arguments)},find(s,e){return Zr(this,"find",s,e,Zs,arguments)},findIndex(s,e){return Zr(this,"findIndex",s,e,void 0,arguments)},findLast(s,e){return Zr(this,"findLast",s,e,Zs,arguments)},findLastIndex(s,e){return Zr(this,"findLastIndex",s,e,void 0,arguments)},forEach(s,e){return Zr(this,"forEach",s,e,void 0,arguments)},includes(...s){return Em(this,"includes",s)},indexOf(...s){return Em(this,"indexOf",s)},join(s){return Yl(this).join(s)},lastIndexOf(...s){return Em(this,"lastIndexOf",s)},map(s,e){return Zr(this,"map",s,e,void 0,arguments)},pop(){return Bh(this,"pop")},push(...s){return Bh(this,"push",s)},reduce(s,...e){return Qy(this,"reduce",s,e)},reduceRight(s,...e){return Qy(this,"reduceRight",s,e)},shift(){return Bh(this,"shift")},some(s,e){return Zr(this,"some",s,e,void 0,arguments)},splice(...s){return Bh(this,"splice",s)},toReversed(){return Yl(this).toReversed()},toSorted(s){return Yl(this).toSorted(s)},toSpliced(...s){return Yl(this).toSpliced(...s)},unshift(...s){return Bh(this,"unshift",s)},values(){return Am(this,"values",Zs)}};function Am(s,e,n){const c=rp(s),h=c[e]();return c!==s&&!Vn(s)&&(h._next=h.next,h.next=()=>{const p=h._next();return p.value&&(p.value=n(p.value)),p}),h}const V2=Array.prototype;function Zr(s,e,n,c,h,p){const f=rp(s),a=f!==s&&!Vn(s),w=f[e];if(w!==V2[e]){const E=w.apply(s,p);return a?Zs(E):E}let P=n;f!==s&&(a?P=function(E,F){return n.call(this,Zs(E),F,s)}:n.length>2&&(P=function(E,F){return n.call(this,E,F,s)}));const k=w.call(f,P,c);return a&&h?h(k):k}function Qy(s,e,n,c){const h=rp(s);let p=n;return h!==s&&(Vn(s)?n.length>3&&(p=function(f,a,w){return n.call(this,f,a,w,s)}):p=function(f,a,w){return n.call(this,f,Zs(a),w,s)}),h[e](p,...c)}function Em(s,e,n){const c=Mi(s);Hs(c,"iterate",gu);const h=c[e](...n);return(h===-1||h===!1)&&Ng(n[0])?(n[0]=Mi(n[0]),c[e](...n)):h}function Bh(s,e,n=[]){Yo(),Rg();const c=Mi(s)[e].apply(s,n);return Lg(),Jo(),c}const $2=Ig("__proto__,__v_isRef,__isVue"),Av=new Set(Object.getOwnPropertyNames(Symbol).filter(s=>s!=="arguments"&&s!=="caller").map(s=>Symbol[s]).filter(or));function U2(s){or(s)||(s=String(s));const e=Mi(this);return Hs(e,"has",s),e.hasOwnProperty(s)}class Ev{constructor(e=!1,n=!1){this._isReadonly=e,this._isShallow=n}get(e,n,c){if(n==="__v_skip")return e.__v_skip;const h=this._isReadonly,p=this._isShallow;if(n==="__v_isReactive")return!h;if(n==="__v_isReadonly")return h;if(n==="__v_isShallow")return p;if(n==="__v_raw")return c===(h?p?Q2:Fv:p?Lv:Rv).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(c)?e:void 0;const f=Ue(e);if(!h){let w;if(f&&(w=N2[n]))return w;if(n==="hasOwnProperty")return U2}const a=Reflect.get(e,n,Xs(e)?e:c);return(or(n)?Av.has(n):$2(n))||(h||Hs(e,"get",n),p)?a:Xs(a)?f&&Eg(n)?a:a.value:qi(a)?h?Bv(a):op(a):a}}class zv extends Ev{constructor(e=!1){super(!1,e)}set(e,n,c,h){let p=e[n];if(!this._isShallow){const w=Wa(p);if(!Vn(c)&&!Wa(c)&&(p=Mi(p),c=Mi(c)),!Ue(e)&&Xs(p)&&!Xs(c))return w?!1:(p.value=c,!0)}const f=Ue(e)&&Eg(n)?Number(n)<e.length:Pi(e,n),a=Reflect.set(e,n,c,Xs(e)?e:h);return e===Mi(h)&&(f?Go(c,p)&&to(e,"set",n,c):to(e,"add",n,c)),a}deleteProperty(e,n){const c=Pi(e,n);e[n];const h=Reflect.deleteProperty(e,n);return h&&c&&to(e,"delete",n,void 0),h}has(e,n){const c=Reflect.has(e,n);return(!or(n)||!Av.has(n))&&Hs(e,"has",n),c}ownKeys(e){return Hs(e,"iterate",Ue(e)?"length":Ha),Reflect.ownKeys(e)}}class H2 extends Ev{constructor(e=!1){super(!0,e)}set(e,n){return!0}deleteProperty(e,n){return!0}}const Z2=new zv,G2=new H2,q2=new zv(!0);const ig=s=>s,ef=s=>Reflect.getPrototypeOf(s);function W2(s,e,n){return function(...c){const h=this.__v_raw,p=Mi(h),f=sc(p),a=s==="entries"||s===Symbol.iterator&&f,w=s==="keys"&&f,P=h[s](...c),k=n?ig:e?sg:Zs;return!e&&Hs(p,"iterate",w?eg:Ha),{next(){const{value:E,done:F}=P.next();return F?{value:E,done:F}:{value:a?[k(E[0]),k(E[1])]:k(E),done:F}},[Symbol.iterator](){return this}}}}function sf(s){return function(...e){return s==="delete"?!1:s==="clear"?void 0:this}}function X2(s,e){const n={get(h){const p=this.__v_raw,f=Mi(p),a=Mi(h);s||(Go(h,a)&&Hs(f,"get",h),Hs(f,"get",a));const{has:w}=ef(f),P=e?ig:s?sg:Zs;if(w.call(f,h))return P(p.get(h));if(w.call(f,a))return P(p.get(a));p!==f&&p.get(h)},get size(){const h=this.__v_raw;return!s&&Hs(Mi(h),"iterate",Ha),Reflect.get(h,"size",h)},has(h){const p=this.__v_raw,f=Mi(p),a=Mi(h);return s||(Go(h,a)&&Hs(f,"has",h),Hs(f,"has",a)),h===a?p.has(h):p.has(h)||p.has(a)},forEach(h,p){const f=this,a=f.__v_raw,w=Mi(a),P=e?ig:s?sg:Zs;return!s&&Hs(w,"iterate",Ha),a.forEach((k,E)=>h.call(p,P(k),P(E),f))}};return Ks(n,s?{add:sf("add"),set:sf("set"),delete:sf("delete"),clear:sf("clear")}:{add(h){!e&&!Vn(h)&&!Wa(h)&&(h=Mi(h));const p=Mi(this);return ef(p).has.call(p,h)||(p.add(h),to(p,"add",h,h)),this},set(h,p){!e&&!Vn(p)&&!Wa(p)&&(p=Mi(p));const f=Mi(this),{has:a,get:w}=ef(f);let P=a.call(f,h);P||(h=Mi(h),P=a.call(f,h));const k=w.call(f,h);return f.set(h,p),P?Go(p,k)&&to(f,"set",h,p):to(f,"add",h,p),this},delete(h){const p=Mi(this),{has:f,get:a}=ef(p);let w=f.call(p,h);w||(h=Mi(h),w=f.call(p,h)),a&&a.call(p,h);const P=p.delete(h);return w&&to(p,"delete",h,void 0),P},clear(){const h=Mi(this),p=h.size!==0,f=h.clear();return p&&to(h,"clear",void 0,void 0),f}}),["keys","values","entries",Symbol.iterator].forEach(h=>{n[h]=W2(h,s,e)}),n}function Bg(s,e){const n=X2(s,e);return(c,h,p)=>h==="__v_isReactive"?!s:h==="__v_isReadonly"?s:h==="__v_raw"?c:Reflect.get(Pi(n,h)&&h in c?n:c,h,p)}const K2={get:Bg(!1,!1)},Y2={get:Bg(!1,!0)},J2={get:Bg(!0,!1)};const Rv=new WeakMap,Lv=new WeakMap,Fv=new WeakMap,Q2=new WeakMap;function tS(s){switch(s){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function eS(s){return s.__v_skip||!Object.isExtensible(s)?0:tS(M2(s))}function op(s){return Wa(s)?s:jg(s,!1,Z2,K2,Rv)}function Ov(s){return jg(s,!1,q2,Y2,Lv)}function Bv(s){return jg(s,!0,G2,J2,Fv)}function jg(s,e,n,c,h){if(!qi(s)||s.__v_raw&&!(e&&s.__v_isReactive))return s;const p=h.get(s);if(p)return p;const f=eS(s);if(f===0)return s;const a=new Proxy(s,f===2?c:n);return h.set(s,a),a}function nc(s){return Wa(s)?nc(s.__v_raw):!!(s&&s.__v_isReactive)}function Wa(s){return!!(s&&s.__v_isReadonly)}function Vn(s){return!!(s&&s.__v_isShallow)}function Ng(s){return s?!!s.__v_raw:!1}function Mi(s){const e=s&&s.__v_raw;return e?Mi(e):s}function iS(s){return!Pi(s,"__v_skip")&&Object.isExtensible(s)&&yv(s,"__v_skip",!0),s}const Zs=s=>qi(s)?op(s):s,sg=s=>qi(s)?Bv(s):s;function Xs(s){return s?s.__v_isRef===!0:!1}function sS(s){return jv(s,!1)}function nS(s){return jv(s,!0)}function jv(s,e){return Xs(s)?s:new rS(s,e)}class rS{constructor(e,n){this.dep=new Og,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?e:Mi(e),this._value=n?e:Zs(e),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(e){const n=this._rawValue,c=this.__v_isShallow||Vn(e)||Wa(e);e=c?e:Mi(e),Go(e,n)&&(this._rawValue=e,this._value=c?e:Zs(e),this.dep.trigger())}}function Za(s){return Xs(s)?s.value:s}const oS={get:(s,e,n)=>e==="__v_raw"?s:Za(Reflect.get(s,e,n)),set:(s,e,n,c)=>{const h=s[e];return Xs(h)&&!Xs(n)?(h.value=n,!0):Reflect.set(s,e,n,c)}};function Nv(s){return nc(s)?s:new Proxy(s,oS)}class aS{constructor(e,n,c){this.fn=e,this.setter=n,this._value=void 0,this.dep=new Og(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=mu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!n,this.isSSR=c}notify(){if(this.flags|=16,!(this.flags&8)&&Zi!==this)return Mv(this,!0),!0}get value(){const e=this.dep.track();return kv(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function lS(s,e,n=!1){let c,h;return Ye(s)?c=s:(c=s.get,h=s.set),new aS(c,h,n)}const nf={},Bf=new WeakMap;let Na;function cS(s,e=!1,n=Na){if(n){let c=Bf.get(n);c||Bf.set(n,c=[]),c.push(s)}}function hS(s,e,n=Vi){const{immediate:c,deep:h,once:p,scheduler:f,augmentJob:a,call:w}=n,P=At=>h?At:Vn(At)||h===!1||h===0?eo(At,1):eo(At);let k,E,F,R,J=!1,rt=!1;if(Xs(s)?(E=()=>s.value,J=Vn(s)):nc(s)?(E=()=>P(s),J=!0):Ue(s)?(rt=!0,J=s.some(At=>nc(At)||Vn(At)),E=()=>s.map(At=>{if(Xs(At))return At.value;if(nc(At))return P(At);if(Ye(At))return w?w(At,2):At()})):Ye(s)?e?E=w?()=>w(s,2):s:E=()=>{if(F){Yo();try{F()}finally{Jo()}}const At=Na;Na=k;try{return w?w(s,3,[R]):s(R)}finally{Na=At}}:E=wr,e&&h){const At=E,Vt=h===!0?1/0:h;E=()=>eo(At(),Vt)}const mt=O2(),xt=()=>{k.stop(),mt&&mt.active&&Ag(mt.effects,k)};if(p&&e){const At=e;e=(...Vt)=>{At(...Vt),xt()}}let Ct=rt?new Array(s.length).fill(nf):nf;const Lt=At=>{if(!(!(k.flags&1)||!k.dirty&&!At))if(e){const Vt=k.run();if(h||J||(rt?Vt.some((Yt,Gt)=>Go(Yt,Ct[Gt])):Go(Vt,Ct))){F&&F();const Yt=Na;Na=k;try{const Gt=[Vt,Ct===nf?void 0:rt&&Ct[0]===nf?[]:Ct,R];w?w(e,3,Gt):e(...Gt),Ct=Vt}finally{Na=Yt}}}else k.run()};return a&&a(Lt),k=new Sv(E),k.scheduler=f?()=>f(Lt,!1):Lt,R=At=>cS(At,!1,k),F=k.onStop=()=>{const At=Bf.get(k);if(At){if(w)w(At,4);else for(const Vt of At)Vt();Bf.delete(k)}},e?c?Lt(!0):Ct=k.run():f?f(Lt.bind(null,!0),!0):k.run(),xt.pause=k.pause.bind(k),xt.resume=k.resume.bind(k),xt.stop=xt,xt}function eo(s,e=1/0,n){if(e<=0||!qi(s)||s.__v_skip||(n=n||new Set,n.has(s)))return s;if(n.add(s),e--,Xs(s))eo(s.value,e,n);else if(Ue(s))for(let c=0;c<s.length;c++)eo(s[c],e,n);else if(ep(s)||sc(s))s.forEach(c=>{eo(c,e,n)});else if(_v(s)){for(const c in s)eo(s[c],e,n);for(const c of Object.getOwnPropertySymbols(s))Object.prototype.propertyIsEnumerable.call(s,c)&&eo(s[c],e,n)}return s}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Eu(s,e,n,c){try{return c?s(...c):s()}catch(h){ap(h,e,n)}}function Tr(s,e,n,c){if(Ye(s)){const h=Eu(s,e,n,c);return h&&mv(h)&&h.catch(p=>{ap(p,e,n)}),h}if(Ue(s)){const h=[];for(let p=0;p<s.length;p++)h.push(Tr(s[p],e,n,c));return h}}function ap(s,e,n,c=!0){const h=e?e.vnode:null,{errorHandler:p,throwUnhandledErrorInProduction:f}=e&&e.appContext.config||Vi;if(e){let a=e.parent;const w=e.proxy,P=`https://vuejs.org/error-reference/#runtime-${n}`;for(;a;){const k=a.ec;if(k){for(let E=0;E<k.length;E++)if(k[E](s,w,P)===!1)return}a=a.parent}if(p){Yo(),Eu(p,null,10,[s,w,P]),Jo();return}}uS(s,n,h,c,f)}function uS(s,e,n,c=!0,h=!1){if(h)throw s;console.error(s)}const hn=[];let xr=-1;const rc=[];let Bo=null,tc=0;const Vv=Promise.resolve();let jf=null;function $v(s){const e=jf||Vv;return s?e.then(this?s.bind(this):s):e}function dS(s){let e=xr+1,n=hn.length;for(;e<n;){const c=e+n>>>1,h=hn[c],p=_u(h);p<s||p===s&&h.flags&2?e=c+1:n=c}return e}function Vg(s){if(!(s.flags&1)){const e=_u(s),n=hn[hn.length-1];!n||!(s.flags&2)&&e>=_u(n)?hn.push(s):hn.splice(dS(e),0,s),s.flags|=1,Uv()}}function Uv(){jf||(jf=Vv.then(Zv))}function fS(s){Ue(s)?rc.push(...s):Bo&&s.id===-1?Bo.splice(tc+1,0,s):s.flags&1||(rc.push(s),s.flags|=1),Uv()}function tx(s,e,n=xr+1){for(;n<hn.length;n++){const c=hn[n];if(c&&c.flags&2){if(s&&c.id!==s.uid)continue;hn.splice(n,1),n--,c.flags&4&&(c.flags&=-2),c(),c.flags&4||(c.flags&=-2)}}}function Hv(s){if(rc.length){const e=[...new Set(rc)].sort((n,c)=>_u(n)-_u(c));if(rc.length=0,Bo){Bo.push(...e);return}for(Bo=e,tc=0;tc<Bo.length;tc++){const n=Bo[tc];n.flags&4&&(n.flags&=-2),n.flags&8||n(),n.flags&=-2}Bo=null,tc=0}}const _u=s=>s.id==null?s.flags&2?-1:1/0:s.id;function Zv(s){try{for(xr=0;xr<hn.length;xr++){const e=hn[xr];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Eu(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;xr<hn.length;xr++){const e=hn[xr];e&&(e.flags&=-2)}xr=-1,hn.length=0,Hv(),jf=null,(hn.length||rc.length)&&Zv()}}let js=null,Gv=null;function Nf(s){const e=js;return js=s,Gv=s&&s.type.__scopeId||null,e}function oo(s,e=js,n){if(!e||s._n)return s;const c=(...h)=>{c._d&&hx(-1);const p=Nf(e);let f;try{f=s(...h)}finally{Nf(p),c._d&&hx(1)}return f};return c._n=!0,c._c=!0,c._d=!0,c}function qh(s,e){if(js===null)return s;const n=up(js),c=s.dirs||(s.dirs=[]);for(let h=0;h<e.length;h++){let[p,f,a,w=Vi]=e[h];p&&(Ye(p)&&(p={mounted:p,updated:p}),p.deep&&eo(f),c.push({dir:p,instance:n,value:f,oldValue:void 0,arg:a,modifiers:w}))}return s}function Ra(s,e,n,c){const h=s.dirs,p=e&&e.dirs;for(let f=0;f<h.length;f++){const a=h[f];p&&(a.oldValue=p[f].value);let w=a.dir[c];w&&(Yo(),Tr(w,n,8,[s.el,a,s,e]),Jo())}}const pS=Symbol("_vte"),mS=s=>s.__isTeleport;function $g(s,e){s.shapeFlag&6&&s.component?(s.transition=e,$g(s.component.subTree,e)):s.shapeFlag&128?(s.ssContent.transition=e.clone(s.ssContent),s.ssFallback.transition=e.clone(s.ssFallback)):s.transition=e}/*! #__NO_SIDE_EFFECTS__ */function qv(s,e){return Ye(s)?Ks({name:s.name},e,{setup:s}):s}function Wv(s){s.ids=[s.ids[0]+s.ids[2]+++"-",0,0]}function Vf(s,e,n,c,h=!1){if(Ue(s)){s.forEach((J,rt)=>Vf(J,e&&(Ue(e)?e[rt]:e),n,c,h));return}if(oc(c)&&!h){c.shapeFlag&512&&c.type.__asyncResolved&&c.component.subTree.component&&Vf(s,e,n,c.component.subTree);return}const p=c.shapeFlag&4?up(c.component):c.el,f=h?null:p,{i:a,r:w}=s,P=e&&e.r,k=a.refs===Vi?a.refs={}:a.refs,E=a.setupState,F=Mi(E),R=E===Vi?()=>!1:J=>Pi(F,J);if(P!=null&&P!==w&&(Ss(P)?(k[P]=null,R(P)&&(E[P]=null)):Xs(P)&&(P.value=null)),Ye(w))Eu(w,a,12,[f,k]);else{const J=Ss(w),rt=Xs(w);if(J||rt){const mt=()=>{if(s.f){const xt=J?R(w)?E[w]:k[w]:w.value;h?Ue(xt)&&Ag(xt,p):Ue(xt)?xt.includes(p)||xt.push(p):J?(k[w]=[p],R(w)&&(E[w]=k[w])):(w.value=[p],s.k&&(k[s.k]=w.value))}else J?(k[w]=f,R(w)&&(E[w]=f)):rt&&(w.value=f,s.k&&(k[s.k]=f))};f?(mt.id=-1,kn(mt,n)):mt()}}}np().requestIdleCallback;np().cancelIdleCallback;const oc=s=>!!s.type.__asyncLoader,Xv=s=>s.type.__isKeepAlive;function gS(s,e){Kv(s,"a",e)}function _S(s,e){Kv(s,"da",e)}function Kv(s,e,n=qs){const c=s.__wdc||(s.__wdc=()=>{let h=n;for(;h;){if(h.isDeactivated)return;h=h.parent}return s()});if(lp(e,c,n),n){let h=n.parent;for(;h&&h.parent;)Xv(h.parent.vnode)&&yS(c,e,n,h),h=h.parent}}function yS(s,e,n,c){const h=lp(e,s,c,!0);Yv(()=>{Ag(c[e],h)},n)}function lp(s,e,n=qs,c=!1){if(n){const h=n[s]||(n[s]=[]),p=e.__weh||(e.__weh=(...f)=>{Yo();const a=zu(n),w=Tr(e,n,s,f);return a(),Jo(),w});return c?h.unshift(p):h.push(p),p}}const lo=s=>(e,n=qs)=>{(!bu||s==="sp")&&lp(s,(...c)=>e(...c),n)},xS=lo("bm"),bS=lo("m"),vS=lo("bu"),wS=lo("u"),SS=lo("bum"),Yv=lo("um"),TS=lo("sp"),MS=lo("rtg"),PS=lo("rtc");function CS(s,e=qs){lp("ec",s,e)}const kS="components";function ks(s,e){return DS(kS,s,!0,e)||s}const IS=Symbol.for("v-ndc");function DS(s,e,n=!0,c=!1){const h=js||qs;if(h){const p=h.type;{const a=_T(p,!1);if(a&&(a===e||a===$n(e)||a===sp($n(e))))return p}const f=ex(h[s]||p[s],e)||ex(h.appContext[s],e);return!f&&c?p:f}}function ex(s,e){return s&&(s[e]||s[$n(e)]||s[sp($n(e))])}function Ug(s,e,n,c){let h;const p=n,f=Ue(s);if(f||Ss(s)){const a=f&&nc(s);let w=!1;a&&(w=!Vn(s),s=rp(s)),h=new Array(s.length);for(let P=0,k=s.length;P<k;P++)h[P]=e(w?Zs(s[P]):s[P],P,void 0,p)}else if(typeof s=="number"){h=new Array(s);for(let a=0;a<s;a++)h[a]=e(a+1,a,void 0,p)}else if(qi(s))if(s[Symbol.iterator])h=Array.from(s,(a,w)=>e(a,w,void 0,p));else{const a=Object.keys(s);h=new Array(a.length);for(let w=0,P=a.length;w<P;w++){const k=a[w];h[w]=e(s[k],k,w,p)}}else h=[];return h}function nu(s,e,n={},c,h){if(js.ce||js.parent&&oc(js.parent)&&js.parent.ce)return e!=="default"&&(n.name=e),hi(),nr(Gs,null,[ki("slot",n,c)],64);let p=s[e];p&&p._c&&(p._d=!1),hi();const f=p&&Jv(p(n)),a=n.key||f&&f.key,w=nr(Gs,{key:(a&&!or(a)?a:`_${e}`)+""},f||[],f&&s._===1?64:-2);return p&&p._c&&(p._d=!0),w}function Jv(s){return s.some(e=>xu(e)?!(e.type===Wo||e.type===Gs&&!Jv(e.children)):!0)?s:null}const ng=s=>s?x0(s)?up(s):ng(s.parent):null,ru=Ks(Object.create(null),{$:s=>s,$el:s=>s.vnode.el,$data:s=>s.data,$props:s=>s.props,$attrs:s=>s.attrs,$slots:s=>s.slots,$refs:s=>s.refs,$parent:s=>ng(s.parent),$root:s=>ng(s.root),$host:s=>s.ce,$emit:s=>s.emit,$options:s=>t0(s),$forceUpdate:s=>s.f||(s.f=()=>{Vg(s.update)}),$nextTick:s=>s.n||(s.n=$v.bind(s.proxy)),$watch:s=>YS.bind(s)}),zm=(s,e)=>s!==Vi&&!s.__isScriptSetup&&Pi(s,e),AS={get({_:s},e){if(e==="__v_skip")return!0;const{ctx:n,setupState:c,data:h,props:p,accessCache:f,type:a,appContext:w}=s;let P;if(e[0]!=="$"){const R=f[e];if(R!==void 0)switch(R){case 1:return c[e];case 2:return h[e];case 4:return n[e];case 3:return p[e]}else{if(zm(c,e))return f[e]=1,c[e];if(h!==Vi&&Pi(h,e))return f[e]=2,h[e];if((P=s.propsOptions[0])&&Pi(P,e))return f[e]=3,p[e];if(n!==Vi&&Pi(n,e))return f[e]=4,n[e];rg&&(f[e]=0)}}const k=ru[e];let E,F;if(k)return e==="$attrs"&&Hs(s.attrs,"get",""),k(s);if((E=a.__cssModules)&&(E=E[e]))return E;if(n!==Vi&&Pi(n,e))return f[e]=4,n[e];if(F=w.config.globalProperties,Pi(F,e))return F[e]},set({_:s},e,n){const{data:c,setupState:h,ctx:p}=s;return zm(h,e)?(h[e]=n,!0):c!==Vi&&Pi(c,e)?(c[e]=n,!0):Pi(s.props,e)||e[0]==="$"&&e.slice(1)in s?!1:(p[e]=n,!0)},has({_:{data:s,setupState:e,accessCache:n,ctx:c,appContext:h,propsOptions:p}},f){let a;return!!n[f]||s!==Vi&&Pi(s,f)||zm(e,f)||(a=p[0])&&Pi(a,f)||Pi(c,f)||Pi(ru,f)||Pi(h.config.globalProperties,f)},defineProperty(s,e,n){return n.get!=null?s._.accessCache[e]=0:Pi(n,"value")&&this.set(s,e,n.value,null),Reflect.defineProperty(s,e,n)}};function ix(s){return Ue(s)?s.reduce((e,n)=>(e[n]=null,e),{}):s}let rg=!0;function ES(s){const e=t0(s),n=s.proxy,c=s.ctx;rg=!1,e.beforeCreate&&sx(e.beforeCreate,s,"bc");const{data:h,computed:p,methods:f,watch:a,provide:w,inject:P,created:k,beforeMount:E,mounted:F,beforeUpdate:R,updated:J,activated:rt,deactivated:mt,beforeDestroy:xt,beforeUnmount:Ct,destroyed:Lt,unmounted:At,render:Vt,renderTracked:Yt,renderTriggered:Gt,errorCaptured:ie,serverPrefetch:be,expose:ze,inheritAttrs:Me,components:Fe,directives:Ve,filters:He}=e;if(P&&zS(P,c,null),f)for(const De in f){const Oe=f[De];Ye(Oe)&&(c[De]=Oe.bind(n))}if(h){const De=h.call(n,n);qi(De)&&(s.data=op(De))}if(rg=!0,p)for(const De in p){const Oe=p[De],qe=Ye(Oe)?Oe.bind(n,n):Ye(Oe.get)?Oe.get.bind(n,n):wr,zi=!Ye(Oe)&&Ye(Oe.set)?Oe.set.bind(n):wr,mi=er({get:qe,set:zi});Object.defineProperty(c,De,{enumerable:!0,configurable:!0,get:()=>mi.value,set:ci=>mi.value=ci})}if(a)for(const De in a)Qv(a[De],c,n,De);if(w){const De=Ye(w)?w.call(n):w;Reflect.ownKeys(De).forEach(Oe=>{wf(Oe,De[Oe])})}k&&sx(k,s,"c");function xe(De,Oe){Ue(Oe)?Oe.forEach(qe=>De(qe.bind(n))):Oe&&De(Oe.bind(n))}if(xe(xS,E),xe(bS,F),xe(vS,R),xe(wS,J),xe(gS,rt),xe(_S,mt),xe(CS,ie),xe(PS,Yt),xe(MS,Gt),xe(SS,Ct),xe(Yv,At),xe(TS,be),Ue(ze))if(ze.length){const De=s.exposed||(s.exposed={});ze.forEach(Oe=>{Object.defineProperty(De,Oe,{get:()=>n[Oe],set:qe=>n[Oe]=qe})})}else s.exposed||(s.exposed={});Vt&&s.render===wr&&(s.render=Vt),Me!=null&&(s.inheritAttrs=Me),Fe&&(s.components=Fe),Ve&&(s.directives=Ve),be&&Wv(s)}function zS(s,e,n=wr){Ue(s)&&(s=og(s));for(const c in s){const h=s[c];let p;qi(h)?"default"in h?p=ao(h.from||c,h.default,!0):p=ao(h.from||c):p=ao(h),Xs(p)?Object.defineProperty(e,c,{enumerable:!0,configurable:!0,get:()=>p.value,set:f=>p.value=f}):e[c]=p}}function sx(s,e,n){Tr(Ue(s)?s.map(c=>c.bind(e.proxy)):s.bind(e.proxy),e,n)}function Qv(s,e,n,c){let h=c.includes(".")?p0(n,c):()=>n[c];if(Ss(s)){const p=e[s];Ye(p)&&Sf(h,p)}else if(Ye(s))Sf(h,s.bind(n));else if(qi(s))if(Ue(s))s.forEach(p=>Qv(p,e,n,c));else{const p=Ye(s.handler)?s.handler.bind(n):e[s.handler];Ye(p)&&Sf(h,p,s)}}function t0(s){const e=s.type,{mixins:n,extends:c}=e,{mixins:h,optionsCache:p,config:{optionMergeStrategies:f}}=s.appContext,a=p.get(e);let w;return a?w=a:!h.length&&!n&&!c?w=e:(w={},h.length&&h.forEach(P=>$f(w,P,f,!0)),$f(w,e,f)),qi(e)&&p.set(e,w),w}function $f(s,e,n,c=!1){const{mixins:h,extends:p}=e;p&&$f(s,p,n,!0),h&&h.forEach(f=>$f(s,f,n,!0));for(const f in e)if(!(c&&f==="expose")){const a=RS[f]||n&&n[f];s[f]=a?a(s[f],e[f]):e[f]}return s}const RS={data:nx,props:rx,emits:rx,methods:Wh,computed:Wh,beforeCreate:cn,created:cn,beforeMount:cn,mounted:cn,beforeUpdate:cn,updated:cn,beforeDestroy:cn,beforeUnmount:cn,destroyed:cn,unmounted:cn,activated:cn,deactivated:cn,errorCaptured:cn,serverPrefetch:cn,components:Wh,directives:Wh,watch:FS,provide:nx,inject:LS};function nx(s,e){return e?s?function(){return Ks(Ye(s)?s.call(this,this):s,Ye(e)?e.call(this,this):e)}:e:s}function LS(s,e){return Wh(og(s),og(e))}function og(s){if(Ue(s)){const e={};for(let n=0;n<s.length;n++)e[s[n]]=s[n];return e}return s}function cn(s,e){return s?[...new Set([].concat(s,e))]:e}function Wh(s,e){return s?Ks(Object.create(null),s,e):e}function rx(s,e){return s?Ue(s)&&Ue(e)?[...new Set([...s,...e])]:Ks(Object.create(null),ix(s),ix(e??{})):e}function FS(s,e){if(!s)return e;if(!e)return s;const n=Ks(Object.create(null),s);for(const c in e)n[c]=cn(s[c],e[c]);return n}function e0(){return{app:null,config:{isNativeTag:S2,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let OS=0;function BS(s,e){return function(c,h=null){Ye(c)||(c=Ks({},c)),h!=null&&!qi(h)&&(h=null);const p=e0(),f=new WeakSet,a=[];let w=!1;const P=p.app={_uid:OS++,_component:c,_props:h,_container:null,_context:p,_instance:null,version:xT,get config(){return p.config},set config(k){},use(k,...E){return f.has(k)||(k&&Ye(k.install)?(f.add(k),k.install(P,...E)):Ye(k)&&(f.add(k),k(P,...E))),P},mixin(k){return p.mixins.includes(k)||p.mixins.push(k),P},component(k,E){return E?(p.components[k]=E,P):p.components[k]},directive(k,E){return E?(p.directives[k]=E,P):p.directives[k]},mount(k,E,F){if(!w){const R=P._ceVNode||ki(c,h);return R.appContext=p,F===!0?F="svg":F===!1&&(F=void 0),s(R,k,F),w=!0,P._container=k,k.__vue_app__=P,up(R.component)}},onUnmount(k){a.push(k)},unmount(){w&&(Tr(a,P._instance,16),s(null,P._container),delete P._container.__vue_app__)},provide(k,E){return p.provides[k]=E,P},runWithContext(k){const E=ac;ac=P;try{return k()}finally{ac=E}}};return P}}let ac=null;function wf(s,e){if(qs){let n=qs.provides;const c=qs.parent&&qs.parent.provides;c===n&&(n=qs.provides=Object.create(c)),n[s]=e}}function ao(s,e,n=!1){const c=qs||js;if(c||ac){const h=ac?ac._context.provides:c?c.parent==null?c.vnode.appContext&&c.vnode.appContext.provides:c.parent.provides:void 0;if(h&&s in h)return h[s];if(arguments.length>1)return n&&Ye(e)?e.call(c&&c.proxy):e}}const i0={},s0=()=>Object.create(i0),n0=s=>Object.getPrototypeOf(s)===i0;function jS(s,e,n,c=!1){const h={},p=s0();s.propsDefaults=Object.create(null),r0(s,e,h,p);for(const f in s.propsOptions[0])f in h||(h[f]=void 0);n?s.props=c?h:Ov(h):s.type.props?s.props=h:s.props=p,s.attrs=p}function NS(s,e,n,c){const{props:h,attrs:p,vnode:{patchFlag:f}}=s,a=Mi(h),[w]=s.propsOptions;let P=!1;if((c||f>0)&&!(f&16)){if(f&8){const k=s.vnode.dynamicProps;for(let E=0;E<k.length;E++){let F=k[E];if(cp(s.emitsOptions,F))continue;const R=e[F];if(w)if(Pi(p,F))R!==p[F]&&(p[F]=R,P=!0);else{const J=$n(F);h[J]=ag(w,a,J,R,s,!1)}else R!==p[F]&&(p[F]=R,P=!0)}}}else{r0(s,e,h,p)&&(P=!0);let k;for(const E in a)(!e||!Pi(e,E)&&((k=Ya(E))===E||!Pi(e,k)))&&(w?n&&(n[E]!==void 0||n[k]!==void 0)&&(h[E]=ag(w,a,E,void 0,s,!0)):delete h[E]);if(p!==a)for(const E in p)(!e||!Pi(e,E))&&(delete p[E],P=!0)}P&&to(s.attrs,"set","")}function r0(s,e,n,c){const[h,p]=s.propsOptions;let f=!1,a;if(e)for(let w in e){if(eu(w))continue;const P=e[w];let k;h&&Pi(h,k=$n(w))?!p||!p.includes(k)?n[k]=P:(a||(a={}))[k]=P:cp(s.emitsOptions,w)||(!(w in c)||P!==c[w])&&(c[w]=P,f=!0)}if(p){const w=Mi(n),P=a||Vi;for(let k=0;k<p.length;k++){const E=p[k];n[E]=ag(h,w,E,P[E],s,!Pi(P,E))}}return f}function ag(s,e,n,c,h,p){const f=s[n];if(f!=null){const a=Pi(f,"default");if(a&&c===void 0){const w=f.default;if(f.type!==Function&&!f.skipFactory&&Ye(w)){const{propsDefaults:P}=h;if(n in P)c=P[n];else{const k=zu(h);c=P[n]=w.call(null,e),k()}}else c=w;h.ce&&h.ce._setProp(n,c)}f[0]&&(p&&!a?c=!1:f[1]&&(c===""||c===Ya(n))&&(c=!0))}return c}const VS=new WeakMap;function o0(s,e,n=!1){const c=n?VS:e.propsCache,h=c.get(s);if(h)return h;const p=s.props,f={},a=[];let w=!1;if(!Ye(s)){const k=E=>{w=!0;const[F,R]=o0(E,e,!0);Ks(f,F),R&&a.push(...R)};!n&&e.mixins.length&&e.mixins.forEach(k),s.extends&&k(s.extends),s.mixins&&s.mixins.forEach(k)}if(!p&&!w)return qi(s)&&c.set(s,ic),ic;if(Ue(p))for(let k=0;k<p.length;k++){const E=$n(p[k]);ox(E)&&(f[E]=Vi)}else if(p)for(const k in p){const E=$n(k);if(ox(E)){const F=p[k],R=f[E]=Ue(F)||Ye(F)?{type:F}:Ks({},F),J=R.type;let rt=!1,mt=!0;if(Ue(J))for(let xt=0;xt<J.length;++xt){const Ct=J[xt],Lt=Ye(Ct)&&Ct.name;if(Lt==="Boolean"){rt=!0;break}else Lt==="String"&&(mt=!1)}else rt=Ye(J)&&J.name==="Boolean";R[0]=rt,R[1]=mt,(rt||Pi(R,"default"))&&a.push(E)}}const P=[f,a];return qi(s)&&c.set(s,P),P}function ox(s){return s[0]!=="$"&&!eu(s)}const a0=s=>s[0]==="_"||s==="$stable",Hg=s=>Ue(s)?s.map(vr):[vr(s)],$S=(s,e,n)=>{if(e._n)return e;const c=oo((...h)=>Hg(e(...h)),n);return c._c=!1,c},l0=(s,e,n)=>{const c=s._ctx;for(const h in s){if(a0(h))continue;const p=s[h];if(Ye(p))e[h]=$S(h,p,c);else if(p!=null){const f=Hg(p);e[h]=()=>f}}},c0=(s,e)=>{const n=Hg(e);s.slots.default=()=>n},h0=(s,e,n)=>{for(const c in e)(n||c!=="_")&&(s[c]=e[c])},US=(s,e,n)=>{const c=s.slots=s0();if(s.vnode.shapeFlag&32){const h=e._;h?(h0(c,e,n),n&&yv(c,"_",h,!0)):l0(e,c)}else e&&c0(s,e)},HS=(s,e,n)=>{const{vnode:c,slots:h}=s;let p=!0,f=Vi;if(c.shapeFlag&32){const a=e._;a?n&&a===1?p=!1:h0(h,e,n):(p=!e.$stable,l0(e,h)),f=e}else e&&(c0(s,e),f={default:1});if(p)for(const a in h)!a0(a)&&f[a]==null&&delete h[a]},kn=nT;function ZS(s){return GS(s)}function GS(s,e){const n=np();n.__VUE__=!0;const{insert:c,remove:h,patchProp:p,createElement:f,createText:a,createComment:w,setText:P,setElementText:k,parentNode:E,nextSibling:F,setScopeId:R=wr,insertStaticContent:J}=s,rt=(N,O,K,nt=null,et=null,ht=null,Tt=void 0,Et=null,jt=!!O.dynamicChildren)=>{if(N===O)return;N&&!jh(N,O)&&(nt=Jt(N),ci(N,et,ht,!0),N=null),O.patchFlag===-2&&(jt=!1,O.dynamicChildren=null);const{type:Ft,ref:se,shapeFlag:re}=O;switch(Ft){case hp:mt(N,O,K,nt);break;case Wo:xt(N,O,K,nt);break;case Tf:N==null&&Ct(O,K,nt,Tt);break;case Gs:Fe(N,O,K,nt,et,ht,Tt,Et,jt);break;default:re&1?Vt(N,O,K,nt,et,ht,Tt,Et,jt):re&6?Ve(N,O,K,nt,et,ht,Tt,Et,jt):(re&64||re&128)&&Ft.process(N,O,K,nt,et,ht,Tt,Et,jt,Pt)}se!=null&&et&&Vf(se,N&&N.ref,ht,O||N,!O)},mt=(N,O,K,nt)=>{if(N==null)c(O.el=a(O.children),K,nt);else{const et=O.el=N.el;O.children!==N.children&&P(et,O.children)}},xt=(N,O,K,nt)=>{N==null?c(O.el=w(O.children||""),K,nt):O.el=N.el},Ct=(N,O,K,nt)=>{[N.el,N.anchor]=J(N.children,O,K,nt,N.el,N.anchor)},Lt=({el:N,anchor:O},K,nt)=>{let et;for(;N&&N!==O;)et=F(N),c(N,K,nt),N=et;c(O,K,nt)},At=({el:N,anchor:O})=>{let K;for(;N&&N!==O;)K=F(N),h(N),N=K;h(O)},Vt=(N,O,K,nt,et,ht,Tt,Et,jt)=>{O.type==="svg"?Tt="svg":O.type==="math"&&(Tt="mathml"),N==null?Yt(O,K,nt,et,ht,Tt,Et,jt):be(N,O,et,ht,Tt,Et,jt)},Yt=(N,O,K,nt,et,ht,Tt,Et)=>{let jt,Ft;const{props:se,shapeFlag:re,transition:ve,dirs:Te}=N;if(jt=N.el=f(N.type,ht,se&&se.is,se),re&8?k(jt,N.children):re&16&&ie(N.children,jt,null,nt,et,Rm(N,ht),Tt,Et),Te&&Ra(N,null,nt,"created"),Gt(jt,N,N.scopeId,Tt,nt),se){for(const Je in se)Je!=="value"&&!eu(Je)&&p(jt,Je,null,se[Je],ht,nt);"value"in se&&p(jt,"value",null,se.value,ht),(Ft=se.onVnodeBeforeMount)&&_r(Ft,nt,N)}Te&&Ra(N,null,nt,"beforeMount");const Ne=qS(et,ve);Ne&&ve.beforeEnter(jt),c(jt,O,K),((Ft=se&&se.onVnodeMounted)||Ne||Te)&&kn(()=>{Ft&&_r(Ft,nt,N),Ne&&ve.enter(jt),Te&&Ra(N,null,nt,"mounted")},et)},Gt=(N,O,K,nt,et)=>{if(K&&R(N,K),nt)for(let ht=0;ht<nt.length;ht++)R(N,nt[ht]);if(et){let ht=et.subTree;if(O===ht||g0(ht.type)&&(ht.ssContent===O||ht.ssFallback===O)){const Tt=et.vnode;Gt(N,Tt,Tt.scopeId,Tt.slotScopeIds,et.parent)}}},ie=(N,O,K,nt,et,ht,Tt,Et,jt=0)=>{for(let Ft=jt;Ft<N.length;Ft++){const se=N[Ft]=Et?jo(N[Ft]):vr(N[Ft]);rt(null,se,O,K,nt,et,ht,Tt,Et)}},be=(N,O,K,nt,et,ht,Tt)=>{const Et=O.el=N.el;let{patchFlag:jt,dynamicChildren:Ft,dirs:se}=O;jt|=N.patchFlag&16;const re=N.props||Vi,ve=O.props||Vi;let Te;if(K&&La(K,!1),(Te=ve.onVnodeBeforeUpdate)&&_r(Te,K,O,N),se&&Ra(O,N,K,"beforeUpdate"),K&&La(K,!0),(re.innerHTML&&ve.innerHTML==null||re.textContent&&ve.textContent==null)&&k(Et,""),Ft?ze(N.dynamicChildren,Ft,Et,K,nt,Rm(O,et),ht):Tt||Oe(N,O,Et,null,K,nt,Rm(O,et),ht,!1),jt>0){if(jt&16)Me(Et,re,ve,K,et);else if(jt&2&&re.class!==ve.class&&p(Et,"class",null,ve.class,et),jt&4&&p(Et,"style",re.style,ve.style,et),jt&8){const Ne=O.dynamicProps;for(let Je=0;Je<Ne.length;Je++){const $e=Ne[Je],_i=re[$e],fi=ve[$e];(fi!==_i||$e==="value")&&p(Et,$e,_i,fi,et,K)}}jt&1&&N.children!==O.children&&k(Et,O.children)}else!Tt&&Ft==null&&Me(Et,re,ve,K,et);((Te=ve.onVnodeUpdated)||se)&&kn(()=>{Te&&_r(Te,K,O,N),se&&Ra(O,N,K,"updated")},nt)},ze=(N,O,K,nt,et,ht,Tt)=>{for(let Et=0;Et<O.length;Et++){const jt=N[Et],Ft=O[Et],se=jt.el&&(jt.type===Gs||!jh(jt,Ft)||jt.shapeFlag&70)?E(jt.el):K;rt(jt,Ft,se,null,nt,et,ht,Tt,!0)}},Me=(N,O,K,nt,et)=>{if(O!==K){if(O!==Vi)for(const ht in O)!eu(ht)&&!(ht in K)&&p(N,ht,O[ht],null,et,nt);for(const ht in K){if(eu(ht))continue;const Tt=K[ht],Et=O[ht];Tt!==Et&&ht!=="value"&&p(N,ht,Et,Tt,et,nt)}"value"in K&&p(N,"value",O.value,K.value,et)}},Fe=(N,O,K,nt,et,ht,Tt,Et,jt)=>{const Ft=O.el=N?N.el:a(""),se=O.anchor=N?N.anchor:a("");let{patchFlag:re,dynamicChildren:ve,slotScopeIds:Te}=O;Te&&(Et=Et?Et.concat(Te):Te),N==null?(c(Ft,K,nt),c(se,K,nt),ie(O.children||[],K,se,et,ht,Tt,Et,jt)):re>0&&re&64&&ve&&N.dynamicChildren?(ze(N.dynamicChildren,ve,K,et,ht,Tt,Et),(O.key!=null||et&&O===et.subTree)&&u0(N,O,!0)):Oe(N,O,K,se,et,ht,Tt,Et,jt)},Ve=(N,O,K,nt,et,ht,Tt,Et,jt)=>{O.slotScopeIds=Et,N==null?O.shapeFlag&512?et.ctx.activate(O,K,nt,Tt,jt):He(O,K,nt,et,ht,Tt,jt):je(N,O,jt)},He=(N,O,K,nt,et,ht,Tt)=>{const Et=N.component=dT(N,nt,et);if(Xv(N)&&(Et.ctx.renderer=Pt),fT(Et,!1,Tt),Et.asyncDep){if(et&&et.registerDep(Et,xe,Tt),!N.el){const jt=Et.subTree=ki(Wo);xt(null,jt,O,K)}}else xe(Et,N,O,K,et,ht,Tt)},je=(N,O,K)=>{const nt=O.component=N.component;if(iT(N,O,K))if(nt.asyncDep&&!nt.asyncResolved){De(nt,O,K);return}else nt.next=O,nt.update();else O.el=N.el,nt.vnode=O},xe=(N,O,K,nt,et,ht,Tt)=>{const Et=()=>{if(N.isMounted){let{next:re,bu:ve,u:Te,parent:Ne,vnode:Je}=N;{const Qi=d0(N);if(Qi){re&&(re.el=Je.el,De(N,re,Tt)),Qi.asyncDep.then(()=>{N.isUnmounted||Et()});return}}let $e=re,_i;La(N,!1),re?(re.el=Je.el,De(N,re,Tt)):re=Je,ve&&vf(ve),(_i=re.props&&re.props.onVnodeBeforeUpdate)&&_r(_i,Ne,re,Je),La(N,!0);const fi=lx(N),ns=N.subTree;N.subTree=fi,rt(ns,fi,E(ns.el),Jt(ns),N,et,ht),re.el=fi.el,$e===null&&sT(N,fi.el),Te&&kn(Te,et),(_i=re.props&&re.props.onVnodeUpdated)&&kn(()=>_r(_i,Ne,re,Je),et)}else{let re;const{el:ve,props:Te}=O,{bm:Ne,m:Je,parent:$e,root:_i,type:fi}=N,ns=oc(O);La(N,!1),Ne&&vf(Ne),!ns&&(re=Te&&Te.onVnodeBeforeMount)&&_r(re,$e,O),La(N,!0);{_i.ce&&_i.ce._injectChildStyle(fi);const Qi=N.subTree=lx(N);rt(null,Qi,K,nt,N,et,ht),O.el=Qi.el}if(Je&&kn(Je,et),!ns&&(re=Te&&Te.onVnodeMounted)){const Qi=O;kn(()=>_r(re,$e,Qi),et)}(O.shapeFlag&256||$e&&oc($e.vnode)&&$e.vnode.shapeFlag&256)&&N.a&&kn(N.a,et),N.isMounted=!0,O=K=nt=null}};N.scope.on();const jt=N.effect=new Sv(Et);N.scope.off();const Ft=N.update=jt.run.bind(jt),se=N.job=jt.runIfDirty.bind(jt);se.i=N,se.id=N.uid,jt.scheduler=()=>Vg(se),La(N,!0),Ft()},De=(N,O,K)=>{O.component=N;const nt=N.vnode.props;N.vnode=O,N.next=null,NS(N,O.props,nt,K),HS(N,O.children,K),Yo(),tx(N),Jo()},Oe=(N,O,K,nt,et,ht,Tt,Et,jt=!1)=>{const Ft=N&&N.children,se=N?N.shapeFlag:0,re=O.children,{patchFlag:ve,shapeFlag:Te}=O;if(ve>0){if(ve&128){zi(Ft,re,K,nt,et,ht,Tt,Et,jt);return}else if(ve&256){qe(Ft,re,K,nt,et,ht,Tt,Et,jt);return}}Te&8?(se&16&&ii(Ft,et,ht),re!==Ft&&k(K,re)):se&16?Te&16?zi(Ft,re,K,nt,et,ht,Tt,Et,jt):ii(Ft,et,ht,!0):(se&8&&k(K,""),Te&16&&ie(re,K,nt,et,ht,Tt,Et,jt))},qe=(N,O,K,nt,et,ht,Tt,Et,jt)=>{N=N||ic,O=O||ic;const Ft=N.length,se=O.length,re=Math.min(Ft,se);let ve;for(ve=0;ve<re;ve++){const Te=O[ve]=jt?jo(O[ve]):vr(O[ve]);rt(N[ve],Te,K,null,et,ht,Tt,Et,jt)}Ft>se?ii(N,et,ht,!0,!1,re):ie(O,K,nt,et,ht,Tt,Et,jt,re)},zi=(N,O,K,nt,et,ht,Tt,Et,jt)=>{let Ft=0;const se=O.length;let re=N.length-1,ve=se-1;for(;Ft<=re&&Ft<=ve;){const Te=N[Ft],Ne=O[Ft]=jt?jo(O[Ft]):vr(O[Ft]);if(jh(Te,Ne))rt(Te,Ne,K,null,et,ht,Tt,Et,jt);else break;Ft++}for(;Ft<=re&&Ft<=ve;){const Te=N[re],Ne=O[ve]=jt?jo(O[ve]):vr(O[ve]);if(jh(Te,Ne))rt(Te,Ne,K,null,et,ht,Tt,Et,jt);else break;re--,ve--}if(Ft>re){if(Ft<=ve){const Te=ve+1,Ne=Te<se?O[Te].el:nt;for(;Ft<=ve;)rt(null,O[Ft]=jt?jo(O[Ft]):vr(O[Ft]),K,Ne,et,ht,Tt,Et,jt),Ft++}}else if(Ft>ve)for(;Ft<=re;)ci(N[Ft],et,ht,!0),Ft++;else{const Te=Ft,Ne=Ft,Je=new Map;for(Ft=Ne;Ft<=ve;Ft++){const st=O[Ft]=jt?jo(O[Ft]):vr(O[Ft]);st.key!=null&&Je.set(st.key,Ft)}let $e,_i=0;const fi=ve-Ne+1;let ns=!1,Qi=0;const Js=new Array(fi);for(Ft=0;Ft<fi;Ft++)Js[Ft]=0;for(Ft=Te;Ft<=re;Ft++){const st=N[Ft];if(_i>=fi){ci(st,et,ht,!0);continue}let G;if(st.key!=null)G=Je.get(st.key);else for($e=Ne;$e<=ve;$e++)if(Js[$e-Ne]===0&&jh(st,O[$e])){G=$e;break}G===void 0?ci(st,et,ht,!0):(Js[G-Ne]=Ft+1,G>=Qi?Qi=G:ns=!0,rt(st,O[G],K,null,et,ht,Tt,Et,jt),_i++)}const Qs=ns?WS(Js):ic;for($e=Qs.length-1,Ft=fi-1;Ft>=0;Ft--){const st=Ne+Ft,G=O[st],Y=st+1<se?O[st+1].el:nt;Js[Ft]===0?rt(null,G,K,Y,et,ht,Tt,Et,jt):ns&&($e<0||Ft!==Qs[$e]?mi(G,K,Y,2):$e--)}}},mi=(N,O,K,nt,et=null)=>{const{el:ht,type:Tt,transition:Et,children:jt,shapeFlag:Ft}=N;if(Ft&6){mi(N.component.subTree,O,K,nt);return}if(Ft&128){N.suspense.move(O,K,nt);return}if(Ft&64){Tt.move(N,O,K,Pt);return}if(Tt===Gs){c(ht,O,K);for(let re=0;re<jt.length;re++)mi(jt[re],O,K,nt);c(N.anchor,O,K);return}if(Tt===Tf){Lt(N,O,K);return}if(nt!==2&&Ft&1&&Et)if(nt===0)Et.beforeEnter(ht),c(ht,O,K),kn(()=>Et.enter(ht),et);else{const{leave:re,delayLeave:ve,afterLeave:Te}=Et,Ne=()=>c(ht,O,K),Je=()=>{re(ht,()=>{Ne(),Te&&Te()})};ve?ve(ht,Ne,Je):Je()}else c(ht,O,K)},ci=(N,O,K,nt=!1,et=!1)=>{const{type:ht,props:Tt,ref:Et,children:jt,dynamicChildren:Ft,shapeFlag:se,patchFlag:re,dirs:ve,cacheIndex:Te}=N;if(re===-2&&(et=!1),Et!=null&&Vf(Et,null,K,N,!0),Te!=null&&(O.renderCache[Te]=void 0),se&256){O.ctx.deactivate(N);return}const Ne=se&1&&ve,Je=!oc(N);let $e;if(Je&&($e=Tt&&Tt.onVnodeBeforeUnmount)&&_r($e,O,N),se&6)ai(N.component,K,nt);else{if(se&128){N.suspense.unmount(K,nt);return}Ne&&Ra(N,null,O,"beforeUnmount"),se&64?N.type.remove(N,O,K,Pt,nt):Ft&&!Ft.hasOnce&&(ht!==Gs||re>0&&re&64)?ii(Ft,O,K,!1,!0):(ht===Gs&&re&384||!et&&se&16)&&ii(jt,O,K),nt&&Ii(N)}(Je&&($e=Tt&&Tt.onVnodeUnmounted)||Ne)&&kn(()=>{$e&&_r($e,O,N),Ne&&Ra(N,null,O,"unmounted")},K)},Ii=N=>{const{type:O,el:K,anchor:nt,transition:et}=N;if(O===Gs){Ce(K,nt);return}if(O===Tf){At(N);return}const ht=()=>{h(K),et&&!et.persisted&&et.afterLeave&&et.afterLeave()};if(N.shapeFlag&1&&et&&!et.persisted){const{leave:Tt,delayLeave:Et}=et,jt=()=>Tt(K,ht);Et?Et(N.el,ht,jt):jt()}else ht()},Ce=(N,O)=>{let K;for(;N!==O;)K=F(N),h(N),N=K;h(O)},ai=(N,O,K)=>{const{bum:nt,scope:et,job:ht,subTree:Tt,um:Et,m:jt,a:Ft}=N;ax(jt),ax(Ft),nt&&vf(nt),et.stop(),ht&&(ht.flags|=8,ci(Tt,N,O,K)),Et&&kn(Et,O),kn(()=>{N.isUnmounted=!0},O),O&&O.pendingBranch&&!O.isUnmounted&&N.asyncDep&&!N.asyncResolved&&N.suspenseId===O.pendingId&&(O.deps--,O.deps===0&&O.resolve())},ii=(N,O,K,nt=!1,et=!1,ht=0)=>{for(let Tt=ht;Tt<N.length;Tt++)ci(N[Tt],O,K,nt,et)},Jt=N=>{if(N.shapeFlag&6)return Jt(N.component.subTree);if(N.shapeFlag&128)return N.suspense.next();const O=F(N.anchor||N.el),K=O&&O[pS];return K?F(K):O};let me=!1;const ue=(N,O,K)=>{N==null?O._vnode&&ci(O._vnode,null,null,!0):rt(O._vnode||null,N,O,null,null,null,K),O._vnode=N,me||(me=!0,tx(),Hv(),me=!1)},Pt={p:rt,um:ci,m:mi,r:Ii,mt:He,mc:ie,pc:Oe,pbc:ze,n:Jt,o:s};return{render:ue,hydrate:void 0,createApp:BS(ue)}}function Rm({type:s,props:e},n){return n==="svg"&&s==="foreignObject"||n==="mathml"&&s==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:n}function La({effect:s,job:e},n){n?(s.flags|=32,e.flags|=4):(s.flags&=-33,e.flags&=-5)}function qS(s,e){return(!s||s&&!s.pendingBranch)&&e&&!e.persisted}function u0(s,e,n=!1){const c=s.children,h=e.children;if(Ue(c)&&Ue(h))for(let p=0;p<c.length;p++){const f=c[p];let a=h[p];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=h[p]=jo(h[p]),a.el=f.el),!n&&a.patchFlag!==-2&&u0(f,a)),a.type===hp&&(a.el=f.el)}}function WS(s){const e=s.slice(),n=[0];let c,h,p,f,a;const w=s.length;for(c=0;c<w;c++){const P=s[c];if(P!==0){if(h=n[n.length-1],s[h]<P){e[c]=h,n.push(c);continue}for(p=0,f=n.length-1;p<f;)a=p+f>>1,s[n[a]]<P?p=a+1:f=a;P<s[n[p]]&&(p>0&&(e[c]=n[p-1]),n[p]=c)}}for(p=n.length,f=n[p-1];p-- >0;)n[p]=f,f=e[f];return n}function d0(s){const e=s.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:d0(e)}function ax(s){if(s)for(let e=0;e<s.length;e++)s[e].flags|=8}const XS=Symbol.for("v-scx"),KS=()=>ao(XS);function Sf(s,e,n){return f0(s,e,n)}function f0(s,e,n=Vi){const{immediate:c,deep:h,flush:p,once:f}=n,a=Ks({},n),w=e&&c||!e&&p!=="post";let P;if(bu){if(p==="sync"){const R=KS();P=R.__watcherHandles||(R.__watcherHandles=[])}else if(!w){const R=()=>{};return R.stop=wr,R.resume=wr,R.pause=wr,R}}const k=qs;a.call=(R,J,rt)=>Tr(R,k,J,rt);let E=!1;p==="post"?a.scheduler=R=>{kn(R,k&&k.suspense)}:p!=="sync"&&(E=!0,a.scheduler=(R,J)=>{J?R():Vg(R)}),a.augmentJob=R=>{e&&(R.flags|=4),E&&(R.flags|=2,k&&(R.id=k.uid,R.i=k))};const F=hS(s,e,a);return bu&&(P?P.push(F):w&&F()),F}function YS(s,e,n){const c=this.proxy,h=Ss(s)?s.includes(".")?p0(c,s):()=>c[s]:s.bind(c,c);let p;Ye(e)?p=e:(p=e.handler,n=e);const f=zu(this),a=f0(h,p.bind(c),n);return f(),a}function p0(s,e){const n=e.split(".");return()=>{let c=s;for(let h=0;h<n.length&&c;h++)c=c[n[h]];return c}}const JS=(s,e)=>e==="modelValue"||e==="model-value"?s.modelModifiers:s[`${e}Modifiers`]||s[`${$n(e)}Modifiers`]||s[`${Ya(e)}Modifiers`];function QS(s,e,...n){if(s.isUnmounted)return;const c=s.vnode.props||Vi;let h=n;const p=e.startsWith("update:"),f=p&&JS(c,e.slice(7));f&&(f.trim&&(h=n.map(k=>Ss(k)?k.trim():k)),f.number&&(h=n.map(k2)));let a,w=c[a=km(e)]||c[a=km($n(e))];!w&&p&&(w=c[a=km(Ya(e))]),w&&Tr(w,s,6,h);const P=c[a+"Once"];if(P){if(!s.emitted)s.emitted={};else if(s.emitted[a])return;s.emitted[a]=!0,Tr(P,s,6,h)}}function m0(s,e,n=!1){const c=e.emitsCache,h=c.get(s);if(h!==void 0)return h;const p=s.emits;let f={},a=!1;if(!Ye(s)){const w=P=>{const k=m0(P,e,!0);k&&(a=!0,Ks(f,k))};!n&&e.mixins.length&&e.mixins.forEach(w),s.extends&&w(s.extends),s.mixins&&s.mixins.forEach(w)}return!p&&!a?(qi(s)&&c.set(s,null),null):(Ue(p)?p.forEach(w=>f[w]=null):Ks(f,p),qi(s)&&c.set(s,f),f)}function cp(s,e){return!s||!tp(e)?!1:(e=e.slice(2).replace(/Once$/,""),Pi(s,e[0].toLowerCase()+e.slice(1))||Pi(s,Ya(e))||Pi(s,e))}function lx(s){const{type:e,vnode:n,proxy:c,withProxy:h,propsOptions:[p],slots:f,attrs:a,emit:w,render:P,renderCache:k,props:E,data:F,setupState:R,ctx:J,inheritAttrs:rt}=s,mt=Nf(s);let xt,Ct;try{if(n.shapeFlag&4){const At=h||c,Vt=At;xt=vr(P.call(Vt,At,k,E,R,F,J)),Ct=a}else{const At=e;xt=vr(At.length>1?At(E,{attrs:a,slots:f,emit:w}):At(E,null)),Ct=e.props?a:tT(a)}}catch(At){ou.length=0,ap(At,s,1),xt=ki(Wo)}let Lt=xt;if(Ct&&rt!==!1){const At=Object.keys(Ct),{shapeFlag:Vt}=Lt;At.length&&Vt&7&&(p&&At.some(Dg)&&(Ct=eT(Ct,p)),Lt=uc(Lt,Ct,!1,!0))}return n.dirs&&(Lt=uc(Lt,null,!1,!0),Lt.dirs=Lt.dirs?Lt.dirs.concat(n.dirs):n.dirs),n.transition&&$g(Lt,n.transition),xt=Lt,Nf(mt),xt}const tT=s=>{let e;for(const n in s)(n==="class"||n==="style"||tp(n))&&((e||(e={}))[n]=s[n]);return e},eT=(s,e)=>{const n={};for(const c in s)(!Dg(c)||!(c.slice(9)in e))&&(n[c]=s[c]);return n};function iT(s,e,n){const{props:c,children:h,component:p}=s,{props:f,children:a,patchFlag:w}=e,P=p.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&w>=0){if(w&1024)return!0;if(w&16)return c?cx(c,f,P):!!f;if(w&8){const k=e.dynamicProps;for(let E=0;E<k.length;E++){const F=k[E];if(f[F]!==c[F]&&!cp(P,F))return!0}}}else return(h||a)&&(!a||!a.$stable)?!0:c===f?!1:c?f?cx(c,f,P):!0:!!f;return!1}function cx(s,e,n){const c=Object.keys(e);if(c.length!==Object.keys(s).length)return!0;for(let h=0;h<c.length;h++){const p=c[h];if(e[p]!==s[p]&&!cp(n,p))return!0}return!1}function sT({vnode:s,parent:e},n){for(;e;){const c=e.subTree;if(c.suspense&&c.suspense.activeBranch===s&&(c.el=s.el),c===s)(s=e.vnode).el=n,e=e.parent;else break}}const g0=s=>s.__isSuspense;function nT(s,e){e&&e.pendingBranch?Ue(s)?e.effects.push(...s):e.effects.push(s):fS(s)}const Gs=Symbol.for("v-fgt"),hp=Symbol.for("v-txt"),Wo=Symbol.for("v-cmt"),Tf=Symbol.for("v-stc"),ou=[];let En=null;function hi(s=!1){ou.push(En=s?null:[])}function rT(){ou.pop(),En=ou[ou.length-1]||null}let yu=1;function hx(s,e=!1){yu+=s,s<0&&En&&e&&(En.hasOnce=!0)}function _0(s){return s.dynamicChildren=yu>0?En||ic:null,rT(),yu>0&&En&&En.push(s),s}function Yi(s,e,n,c,h,p){return _0(fe(s,e,n,c,h,p,!0))}function nr(s,e,n,c,h){return _0(ki(s,e,n,c,h,!0))}function xu(s){return s?s.__v_isVNode===!0:!1}function jh(s,e){return s.type===e.type&&s.key===e.key}const y0=({key:s})=>s??null,Mf=({ref:s,ref_key:e,ref_for:n})=>(typeof s=="number"&&(s=""+s),s!=null?Ss(s)||Xs(s)||Ye(s)?{i:js,r:s,k:e,f:!!n}:s:null);function fe(s,e=null,n=null,c=0,h=null,p=s===Gs?0:1,f=!1,a=!1){const w={__v_isVNode:!0,__v_skip:!0,type:s,props:e,key:e&&y0(e),ref:e&&Mf(e),scopeId:Gv,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:p,patchFlag:c,dynamicProps:h,dynamicChildren:null,appContext:null,ctx:js};return a?(Zg(w,n),p&128&&s.normalize(w)):n&&(w.shapeFlag|=Ss(n)?8:16),yu>0&&!f&&En&&(w.patchFlag>0||p&6)&&w.patchFlag!==32&&En.push(w),w}const ki=oT;function oT(s,e=null,n=null,c=0,h=null,p=!1){if((!s||s===IS)&&(s=Wo),xu(s)){const a=uc(s,e,!0);return n&&Zg(a,n),yu>0&&!p&&En&&(a.shapeFlag&6?En[En.indexOf(s)]=a:En.push(a)),a.patchFlag=-2,a}if(yT(s)&&(s=s.__vccOpts),e){e=aT(e);let{class:a,style:w}=e;a&&!Ss(a)&&(e.class=Yr(a)),qi(w)&&(Ng(w)&&!Ue(w)&&(w=Ks({},w)),e.style=zg(w))}const f=Ss(s)?1:g0(s)?128:mS(s)?64:qi(s)?4:Ye(s)?2:0;return fe(s,e,n,c,h,f,p,!0)}function aT(s){return s?Ng(s)||n0(s)?Ks({},s):s:null}function uc(s,e,n=!1,c=!1){const{props:h,ref:p,patchFlag:f,children:a,transition:w}=s,P=e?cT(h||{},e):h,k={__v_isVNode:!0,__v_skip:!0,type:s.type,props:P,key:P&&y0(P),ref:e&&e.ref?n&&p?Ue(p)?p.concat(Mf(e)):[p,Mf(e)]:Mf(e):p,scopeId:s.scopeId,slotScopeIds:s.slotScopeIds,children:a,target:s.target,targetStart:s.targetStart,targetAnchor:s.targetAnchor,staticCount:s.staticCount,shapeFlag:s.shapeFlag,patchFlag:e&&s.type!==Gs?f===-1?16:f|16:f,dynamicProps:s.dynamicProps,dynamicChildren:s.dynamicChildren,appContext:s.appContext,dirs:s.dirs,transition:w,component:s.component,suspense:s.suspense,ssContent:s.ssContent&&uc(s.ssContent),ssFallback:s.ssFallback&&uc(s.ssFallback),el:s.el,anchor:s.anchor,ctx:s.ctx,ce:s.ce};return w&&c&&$g(k,w.clone(k)),k}function io(s=" ",e=0){return ki(hp,null,s,e)}function lT(s,e){const n=ki(Tf,null,s);return n.staticCount=e,n}function Vo(s="",e=!1){return e?(hi(),nr(Wo,null,s)):ki(Wo,null,s)}function vr(s){return s==null||typeof s=="boolean"?ki(Wo):Ue(s)?ki(Gs,null,s.slice()):xu(s)?jo(s):ki(hp,null,String(s))}function jo(s){return s.el===null&&s.patchFlag!==-1||s.memo?s:uc(s)}function Zg(s,e){let n=0;const{shapeFlag:c}=s;if(e==null)e=null;else if(Ue(e))n=16;else if(typeof e=="object")if(c&65){const h=e.default;h&&(h._c&&(h._d=!1),Zg(s,h()),h._c&&(h._d=!0));return}else{n=32;const h=e._;!h&&!n0(e)?e._ctx=js:h===3&&js&&(js.slots._===1?e._=1:(e._=2,s.patchFlag|=1024))}else Ye(e)?(e={default:e,_ctx:js},n=32):(e=String(e),c&64?(n=16,e=[io(e)]):n=8);s.children=e,s.shapeFlag|=n}function cT(...s){const e={};for(let n=0;n<s.length;n++){const c=s[n];for(const h in c)if(h==="class")e.class!==c.class&&(e.class=Yr([e.class,c.class]));else if(h==="style")e.style=zg([e.style,c.style]);else if(tp(h)){const p=e[h],f=c[h];f&&p!==f&&!(Ue(p)&&p.includes(f))&&(e[h]=p?[].concat(p,f):f)}else h!==""&&(e[h]=c[h])}return e}function _r(s,e,n,c=null){Tr(s,e,7,[n,c])}const hT=e0();let uT=0;function dT(s,e,n){const c=s.type,h=(e?e.appContext:s.appContext)||hT,p={uid:uT++,vnode:s,type:c,parent:e,appContext:h,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new F2(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(h.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:o0(c,h),emitsOptions:m0(c,h),emit:null,emitted:null,propsDefaults:Vi,inheritAttrs:c.inheritAttrs,ctx:Vi,data:Vi,props:Vi,attrs:Vi,slots:Vi,refs:Vi,setupState:Vi,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return p.ctx={_:p},p.root=e?e.root:p,p.emit=QS.bind(null,p),s.ce&&s.ce(p),p}let qs=null,Uf,lg;{const s=np(),e=(n,c)=>{let h;return(h=s[n])||(h=s[n]=[]),h.push(c),p=>{h.length>1?h.forEach(f=>f(p)):h[0](p)}};Uf=e("__VUE_INSTANCE_SETTERS__",n=>qs=n),lg=e("__VUE_SSR_SETTERS__",n=>bu=n)}const zu=s=>{const e=qs;return Uf(s),s.scope.on(),()=>{s.scope.off(),Uf(e)}},ux=()=>{qs&&qs.scope.off(),Uf(null)};function x0(s){return s.vnode.shapeFlag&4}let bu=!1;function fT(s,e=!1,n=!1){e&&lg(e);const{props:c,children:h}=s.vnode,p=x0(s);jS(s,c,p,e),US(s,h,n);const f=p?pT(s,e):void 0;return e&&lg(!1),f}function pT(s,e){const n=s.type;s.accessCache=Object.create(null),s.proxy=new Proxy(s.ctx,AS);const{setup:c}=n;if(c){Yo();const h=s.setupContext=c.length>1?gT(s):null,p=zu(s),f=Eu(c,s,0,[s.props,h]),a=mv(f);if(Jo(),p(),(a||s.sp)&&!oc(s)&&Wv(s),a){if(f.then(ux,ux),e)return f.then(w=>{dx(s,w)}).catch(w=>{ap(w,s,0)});s.asyncDep=f}else dx(s,f)}else b0(s)}function dx(s,e,n){Ye(e)?s.type.__ssrInlineRender?s.ssrRender=e:s.render=e:qi(e)&&(s.setupState=Nv(e)),b0(s)}function b0(s,e,n){const c=s.type;s.render||(s.render=c.render||wr);{const h=zu(s);Yo();try{ES(s)}finally{Jo(),h()}}}const mT={get(s,e){return Hs(s,"get",""),s[e]}};function gT(s){const e=n=>{s.exposed=n||{}};return{attrs:new Proxy(s.attrs,mT),slots:s.slots,emit:s.emit,expose:e}}function up(s){return s.exposed?s.exposeProxy||(s.exposeProxy=new Proxy(Nv(iS(s.exposed)),{get(e,n){if(n in e)return e[n];if(n in ru)return ru[n](s)},has(e,n){return n in e||n in ru}})):s.proxy}function _T(s,e=!0){return Ye(s)?s.displayName||s.name:s.name||e&&s.__name}function yT(s){return Ye(s)&&"__vccOpts"in s}const er=(s,e)=>lS(s,e,bu);function v0(s,e,n){const c=arguments.length;return c===2?qi(e)&&!Ue(e)?xu(e)?ki(s,null,[e]):ki(s,e):ki(s,null,e):(c>3?n=Array.prototype.slice.call(arguments,2):c===3&&xu(n)&&(n=[n]),ki(s,e,n))}const xT="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let cg;const fx=typeof window<"u"&&window.trustedTypes;if(fx)try{cg=fx.createPolicy("vue",{createHTML:s=>s})}catch{}const w0=cg?s=>cg.createHTML(s):s=>s,bT="http://www.w3.org/2000/svg",vT="http://www.w3.org/1998/Math/MathML",Kr=typeof document<"u"?document:null,px=Kr&&Kr.createElement("template"),wT={insert:(s,e,n)=>{e.insertBefore(s,n||null)},remove:s=>{const e=s.parentNode;e&&e.removeChild(s)},createElement:(s,e,n,c)=>{const h=e==="svg"?Kr.createElementNS(bT,s):e==="mathml"?Kr.createElementNS(vT,s):n?Kr.createElement(s,{is:n}):Kr.createElement(s);return s==="select"&&c&&c.multiple!=null&&h.setAttribute("multiple",c.multiple),h},createText:s=>Kr.createTextNode(s),createComment:s=>Kr.createComment(s),setText:(s,e)=>{s.nodeValue=e},setElementText:(s,e)=>{s.textContent=e},parentNode:s=>s.parentNode,nextSibling:s=>s.nextSibling,querySelector:s=>Kr.querySelector(s),setScopeId(s,e){s.setAttribute(e,"")},insertStaticContent(s,e,n,c,h,p){const f=n?n.previousSibling:e.lastChild;if(h&&(h===p||h.nextSibling))for(;e.insertBefore(h.cloneNode(!0),n),!(h===p||!(h=h.nextSibling)););else{px.innerHTML=w0(c==="svg"?`<svg>${s}</svg>`:c==="mathml"?`<math>${s}</math>`:s);const a=px.content;if(c==="svg"||c==="mathml"){const w=a.firstChild;for(;w.firstChild;)a.appendChild(w.firstChild);a.removeChild(w)}e.insertBefore(a,n)}return[f?f.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}},ST=Symbol("_vtc");function TT(s,e,n){const c=s[ST];c&&(e=(e?[e,...c]:[...c]).join(" ")),e==null?s.removeAttribute("class"):n?s.setAttribute("class",e):s.className=e}const mx=Symbol("_vod"),MT=Symbol("_vsh"),PT=Symbol(""),CT=/(^|;)\s*display\s*:/;function kT(s,e,n){const c=s.style,h=Ss(n);let p=!1;if(n&&!h){if(e)if(Ss(e))for(const f of e.split(";")){const a=f.slice(0,f.indexOf(":")).trim();n[a]==null&&Pf(c,a,"")}else for(const f in e)n[f]==null&&Pf(c,f,"");for(const f in n)f==="display"&&(p=!0),Pf(c,f,n[f])}else if(h){if(e!==n){const f=c[PT];f&&(n+=";"+f),c.cssText=n,p=CT.test(n)}}else e&&s.removeAttribute("style");mx in s&&(s[mx]=p?c.display:"",s[MT]&&(c.display="none"))}const gx=/\s*!important$/;function Pf(s,e,n){if(Ue(n))n.forEach(c=>Pf(s,e,c));else if(n==null&&(n=""),e.startsWith("--"))s.setProperty(e,n);else{const c=IT(s,e);gx.test(n)?s.setProperty(Ya(c),n.replace(gx,""),"important"):s[c]=n}}const _x=["Webkit","Moz","ms"],Lm={};function IT(s,e){const n=Lm[e];if(n)return n;let c=$n(e);if(c!=="filter"&&c in s)return Lm[e]=c;c=sp(c);for(let h=0;h<_x.length;h++){const p=_x[h]+c;if(p in s)return Lm[e]=p}return e}const yx="http://www.w3.org/1999/xlink";function xx(s,e,n,c,h,p=R2(e)){c&&e.startsWith("xlink:")?n==null?s.removeAttributeNS(yx,e.slice(6,e.length)):s.setAttributeNS(yx,e,n):n==null||p&&!xv(n)?s.removeAttribute(e):s.setAttribute(e,p?"":or(n)?String(n):n)}function bx(s,e,n,c,h){if(e==="innerHTML"||e==="textContent"){n!=null&&(s[e]=e==="innerHTML"?w0(n):n);return}const p=s.tagName;if(e==="value"&&p!=="PROGRESS"&&!p.includes("-")){const a=p==="OPTION"?s.getAttribute("value")||"":s.value,w=n==null?s.type==="checkbox"?"on":"":String(n);(a!==w||!("_value"in s))&&(s.value=w),n==null&&s.removeAttribute(e),s._value=n;return}let f=!1;if(n===""||n==null){const a=typeof s[e];a==="boolean"?n=xv(n):n==null&&a==="string"?(n="",f=!0):a==="number"&&(n=0,f=!0)}try{s[e]=n}catch{}f&&s.removeAttribute(h||e)}function Gg(s,e,n,c){s.addEventListener(e,n,c)}function DT(s,e,n,c){s.removeEventListener(e,n,c)}const vx=Symbol("_vei");function AT(s,e,n,c,h=null){const p=s[vx]||(s[vx]={}),f=p[e];if(c&&f)f.value=c;else{const[a,w]=ET(e);if(c){const P=p[e]=LT(c,h);Gg(s,a,P,w)}else f&&(DT(s,a,f,w),p[e]=void 0)}}const wx=/(?:Once|Passive|Capture)$/;function ET(s){let e;if(wx.test(s)){e={};let c;for(;c=s.match(wx);)s=s.slice(0,s.length-c[0].length),e[c[0].toLowerCase()]=!0}return[s[2]===":"?s.slice(3):Ya(s.slice(2)),e]}let Fm=0;const zT=Promise.resolve(),RT=()=>Fm||(zT.then(()=>Fm=0),Fm=Date.now());function LT(s,e){const n=c=>{if(!c._vts)c._vts=Date.now();else if(c._vts<=n.attached)return;Tr(FT(c,n.value),e,5,[c])};return n.value=s,n.attached=RT(),n}function FT(s,e){if(Ue(e)){const n=s.stopImmediatePropagation;return s.stopImmediatePropagation=()=>{n.call(s),s._stopped=!0},e.map(c=>h=>!h._stopped&&c&&c(h))}else return e}const Sx=s=>s.charCodeAt(0)===111&&s.charCodeAt(1)===110&&s.charCodeAt(2)>96&&s.charCodeAt(2)<123,OT=(s,e,n,c,h,p)=>{const f=h==="svg";e==="class"?TT(s,c,f):e==="style"?kT(s,n,c):tp(e)?Dg(e)||AT(s,e,n,c,p):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):BT(s,e,c,f))?(bx(s,e,c),!s.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&xx(s,e,c,f,p,e!=="value")):s._isVueCE&&(/[A-Z]/.test(e)||!Ss(c))?bx(s,$n(e),c,p,e):(e==="true-value"?s._trueValue=c:e==="false-value"&&(s._falseValue=c),xx(s,e,c,f))};function BT(s,e,n,c){if(c)return!!(e==="innerHTML"||e==="textContent"||e in s&&Sx(e)&&Ye(n));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&s.tagName==="INPUT"||e==="type"&&s.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const h=s.tagName;if(h==="IMG"||h==="VIDEO"||h==="CANVAS"||h==="SOURCE")return!1}return Sx(e)&&Ss(n)?!1:e in s}const Hf=s=>{const e=s.props["onUpdate:modelValue"]||!1;return Ue(e)?n=>vf(e,n):e},lc=Symbol("_assign"),jT={deep:!0,created(s,e,n){s[lc]=Hf(n),Gg(s,"change",()=>{const c=s._modelValue,h=S0(s),p=s.checked,f=s[lc];if(Ue(c)){const a=bv(c,h),w=a!==-1;if(p&&!w)f(c.concat(h));else if(!p&&w){const P=[...c];P.splice(a,1),f(P)}}else if(ep(c)){const a=new Set(c);p?a.add(h):a.delete(h),f(a)}else f(T0(s,p))})},mounted:Tx,beforeUpdate(s,e,n){s[lc]=Hf(n),Tx(s,e,n)}};function Tx(s,{value:e,oldValue:n},c){s._modelValue=e;let h;if(Ue(e))h=bv(e,c.props.value)>-1;else if(ep(e))h=e.has(c.props.value);else{if(e===n)return;h=hc(e,T0(s,!0))}s.checked!==h&&(s.checked=h)}const rf={created(s,{value:e},n){s.checked=hc(e,n.props.value),s[lc]=Hf(n),Gg(s,"change",()=>{s[lc](S0(s))})},beforeUpdate(s,{value:e,oldValue:n},c){s[lc]=Hf(c),e!==n&&(s.checked=hc(e,c.props.value))}};function S0(s){return"_value"in s?s._value:s.value}function T0(s,e){const n=e?"_trueValue":"_falseValue";return n in s?s[n]:e}const NT=Ks({patchProp:OT},wT);let Mx;function VT(){return Mx||(Mx=ZS(NT))}const $T=(...s)=>{const e=VT().createApp(...s),{mount:n}=e;return e.mount=c=>{const h=HT(c);if(!h)return;const p=e._component;!Ye(p)&&!p.render&&!p.template&&(p.template=h.innerHTML),h.nodeType===1&&(h.textContent="");const f=n(h,!1,UT(h));return h instanceof Element&&(h.removeAttribute("v-cloak"),h.setAttribute("data-v-app","")),f},e};function UT(s){if(s instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&s instanceof MathMLElement)return"mathml"}function HT(s){return Ss(s)?document.querySelector(s):s}/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const ec=typeof document<"u";function M0(s){return typeof s=="object"||"displayName"in s||"props"in s||"__vccOpts"in s}function ZT(s){return s.__esModule||s[Symbol.toStringTag]==="Module"||s.default&&M0(s.default)}const Ti=Object.assign;function Om(s,e){const n={};for(const c in e){const h=e[c];n[c]=ar(h)?h.map(s):s(h)}return n}const au=()=>{},ar=Array.isArray,P0=/#/g,GT=/&/g,qT=/\//g,WT=/=/g,XT=/\?/g,C0=/\+/g,KT=/%5B/g,YT=/%5D/g,k0=/%5E/g,JT=/%60/g,I0=/%7B/g,QT=/%7C/g,D0=/%7D/g,tM=/%20/g;function qg(s){return encodeURI(""+s).replace(QT,"|").replace(KT,"[").replace(YT,"]")}function eM(s){return qg(s).replace(I0,"{").replace(D0,"}").replace(k0,"^")}function hg(s){return qg(s).replace(C0,"%2B").replace(tM,"+").replace(P0,"%23").replace(GT,"%26").replace(JT,"`").replace(I0,"{").replace(D0,"}").replace(k0,"^")}function iM(s){return hg(s).replace(WT,"%3D")}function sM(s){return qg(s).replace(P0,"%23").replace(XT,"%3F")}function nM(s){return s==null?"":sM(s).replace(qT,"%2F")}function vu(s){try{return decodeURIComponent(""+s)}catch{}return""+s}const rM=/\/$/,oM=s=>s.replace(rM,"");function Bm(s,e,n="/"){let c,h={},p="",f="";const a=e.indexOf("#");let w=e.indexOf("?");return a<w&&a>=0&&(w=-1),w>-1&&(c=e.slice(0,w),p=e.slice(w+1,a>-1?a:e.length),h=s(p)),a>-1&&(c=c||e.slice(0,a),f=e.slice(a,e.length)),c=hM(c??e,n),{fullPath:c+(p&&"?")+p+f,path:c,query:h,hash:vu(f)}}function aM(s,e){const n=e.query?s(e.query):"";return e.path+(n&&"?")+n+(e.hash||"")}function Px(s,e){return!e||!s.toLowerCase().startsWith(e.toLowerCase())?s:s.slice(e.length)||"/"}function lM(s,e,n){const c=e.matched.length-1,h=n.matched.length-1;return c>-1&&c===h&&dc(e.matched[c],n.matched[h])&&A0(e.params,n.params)&&s(e.query)===s(n.query)&&e.hash===n.hash}function dc(s,e){return(s.aliasOf||s)===(e.aliasOf||e)}function A0(s,e){if(Object.keys(s).length!==Object.keys(e).length)return!1;for(const n in s)if(!cM(s[n],e[n]))return!1;return!0}function cM(s,e){return ar(s)?Cx(s,e):ar(e)?Cx(e,s):s===e}function Cx(s,e){return ar(e)?s.length===e.length&&s.every((n,c)=>n===e[c]):s.length===1&&s[0]===e}function hM(s,e){if(s.startsWith("/"))return s;if(!s)return e;const n=e.split("/"),c=s.split("/"),h=c[c.length-1];(h===".."||h===".")&&c.push("");let p=n.length-1,f,a;for(f=0;f<c.length;f++)if(a=c[f],a!==".")if(a==="..")p>1&&p--;else break;return n.slice(0,p).join("/")+"/"+c.slice(f).join("/")}const Oo={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var wu;(function(s){s.pop="pop",s.push="push"})(wu||(wu={}));var lu;(function(s){s.back="back",s.forward="forward",s.unknown=""})(lu||(lu={}));function uM(s){if(!s)if(ec){const e=document.querySelector("base");s=e&&e.getAttribute("href")||"/",s=s.replace(/^\w+:\/\/[^\/]+/,"")}else s="/";return s[0]!=="/"&&s[0]!=="#"&&(s="/"+s),oM(s)}const dM=/^[^#]+#/;function fM(s,e){return s.replace(dM,"#")+e}function pM(s,e){const n=document.documentElement.getBoundingClientRect(),c=s.getBoundingClientRect();return{behavior:e.behavior,left:c.left-n.left-(e.left||0),top:c.top-n.top-(e.top||0)}}const dp=()=>({left:window.scrollX,top:window.scrollY});function mM(s){let e;if("el"in s){const n=s.el,c=typeof n=="string"&&n.startsWith("#"),h=typeof n=="string"?c?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!h)return;e=pM(h,s)}else e=s;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function kx(s,e){return(history.state?history.state.position-e:-1)+s}const ug=new Map;function gM(s,e){ug.set(s,e)}function _M(s){const e=ug.get(s);return ug.delete(s),e}let yM=()=>location.protocol+"//"+location.host;function E0(s,e){const{pathname:n,search:c,hash:h}=e,p=s.indexOf("#");if(p>-1){let a=h.includes(s.slice(p))?s.slice(p).length:1,w=h.slice(a);return w[0]!=="/"&&(w="/"+w),Px(w,"")}return Px(n,s)+c+h}function xM(s,e,n,c){let h=[],p=[],f=null;const a=({state:F})=>{const R=E0(s,location),J=n.value,rt=e.value;let mt=0;if(F){if(n.value=R,e.value=F,f&&f===J){f=null;return}mt=rt?F.position-rt.position:0}else c(R);h.forEach(xt=>{xt(n.value,J,{delta:mt,type:wu.pop,direction:mt?mt>0?lu.forward:lu.back:lu.unknown})})};function w(){f=n.value}function P(F){h.push(F);const R=()=>{const J=h.indexOf(F);J>-1&&h.splice(J,1)};return p.push(R),R}function k(){const{history:F}=window;F.state&&F.replaceState(Ti({},F.state,{scroll:dp()}),"")}function E(){for(const F of p)F();p=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",k)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",k,{passive:!0}),{pauseListeners:w,listen:P,destroy:E}}function Ix(s,e,n,c=!1,h=!1){return{back:s,current:e,forward:n,replaced:c,position:window.history.length,scroll:h?dp():null}}function bM(s){const{history:e,location:n}=window,c={value:E0(s,n)},h={value:e.state};h.value||p(c.value,{back:null,current:c.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function p(w,P,k){const E=s.indexOf("#"),F=E>-1?(n.host&&document.querySelector("base")?s:s.slice(E))+w:yM()+s+w;try{e[k?"replaceState":"pushState"](P,"",F),h.value=P}catch(R){console.error(R),n[k?"replace":"assign"](F)}}function f(w,P){const k=Ti({},e.state,Ix(h.value.back,w,h.value.forward,!0),P,{position:h.value.position});p(w,k,!0),c.value=w}function a(w,P){const k=Ti({},h.value,e.state,{forward:w,scroll:dp()});p(k.current,k,!0);const E=Ti({},Ix(c.value,w,null),{position:k.position+1},P);p(w,E,!1),c.value=w}return{location:c,state:h,push:a,replace:f}}function vM(s){s=uM(s);const e=bM(s),n=xM(s,e.state,e.location,e.replace);function c(p,f=!0){f||n.pauseListeners(),history.go(p)}const h=Ti({location:"",base:s,go:c,createHref:fM.bind(null,s)},e,n);return Object.defineProperty(h,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(h,"state",{enumerable:!0,get:()=>e.state.value}),h}function wM(s){return typeof s=="string"||s&&typeof s=="object"}function z0(s){return typeof s=="string"||typeof s=="symbol"}const R0=Symbol("");var Dx;(function(s){s[s.aborted=4]="aborted",s[s.cancelled=8]="cancelled",s[s.duplicated=16]="duplicated"})(Dx||(Dx={}));function fc(s,e){return Ti(new Error,{type:s,[R0]:!0},e)}function Gr(s,e){return s instanceof Error&&R0 in s&&(e==null||!!(s.type&e))}const Ax="[^/]+?",SM={sensitive:!1,strict:!1,start:!0,end:!0},TM=/[.+*?^${}()[\]/\\]/g;function MM(s,e){const n=Ti({},SM,e),c=[];let h=n.start?"^":"";const p=[];for(const P of s){const k=P.length?[]:[90];n.strict&&!P.length&&(h+="/");for(let E=0;E<P.length;E++){const F=P[E];let R=40+(n.sensitive?.25:0);if(F.type===0)E||(h+="/"),h+=F.value.replace(TM,"\\$&"),R+=40;else if(F.type===1){const{value:J,repeatable:rt,optional:mt,regexp:xt}=F;p.push({name:J,repeatable:rt,optional:mt});const Ct=xt||Ax;if(Ct!==Ax){R+=10;try{new RegExp(`(${Ct})`)}catch(At){throw new Error(`Invalid custom RegExp for param "${J}" (${Ct}): `+At.message)}}let Lt=rt?`((?:${Ct})(?:/(?:${Ct}))*)`:`(${Ct})`;E||(Lt=mt&&P.length<2?`(?:/${Lt})`:"/"+Lt),mt&&(Lt+="?"),h+=Lt,R+=20,mt&&(R+=-8),rt&&(R+=-20),Ct===".*"&&(R+=-50)}k.push(R)}c.push(k)}if(n.strict&&n.end){const P=c.length-1;c[P][c[P].length-1]+=.7000000000000001}n.strict||(h+="/?"),n.end?h+="$":n.strict&&!h.endsWith("/")&&(h+="(?:/|$)");const f=new RegExp(h,n.sensitive?"":"i");function a(P){const k=P.match(f),E={};if(!k)return null;for(let F=1;F<k.length;F++){const R=k[F]||"",J=p[F-1];E[J.name]=R&&J.repeatable?R.split("/"):R}return E}function w(P){let k="",E=!1;for(const F of s){(!E||!k.endsWith("/"))&&(k+="/"),E=!1;for(const R of F)if(R.type===0)k+=R.value;else if(R.type===1){const{value:J,repeatable:rt,optional:mt}=R,xt=J in P?P[J]:"";if(ar(xt)&&!rt)throw new Error(`Provided param "${J}" is an array but it is not repeatable (* or + modifiers)`);const Ct=ar(xt)?xt.join("/"):xt;if(!Ct)if(mt)F.length<2&&(k.endsWith("/")?k=k.slice(0,-1):E=!0);else throw new Error(`Missing required param "${J}"`);k+=Ct}}return k||"/"}return{re:f,score:c,keys:p,parse:a,stringify:w}}function PM(s,e){let n=0;for(;n<s.length&&n<e.length;){const c=e[n]-s[n];if(c)return c;n++}return s.length<e.length?s.length===1&&s[0]===80?-1:1:s.length>e.length?e.length===1&&e[0]===80?1:-1:0}function L0(s,e){let n=0;const c=s.score,h=e.score;for(;n<c.length&&n<h.length;){const p=PM(c[n],h[n]);if(p)return p;n++}if(Math.abs(h.length-c.length)===1){if(Ex(c))return 1;if(Ex(h))return-1}return h.length-c.length}function Ex(s){const e=s[s.length-1];return s.length>0&&e[e.length-1]<0}const CM={type:0,value:""},kM=/[a-zA-Z0-9_]/;function IM(s){if(!s)return[[]];if(s==="/")return[[CM]];if(!s.startsWith("/"))throw new Error(`Invalid path "${s}"`);function e(R){throw new Error(`ERR (${n})/"${P}": ${R}`)}let n=0,c=n;const h=[];let p;function f(){p&&h.push(p),p=[]}let a=0,w,P="",k="";function E(){P&&(n===0?p.push({type:0,value:P}):n===1||n===2||n===3?(p.length>1&&(w==="*"||w==="+")&&e(`A repeatable param (${P}) must be alone in its segment. eg: '/:ids+.`),p.push({type:1,value:P,regexp:k,repeatable:w==="*"||w==="+",optional:w==="*"||w==="?"})):e("Invalid state to consume buffer"),P="")}function F(){P+=w}for(;a<s.length;){if(w=s[a++],w==="\\"&&n!==2){c=n,n=4;continue}switch(n){case 0:w==="/"?(P&&E(),f()):w===":"?(E(),n=1):F();break;case 4:F(),n=c;break;case 1:w==="("?n=2:kM.test(w)?F():(E(),n=0,w!=="*"&&w!=="?"&&w!=="+"&&a--);break;case 2:w===")"?k[k.length-1]=="\\"?k=k.slice(0,-1)+w:n=3:k+=w;break;case 3:E(),n=0,w!=="*"&&w!=="?"&&w!=="+"&&a--,k="";break;default:e("Unknown state");break}}return n===2&&e(`Unfinished custom RegExp for param "${P}"`),E(),f(),h}function DM(s,e,n){const c=MM(IM(s.path),n),h=Ti(c,{record:s,parent:e,children:[],alias:[]});return e&&!h.record.aliasOf==!e.record.aliasOf&&e.children.push(h),h}function AM(s,e){const n=[],c=new Map;e=Fx({strict:!1,end:!0,sensitive:!1},e);function h(E){return c.get(E)}function p(E,F,R){const J=!R,rt=Rx(E);rt.aliasOf=R&&R.record;const mt=Fx(e,E),xt=[rt];if("alias"in E){const At=typeof E.alias=="string"?[E.alias]:E.alias;for(const Vt of At)xt.push(Rx(Ti({},rt,{components:R?R.record.components:rt.components,path:Vt,aliasOf:R?R.record:rt})))}let Ct,Lt;for(const At of xt){const{path:Vt}=At;if(F&&Vt[0]!=="/"){const Yt=F.record.path,Gt=Yt[Yt.length-1]==="/"?"":"/";At.path=F.record.path+(Vt&&Gt+Vt)}if(Ct=DM(At,F,mt),R?R.alias.push(Ct):(Lt=Lt||Ct,Lt!==Ct&&Lt.alias.push(Ct),J&&E.name&&!Lx(Ct)&&f(E.name)),F0(Ct)&&w(Ct),rt.children){const Yt=rt.children;for(let Gt=0;Gt<Yt.length;Gt++)p(Yt[Gt],Ct,R&&R.children[Gt])}R=R||Ct}return Lt?()=>{f(Lt)}:au}function f(E){if(z0(E)){const F=c.get(E);F&&(c.delete(E),n.splice(n.indexOf(F),1),F.children.forEach(f),F.alias.forEach(f))}else{const F=n.indexOf(E);F>-1&&(n.splice(F,1),E.record.name&&c.delete(E.record.name),E.children.forEach(f),E.alias.forEach(f))}}function a(){return n}function w(E){const F=RM(E,n);n.splice(F,0,E),E.record.name&&!Lx(E)&&c.set(E.record.name,E)}function P(E,F){let R,J={},rt,mt;if("name"in E&&E.name){if(R=c.get(E.name),!R)throw fc(1,{location:E});mt=R.record.name,J=Ti(zx(F.params,R.keys.filter(Lt=>!Lt.optional).concat(R.parent?R.parent.keys.filter(Lt=>Lt.optional):[]).map(Lt=>Lt.name)),E.params&&zx(E.params,R.keys.map(Lt=>Lt.name))),rt=R.stringify(J)}else if(E.path!=null)rt=E.path,R=n.find(Lt=>Lt.re.test(rt)),R&&(J=R.parse(rt),mt=R.record.name);else{if(R=F.name?c.get(F.name):n.find(Lt=>Lt.re.test(F.path)),!R)throw fc(1,{location:E,currentLocation:F});mt=R.record.name,J=Ti({},F.params,E.params),rt=R.stringify(J)}const xt=[];let Ct=R;for(;Ct;)xt.unshift(Ct.record),Ct=Ct.parent;return{name:mt,path:rt,params:J,matched:xt,meta:zM(xt)}}s.forEach(E=>p(E));function k(){n.length=0,c.clear()}return{addRoute:p,resolve:P,removeRoute:f,clearRoutes:k,getRoutes:a,getRecordMatcher:h}}function zx(s,e){const n={};for(const c of e)c in s&&(n[c]=s[c]);return n}function Rx(s){const e={path:s.path,redirect:s.redirect,name:s.name,meta:s.meta||{},aliasOf:s.aliasOf,beforeEnter:s.beforeEnter,props:EM(s),children:s.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in s?s.components||null:s.component&&{default:s.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function EM(s){const e={},n=s.props||!1;if("component"in s)e.default=n;else for(const c in s.components)e[c]=typeof n=="object"?n[c]:n;return e}function Lx(s){for(;s;){if(s.record.aliasOf)return!0;s=s.parent}return!1}function zM(s){return s.reduce((e,n)=>Ti(e,n.meta),{})}function Fx(s,e){const n={};for(const c in s)n[c]=c in e?e[c]:s[c];return n}function RM(s,e){let n=0,c=e.length;for(;n!==c;){const p=n+c>>1;L0(s,e[p])<0?c=p:n=p+1}const h=LM(s);return h&&(c=e.lastIndexOf(h,c-1)),c}function LM(s){let e=s;for(;e=e.parent;)if(F0(e)&&L0(s,e)===0)return e}function F0({record:s}){return!!(s.name||s.components&&Object.keys(s.components).length||s.redirect)}function FM(s){const e={};if(s===""||s==="?")return e;const c=(s[0]==="?"?s.slice(1):s).split("&");for(let h=0;h<c.length;++h){const p=c[h].replace(C0," "),f=p.indexOf("="),a=vu(f<0?p:p.slice(0,f)),w=f<0?null:vu(p.slice(f+1));if(a in e){let P=e[a];ar(P)||(P=e[a]=[P]),P.push(w)}else e[a]=w}return e}function Ox(s){let e="";for(let n in s){const c=s[n];if(n=iM(n),c==null){c!==void 0&&(e+=(e.length?"&":"")+n);continue}(ar(c)?c.map(p=>p&&hg(p)):[c&&hg(c)]).forEach(p=>{p!==void 0&&(e+=(e.length?"&":"")+n,p!=null&&(e+="="+p))})}return e}function OM(s){const e={};for(const n in s){const c=s[n];c!==void 0&&(e[n]=ar(c)?c.map(h=>h==null?null:""+h):c==null?c:""+c)}return e}const BM=Symbol(""),Bx=Symbol(""),Wg=Symbol(""),O0=Symbol(""),dg=Symbol("");function Nh(){let s=[];function e(c){return s.push(c),()=>{const h=s.indexOf(c);h>-1&&s.splice(h,1)}}function n(){s=[]}return{add:e,list:()=>s.slice(),reset:n}}function No(s,e,n,c,h,p=f=>f()){const f=c&&(c.enterCallbacks[h]=c.enterCallbacks[h]||[]);return()=>new Promise((a,w)=>{const P=F=>{F===!1?w(fc(4,{from:n,to:e})):F instanceof Error?w(F):wM(F)?w(fc(2,{from:e,to:F})):(f&&c.enterCallbacks[h]===f&&typeof F=="function"&&f.push(F),a())},k=p(()=>s.call(c&&c.instances[h],e,n,P));let E=Promise.resolve(k);s.length<3&&(E=E.then(P)),E.catch(F=>w(F))})}function jm(s,e,n,c,h=p=>p()){const p=[];for(const f of s)for(const a in f.components){let w=f.components[a];if(!(e!=="beforeRouteEnter"&&!f.instances[a]))if(M0(w)){const k=(w.__vccOpts||w)[e];k&&p.push(No(k,n,c,f,a,h))}else{let P=w();p.push(()=>P.then(k=>{if(!k)throw new Error(`Couldn't resolve component "${a}" at "${f.path}"`);const E=ZT(k)?k.default:k;f.mods[a]=k,f.components[a]=E;const R=(E.__vccOpts||E)[e];return R&&No(R,n,c,f,a,h)()}))}}return p}function jx(s){const e=ao(Wg),n=ao(O0),c=er(()=>{const w=Za(s.to);return e.resolve(w)}),h=er(()=>{const{matched:w}=c.value,{length:P}=w,k=w[P-1],E=n.matched;if(!k||!E.length)return-1;const F=E.findIndex(dc.bind(null,k));if(F>-1)return F;const R=Nx(w[P-2]);return P>1&&Nx(k)===R&&E[E.length-1].path!==R?E.findIndex(dc.bind(null,w[P-2])):F}),p=er(()=>h.value>-1&&UM(n.params,c.value.params)),f=er(()=>h.value>-1&&h.value===n.matched.length-1&&A0(n.params,c.value.params));function a(w={}){if($M(w)){const P=e[Za(s.replace)?"replace":"push"](Za(s.to)).catch(au);return s.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>P),P}return Promise.resolve()}return{route:c,href:er(()=>c.value.href),isActive:p,isExactActive:f,navigate:a}}function jM(s){return s.length===1?s[0]:s}const NM=qv({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:jx,setup(s,{slots:e}){const n=op(jx(s)),{options:c}=ao(Wg),h=er(()=>({[Vx(s.activeClass,c.linkActiveClass,"router-link-active")]:n.isActive,[Vx(s.exactActiveClass,c.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive}));return()=>{const p=e.default&&jM(e.default(n));return s.custom?p:v0("a",{"aria-current":n.isExactActive?s.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:h.value},p)}}}),VM=NM;function $M(s){if(!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)&&!s.defaultPrevented&&!(s.button!==void 0&&s.button!==0)){if(s.currentTarget&&s.currentTarget.getAttribute){const e=s.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return s.preventDefault&&s.preventDefault(),!0}}function UM(s,e){for(const n in e){const c=e[n],h=s[n];if(typeof c=="string"){if(c!==h)return!1}else if(!ar(h)||h.length!==c.length||c.some((p,f)=>p!==h[f]))return!1}return!0}function Nx(s){return s?s.aliasOf?s.aliasOf.path:s.path:""}const Vx=(s,e,n)=>s??e??n,HM=qv({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(s,{attrs:e,slots:n}){const c=ao(dg),h=er(()=>s.route||c.value),p=ao(Bx,0),f=er(()=>{let P=Za(p);const{matched:k}=h.value;let E;for(;(E=k[P])&&!E.components;)P++;return P}),a=er(()=>h.value.matched[f.value]);wf(Bx,er(()=>f.value+1)),wf(BM,a),wf(dg,h);const w=sS();return Sf(()=>[w.value,a.value,s.name],([P,k,E],[F,R,J])=>{k&&(k.instances[E]=P,R&&R!==k&&P&&P===F&&(k.leaveGuards.size||(k.leaveGuards=R.leaveGuards),k.updateGuards.size||(k.updateGuards=R.updateGuards))),P&&k&&(!R||!dc(k,R)||!F)&&(k.enterCallbacks[E]||[]).forEach(rt=>rt(P))},{flush:"post"}),()=>{const P=h.value,k=s.name,E=a.value,F=E&&E.components[k];if(!F)return $x(n.default,{Component:F,route:P});const R=E.props[k],J=R?R===!0?P.params:typeof R=="function"?R(P):R:null,mt=v0(F,Ti({},J,e,{onVnodeUnmounted:xt=>{xt.component.isUnmounted&&(E.instances[k]=null)},ref:w}));return $x(n.default,{Component:mt,route:P})||mt}}});function $x(s,e){if(!s)return null;const n=s(e);return n.length===1?n[0]:n}const B0=HM;function ZM(s){const e=AM(s.routes,s),n=s.parseQuery||FM,c=s.stringifyQuery||Ox,h=s.history,p=Nh(),f=Nh(),a=Nh(),w=nS(Oo);let P=Oo;ec&&s.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const k=Om.bind(null,Jt=>""+Jt),E=Om.bind(null,nM),F=Om.bind(null,vu);function R(Jt,me){let ue,Pt;return z0(Jt)?(ue=e.getRecordMatcher(Jt),Pt=me):Pt=Jt,e.addRoute(Pt,ue)}function J(Jt){const me=e.getRecordMatcher(Jt);me&&e.removeRoute(me)}function rt(){return e.getRoutes().map(Jt=>Jt.record)}function mt(Jt){return!!e.getRecordMatcher(Jt)}function xt(Jt,me){if(me=Ti({},me||w.value),typeof Jt=="string"){const K=Bm(n,Jt,me.path),nt=e.resolve({path:K.path},me),et=h.createHref(K.fullPath);return Ti(K,nt,{params:F(nt.params),hash:vu(K.hash),redirectedFrom:void 0,href:et})}let ue;if(Jt.path!=null)ue=Ti({},Jt,{path:Bm(n,Jt.path,me.path).path});else{const K=Ti({},Jt.params);for(const nt in K)K[nt]==null&&delete K[nt];ue=Ti({},Jt,{params:E(K)}),me.params=E(me.params)}const Pt=e.resolve(ue,me),X=Jt.hash||"";Pt.params=k(F(Pt.params));const N=aM(c,Ti({},Jt,{hash:eM(X),path:Pt.path})),O=h.createHref(N);return Ti({fullPath:N,hash:X,query:c===Ox?OM(Jt.query):Jt.query||{}},Pt,{redirectedFrom:void 0,href:O})}function Ct(Jt){return typeof Jt=="string"?Bm(n,Jt,w.value.path):Ti({},Jt)}function Lt(Jt,me){if(P!==Jt)return fc(8,{from:me,to:Jt})}function At(Jt){return Gt(Jt)}function Vt(Jt){return At(Ti(Ct(Jt),{replace:!0}))}function Yt(Jt){const me=Jt.matched[Jt.matched.length-1];if(me&&me.redirect){const{redirect:ue}=me;let Pt=typeof ue=="function"?ue(Jt):ue;return typeof Pt=="string"&&(Pt=Pt.includes("?")||Pt.includes("#")?Pt=Ct(Pt):{path:Pt},Pt.params={}),Ti({query:Jt.query,hash:Jt.hash,params:Pt.path!=null?{}:Jt.params},Pt)}}function Gt(Jt,me){const ue=P=xt(Jt),Pt=w.value,X=Jt.state,N=Jt.force,O=Jt.replace===!0,K=Yt(ue);if(K)return Gt(Ti(Ct(K),{state:typeof K=="object"?Ti({},X,K.state):X,force:N,replace:O}),me||ue);const nt=ue;nt.redirectedFrom=me;let et;return!N&&lM(c,Pt,ue)&&(et=fc(16,{to:nt,from:Pt}),mi(Pt,Pt,!0,!1)),(et?Promise.resolve(et):ze(nt,Pt)).catch(ht=>Gr(ht)?Gr(ht,2)?ht:zi(ht):Oe(ht,nt,Pt)).then(ht=>{if(ht){if(Gr(ht,2))return Gt(Ti({replace:O},Ct(ht.to),{state:typeof ht.to=="object"?Ti({},X,ht.to.state):X,force:N}),me||nt)}else ht=Fe(nt,Pt,!0,O,X);return Me(nt,Pt,ht),ht})}function ie(Jt,me){const ue=Lt(Jt,me);return ue?Promise.reject(ue):Promise.resolve()}function be(Jt){const me=Ce.values().next().value;return me&&typeof me.runWithContext=="function"?me.runWithContext(Jt):Jt()}function ze(Jt,me){let ue;const[Pt,X,N]=GM(Jt,me);ue=jm(Pt.reverse(),"beforeRouteLeave",Jt,me);for(const K of Pt)K.leaveGuards.forEach(nt=>{ue.push(No(nt,Jt,me))});const O=ie.bind(null,Jt,me);return ue.push(O),ii(ue).then(()=>{ue=[];for(const K of p.list())ue.push(No(K,Jt,me));return ue.push(O),ii(ue)}).then(()=>{ue=jm(X,"beforeRouteUpdate",Jt,me);for(const K of X)K.updateGuards.forEach(nt=>{ue.push(No(nt,Jt,me))});return ue.push(O),ii(ue)}).then(()=>{ue=[];for(const K of N)if(K.beforeEnter)if(ar(K.beforeEnter))for(const nt of K.beforeEnter)ue.push(No(nt,Jt,me));else ue.push(No(K.beforeEnter,Jt,me));return ue.push(O),ii(ue)}).then(()=>(Jt.matched.forEach(K=>K.enterCallbacks={}),ue=jm(N,"beforeRouteEnter",Jt,me,be),ue.push(O),ii(ue))).then(()=>{ue=[];for(const K of f.list())ue.push(No(K,Jt,me));return ue.push(O),ii(ue)}).catch(K=>Gr(K,8)?K:Promise.reject(K))}function Me(Jt,me,ue){a.list().forEach(Pt=>be(()=>Pt(Jt,me,ue)))}function Fe(Jt,me,ue,Pt,X){const N=Lt(Jt,me);if(N)return N;const O=me===Oo,K=ec?history.state:{};ue&&(Pt||O?h.replace(Jt.fullPath,Ti({scroll:O&&K&&K.scroll},X)):h.push(Jt.fullPath,X)),w.value=Jt,mi(Jt,me,ue,O),zi()}let Ve;function He(){Ve||(Ve=h.listen((Jt,me,ue)=>{if(!ai.listening)return;const Pt=xt(Jt),X=Yt(Pt);if(X){Gt(Ti(X,{replace:!0,force:!0}),Pt).catch(au);return}P=Pt;const N=w.value;ec&&gM(kx(N.fullPath,ue.delta),dp()),ze(Pt,N).catch(O=>Gr(O,12)?O:Gr(O,2)?(Gt(Ti(Ct(O.to),{force:!0}),Pt).then(K=>{Gr(K,20)&&!ue.delta&&ue.type===wu.pop&&h.go(-1,!1)}).catch(au),Promise.reject()):(ue.delta&&h.go(-ue.delta,!1),Oe(O,Pt,N))).then(O=>{O=O||Fe(Pt,N,!1),O&&(ue.delta&&!Gr(O,8)?h.go(-ue.delta,!1):ue.type===wu.pop&&Gr(O,20)&&h.go(-1,!1)),Me(Pt,N,O)}).catch(au)}))}let je=Nh(),xe=Nh(),De;function Oe(Jt,me,ue){zi(Jt);const Pt=xe.list();return Pt.length?Pt.forEach(X=>X(Jt,me,ue)):console.error(Jt),Promise.reject(Jt)}function qe(){return De&&w.value!==Oo?Promise.resolve():new Promise((Jt,me)=>{je.add([Jt,me])})}function zi(Jt){return De||(De=!Jt,He(),je.list().forEach(([me,ue])=>Jt?ue(Jt):me()),je.reset()),Jt}function mi(Jt,me,ue,Pt){const{scrollBehavior:X}=s;if(!ec||!X)return Promise.resolve();const N=!ue&&_M(kx(Jt.fullPath,0))||(Pt||!ue)&&history.state&&history.state.scroll||null;return $v().then(()=>X(Jt,me,N)).then(O=>O&&mM(O)).catch(O=>Oe(O,Jt,me))}const ci=Jt=>h.go(Jt);let Ii;const Ce=new Set,ai={currentRoute:w,listening:!0,addRoute:R,removeRoute:J,clearRoutes:e.clearRoutes,hasRoute:mt,getRoutes:rt,resolve:xt,options:s,push:At,replace:Vt,go:ci,back:()=>ci(-1),forward:()=>ci(1),beforeEach:p.add,beforeResolve:f.add,afterEach:a.add,onError:xe.add,isReady:qe,install(Jt){const me=this;Jt.component("RouterLink",VM),Jt.component("RouterView",B0),Jt.config.globalProperties.$router=me,Object.defineProperty(Jt.config.globalProperties,"$route",{enumerable:!0,get:()=>Za(w)}),ec&&!Ii&&w.value===Oo&&(Ii=!0,At(h.location).catch(X=>{}));const ue={};for(const X in Oo)Object.defineProperty(ue,X,{get:()=>w.value[X],enumerable:!0});Jt.provide(Wg,me),Jt.provide(O0,Ov(ue)),Jt.provide(dg,w);const Pt=Jt.unmount;Ce.add(Jt),Jt.unmount=function(){Ce.delete(Jt),Ce.size<1&&(P=Oo,Ve&&Ve(),Ve=null,w.value=Oo,Ii=!1,De=!1),Pt()}}};function ii(Jt){return Jt.reduce((me,ue)=>me.then(()=>be(ue)),Promise.resolve())}return ai}function GM(s,e){const n=[],c=[],h=[],p=Math.max(e.matched.length,s.matched.length);for(let f=0;f<p;f++){const a=e.matched[f];a&&(s.matched.find(P=>dc(P,a))?c.push(a):n.push(a));const w=s.matched[f];w&&(e.matched.find(P=>dc(P,w))||h.push(w))}return[n,c,h]}const qM={__name:"App",setup(s){return(e,n)=>(hi(),nr(Za(B0)))}},WM="/pimeteo.png",xn=(s,e)=>{const n=s.__vccOpts||s;for(const[c,h]of e)n[c]=h;return n},XM={data(){return{stationName:"Pi 28"}},methods:{stationCliqued(s){this.stationName=s,this.$emit("updateStationName",this.stationName)},goHome(){this.$router.push({name:"home"})}}},KM={class:"d-flex flex-wrap justify-content-between align-items-center py-3 mb-4 border-bottom"},YM={class:"nav nav-pills me-5"},JM={class:"nav-item"},QM={class:"nav-item"},tP={class:"nav-item"},eP={class:"nav-item"},iP={class:"nav-item"},sP={class:"nav-item"};function nP(s,e,n,c,h,p){return hi(),Yi("header",KM,[fe("img",{src:WM,class:"ms-3",alt:"Logo",width:"40%",height:"5%",title:"Très bon slogan !",onClick:e[0]||(e[0]=(...f)=>p.goHome&&p.goHome(...f))}),fe("ul",YM,[fe("li",JM,[fe("a",{class:Yr(["nav-link",{active:h.stationName==="Pi 28"}]),onClick:e[1]||(e[1]=f=>p.stationCliqued("Pi 28"))},"Pi 28",2)]),fe("li",QM,[fe("a",{class:Yr(["nav-link",{active:h.stationName==="Pi 27"}]),onClick:e[2]||(e[2]=f=>p.stationCliqued("Pi 27"))},"Pi 27",2)]),fe("li",tP,[fe("a",{class:Yr(["nav-link",{active:h.stationName==="Pi 29"}]),onClick:e[3]||(e[3]=f=>p.stationCliqued("Pi 29"))},"Pi 29",2)]),fe("li",eP,[fe("a",{class:Yr(["nav-link",{active:h.stationName==="Pi 30"}]),onClick:e[4]||(e[4]=f=>p.stationCliqued("Pi 30"))},"Pi 30",2)]),fe("li",iP,[fe("a",{class:Yr(["nav-link",{active:h.stationName==="Pi 31"}]),onClick:e[5]||(e[5]=f=>p.stationCliqued("Pi 31"))},"Pi 31",2)]),fe("li",sP,[fe("a",{class:Yr(["nav-link",{active:h.stationName==="Pi 32"}]),onClick:e[6]||(e[6]=f=>p.stationCliqued("Pi 32"))},"Pi 32",2)])])])}const Xg=xn(XM,[["render",nP]]),rP={data(){return{sensorName:{rain:"Precipitation",temperature:"Temperature",humidity:"Humidity",pressure:"Pressure",wind_speed_avg:"Wind Speed",wind_heading:"Wind Heading",luminosity:"Luminosity",location:"Location",all:"All Sensors"},sensorList:[]}},methods:{helloSensor(){this.$emit("updateSensor",this.sensorList)},handleSensorChange(s){s==="all"?this.sensorList=["all"]:this.sensorList=this.sensorList.filter(e=>e!=="all"),this.helloSensor()}}},oP={class:"container"},aP={class:"mt-3"},lP={class:"form-check"},cP=["value","onChange"],hP={class:"form-check-label"};function uP(s,e,n,c,h,p){return hi(),Yi("div",oP,[e[1]||(e[1]=fe("h2",null,"Sensors",-1)),fe("div",aP,[(hi(!0),Yi(Gs,null,Ug(h.sensorName,(f,a)=>(hi(),Yi("div",{key:a},[fe("div",lP,[qh(fe("input",{class:"form-check-input",type:"checkbox",value:a,"onUpdate:modelValue":e[0]||(e[0]=w=>h.sensorList=w),onChange:w=>p.handleSensorChange(a)},null,40,cP),[[jT,h.sensorList]]),fe("label",hP,Nn(f),1)])]))),128))])])}const j0=xn(rP,[["render",uP]]);function Kg(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Cf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.1.0/LICENSE.txt
 */var dP=Cf.exports,Ux;function fP(){return Ux||(Ux=1,function(s,e){(function(n,c){s.exports=c()})(dP,function(){var n={},c={};function h(f,a,w){if(c[f]=w,f==="index"){var P="var sharedModule = {}; ("+c.shared+")(sharedModule); ("+c.worker+")(sharedModule);",k={};return c.shared(k),c.index(n,k),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([P],{type:"text/javascript"}))),n}}h("shared",["exports"],function(f){function a(l,i,o,u){return new(o||(o=Promise))(function(g,x){function b(I){try{M(u.next(I))}catch(A){x(A)}}function S(I){try{M(u.throw(I))}catch(A){x(A)}}function M(I){var A;I.done?g(I.value):(A=I.value,A instanceof o?A:new o(function(z){z(A)})).then(b,S)}M((u=u.apply(l,i||[])).next())})}function w(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var P,k;function E(){if(k)return P;function l(i,o){this.x=i,this.y=o}return k=1,P=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,o){return this.clone()._rotateAround(i,o)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var o=i.x-this.x,u=i.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,o){return Math.atan2(this.x*o-this.y*i,this.x*i+this.y*o)},_matMult:function(i){var o=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=o,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var o=Math.cos(i),u=Math.sin(i),g=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=g,this},_rotateAround:function(i,o){var u=Math.cos(i),g=Math.sin(i),x=o.y+g*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-g*(this.y-o.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(i){return i instanceof l?i:Array.isArray(i)?new l(i[0],i[1]):i},P}typeof SuppressedError=="function"&&SuppressedError;var F,R,J=w(E()),rt=function(){if(R)return F;function l(i,o,u,g){this.cx=3*i,this.bx=3*(u-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(g-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=u,this.p2y=g}return R=1,F=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,o){if(o===void 0&&(o=1e-6),i<0)return 0;if(i>1)return 1;for(var u=i,g=0;g<8;g++){var x=this.sampleCurveX(u)-i;if(Math.abs(x)<o)return u;var b=this.sampleCurveDerivativeX(u);if(Math.abs(b)<1e-6)break;u-=x/b}var S=0,M=1;for(u=i,g=0;g<20&&(x=this.sampleCurveX(u),!(Math.abs(x-i)<o));g++)i>x?S=u:M=u,u=.5*(M-S)+S;return u},solve:function(i,o){return this.sampleCurveY(this.solveCurveX(i,o))}},F}(),mt=w(rt);let xt,Ct;function Lt(){return xt==null&&(xt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),xt}function At(){if(Ct==null&&(Ct=!1,Lt())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let u=0;u<5*5;u++){const g=4*u;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(u%5,Math.floor(u/5),1,1)}const o=i.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&o[u]!==u){Ct=!0;break}}}return Ct||!1}var Vt,Yt=1e-6,Gt=typeof Float32Array<"u"?Float32Array:Array;function ie(){var l=new Gt(9);return Gt!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function be(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ze(){var l=new Gt(3);return Gt!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Me(l,i,o){var u=new Gt(3);return u[0]=l,u[1]=i,u[2]=o,u}function Fe(l,i,o){var u=i[0],g=i[1],x=i[2],b=i[3];return l[0]=o[0]*u+o[4]*g+o[8]*x+o[12]*b,l[1]=o[1]*u+o[5]*g+o[9]*x+o[13]*b,l[2]=o[2]*u+o[6]*g+o[10]*x+o[14]*b,l[3]=o[3]*u+o[7]*g+o[11]*x+o[15]*b,l}function Ve(){var l=new Gt(4);return Gt!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function He(){var l=new Gt(2);return Gt!=Float32Array&&(l[0]=0,l[1]=0),l}function je(l,i){var o=new Gt(2);return o[0]=l,o[1]=i,o}Math.hypot||(Math.hypot=function(){for(var l=0,i=arguments.length;i--;)l+=arguments[i]*arguments[i];return Math.sqrt(l)}),ze(),Vt=new Gt(4),Gt!=Float32Array&&(Vt[0]=0,Vt[1]=0,Vt[2]=0,Vt[3]=0),ze(),Me(1,0,0),Me(0,1,0),Ve(),Ve(),ie(),He();const xe=8192;function De(l,i,o){return i*(xe/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}function Oe(l,i){return(l%i+i)%i}function qe(l,i,o){return l*(1-o)+i*o}function zi(l){if(l<=0)return 0;if(l>=1)return 1;const i=l*l,o=i*l;return 4*(l<.5?o:3*(l-i)+o-.75)}function mi(l,i,o,u){const g=new mt(l,i,o,u);return x=>g.solve(x)}const ci=mi(.25,.1,.25,1);function Ii(l,i,o){return Math.min(o,Math.max(i,l))}function Ce(l,i,o){const u=o-i,g=((l-i)%u+u)%u+i;return g===i?o:g}function ai(l,...i){for(const o of i)for(const u in o)l[u]=o[u];return l}let ii=1;function Jt(l,i,o){const u={};for(const g in l)u[g]=i.call(this,l[g],g,l);return u}function me(l,i,o){const u={};for(const g in l)i.call(this,l[g],g,l)&&(u[g]=l[g]);return u}function ue(l){return Array.isArray(l)?l.map(ue):typeof l=="object"&&l?Jt(l,ue):l}const Pt={};function X(l){Pt[l]||(typeof console<"u"&&console.warn(l),Pt[l]=!0)}function N(l,i,o){return(o.y-l.y)*(i.x-l.x)>(i.y-l.y)*(o.x-l.x)}function O(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let K=null;function nt(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ht(l,i,o,u,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(l,{timestamp:0});try{const b=x==null?void 0:x.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const S=b.startsWith("BGR"),M=new Uint8ClampedArray(u*g*4);if(yield x.copyTo(M,function(I,A,z,j,U){const H=4*Math.max(1,0),q=(Math.max(0,z)-z)*j*4+H,it=4*j,ct=Math.max(0,A),St=Math.max(0,z);return{rect:{x:ct,y:St,width:Math.min(I.width,A+j)-ct,height:Math.min(I.height,z+U)-St},layout:[{offset:q,stride:it}]}}(l,i,o,u,g)),S)for(let I=0;I<M.length;I+=4){const A=M[I];M[I]=M[I+2],M[I+2]=A}return M}finally{x.close()}})}let Tt,Et;function jt(l){return l/Math.PI*180}const Ft="AbortError";function se(){return new Error(Ft)}const re={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ve(l){return re.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const Te="global-dispatcher";class Ne extends Error{constructor(i,o,u,g){super(`AJAXError: ${o} (${i}): ${u}`),this.status=i,this.statusText=o,this.url=u,this.body=g}}const Je=()=>O(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,$e=function(l,i){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const u=ve(l.url);if(u)return u(l,i);if(O(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:Te},i)}if(!(/^file:/.test(o=l.url)||/^file:/.test(Je())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(u,g){return a(this,void 0,void 0,function*(){const x=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,cache:u.cache,referrer:Je(),signal:g.signal});let b,S;u.type!=="json"||x.headers.has("Accept")||x.headers.set("Accept","application/json");try{b=yield fetch(x)}catch(I){throw new Ne(0,I.message,u.url,new Blob)}if(!b.ok){const I=yield b.blob();throw new Ne(b.status,b.statusText,u.url,I)}S=u.type==="arrayBuffer"||u.type==="image"?b.arrayBuffer():u.type==="json"?b.json():b.text();const M=yield S;if(g.signal.aborted)throw se();return{data:M,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(l,i);if(O(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:Te},i)}var o;return function(u,g){return new Promise((x,b)=>{var S;const M=new XMLHttpRequest;M.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(M.responseType="arraybuffer");for(const I in u.headers)M.setRequestHeader(I,u.headers[I]);u.type==="json"&&(M.responseType="text",!((S=u.headers)===null||S===void 0)&&S.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=u.credentials==="include",M.onerror=()=>{b(new Error(M.statusText))},M.onload=()=>{if(!g.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let I=M.response;if(u.type==="json")try{I=JSON.parse(M.response)}catch(A){return void b(A)}x({data:I,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const I=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});b(new Ne(M.status,M.statusText,u.url,I))}},g.signal.addEventListener("abort",()=>{M.abort(),b(se())}),M.send(u.body)})}(l,i)};function _i(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const i=new URL(l),o=window.location;return i.protocol===o.protocol&&i.host===o.host}function fi(l,i,o){o[l]&&o[l].indexOf(i)!==-1||(o[l]=o[l]||[],o[l].push(i))}function ns(l,i,o){if(o&&o[l]){const u=o[l].indexOf(i);u!==-1&&o[l].splice(u,1)}}class Qi{constructor(i,o={}){ai(this,o),this.type=i}}class Js extends Qi{constructor(i,o={}){super("error",ai({error:i},o))}}class Qs{on(i,o){return this._listeners=this._listeners||{},fi(i,o,this._listeners),{unsubscribe:()=>{this.off(i,o)}}}off(i,o){return ns(i,o,this._listeners),ns(i,o,this._oneTimeListeners),this}once(i,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},fi(i,o,this._oneTimeListeners),this):new Promise(u=>this.once(i,u))}fire(i,o){typeof i=="string"&&(i=new Qi(i,o||{}));const u=i.type;if(this.listens(u)){i.target=this;const g=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of g)S.call(this,i);const x=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of x)ns(u,S,this._oneTimeListeners),S.call(this,i);const b=this._eventedParent;b&&(ai(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(i))}else i instanceof Js&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,o){return this._eventedParent=i,this._eventedParentData=o,this}}var st={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const G=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Y(l,i){const o={};for(const u in l)u!=="ref"&&(o[u]=l[u]);return G.forEach(u=>{u in i&&(o[u]=i[u])}),o}function Q(l,i){if(Array.isArray(l)){if(!Array.isArray(i)||l.length!==i.length)return!1;for(let o=0;o<l.length;o++)if(!Q(l[o],i[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&i!==null){if(typeof i!="object"||Object.keys(l).length!==Object.keys(i).length)return!1;for(const o in l)if(!Q(l[o],i[o]))return!1;return!0}return l===i}function dt(l,i){l.push(i)}function bt(l,i,o){dt(o,{command:"addSource",args:[l,i[l]]})}function It(l,i,o){dt(i,{command:"removeSource",args:[l]}),o[l]=!0}function Bt(l,i,o,u){It(l,o,u),bt(l,i,o)}function kt(l,i,o){let u;for(u in l[o])if(Object.prototype.hasOwnProperty.call(l[o],u)&&u!=="data"&&!Q(l[o][u],i[o][u]))return!1;for(u in i[o])if(Object.prototype.hasOwnProperty.call(i[o],u)&&u!=="data"&&!Q(l[o][u],i[o][u]))return!1;return!0}function Zt(l,i,o,u,g,x){l=l||{},i=i||{};for(const b in l)Object.prototype.hasOwnProperty.call(l,b)&&(Q(l[b],i[b])||o.push({command:x,args:[u,b,i[b],g]}));for(const b in i)Object.prototype.hasOwnProperty.call(i,b)&&!Object.prototype.hasOwnProperty.call(l,b)&&(Q(l[b],i[b])||o.push({command:x,args:[u,b,i[b],g]}))}function $t(l){return l.id}function Dt(l,i){return l[i.id]=i,l}class Mt{constructor(i,o,u,g){this.message=(i?`${i}: `:"")+u,g&&(this.identifier=g),o!=null&&o.__line__&&(this.line=o.__line__)}}function he(l,...i){for(const o of i)for(const u in o)l[u]=o[u];return l}class le extends Error{constructor(i,o){super(o),this.message=o,this.key=i}}class Ee{constructor(i,o=[]){this.parent=i,this.bindings={};for(const[u,g]of o)this.bindings[u]=g}concat(i){return new Ee(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Be={kind:"null"},Xt={kind:"number"},de={kind:"string"},Se={kind:"boolean"},We={kind:"color"},ni={kind:"projectionDefinition"},Le={kind:"object"},ye={kind:"value"},Wi={kind:"collator"},lr={kind:"formatted"},ds={kind:"padding"},as={kind:"resolvedImage"},Ri={kind:"variableAnchorOffsetCollection"};function tn(l,i){return{kind:"array",itemType:l,N:i}}function Li(l){if(l.kind==="array"){const i=Li(l.itemType);return typeof l.N=="number"?`array<${i}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${i}>`}return l.kind}const ta=[Be,Xt,de,Se,We,ni,lr,Le,tn(ye),ds,as,Ri];function ho(l,i){if(i.kind==="error")return null;if(l.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!ho(l.itemType,i.itemType))&&(typeof l.N!="number"||l.N===i.N))return null}else{if(l.kind===i.kind)return null;if(l.kind==="value"){for(const o of ta)if(!ho(o,i))return null}}return`Expected ${Li(l)} but found ${Li(i)} instead.`}function _c(l,i){return i.some(o=>o.kind===l.kind)}function Mr(l,i){return i.some(o=>o==="null"?l===null:o==="array"?Array.isArray(l):o==="object"?l&&!Array.isArray(l)&&typeof l=="object":o===typeof l)}function Pr(l,i){return l.kind==="array"&&i.kind==="array"?l.itemType.kind===i.itemType.kind&&typeof l.N=="number":l.kind===i.kind}const Fu=.96422,yc=.82521,Ou=4/29,uo=6/29,Bu=3*uo*uo,xp=uo*uo*uo,bp=Math.PI/180,vp=180/Math.PI;function ju(l){return(l%=360)<0&&(l+=360),l}function xc([l,i,o,u]){let g,x;const b=bc((.2225045*(l=Cr(l))+.7168786*(i=Cr(i))+.0606169*(o=Cr(o)))/1);l===i&&i===o?g=x=b:(g=bc((.4360747*l+.3850649*i+.1430804*o)/Fu),x=bc((.0139322*l+.0971045*i+.7141733*o)/yc));const S=116*b-16;return[S<0?0:S,500*(g-b),200*(b-x),u]}function Cr(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function bc(l){return l>xp?Math.pow(l,1/3):l/Bu+Ou}function Nu([l,i,o,u]){let g=(l+16)/116,x=isNaN(i)?g:g+i/500,b=isNaN(o)?g:g-o/200;return g=1*vc(g),x=Fu*vc(x),b=yc*vc(b),[kr(3.1338561*x-1.6168667*g-.4906146*b),kr(-.9787684*x+1.9161415*g+.033454*b),kr(.0719453*x-.2289914*g+1.4052427*b),u]}function kr(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function vc(l){return l>uo?l*l*l:Bu*(l-Ou)}function Qa(l){return parseInt(l.padEnd(2,l),16)/255}function Vu(l,i){return Ir(i?l/100:l,0,1)}function Ir(l,i,o){return Math.min(Math.max(i,l),o)}function wc(l){return!l.some(Number.isNaN)}const zn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Xe(l,i,o){return l+o*(i-l)}function Rn(l,i,o){return l.map((u,g)=>Xe(u,i[g],o))}class Ke{constructor(i,o,u,g=1,x=!0){this.r=i,this.g=o,this.b=u,this.a=g,x||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,o,u,g]))}static parse(i){if(i instanceof Ke)return i;if(typeof i!="string")return;const o=function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=zn[u];if(g){const[b,S,M]=g;return[b/255,S/255,M/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const b=u.length<6?1:2;let S=1;return[Qa(u.slice(S,S+=b)),Qa(u.slice(S,S+=b)),Qa(u.slice(S,S+=b)),Qa(u.slice(S,S+b)||"ff")]}if(u.startsWith("rgb")){const b=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[S,M,I,A,z,j,U,H,q,it,ct,St]=b,ft=[A||" ",U||" ",it].join("");if(ft==="  "||ft==="  /"||ft===",,"||ft===",,,"){const $=[I,j,q].join(""),tt=$==="%%%"?100:$===""?255:0;if(tt){const pt=[Ir(+M/tt,0,1),Ir(+z/tt,0,1),Ir(+H/tt,0,1),ct?Vu(+ct,St):1];if(wc(pt))return pt}}return}}const x=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[b,S,M,I,A,z,j,U,H]=x,q=[M||" ",A||" ",j].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const it=[+S,Ir(+I,0,100),Ir(+z,0,100),U?Vu(+U,H):1];if(wc(it))return function([ct,St,ft,$]){function tt(pt){const Rt=(pt+ct/30)%12,Qt=St*Math.min(ft,1-ft);return ft-Qt*Math.max(-1,Math.min(Rt-3,9-Rt,1))}return ct=ju(ct),St/=100,ft/=100,[tt(0),tt(8),tt(4),$]}(it)}}}(i);return o?new Ke(...o,!1):void 0}get rgb(){const{r:i,g:o,b:u,a:g}=this,x=g||1/0;return this.overwriteGetter("rgb",[i/x,o/x,u/x,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[o,u,g,x]=xc(i),b=Math.sqrt(u*u+g*g);return[Math.round(1e4*b)?ju(Math.atan2(g,u)*vp):NaN,b,o,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",xc(this.rgb))}overwriteGetter(i,o){return Object.defineProperty(this,i,{value:o}),o}toString(){const[i,o,u,g]=this.rgb;return`rgba(${[i,o,u].map(x=>Math.round(255*x)).join(",")},${g})`}static interpolate(i,o,u,g="rgb"){switch(g){case"rgb":{const[x,b,S,M]=Rn(i.rgb,o.rgb,u);return new Ke(x,b,S,M,!1)}case"hcl":{const[x,b,S,M]=i.hcl,[I,A,z,j]=o.hcl;let U,H;if(isNaN(x)||isNaN(I))isNaN(x)?isNaN(I)?U=NaN:(U=I,S!==1&&S!==0||(H=A)):(U=x,z!==1&&z!==0||(H=b));else{let ft=I-x;I>x&&ft>180?ft-=360:I<x&&x-I>180&&(ft+=360),U=x+u*ft}const[q,it,ct,St]=function([ft,$,tt,pt]){return ft=isNaN(ft)?0:ft*bp,Nu([tt,Math.cos(ft)*$,Math.sin(ft)*$,pt])}([U,H??Xe(b,A,u),Xe(S,z,u),Xe(M,j,u)]);return new Ke(q,it,ct,St,!1)}case"lab":{const[x,b,S,M]=Nu(Rn(i.lab,o.lab,u));return new Ke(x,b,S,M,!1)}}}}Ke.black=new Ke(0,0,0,1),Ke.white=new Ke(1,1,1,1),Ke.transparent=new Ke(0,0,0,0),Ke.red=new Ke(1,0,0,1);class tl{constructor(i,o,u){this.sensitivity=i?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,o){return this.collator.compare(i,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const $u=["bottom","center","top"];class ea{constructor(i,o,u,g,x,b){this.text=i,this.image=o,this.scale=u,this.fontStack=g,this.textColor=x,this.verticalAlign=b}}class ts{constructor(i){this.sections=i}static fromString(i){return new ts([new ea(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof ts?i:ts.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class fs{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof fs)return i;if(typeof i=="number")return new fs([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const o of i)if(typeof o!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new fs(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,o,u){return new fs(Rn(i.values,o.values,u))}}class $i{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Sc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ds{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Ds)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let o=0;o<i.length;o+=2){const u=i[o],g=i[o+1];if(typeof u!="string"||!Sc.has(u)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Ds(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,o,u){const g=i.values,x=o.values;if(g.length!==x.length)throw new $i(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${o.toString()}`);const b=[];for(let S=0;S<g.length;S+=2){if(g[S]!==x[S])throw new $i(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${g[S]}, to[${S}]: ${x[S]}`);b.push(g[S]);const[M,I]=g[S+1],[A,z]=x[S+1];b.push([Xe(M,A,u),Xe(I,z,u)])}return new Ds(b)}}class As{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new As({name:i,available:!1}):null}}class Es{constructor(i,o,u){this.from=i,this.to=o,this.transition=u}static interpolate(i,o,u){return new Es(i,o,u)}static parse(i){return i instanceof Es?i:Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"?new Es(i[0],i[1],i[2]):typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number"?new Es(i.from,i.to,i.transition):typeof i=="string"?new Es(i,i,1):void 0}}function Tc(l,i,o,u){return typeof l=="number"&&l>=0&&l<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[l,i,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[l,i,o,u]:[l,i,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Dr(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Es||l instanceof Ke||l instanceof tl||l instanceof ts||l instanceof fs||l instanceof Ds||l instanceof As)return!0;if(Array.isArray(l)){for(const i of l)if(!Dr(i))return!1;return!0}if(typeof l=="object"){for(const i in l)if(!Dr(l[i]))return!1;return!0}return!1}function Di(l){if(l===null)return Be;if(typeof l=="string")return de;if(typeof l=="boolean")return Se;if(typeof l=="number")return Xt;if(l instanceof Ke)return We;if(l instanceof Es)return ni;if(l instanceof tl)return Wi;if(l instanceof ts)return lr;if(l instanceof fs)return ds;if(l instanceof Ds)return Ri;if(l instanceof As)return as;if(Array.isArray(l)){const i=l.length;let o;for(const u of l){const g=Di(u);if(o){if(o===g)continue;o=ye;break}o=g}return tn(o||ye,i)}return Le}function ia(l){const i=typeof l;return l===null?"":i==="string"||i==="number"||i==="boolean"?String(l):l instanceof Ke||l instanceof Es||l instanceof ts||l instanceof fs||l instanceof Ds||l instanceof As?l.toString():JSON.stringify(l)}class Ln{constructor(i,o){this.type=i,this.value=o}static parse(i,o){if(i.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Dr(i[1]))return o.error("invalid value");const u=i[1];let g=Di(u);const x=o.expectedType;return g.kind!=="array"||g.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(g=x),new Ln(g,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Un={string:de,number:Xt,boolean:Se,object:Le};class un{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let u,g=1;const x=i[0];if(x==="array"){let S,M;if(i.length>2){const I=i[1];if(typeof I!="string"||!(I in Un)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);S=Un[I],g++}else S=ye;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return o.error('The length argument to "array" must be a positive integer literal',2);M=i[2],g++}u=tn(S,M)}else{if(!Un[x])throw new Error(`Types doesn't contain name = ${x}`);u=Un[x]}const b=[];for(;g<i.length;g++){const S=o.parse(i[g],g,ye);if(!S)return null;b.push(S)}return new un(u,b)}evaluate(i){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(i);if(!ho(this.type,Di(u)))return u;if(o===this.args.length-1)throw new $i(`Expected value to be of type ${Li(this.type)}, but found ${Li(Di(u))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Mc={"to-boolean":Se,"to-color":We,"to-number":Xt,"to-string":de};class Hn{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const u=i[0];if(!Mc[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&i.length!==2)return o.error("Expected one argument.");const g=Mc[u],x=[];for(let b=1;b<i.length;b++){const S=o.parse(i[b],b,ye);if(!S)return null;x.push(S)}return new Hn(g,x)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let o,u;for(const g of this.args){if(o=g.evaluate(i),u=null,o instanceof Ke)return o;if(typeof o=="string"){const x=i.parseColor(o);if(x)return x}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rgba value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Tc(o[0],o[1],o[2],o[3]),!u))return new Ke(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new $i(u||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const u of this.args){o=u.evaluate(i);const g=fs.parse(o);if(g)return g}throw new $i(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const u of this.args){o=u.evaluate(i);const g=Ds.parse(o);if(g)return g}throw new $i(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const u of this.args){if(o=u.evaluate(i),o===null)return 0;const g=Number(o);if(!isNaN(g))return g}throw new $i(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return ts.fromString(ia(this.args[0].evaluate(i)));case"resolvedImage":return As.fromString(ia(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return ia(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const el=["Unknown","Point","LineString","Polygon"];class Ai{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?el[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let o=this._parseColorCache[i];return o||(o=this._parseColorCache[i]=Ke.parse(i)),o}}class fo{constructor(i,o,u=[],g,x=new Ee,b=[]){this.registry=i,this.path=u,this.key=u.map(S=>`[${S}]`).join(""),this.scope=x,this.errors=b,this.expectedType=g,this._isConstant=o}parse(i,o,u,g,x={}){return o?this.concat(o,u,g)._parse(i,x):this._parse(i,x)}_parse(i,o){function u(g,x,b){return b==="assert"?new un(x,[g]):b==="coerce"?new Hn(x,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[g];if(x){let b=x.parse(i,this);if(!b)return null;if(this.expectedType){const S=this.expectedType,M=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="projectionDefinition"||M.kind!=="string"&&M.kind!=="array")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(S.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array")if(S.kind!=="variableAnchorOffsetCollection"||M.kind!=="value"&&M.kind!=="array"){if(this.checkSubtype(S,M))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof Ln)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const S=new Ai;try{b=new Ln(b.type,b.evaluate(S))}catch(M){return this.error(M.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,o,u){const g=typeof i=="number"?this.path.concat(i):this.path,x=u?this.scope.concat(u):this.scope;return new fo(this.registry,this._isConstant,g,o||null,x,this.errors)}error(i,...o){const u=`${this.key}${o.map(g=>`[${g}]`).join("")}`;this.errors.push(new le(u,i))}checkSubtype(i,o){const u=ho(i,o);return u&&this.error(u),u}}class si{constructor(i,o){this.type=o.type,this.bindings=[].concat(i),this.result=o}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const o of this.bindings)i(o[1]);i(this.result)}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const u=[];for(let x=1;x<i.length-1;x+=2){const b=i[x];if(typeof b!="string")return o.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return o.error("Variable names must contain only alphanumeric characters or '_'.",x);const S=o.parse(i[x+1],x+1);if(!S)return null;u.push([b,S])}const g=o.parse(i[i.length-1],i.length-1,o.expectedType,u);return g?new si(u,g):null}outputDefined(){return this.result.outputDefined()}}class Ze{constructor(i,o){this.type=o.type,this.name=i,this.boundExpression=o}static parse(i,o){if(i.length!==2||typeof i[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=i[1];return o.scope.has(u)?new Ze(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class sa{constructor(i,o,u){this.type=i,this.index=o,this.input=u}static parse(i,o){if(i.length!==3)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=o.parse(i[1],1,Xt),g=o.parse(i[2],2,tn(o.expectedType||ye));return u&&g?new sa(g.type.itemType,u,g):null}evaluate(i){const o=this.index.evaluate(i),u=this.input.evaluate(i);if(o<0)throw new $i(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new $i(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new $i(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class ri{constructor(i,o){this.type=Se,this.needle=i,this.haystack=o}static parse(i,o){if(i.length!==3)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=o.parse(i[1],1,ye),g=o.parse(i[2],2,ye);return u&&g?_c(u.type,[Se,de,Xt,Be,ye])?new ri(u,g):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Li(u.type)} instead`):null}evaluate(i){const o=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!u)return!1;if(!Mr(o,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${Li(Di(o))} instead.`);if(!Mr(u,["string","array"]))throw new $i(`Expected second argument to be of type array or string, but found ${Li(Di(u))} instead.`);return u.indexOf(o)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class po{constructor(i,o,u){this.type=Xt,this.needle=i,this.haystack=o,this.fromIndex=u}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=o.parse(i[1],1,ye),g=o.parse(i[2],2,ye);if(!u||!g)return null;if(!_c(u.type,[Se,de,Xt,Be,ye]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Li(u.type)} instead`);if(i.length===4){const x=o.parse(i[3],3,Xt);return x?new po(u,g,x):null}return new po(u,g)}evaluate(i){const o=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!Mr(o,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${Li(Di(o))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(i)),Mr(u,["string"])){const x=u.indexOf(o,g);return x===-1?-1:[...u.slice(0,x)].length}if(Mr(u,["array"]))return u.indexOf(o,g);throw new $i(`Expected second argument to be of type array or string, but found ${Li(Di(u))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class bn{constructor(i,o,u,g,x,b){this.inputType=i,this.type=o,this.input=u,this.cases=g,this.outputs=x,this.otherwise=b}static parse(i,o){if(i.length<5)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return o.error("Expected an even number of arguments.");let u,g;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);const x={},b=[];for(let I=2;I<i.length-1;I+=2){let A=i[I];const z=i[I+1];Array.isArray(A)||(A=[A]);const j=o.concat(I);if(A.length===0)return j.error("Expected at least one branch label.");for(const H of A){if(typeof H!="number"&&typeof H!="string")return j.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return j.error("Numeric branch labels must be integer values.");if(u){if(j.checkSubtype(u,Di(H)))return null}else u=Di(H);if(x[String(H)]!==void 0)return j.error("Branch labels must be unique.");x[String(H)]=b.length}const U=o.parse(z,I,g);if(!U)return null;g=g||U.type,b.push(U)}const S=o.parse(i[1],1,ye);if(!S)return null;const M=o.parse(i[i.length-1],i.length-1,g);return M?S.type.kind!=="value"&&o.concat(1).checkSubtype(u,S.type)?null:new bn(u,g,S,x,b,M):null}evaluate(i){const o=this.input.evaluate(i);return(Di(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class na{constructor(i,o,u){this.type=i,this.branches=o,this.otherwise=u}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const g=[];for(let b=1;b<i.length-1;b+=2){const S=o.parse(i[b],b,Se);if(!S)return null;const M=o.parse(i[b+1],b+1,u);if(!M)return null;g.push([S,M]),u=u||M.type}const x=o.parse(i[i.length-1],i.length-1,u);if(!x)return null;if(!u)throw new Error("Can't infer output type");return new na(u,g,x)}evaluate(i){for(const[o,u]of this.branches)if(o.evaluate(i))return u.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[o,u]of this.branches)i(o),i(u);i(this.otherwise)}outputDefined(){return this.branches.every(([i,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class ra{constructor(i,o,u,g){this.type=i,this.input=o,this.beginIndex=u,this.endIndex=g}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=o.parse(i[1],1,ye),g=o.parse(i[2],2,Xt);if(!u||!g)return null;if(!_c(u.type,[tn(ye),de,ye]))return o.error(`Expected first argument to be of type array or string, but found ${Li(u.type)} instead`);if(i.length===4){const x=o.parse(i[3],3,Xt);return x?new ra(u.type,u,g,x):null}return new ra(u.type,u,g)}evaluate(i){const o=this.input.evaluate(i),u=this.beginIndex.evaluate(i);let g;if(this.endIndex&&(g=this.endIndex.evaluate(i)),Mr(o,["string"]))return[...o].slice(u,g).join("");if(Mr(o,["array"]))return o.slice(u,g);throw new $i(`Expected first argument to be of type array or string, but found ${Li(Di(o))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function oa(l,i){const o=l.length-1;let u,g,x=0,b=o,S=0;for(;x<=b;)if(S=Math.floor((x+b)/2),u=l[S],g=l[S+1],u<=i){if(S===o||i<g)return S;x=S+1}else{if(!(u>i))throw new $i("Input is not a number.");b=S-1}return 0}class Ar{constructor(i,o,u){this.type=i,this.input=o,this.labels=[],this.outputs=[];for(const[g,x]of u)this.labels.push(g),this.outputs.push(x)}static parse(i,o){if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(i[1],1,Xt);if(!u)return null;const g=[];let x=null;o.expectedType&&o.expectedType.kind!=="value"&&(x=o.expectedType);for(let b=1;b<i.length;b+=2){const S=b===1?-1/0:i[b],M=i[b+1],I=b,A=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(g.length&&g[g.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const z=o.parse(M,A,x);if(!z)return null;x=x||z.type,g.push([S,z])}return new Ar(x,u,g)}evaluate(i){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(i);const g=this.input.evaluate(i);if(g<=o[0])return u[0].evaluate(i);const x=o.length;return g>=o[x-1]?u[x-1].evaluate(i):u[oa(o,g)].evaluate(i)}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Uu(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Pc,Cc,Hu=function(){if(Cc)return Pc;function l(i,o,u,g){this.cx=3*i,this.bx=3*(u-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(g-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=u,this.p2y=g}return Cc=1,Pc=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,o){if(o===void 0&&(o=1e-6),i<0)return 0;if(i>1)return 1;for(var u=i,g=0;g<8;g++){var x=this.sampleCurveX(u)-i;if(Math.abs(x)<o)return u;var b=this.sampleCurveDerivativeX(u);if(Math.abs(b)<1e-6)break;u-=x/b}var S=0,M=1;for(u=i,g=0;g<20&&(x=this.sampleCurveX(u),!(Math.abs(x-i)<o));g++)i>x?S=u:M=u,u=.5*(M-S)+S;return u},solve:function(i,o){return this.sampleCurveY(this.solveCurveX(i,o))}},Pc}(),aa=Uu(Hu);class wi{constructor(i,o,u,g,x){this.type=i,this.operator=o,this.interpolation=u,this.input=g,this.labels=[],this.outputs=[];for(const[b,S]of x)this.labels.push(b),this.outputs.push(S)}static interpolationFactor(i,o,u,g){let x=0;if(i.name==="exponential")x=mo(o,i.base,u,g);else if(i.name==="linear")x=mo(o,1,u,g);else if(i.name==="cubic-bezier"){const b=i.controlPoints;x=new aa(b[0],b[1],b[2],b[3]).solve(mo(o,1,u,g))}return x}static parse(i,o){let[u,g,x,...b]=i;if(!Array.isArray(g)||g.length===0)return o.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const I=g[1];if(typeof I!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:I}}else{if(g[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const I=g.slice(1);if(I.length!==4||I.some(A=>typeof A!="number"||A<0||A>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:I}}}if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(x=o.parse(x,2,Xt),!x)return null;const S=[];let M=null;u==="interpolate-hcl"||u==="interpolate-lab"?M=We:o.expectedType&&o.expectedType.kind!=="value"&&(M=o.expectedType);for(let I=0;I<b.length;I+=2){const A=b[I],z=b[I+1],j=I+3,U=I+4;if(typeof A!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(S.length&&S[S.length-1][0]>=A)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const H=o.parse(z,U,M);if(!H)return null;M=M||H.type,S.push([A,H])}return Pr(M,Xt)||Pr(M,ni)||Pr(M,We)||Pr(M,ds)||Pr(M,Ri)||Pr(M,tn(Xt))?new wi(M,u,g,x,S):o.error(`Type ${Li(M)} is not interpolatable.`)}evaluate(i){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(i);const g=this.input.evaluate(i);if(g<=o[0])return u[0].evaluate(i);const x=o.length;if(g>=o[x-1])return u[x-1].evaluate(i);const b=oa(o,g),S=wi.interpolationFactor(this.interpolation,g,o[b],o[b+1]),M=u[b].evaluate(i),I=u[b+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Xe(M,I,S);case"color":return Ke.interpolate(M,I,S);case"padding":return fs.interpolate(M,I,S);case"variableAnchorOffsetCollection":return Ds.interpolate(M,I,S);case"array":return Rn(M,I,S);case"projectionDefinition":return Es.interpolate(M,I,S)}case"interpolate-hcl":return Ke.interpolate(M,I,S,"hcl");case"interpolate-lab":return Ke.interpolate(M,I,S,"lab")}}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function mo(l,i,o,u){const g=u-o,x=l-o;return g===0?0:i===1?x/g:(Math.pow(i,x)-1)/(Math.pow(i,g)-1)}const vn={color:Ke.interpolate,number:Xe,padding:fs.interpolate,variableAnchorOffsetCollection:Ds.interpolate,array:Rn};class Er{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let u=null;const g=o.expectedType;g&&g.kind!=="value"&&(u=g);const x=[];for(const S of i.slice(1)){const M=o.parse(S,1+x.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,x.push(M)}if(!u)throw new Error("No output type");const b=g&&x.some(S=>ho(g,S.type));return new Er(b?ye:u,x)}evaluate(i){let o,u=null,g=0;for(const x of this.args)if(g++,u=x.evaluate(i),u&&u instanceof As&&!u.available&&(o||(o=u.name),u=null,g===this.args.length&&(u=o)),u!==null)break;return u}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function ps(l,i){return l==="=="||l==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function kc(l,i,o,u){return u.compare(i,o)===0}function cr(l,i,o){const u=l!=="=="&&l!=="!=";return class N0{constructor(x,b,S){this.type=Se,this.lhs=x,this.rhs=b,this.collator=S,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const S=x[0];let M=b.parse(x[1],1,ye);if(!M)return null;if(!ps(S,M.type))return b.concat(1).error(`"${S}" comparisons are not supported for type '${Li(M.type)}'.`);let I=b.parse(x[2],2,ye);if(!I)return null;if(!ps(S,I.type))return b.concat(2).error(`"${S}" comparisons are not supported for type '${Li(I.type)}'.`);if(M.type.kind!==I.type.kind&&M.type.kind!=="value"&&I.type.kind!=="value")return b.error(`Cannot compare types '${Li(M.type)}' and '${Li(I.type)}'.`);u&&(M.type.kind==="value"&&I.type.kind!=="value"?M=new un(I.type,[M]):M.type.kind!=="value"&&I.type.kind==="value"&&(I=new un(M.type,[I])));let A=null;if(x.length===4){if(M.type.kind!=="string"&&I.type.kind!=="string"&&M.type.kind!=="value"&&I.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(A=b.parse(x[3],3,Wi),!A)return null}return new N0(M,I,A)}evaluate(x){const b=this.lhs.evaluate(x),S=this.rhs.evaluate(x);if(u&&this.hasUntypedArgument){const M=Di(b),I=Di(S);if(M.kind!==I.kind||M.kind!=="string"&&M.kind!=="number")throw new $i(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${M.kind}, ${I.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const M=Di(b),I=Di(S);if(M.kind!=="string"||I.kind!=="string")return i(x,b,S)}return this.collator?o(x,b,S,this.collator.evaluate(x)):i(x,b,S)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Zu=cr("==",function(l,i,o){return i===o},kc),wp=cr("!=",function(l,i,o){return i!==o},function(l,i,o,u){return!kc(0,i,o,u)}),il=cr("<",function(l,i,o){return i<o},function(l,i,o,u){return u.compare(i,o)<0}),Ic=cr(">",function(l,i,o){return i>o},function(l,i,o,u){return u.compare(i,o)>0}),Sp=cr("<=",function(l,i,o){return i<=o},function(l,i,o,u){return u.compare(i,o)<=0}),sl=cr(">=",function(l,i,o){return i>=o},function(l,i,o,u){return u.compare(i,o)>=0});class zr{constructor(i,o,u){this.type=Wi,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=o}static parse(i,o){if(i.length!==2)return o.error("Expected one argument.");const u=i[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const g=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Se);if(!g)return null;const x=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Se);if(!x)return null;let b=null;return u.locale&&(b=o.parse(u.locale,1,de),!b)?null:new zr(g,x,b)}evaluate(i){return new tl(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class en{constructor(i,o,u,g,x){this.type=de,this.number=i,this.locale=o,this.currency=u,this.minFractionDigits=g,this.maxFractionDigits=x}static parse(i,o){if(i.length!==3)return o.error("Expected two arguments.");const u=o.parse(i[1],1,Xt);if(!u)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return o.error("NumberFormat options argument must be an object.");let x=null;if(g.locale&&(x=o.parse(g.locale,1,de),!x))return null;let b=null;if(g.currency&&(b=o.parse(g.currency,1,de),!b))return null;let S=null;if(g["min-fraction-digits"]&&(S=o.parse(g["min-fraction-digits"],1,Xt),!S))return null;let M=null;return g["max-fraction-digits"]&&(M=o.parse(g["max-fraction-digits"],1,Xt),!M)?null:new en(u,x,b,S,M)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class la{constructor(i){this.type=lr,this.sections=i}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const u=i[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const g=[];let x=!1;for(let b=1;b<=i.length-1;++b){const S=i[b];if(x&&typeof S=="object"&&!Array.isArray(S)){x=!1;let M=null;if(S["font-scale"]&&(M=o.parse(S["font-scale"],1,Xt),!M))return null;let I=null;if(S["text-font"]&&(I=o.parse(S["text-font"],1,tn(de)),!I))return null;let A=null;if(S["text-color"]&&(A=o.parse(S["text-color"],1,We),!A))return null;let z=null;if(S["vertical-align"]){if(typeof S["vertical-align"]=="string"&&!$u.includes(S["vertical-align"]))return o.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${S["vertical-align"]}' instead.`);if(z=o.parse(S["vertical-align"],1,de),!z)return null}const j=g[g.length-1];j.scale=M,j.font=I,j.textColor=A,j.verticalAlign=z}else{const M=o.parse(i[b],1,ye);if(!M)return null;const I=M.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,g.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new la(g)}evaluate(i){return new ts(this.sections.map(o=>{const u=o.content.evaluate(i);return Di(u)===as?new ea("",u,null,null,null,o.verticalAlign?o.verticalAlign.evaluate(i):null):new ea(ia(u),null,o.scale?o.scale.evaluate(i):null,o.font?o.font.evaluate(i).join(","):null,o.textColor?o.textColor.evaluate(i):null,o.verticalAlign?o.verticalAlign.evaluate(i):null)}))}eachChild(i){for(const o of this.sections)i(o.content),o.scale&&i(o.scale),o.font&&i(o.font),o.textColor&&i(o.textColor),o.verticalAlign&&i(o.verticalAlign)}outputDefined(){return!1}}class go{constructor(i){this.type=as,this.input=i}static parse(i,o){if(i.length!==2)return o.error("Expected two arguments.");const u=o.parse(i[1],1,de);return u?new go(u):o.error("No image name provided.")}evaluate(i){const o=this.input.evaluate(i),u=As.fromString(o);return u&&i.availableImages&&(u.available=i.availableImages.indexOf(o)>-1),u}eachChild(i){i(this.input)}outputDefined(){return!1}}class Dc{constructor(i){this.type=Xt,this.input=i}static parse(i,o){if(i.length!==2)return o.error(`Expected 1 argument, but found ${i.length-1} instead.`);const u=o.parse(i[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Li(u.type)} instead.`):new Dc(u):null}evaluate(i){const o=this.input.evaluate(i);if(typeof o=="string")return[...o].length;if(Array.isArray(o))return o.length;throw new $i(`Expected value to be of type string or array, but found ${Li(Di(o))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const dn=8192;function Tp(l,i){const o=(180+l[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(o*g*dn),Math.round(u*g*dn)]}function Ac(l,i){const o=Math.pow(2,i.z);return[(g=(l[0]/dn+i.x)/o,360*g-180),(u=(l[1]/dn+i.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90)];var u,g}function ca(l,i){l[0]=Math.min(l[0],i[0]),l[1]=Math.min(l[1],i[1]),l[2]=Math.max(l[2],i[0]),l[3]=Math.max(l[3],i[1])}function ha(l,i){return!(l[0]<=i[0]||l[2]>=i[2]||l[1]<=i[1]||l[3]>=i[3])}function nl(l,i,o){const u=l[0]-i[0],g=l[1]-i[1],x=l[0]-o[0],b=l[1]-o[1];return u*b-x*g==0&&u*x<=0&&g*b<=0}function rl(l,i,o,u){return(g=[u[0]-o[0],u[1]-o[1]])[0]*(x=[i[0]-l[0],i[1]-l[1]])[1]-g[1]*x[0]!=0&&!(!qu(l,i,o,u)||!qu(o,u,l,i));var g,x}function Gu(l,i,o){for(const u of o)for(let g=0;g<u.length-1;++g)if(rl(l,i,u[g],u[g+1]))return!0;return!1}function Rr(l,i,o=!1){let u=!1;for(const S of i)for(let M=0;M<S.length-1;M++){if(nl(l,S[M],S[M+1]))return o;(x=S[M])[1]>(g=l)[1]!=(b=S[M+1])[1]>g[1]&&g[0]<(b[0]-x[0])*(g[1]-x[1])/(b[1]-x[1])+x[0]&&(u=!u)}var g,x,b;return u}function Mp(l,i){for(const o of i)if(Rr(l,o))return!0;return!1}function Ec(l,i){for(const o of l)if(!Rr(o,i))return!1;for(let o=0;o<l.length-1;++o)if(Gu(l[o],l[o+1],i))return!1;return!0}function Pp(l,i){for(const o of i)if(Ec(l,o))return!0;return!1}function qu(l,i,o,u){const g=u[0]-o[0],x=u[1]-o[1],b=(l[0]-o[0])*x-g*(l[1]-o[1]),S=(i[0]-o[0])*x-g*(i[1]-o[1]);return b>0&&S<0||b<0&&S>0}function zc(l,i,o){const u=[];for(let g=0;g<l.length;g++){const x=[];for(let b=0;b<l[g].length;b++){const S=Tp(l[g][b],o);ca(i,S),x.push(S)}u.push(x)}return u}function Wu(l,i,o){const u=[];for(let g=0;g<l.length;g++){const x=zc(l[g],i,o);u.push(x)}return u}function Xu(l,i,o,u){if(l[0]<o[0]||l[0]>o[2]){const g=.5*u;let x=l[0]-o[0]>g?-u:o[0]-l[0]>g?u:0;x===0&&(x=l[0]-o[2]>g?-u:o[2]-l[0]>g?u:0),l[0]+=x}ca(i,l)}function Rc(l,i,o,u){const g=Math.pow(2,u.z)*dn,x=[u.x*dn,u.y*dn],b=[];for(const S of l)for(const M of S){const I=[M.x+x[0],M.y+x[1]];Xu(I,i,o,g),b.push(I)}return b}function Lc(l,i,o,u){const g=Math.pow(2,u.z)*dn,x=[u.x*dn,u.y*dn],b=[];for(const M of l){const I=[];for(const A of M){const z=[A.x+x[0],A.y+x[1]];ca(i,z),I.push(z)}b.push(I)}if(i[2]-i[0]<=g/2){(S=i)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const M of b)for(const I of M)Xu(I,i,o,g)}var S;return b}class hr{constructor(i,o){this.type=Se,this.geojson=i,this.geometries=o}static parse(i,o){if(i.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Dr(i[1])){const u=i[1];if(u.type==="FeatureCollection"){const g=[];for(const x of u.features){const{type:b,coordinates:S}=x.geometry;b==="Polygon"&&g.push(S),b==="MultiPolygon"&&g.push(...S)}if(g.length)return new hr(u,{type:"MultiPolygon",coordinates:g})}else if(u.type==="Feature"){const g=u.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new hr(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new hr(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(o,u){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){const S=zc(u.coordinates,x,b),M=Rc(o.geometry(),g,x,b);if(!ha(g,x))return!1;for(const I of M)if(!Rr(I,S))return!1}if(u.type==="MultiPolygon"){const S=Wu(u.coordinates,x,b),M=Rc(o.geometry(),g,x,b);if(!ha(g,x))return!1;for(const I of M)if(!Mp(I,S))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(o,u){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){const S=zc(u.coordinates,x,b),M=Lc(o.geometry(),g,x,b);if(!ha(g,x))return!1;for(const I of M)if(!Ec(I,S))return!1}if(u.type==="MultiPolygon"){const S=Wu(u.coordinates,x,b),M=Lc(o.geometry(),g,x,b);if(!ha(g,x))return!1;for(const I of M)if(!Pp(I,S))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ku=class{constructor(l=[],i=(o,u)=>o<u?-1:o>u?1:0){if(this.data=l,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:i,compare:o}=this,u=i[l];for(;l>0;){const g=l-1>>1,x=i[g];if(o(u,x)>=0)break;i[l]=x,l=g}i[l]=u}_down(l){const{data:i,compare:o}=this,u=this.length>>1,g=i[l];for(;l<u;){let x=1+(l<<1);const b=x+1;if(b<this.length&&o(i[b],i[x])<0&&(x=b),o(i[x],g)>=0)break;i[l]=i[x],l=x}i[l]=g}};function Yu(l,i,o=0,u=l.length-1,g=Fc){for(;u>o;){if(u-o>600){const M=u-o+1,I=i-o+1,A=Math.log(M),z=.5*Math.exp(2*A/3),j=.5*Math.sqrt(A*z*(M-z)/M)*(I-M/2<0?-1:1);Yu(l,i,Math.max(o,Math.floor(i-I*z/M+j)),Math.min(u,Math.floor(i+(M-I)*z/M+j)),g)}const x=l[i];let b=o,S=u;for(ua(l,o,i),g(l[u],x)>0&&ua(l,o,u);b<S;){for(ua(l,b,S),b++,S--;g(l[b],x)<0;)b++;for(;g(l[S],x)>0;)S--}g(l[o],x)===0?ua(l,o,S):(S++,ua(l,S,u)),S<=i&&(o=S+1),i<=S&&(u=S-1)}}function ua(l,i,o){const u=l[i];l[i]=l[o],l[o]=u}function Fc(l,i){return l<i?-1:l>i?1:0}function ol(l,i){if(l.length<=1)return[l];const o=[];let u,g;for(const x of l){const b=kp(x);b!==0&&(x.area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(u&&o.push(u),u=[x]):u.push(x))}if(u&&o.push(u),i>1)for(let x=0;x<o.length;x++)o[x].length<=i||(Yu(o[x],i,1,o[x].length-1,Cp),o[x]=o[x].slice(0,i));return o}function Cp(l,i){return i.area-l.area}function kp(l){let i=0;for(let o,u,g=0,x=l.length,b=x-1;g<x;b=g++)o=l[g],u=l[b],i+=(u.x-o.x)*(o.y+u.y);return i}const Oc=1/298.257223563,Bc=Oc*(2-Oc),Ju=Math.PI/180;class jc{constructor(i){const o=6378.137*Ju*1e3,u=Math.cos(i*Ju),g=1/(1-Bc*(1-u*u)),x=Math.sqrt(g);this.kx=o*x*u,this.ky=o*x*g*(1-Bc)}distance(i,o){const u=this.wrap(i[0]-o[0])*this.kx,g=(i[1]-o[1])*this.ky;return Math.sqrt(u*u+g*g)}pointOnLine(i,o){let u,g,x,b,S=1/0;for(let M=0;M<i.length-1;M++){let I=i[M][0],A=i[M][1],z=this.wrap(i[M+1][0]-I)*this.kx,j=(i[M+1][1]-A)*this.ky,U=0;z===0&&j===0||(U=(this.wrap(o[0]-I)*this.kx*z+(o[1]-A)*this.ky*j)/(z*z+j*j),U>1?(I=i[M+1][0],A=i[M+1][1]):U>0&&(I+=z/this.kx*U,A+=j/this.ky*U)),z=this.wrap(o[0]-I)*this.kx,j=(o[1]-A)*this.ky;const H=z*z+j*j;H<S&&(S=H,u=I,g=A,x=M,b=U)}return{point:[u,g],index:x,t:Math.max(0,Math.min(1,b))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function Nc(l,i){return i[0]-l[0]}function da(l){return l[1]-l[0]+1}function Zn(l,i){return l[1]>=l[0]&&l[1]<i}function Vc(l,i){if(l[0]>l[1])return[null,null];const o=da(l);if(i){if(o===2)return[l,null];const g=Math.floor(o/2);return[[l[0],l[0]+g],[l[0]+g,l[1]]]}if(o===1)return[l,null];const u=Math.floor(o/2)-1;return[[l[0],l[0]+u],[l[0]+u+1,l[1]]]}function $c(l,i){if(!Zn(i,l.length))return[1/0,1/0,-1/0,-1/0];const o=[1/0,1/0,-1/0,-1/0];for(let u=i[0];u<=i[1];++u)ca(o,l[u]);return o}function al(l){const i=[1/0,1/0,-1/0,-1/0];for(const o of l)for(const u of o)ca(i,u);return i}function Qu(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function Uc(l,i,o){if(!Qu(l)||!Qu(i))return NaN;let u=0,g=0;return l[2]<i[0]&&(u=i[0]-l[2]),l[0]>i[2]&&(u=l[0]-i[2]),l[1]>i[3]&&(g=l[1]-i[3]),l[3]<i[1]&&(g=i[1]-l[3]),o.distance([0,0],[u,g])}function Lr(l,i,o){const u=o.pointOnLine(i,l);return o.distance(l,u.point)}function Hc(l,i,o,u,g){const x=Math.min(Lr(l,[o,u],g),Lr(i,[o,u],g)),b=Math.min(Lr(o,[l,i],g),Lr(u,[l,i],g));return Math.min(x,b)}function di(l,i,o,u,g){if(!Zn(i,l.length)||!Zn(u,o.length))return 1/0;let x=1/0;for(let b=i[0];b<i[1];++b){const S=l[b],M=l[b+1];for(let I=u[0];I<u[1];++I){const A=o[I],z=o[I+1];if(rl(S,M,A,z))return 0;x=Math.min(x,Hc(S,M,A,z,g))}}return x}function Ip(l,i,o,u,g){if(!Zn(i,l.length)||!Zn(u,o.length))return NaN;let x=1/0;for(let b=i[0];b<=i[1];++b)for(let S=u[0];S<=u[1];++S)if(x=Math.min(x,g.distance(l[b],o[S])),x===0)return x;return x}function Dp(l,i,o){if(Rr(l,i,!0))return 0;let u=1/0;for(const g of i){const x=g[0],b=g[g.length-1];if(x!==b&&(u=Math.min(u,Lr(l,[b,x],o)),u===0))return u;const S=o.pointOnLine(g,l);if(u=Math.min(u,o.distance(l,S.point)),u===0)return u}return u}function Ap(l,i,o,u){if(!Zn(i,l.length))return NaN;for(let x=i[0];x<=i[1];++x)if(Rr(l[x],o,!0))return 0;let g=1/0;for(let x=i[0];x<i[1];++x){const b=l[x],S=l[x+1];for(const M of o)for(let I=0,A=M.length,z=A-1;I<A;z=I++){const j=M[z],U=M[I];if(rl(b,S,j,U))return 0;g=Math.min(g,Hc(b,S,j,U,u))}}return g}function td(l,i){for(const o of l)for(const u of o)if(Rr(u,i,!0))return!0;return!1}function Ep(l,i,o,u=1/0){const g=al(l),x=al(i);if(u!==1/0&&Uc(g,x,o)>=u)return u;if(ha(g,x)){if(td(l,i))return 0}else if(td(i,l))return 0;let b=1/0;for(const S of l)for(let M=0,I=S.length,A=I-1;M<I;A=M++){const z=S[A],j=S[M];for(const U of i)for(let H=0,q=U.length,it=q-1;H<q;it=H++){const ct=U[it],St=U[H];if(rl(z,j,ct,St))return 0;b=Math.min(b,Hc(z,j,ct,St,o))}}return b}function ed(l,i,o,u,g,x){if(!x)return;const b=Uc($c(u,x),g,o);b<i&&l.push([b,x,[0,0]])}function ll(l,i,o,u,g,x,b){if(!x||!b)return;const S=Uc($c(u,x),$c(g,b),o);S<i&&l.push([S,x,b])}function cl(l,i,o,u,g=1/0){let x=Math.min(u.distance(l[0],o[0][0]),g);if(x===0)return x;const b=new Ku([[0,[0,l.length-1],[0,0]]],Nc),S=al(o);for(;b.length>0;){const M=b.pop();if(M[0]>=x)continue;const I=M[1],A=i?50:100;if(da(I)<=A){if(!Zn(I,l.length))return NaN;if(i){const z=Ap(l,I,o,u);if(isNaN(z)||z===0)return z;x=Math.min(x,z)}else for(let z=I[0];z<=I[1];++z){const j=Dp(l[z],o,u);if(x=Math.min(x,j),x===0)return 0}}else{const z=Vc(I,i);ed(b,x,u,l,S,z[0]),ed(b,x,u,l,S,z[1])}}return x}function hl(l,i,o,u,g,x=1/0){let b=Math.min(x,g.distance(l[0],o[0]));if(b===0)return b;const S=new Ku([[0,[0,l.length-1],[0,o.length-1]]],Nc);for(;S.length>0;){const M=S.pop();if(M[0]>=b)continue;const I=M[1],A=M[2],z=i?50:100,j=u?50:100;if(da(I)<=z&&da(A)<=j){if(!Zn(I,l.length)&&Zn(A,o.length))return NaN;let U;if(i&&u)U=di(l,I,o,A,g),b=Math.min(b,U);else if(i&&!u){const H=l.slice(I[0],I[1]+1);for(let q=A[0];q<=A[1];++q)if(U=Lr(o[q],H,g),b=Math.min(b,U),b===0)return b}else if(!i&&u){const H=o.slice(A[0],A[1]+1);for(let q=I[0];q<=I[1];++q)if(U=Lr(l[q],H,g),b=Math.min(b,U),b===0)return b}else U=Ip(l,I,o,A,g),b=Math.min(b,U)}else{const U=Vc(I,i),H=Vc(A,u);ll(S,b,g,l,o,U[0],H[0]),ll(S,b,g,l,o,U[0],H[1]),ll(S,b,g,l,o,U[1],H[0]),ll(S,b,g,l,o,U[1],H[1])}}return b}function Zc(l){return l.type==="MultiPolygon"?l.coordinates.map(i=>({type:"Polygon",coordinates:i})):l.type==="MultiLineString"?l.coordinates.map(i=>({type:"LineString",coordinates:i})):l.type==="MultiPoint"?l.coordinates.map(i=>({type:"Point",coordinates:i})):[l]}class Fr{constructor(i,o){this.type=Xt,this.geojson=i,this.geometries=o}static parse(i,o){if(i.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Dr(i[1])){const u=i[1];if(u.type==="FeatureCollection")return new Fr(u,u.features.map(g=>Zc(g.geometry)).flat());if(u.type==="Feature")return new Fr(u,Zc(u.geometry));if("type"in u&&"coordinates"in u)return new Fr(u,Zc(u))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(o,u){const g=o.geometry(),x=g.flat().map(M=>Ac([M.x,M.y],o.canonical));if(g.length===0)return NaN;const b=new jc(x[0][1]);let S=1/0;for(const M of u){switch(M.type){case"Point":S=Math.min(S,hl(x,!1,[M.coordinates],!1,b,S));break;case"LineString":S=Math.min(S,hl(x,!1,M.coordinates,!0,b,S));break;case"Polygon":S=Math.min(S,cl(x,!1,M.coordinates,b,S))}if(S===0)return S}return S}(i,this.geometries);if(i.geometryType()==="LineString")return function(o,u){const g=o.geometry(),x=g.flat().map(M=>Ac([M.x,M.y],o.canonical));if(g.length===0)return NaN;const b=new jc(x[0][1]);let S=1/0;for(const M of u){switch(M.type){case"Point":S=Math.min(S,hl(x,!0,[M.coordinates],!1,b,S));break;case"LineString":S=Math.min(S,hl(x,!0,M.coordinates,!0,b,S));break;case"Polygon":S=Math.min(S,cl(x,!0,M.coordinates,b,S))}if(S===0)return S}return S}(i,this.geometries);if(i.geometryType()==="Polygon")return function(o,u){const g=o.geometry();if(g.length===0||g[0].length===0)return NaN;const x=ol(g,0).map(M=>M.map(I=>I.map(A=>Ac([A.x,A.y],o.canonical)))),b=new jc(x[0][0][0][1]);let S=1/0;for(const M of u)for(const I of x){switch(M.type){case"Point":S=Math.min(S,cl([M.coordinates],!1,I,b,S));break;case"LineString":S=Math.min(S,cl(M.coordinates,!0,I,b,S));break;case"Polygon":S=Math.min(S,Ep(I,M.coordinates,b,S))}if(S===0)return S}return S}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const _o={"==":Zu,"!=":wp,">":Ic,"<":il,">=":sl,"<=":Sp,array:un,at:sa,boolean:un,case:na,coalesce:Er,collator:zr,format:la,image:go,in:ri,"index-of":po,interpolate:wi,"interpolate-hcl":wi,"interpolate-lab":wi,length:Dc,let:si,literal:Ln,match:bn,number:un,"number-format":en,object:un,slice:ra,step:Ar,string:un,"to-boolean":Hn,"to-color":Hn,"to-number":Hn,"to-string":Hn,var:Ze,within:hr,distance:Fr};class fn{constructor(i,o,u,g){this.name=i,this.type=o,this._evaluate=u,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,o){const u=i[0],g=fn.definitions[u];if(!g)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,S=b.filter(([I])=>!Array.isArray(I)||I.length===i.length-1);let M=null;for(const[I,A]of S){M=new fo(o.registry,ul,o.path,null,o.scope);const z=[];let j=!1;for(let U=1;U<i.length;U++){const H=i[U],q=Array.isArray(I)?I[U-1]:I.type,it=M.parse(H,1+z.length,q);if(!it){j=!0;break}z.push(it)}if(!j)if(Array.isArray(I)&&I.length!==z.length)M.error(`Expected ${I.length} arguments, but found ${z.length} instead.`);else{for(let U=0;U<z.length;U++){const H=Array.isArray(I)?I[U]:I.type,q=z[U];M.concat(U+1).checkSubtype(H,q.type)}if(M.errors.length===0)return new fn(u,x,A,z)}}if(S.length===1)o.errors.push(...M.errors);else{const I=(S.length?S:b).map(([z])=>{return j=z,Array.isArray(j)?`(${j.map(Li).join(", ")})`:`(${Li(j.type)}...)`;var j}).join(" | "),A=[];for(let z=1;z<i.length;z++){const j=o.parse(i[z],1+A.length);if(!j)return null;A.push(Li(j.type))}o.error(`Expected arguments of type ${I}, but found (${A.join(", ")}) instead.`)}return null}static register(i,o){fn.definitions=o;for(const u in o)i[u]=fn}}function id(l,[i,o,u,g]){i=i.evaluate(l),o=o.evaluate(l),u=u.evaluate(l);const x=g?g.evaluate(l):1,b=Tc(i,o,u,x);if(b)throw new $i(b);return new Ke(i/255,o/255,u/255,x,!1)}function sd(l,i){return l in i}function Gc(l,i){const o=i[l];return o===void 0?null:o}function Or(l){return{type:l}}function ul(l){if(l instanceof Ze)return ul(l.boundExpression);if(l instanceof fn&&l.name==="error"||l instanceof zr||l instanceof hr||l instanceof Fr)return!1;const i=l instanceof Hn||l instanceof un;let o=!0;return l.eachChild(u=>{o=i?o&&ul(u):o&&u instanceof Ln}),!!o&&dl(l)&&fl(l,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function dl(l){if(l instanceof fn&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof hr||l instanceof Fr)return!1;let i=!0;return l.eachChild(o=>{i&&!dl(o)&&(i=!1)}),i}function fa(l){if(l instanceof fn&&l.name==="feature-state")return!1;let i=!0;return l.eachChild(o=>{i&&!fa(o)&&(i=!1)}),i}function fl(l,i){if(l instanceof fn&&i.indexOf(l.name)>=0)return!1;let o=!0;return l.eachChild(u=>{o&&!fl(u,i)&&(o=!1)}),o}function nd(l){return{result:"success",value:l}}function yo(l){return{result:"error",value:l}}function xo(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function rd(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function qc(l){return!!l.expression&&l.expression.interpolated}function li(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function pl(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function zp(l){return l}function od(l,i){const o=i.type==="color",u=l.stops&&typeof l.stops[0][0]=="object",g=u||!(u||l.property!==void 0),x=l.type||(qc(i)?"exponential":"interval");if(o||i.type==="padding"){const A=o?Ke.parse:fs.parse;(l=he({},l)).stops&&(l.stops=l.stops.map(z=>[z[0],A(z[1])])),l.default=A(l.default?l.default:i.default)}if(l.colorSpace&&(b=l.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var b;let S,M,I;if(x==="exponential")S=ad;else if(x==="interval")S=Rp;else if(x==="categorical"){S=Wc,M=Object.create(null);for(const A of l.stops)M[A[0]]=A[1];I=typeof l.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);S=Lp}if(u){const A={},z=[];for(let H=0;H<l.stops.length;H++){const q=l.stops[H],it=q[0].zoom;A[it]===void 0&&(A[it]={zoom:it,type:l.type,property:l.property,default:l.default,stops:[]},z.push(it)),A[it].stops.push([q[0].value,q[1]])}const j=[];for(const H of z)j.push([A[H].zoom,od(A[H],i)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:wi.interpolationFactor.bind(void 0,U),zoomStops:j.map(H=>H[0]),evaluate:({zoom:H},q)=>ad({stops:j,base:l.base},i,H).evaluate(H,q)}}if(g){const A=x==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:wi.interpolationFactor.bind(void 0,A),zoomStops:l.stops.map(z=>z[0]),evaluate:({zoom:z})=>S(l,i,z,M,I)}}return{kind:"source",evaluate(A,z){const j=z&&z.properties?z.properties[l.property]:void 0;return j===void 0?pa(l.default,i.default):S(l,i,j,M,I)}}}function pa(l,i,o){return l!==void 0?l:i!==void 0?i:o!==void 0?o:void 0}function Wc(l,i,o,u,g){return pa(typeof o===g?u[o]:void 0,l.default,i.default)}function Rp(l,i,o){if(li(o)!=="number")return pa(l.default,i.default);const u=l.stops.length;if(u===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[u-1][0])return l.stops[u-1][1];const g=oa(l.stops.map(x=>x[0]),o);return l.stops[g][1]}function ad(l,i,o){const u=l.base!==void 0?l.base:1;if(li(o)!=="number")return pa(l.default,i.default);const g=l.stops.length;if(g===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[g-1][0])return l.stops[g-1][1];const x=oa(l.stops.map(A=>A[0]),o),b=function(A,z,j,U){const H=U-j,q=A-j;return H===0?0:z===1?q/H:(Math.pow(z,q)-1)/(Math.pow(z,H)-1)}(o,u,l.stops[x][0],l.stops[x+1][0]),S=l.stops[x][1],M=l.stops[x+1][1],I=vn[i.type]||zp;return typeof S.evaluate=="function"?{evaluate(...A){const z=S.evaluate.apply(void 0,A),j=M.evaluate.apply(void 0,A);if(z!==void 0&&j!==void 0)return I(z,j,b,l.colorSpace)}}:I(S,M,b,l.colorSpace)}function Lp(l,i,o){switch(i.type){case"color":o=Ke.parse(o);break;case"formatted":o=ts.fromString(o.toString());break;case"resolvedImage":o=As.fromString(o.toString());break;case"padding":o=fs.parse(o);break;default:li(o)===i.type||i.type==="enum"&&i.values[o]||(o=void 0)}return pa(o,l.default,i.default)}fn.register(_o,{error:[{kind:"error"},[de],(l,[i])=>{throw new $i(i.evaluate(l))}],typeof:[de,[ye],(l,[i])=>Li(Di(i.evaluate(l)))],"to-rgba":[tn(Xt,4),[We],(l,[i])=>{const[o,u,g,x]=i.evaluate(l).rgb;return[255*o,255*u,255*g,x]}],rgb:[We,[Xt,Xt,Xt],id],rgba:[We,[Xt,Xt,Xt,Xt],id],has:{type:Se,overloads:[[[de],(l,[i])=>sd(i.evaluate(l),l.properties())],[[de,Le],(l,[i,o])=>sd(i.evaluate(l),o.evaluate(l))]]},get:{type:ye,overloads:[[[de],(l,[i])=>Gc(i.evaluate(l),l.properties())],[[de,Le],(l,[i,o])=>Gc(i.evaluate(l),o.evaluate(l))]]},"feature-state":[ye,[de],(l,[i])=>Gc(i.evaluate(l),l.featureState||{})],properties:[Le,[],l=>l.properties()],"geometry-type":[de,[],l=>l.geometryType()],id:[ye,[],l=>l.id()],zoom:[Xt,[],l=>l.globals.zoom],"heatmap-density":[Xt,[],l=>l.globals.heatmapDensity||0],"line-progress":[Xt,[],l=>l.globals.lineProgress||0],accumulated:[ye,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Xt,Or(Xt),(l,i)=>{let o=0;for(const u of i)o+=u.evaluate(l);return o}],"*":[Xt,Or(Xt),(l,i)=>{let o=1;for(const u of i)o*=u.evaluate(l);return o}],"-":{type:Xt,overloads:[[[Xt,Xt],(l,[i,o])=>i.evaluate(l)-o.evaluate(l)],[[Xt],(l,[i])=>-i.evaluate(l)]]},"/":[Xt,[Xt,Xt],(l,[i,o])=>i.evaluate(l)/o.evaluate(l)],"%":[Xt,[Xt,Xt],(l,[i,o])=>i.evaluate(l)%o.evaluate(l)],ln2:[Xt,[],()=>Math.LN2],pi:[Xt,[],()=>Math.PI],e:[Xt,[],()=>Math.E],"^":[Xt,[Xt,Xt],(l,[i,o])=>Math.pow(i.evaluate(l),o.evaluate(l))],sqrt:[Xt,[Xt],(l,[i])=>Math.sqrt(i.evaluate(l))],log10:[Xt,[Xt],(l,[i])=>Math.log(i.evaluate(l))/Math.LN10],ln:[Xt,[Xt],(l,[i])=>Math.log(i.evaluate(l))],log2:[Xt,[Xt],(l,[i])=>Math.log(i.evaluate(l))/Math.LN2],sin:[Xt,[Xt],(l,[i])=>Math.sin(i.evaluate(l))],cos:[Xt,[Xt],(l,[i])=>Math.cos(i.evaluate(l))],tan:[Xt,[Xt],(l,[i])=>Math.tan(i.evaluate(l))],asin:[Xt,[Xt],(l,[i])=>Math.asin(i.evaluate(l))],acos:[Xt,[Xt],(l,[i])=>Math.acos(i.evaluate(l))],atan:[Xt,[Xt],(l,[i])=>Math.atan(i.evaluate(l))],min:[Xt,Or(Xt),(l,i)=>Math.min(...i.map(o=>o.evaluate(l)))],max:[Xt,Or(Xt),(l,i)=>Math.max(...i.map(o=>o.evaluate(l)))],abs:[Xt,[Xt],(l,[i])=>Math.abs(i.evaluate(l))],round:[Xt,[Xt],(l,[i])=>{const o=i.evaluate(l);return o<0?-Math.round(-o):Math.round(o)}],floor:[Xt,[Xt],(l,[i])=>Math.floor(i.evaluate(l))],ceil:[Xt,[Xt],(l,[i])=>Math.ceil(i.evaluate(l))],"filter-==":[Se,[de,ye],(l,[i,o])=>l.properties()[i.value]===o.value],"filter-id-==":[Se,[ye],(l,[i])=>l.id()===i.value],"filter-type-==":[Se,[de],(l,[i])=>l.geometryType()===i.value],"filter-<":[Se,[de,ye],(l,[i,o])=>{const u=l.properties()[i.value],g=o.value;return typeof u==typeof g&&u<g}],"filter-id-<":[Se,[ye],(l,[i])=>{const o=l.id(),u=i.value;return typeof o==typeof u&&o<u}],"filter->":[Se,[de,ye],(l,[i,o])=>{const u=l.properties()[i.value],g=o.value;return typeof u==typeof g&&u>g}],"filter-id->":[Se,[ye],(l,[i])=>{const o=l.id(),u=i.value;return typeof o==typeof u&&o>u}],"filter-<=":[Se,[de,ye],(l,[i,o])=>{const u=l.properties()[i.value],g=o.value;return typeof u==typeof g&&u<=g}],"filter-id-<=":[Se,[ye],(l,[i])=>{const o=l.id(),u=i.value;return typeof o==typeof u&&o<=u}],"filter->=":[Se,[de,ye],(l,[i,o])=>{const u=l.properties()[i.value],g=o.value;return typeof u==typeof g&&u>=g}],"filter-id->=":[Se,[ye],(l,[i])=>{const o=l.id(),u=i.value;return typeof o==typeof u&&o>=u}],"filter-has":[Se,[ye],(l,[i])=>i.value in l.properties()],"filter-has-id":[Se,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Se,[tn(de)],(l,[i])=>i.value.indexOf(l.geometryType())>=0],"filter-id-in":[Se,[tn(ye)],(l,[i])=>i.value.indexOf(l.id())>=0],"filter-in-small":[Se,[de,tn(ye)],(l,[i,o])=>o.value.indexOf(l.properties()[i.value])>=0],"filter-in-large":[Se,[de,tn(ye)],(l,[i,o])=>function(u,g,x,b){for(;x<=b;){const S=x+b>>1;if(g[S]===u)return!0;g[S]>u?b=S-1:x=S+1}return!1}(l.properties()[i.value],o.value,0,o.value.length-1)],all:{type:Se,overloads:[[[Se,Se],(l,[i,o])=>i.evaluate(l)&&o.evaluate(l)],[Or(Se),(l,i)=>{for(const o of i)if(!o.evaluate(l))return!1;return!0}]]},any:{type:Se,overloads:[[[Se,Se],(l,[i,o])=>i.evaluate(l)||o.evaluate(l)],[Or(Se),(l,i)=>{for(const o of i)if(o.evaluate(l))return!0;return!1}]]},"!":[Se,[Se],(l,[i])=>!i.evaluate(l)],"is-supported-script":[Se,[de],(l,[i])=>{const o=l.globals&&l.globals.isSupportedScript;return!o||o(i.evaluate(l))}],upcase:[de,[de],(l,[i])=>i.evaluate(l).toUpperCase()],downcase:[de,[de],(l,[i])=>i.evaluate(l).toLowerCase()],concat:[de,Or(ye),(l,i)=>i.map(o=>ia(o.evaluate(l))).join("")],"resolved-locale":[de,[Wi],(l,[i])=>i.evaluate(l).resolvedLocale()]});class ml{constructor(i,o){var u;this.expression=i,this._warningHistory={},this._evaluator=new Ai,this._defaultValue=o?(u=o).type==="color"&&pl(u.default)?new Ke(0,0,0,0):u.type==="color"?Ke.parse(u.default)||null:u.type==="padding"?fs.parse(u.default)||null:u.type==="variableAnchorOffsetCollection"?Ds.parse(u.default)||null:u.type==="projectionDefinition"?Es.parse(u.default)||null:u.default===void 0?null:u.default:null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(i,o,u,g,x,b){return this._evaluator.globals=i,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(i,o,u,g,x,b){this._evaluator.globals=i,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new $i(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function gl(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in _o}function _l(l,i){const o=new fo(_o,ul,[],i?function(g){const x={color:We,string:de,number:Xt,enum:de,boolean:Se,formatted:lr,padding:ds,projectionDefinition:ni,resolvedImage:as,variableAnchorOffsetCollection:Ri};return g.type==="array"?tn(x[g.value]||ye,g.length):x[g.type]}(i):void 0),u=o.parse(l,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?nd(new ml(u,i)):yo(o.errors)}class bo{constructor(i,o){this.kind=i,this._styleExpression=o,this.isStateDependent=i!=="constant"&&!fa(o.expression)}evaluateWithoutErrorHandling(i,o,u,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(i,o,u,g,x,b)}evaluate(i,o,u,g,x,b){return this._styleExpression.evaluate(i,o,u,g,x,b)}}class yl{constructor(i,o,u,g){this.kind=i,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=i!=="camera"&&!fa(o.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,o,u,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(i,o,u,g,x,b)}evaluate(i,o,u,g,x,b){return this._styleExpression.evaluate(i,o,u,g,x,b)}interpolationFactor(i,o,u){return this.interpolationType?wi.interpolationFactor(this.interpolationType,i,o,u):0}}function ld(l,i){const o=_l(l,i);if(o.result==="error")return o;const u=o.value.expression,g=dl(u);if(!g&&!xo(i))return yo([new le("","data expressions not supported")]);const x=fl(u,["zoom"]);if(!x&&!rd(i))return yo([new le("","zoom expressions not supported")]);const b=bl(u);return b||x?b instanceof le?yo([b]):b instanceof wi&&!qc(i)?yo([new le("",'"interpolate" expressions cannot be used with this property')]):nd(b?new yl(g?"camera":"composite",o.value,b.labels,b instanceof wi?b.interpolation:void 0):new bo(g?"constant":"source",o.value)):yo([new le("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xl{constructor(i,o){this._parameters=i,this._specification=o,he(this,od(this._parameters,this._specification))}static deserialize(i){return new xl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function bl(l){let i=null;if(l instanceof si)i=bl(l.result);else if(l instanceof Er){for(const o of l.args)if(i=bl(o),i)break}else(l instanceof Ar||l instanceof wi)&&l.input instanceof fn&&l.input.name==="zoom"&&(i=l);return i instanceof le||l.eachChild(o=>{const u=bl(o);u instanceof le?i=u:!i&&u?i=new le("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&u&&i!==u&&(i=new le("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Xc(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const i of l.slice(1))if(!Xc(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Fp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function vl(l){if(l==null)return{filter:()=>!0,needGeometry:!1};Xc(l)||(l=wl(l));const i=_l(l,Fp);if(i.result==="error")throw new Error(i.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,u,g)=>i.value.evaluate(o,u,{},g),needGeometry:hd(l)}}function cd(l,i){return l<i?-1:l>i?1:0}function hd(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let i=1;i<l.length;i++)if(hd(l[i]))return!0;return!1}function wl(l){if(!l)return!0;const i=l[0];return l.length<=1?i!=="any":i==="=="?Sl(l[1],l[2],"=="):i==="!="?ma(Sl(l[1],l[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Sl(l[1],l[2],i):i==="any"?(o=l.slice(1),["any"].concat(o.map(wl))):i==="all"?["all"].concat(l.slice(1).map(wl)):i==="none"?["all"].concat(l.slice(1).map(wl).map(ma)):i==="in"?Kc(l[1],l.slice(2)):i==="!in"?ma(Kc(l[1],l.slice(2))):i==="has"?Yc(l[1]):i!=="!has"||ma(Yc(l[1]));var o}function Sl(l,i,o){switch(l){case"$type":return[`filter-type-${o}`,i];case"$id":return[`filter-id-${o}`,i];default:return[`filter-${o}`,l,i]}}function Kc(l,i){if(i.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(o=>typeof o!=typeof i[0])?["filter-in-large",l,["literal",i.sort(cd)]]:["filter-in-small",l,["literal",i]]}}function Yc(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function ma(l){return["!",l]}function ga(l){const i=typeof l;if(i==="number"||i==="boolean"||i==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let g="[";for(const x of l)g+=`${ga(x)},`;return`${g}]`}const o=Object.keys(l).sort();let u="{";for(let g=0;g<o.length;g++)u+=`${JSON.stringify(o[g])}:${ga(l[o[g]])},`;return`${u}}`}function Jc(l){let i="";for(const o of G)i+=`/${ga(l[o])}`;return i}function Tl(l){const i=l.value;return i?[new Mt(l.key,i,"constants have been deprecated as of v8")]:[]}function Fi(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Br(l){if(Array.isArray(l))return l.map(Br);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const i={};for(const o in l)i[o]=Br(l[o]);return i}return Fi(l)}function pn(l){const i=l.key,o=l.value,u=l.valueSpec||{},g=l.objectElementValidators||{},x=l.style,b=l.styleSpec,S=l.validateSpec;let M=[];const I=li(o);if(I!=="object")return[new Mt(i,o,`object expected, ${I} found`)];for(const A in o){const z=A.split(".")[0],j=u[z]||u["*"];let U;if(g[z])U=g[z];else if(u[z])U=S;else if(g["*"])U=g["*"];else{if(!u["*"]){M.push(new Mt(i,o[A],`unknown property "${A}"`));continue}U=S}M=M.concat(U({key:(i&&`${i}.`)+A,value:o[A],valueSpec:j,style:x,styleSpec:b,object:o,objectKey:A,validateSpec:S},o))}for(const A in u)g[A]||u[A].required&&u[A].default===void 0&&o[A]===void 0&&M.push(new Mt(i,o,`missing required property "${A}"`));return M}function Qc(l){const i=l.value,o=l.valueSpec,u=l.style,g=l.styleSpec,x=l.key,b=l.arrayElementValidator||l.validateSpec;if(li(i)!=="array")return[new Mt(x,i,`array expected, ${li(i)} found`)];if(o.length&&i.length!==o.length)return[new Mt(x,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return[new Mt(x,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let S={type:o.value,values:o.values};g.$version<7&&(S.function=o.function),li(o.value)==="object"&&(S=o.value);let M=[];for(let I=0;I<i.length;I++)M=M.concat(b({array:i,arrayIndex:I,value:i[I],valueSpec:S,validateSpec:l.validateSpec,style:u,styleSpec:g,key:`${x}[${I}]`}));return M}function th(l){const i=l.key,o=l.value,u=l.valueSpec;let g=li(o);return g==="number"&&o!=o&&(g="NaN"),g!=="number"?[new Mt(i,o,`number expected, ${g} found`)]:"minimum"in u&&o<u.minimum?[new Mt(i,o,`${o} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&o>u.maximum?[new Mt(i,o,`${o} is greater than the maximum value ${u.maximum}`)]:[]}function ud(l){const i=l.valueSpec,o=Fi(l.value.type);let u,g,x,b={};const S=o!=="categorical"&&l.value.property===void 0,M=!S,I=li(l.value.stops)==="array"&&li(l.value.stops[0])==="array"&&li(l.value.stops[0][0])==="object",A=pn({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(U){if(o==="identity")return[new Mt(U.key,U.value,'identity function may not have a "stops" property')];let H=[];const q=U.value;return H=H.concat(Qc({key:U.key,value:q,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:z})),li(q)==="array"&&q.length===0&&H.push(new Mt(U.key,q,"array must have at least one stop")),H},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:i,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return o==="identity"&&S&&A.push(new Mt(l.key,l.value,'missing required property "property"')),o==="identity"||l.value.stops||A.push(new Mt(l.key,l.value,'missing required property "stops"')),o==="exponential"&&l.valueSpec.expression&&!qc(l.valueSpec)&&A.push(new Mt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(M&&!xo(l.valueSpec)?A.push(new Mt(l.key,l.value,"property functions not supported")):S&&!rd(l.valueSpec)&&A.push(new Mt(l.key,l.value,"zoom functions not supported"))),o!=="categorical"&&!I||l.value.property!==void 0||A.push(new Mt(l.key,l.value,'"property" property is required')),A;function z(U){let H=[];const q=U.value,it=U.key;if(li(q)!=="array")return[new Mt(it,q,`array expected, ${li(q)} found`)];if(q.length!==2)return[new Mt(it,q,`array length 2 expected, length ${q.length} found`)];if(I){if(li(q[0])!=="object")return[new Mt(it,q,`object expected, ${li(q[0])} found`)];if(q[0].zoom===void 0)return[new Mt(it,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Mt(it,q,"object stop key must have value")];if(x&&x>Fi(q[0].zoom))return[new Mt(it,q[0].zoom,"stop zoom values must appear in ascending order")];Fi(q[0].zoom)!==x&&(x=Fi(q[0].zoom),g=void 0,b={}),H=H.concat(pn({key:`${it}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:th,value:j}}))}else H=H.concat(j({key:`${it}[0]`,value:q[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},q));return gl(Br(q[1]))?H.concat([new Mt(`${it}[1]`,q[1],"expressions are not allowed in function stops.")]):H.concat(U.validateSpec({key:`${it}[1]`,value:q[1],valueSpec:i,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function j(U,H){const q=li(U.value),it=Fi(U.value),ct=U.value!==null?U.value:H;if(u){if(q!==u)return[new Mt(U.key,ct,`${q} stop domain type must match previous stop domain type ${u}`)]}else u=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Mt(U.key,ct,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&o!=="categorical"){let St=`number expected, ${q} found`;return xo(i)&&o===void 0&&(St+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(U.key,ct,St)]}return o!=="categorical"||q!=="number"||isFinite(it)&&Math.floor(it)===it?o!=="categorical"&&q==="number"&&g!==void 0&&it<g?[new Mt(U.key,ct,"stop domain values must appear in ascending order")]:(g=it,o==="categorical"&&it in b?[new Mt(U.key,ct,"stop domain values must be unique")]:(b[it]=!0,[])):[new Mt(U.key,ct,`integer expected, found ${it}`)]}}function vo(l){const i=(l.expressionContext==="property"?ld:_l)(Br(l.value),l.valueSpec);if(i.result==="error")return i.value.map(u=>new Mt(`${l.key}${u.key}`,l.value,u.message));const o=i.value.expression||i.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!o.outputDefined())return[new Mt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!fa(o))return[new Mt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!fa(o))return[new Mt(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!fl(o,["zoom","feature-state"]))return[new Mt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!dl(o))return[new Mt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wo(l){const i=l.key,o=l.value,u=l.valueSpec,g=[];return Array.isArray(u.values)?u.values.indexOf(Fi(o))===-1&&g.push(new Mt(i,o,`expected one of [${u.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(u.values).indexOf(Fi(o))===-1&&g.push(new Mt(i,o,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(o)} found`)),g}function Ml(l){return Xc(Br(l.value))?vo(he({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):_a(l)}function _a(l){const i=l.value,o=l.key;if(li(i)!=="array")return[new Mt(o,i,`array expected, ${li(i)} found`)];const u=l.styleSpec;let g,x=[];if(i.length<1)return[new Mt(o,i,"filter array must have at least 1 element")];switch(x=x.concat(wo({key:`${o}[0]`,value:i[0],valueSpec:u.filter_operator,style:l.style,styleSpec:l.styleSpec})),Fi(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Fi(i[1])==="$type"&&x.push(new Mt(o,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&x.push(new Mt(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=li(i[1]),g!=="string"&&x.push(new Mt(`${o}[1]`,i[1],`string expected, ${g} found`)));for(let b=2;b<i.length;b++)g=li(i[b]),Fi(i[1])==="$type"?x=x.concat(wo({key:`${o}[${b}]`,value:i[b],valueSpec:u.geometry_type,style:l.style,styleSpec:l.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&x.push(new Mt(`${o}[${b}]`,i[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<i.length;b++)x=x.concat(_a({key:`${o}[${b}]`,value:i[b],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":g=li(i[1]),i.length!==2?x.push(new Mt(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&x.push(new Mt(`${o}[1]`,i[1],`string expected, ${g} found`))}return x}function dd(l,i){const o=l.key,u=l.validateSpec,g=l.style,x=l.styleSpec,b=l.value,S=l.objectKey,M=x[`${i}_${l.layerType}`];if(!M)return[];const I=S.match(/^(.*)-transition$/);if(i==="paint"&&I&&M[I[1]]&&M[I[1]].transition)return u({key:o,value:b,valueSpec:x.transition,style:g,styleSpec:x});const A=l.valueSpec||M[S];if(!A)return[new Mt(o,b,`unknown property "${S}"`)];let z;if(li(b)==="string"&&xo(A)&&!A.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new Mt(o,b,`"${S}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const j=[];return l.layerType==="symbol"&&(S==="text-field"&&g&&!g.glyphs&&j.push(new Mt(o,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&pl(Br(b))&&Fi(b.type)==="identity"&&j.push(new Mt(o,b,'"text-font" does not support identity functions'))),j.concat(u({key:l.key,value:b,valueSpec:A,style:g,styleSpec:x,expressionContext:"property",propertyType:i,propertyKey:S}))}function eh(l){return dd(l,"paint")}function ih(l){return dd(l,"layout")}function fd(l){let i=[];const o=l.value,u=l.key,g=l.style,x=l.styleSpec;o.type||o.ref||i.push(new Mt(u,o,'either "type" or "ref" is required'));let b=Fi(o.type);const S=Fi(o.ref);if(o.id){const M=Fi(o.id);for(let I=0;I<l.arrayIndex;I++){const A=g.layers[I];Fi(A.id)===M&&i.push(new Mt(u,o.id,`duplicate layer id "${o.id}", previously used at line ${A.id.__line__}`))}}if("ref"in o){let M;["type","source","source-layer","filter","layout"].forEach(I=>{I in o&&i.push(new Mt(u,o[I],`"${I}" is prohibited for ref layers`))}),g.layers.forEach(I=>{Fi(I.id)===S&&(M=I)}),M?M.ref?i.push(new Mt(u,o.ref,"ref cannot reference another ref layer")):b=Fi(M.type):i.push(new Mt(u,o.ref,`ref layer "${S}" not found`))}else if(b!=="background")if(o.source){const M=g.sources&&g.sources[o.source],I=M&&Fi(M.type);M?I==="vector"&&b==="raster"?i.push(new Mt(u,o.source,`layer "${o.id}" requires a raster source`)):I!=="raster-dem"&&b==="hillshade"?i.push(new Mt(u,o.source,`layer "${o.id}" requires a raster-dem source`)):I==="raster"&&b!=="raster"?i.push(new Mt(u,o.source,`layer "${o.id}" requires a vector source`)):I!=="vector"||o["source-layer"]?I==="raster-dem"&&b!=="hillshade"?i.push(new Mt(u,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!o.paint||!o.paint["line-gradient"]||I==="geojson"&&M.lineMetrics||i.push(new Mt(u,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Mt(u,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new Mt(u,o.source,`source "${o.source}" not found`))}else i.push(new Mt(u,o,'missing required property "source"'));return i=i.concat(pn({key:u,value:o,valueSpec:x.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${u}.type`,value:o.type,valueSpec:x.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:o,objectKey:"type"}),filter:Ml,layout:M=>pn({layer:o,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":I=>ih(he({layerType:b},I))}}),paint:M=>pn({layer:o,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":I=>eh(he({layerType:b},I))}})}})),i}function ur(l){const i=l.value,o=l.key,u=li(i);return u!=="string"?[new Mt(o,i,`string expected, ${u} found`)]:[]}const sh={promoteId:function({key:l,value:i}){if(li(i)==="string")return ur({key:l,value:i});{const o=[];for(const u in i)o.push(...ur({key:`${l}.${u}`,value:i[u]}));return o}}};function So(l){const i=l.value,o=l.key,u=l.styleSpec,g=l.style,x=l.validateSpec;if(!i.type)return[new Mt(o,i,'"type" is required')];const b=Fi(i.type);let S;switch(b){case"vector":case"raster":return S=pn({key:o,value:i,valueSpec:u[`source_${b.replace("-","_")}`],style:l.style,styleSpec:u,objectElementValidators:sh,validateSpec:x}),S;case"raster-dem":return S=function(M){var I;const A=(I=M.sourceName)!==null&&I!==void 0?I:"",z=M.value,j=M.styleSpec,U=j.source_raster_dem,H=M.style;let q=[];const it=li(z);if(z===void 0)return q;if(it!=="object")return q.push(new Mt("source_raster_dem",z,`object expected, ${it} found`)),q;const ct=Fi(z.encoding)==="custom",St=["redFactor","greenFactor","blueFactor","baseShift"],ft=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const $ in z)!ct&&St.includes($)?q.push(new Mt($,z[$],`In "${A}": "${$}" is only valid when "encoding" is set to "custom". ${ft} encoding found`)):U[$]?q=q.concat(M.validateSpec({key:$,value:z[$],valueSpec:U[$],validateSpec:M.validateSpec,style:H,styleSpec:j})):q.push(new Mt($,z[$],`unknown property "${$}"`));return q}({sourceName:o,value:i,style:l.style,styleSpec:u,validateSpec:x}),S;case"geojson":if(S=pn({key:o,value:i,valueSpec:u.source_geojson,style:g,styleSpec:u,validateSpec:x,objectElementValidators:sh}),i.cluster)for(const M in i.clusterProperties){const[I,A]=i.clusterProperties[M],z=typeof I=="string"?[I,["accumulated"],["get",M]]:I;S.push(...vo({key:`${o}.${M}.map`,value:A,expressionContext:"cluster-map"})),S.push(...vo({key:`${o}.${M}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return S;case"video":return pn({key:o,value:i,valueSpec:u.source_video,style:g,validateSpec:x,styleSpec:u});case"image":return pn({key:o,value:i,valueSpec:u.source_image,style:g,validateSpec:x,styleSpec:u});case"canvas":return[new Mt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wo({key:`${o}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function pd(l){const i=l.value,o=l.styleSpec,u=o.light,g=l.style;let x=[];const b=li(i);if(i===void 0)return x;if(b!=="object")return x=x.concat([new Mt("light",i,`object expected, ${b} found`)]),x;for(const S in i){const M=S.match(/^(.*)-transition$/);x=x.concat(M&&u[M[1]]&&u[M[1]].transition?l.validateSpec({key:S,value:i[S],valueSpec:o.transition,validateSpec:l.validateSpec,style:g,styleSpec:o}):u[S]?l.validateSpec({key:S,value:i[S],valueSpec:u[S],validateSpec:l.validateSpec,style:g,styleSpec:o}):[new Mt(S,i[S],`unknown property "${S}"`)])}return x}function md(l){const i=l.value,o=l.styleSpec,u=o.sky,g=l.style,x=li(i);if(i===void 0)return[];if(x!=="object")return[new Mt("sky",i,`object expected, ${x} found`)];let b=[];for(const S in i)b=b.concat(u[S]?l.validateSpec({key:S,value:i[S],valueSpec:u[S],style:g,styleSpec:o}):[new Mt(S,i[S],`unknown property "${S}"`)]);return b}function gd(l){const i=l.value,o=l.styleSpec,u=o.terrain,g=l.style;let x=[];const b=li(i);if(i===void 0)return x;if(b!=="object")return x=x.concat([new Mt("terrain",i,`object expected, ${b} found`)]),x;for(const S in i)x=x.concat(u[S]?l.validateSpec({key:S,value:i[S],valueSpec:u[S],validateSpec:l.validateSpec,style:g,styleSpec:o}):[new Mt(S,i[S],`unknown property "${S}"`)]);return x}function _d(l){let i=[];const o=l.value,u=l.key;if(Array.isArray(o)){const g=[],x=[];for(const b in o)o[b].id&&g.includes(o[b].id)&&i.push(new Mt(u,o,`all the sprites' ids must be unique, but ${o[b].id} is duplicated`)),g.push(o[b].id),o[b].url&&x.includes(o[b].url)&&i.push(new Mt(u,o,`all the sprites' URLs must be unique, but ${o[b].url} is duplicated`)),x.push(o[b].url),i=i.concat(pn({key:`${u}[${b}]`,value:o[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return i}return ur({key:u,value:o})}const yd={"*":()=>[],array:Qc,boolean:function(l){const i=l.value,o=l.key,u=li(i);return u!=="boolean"?[new Mt(o,i,`boolean expected, ${u} found`)]:[]},number:th,color:function(l){const i=l.key,o=l.value,u=li(o);return u!=="string"?[new Mt(i,o,`color expected, ${u} found`)]:Ke.parse(String(o))?[]:[new Mt(i,o,`color expected, "${o}" found`)]},constants:Tl,enum:wo,filter:Ml,function:ud,layer:fd,object:pn,source:So,light:pd,sky:md,terrain:gd,projection:function(l){const i=l.value,o=l.styleSpec,u=o.projection,g=l.style,x=li(i);if(i===void 0)return[];if(x!=="object")return[new Mt("projection",i,`object expected, ${x} found`)];let b=[];for(const S in i)b=b.concat(u[S]?l.validateSpec({key:S,value:i[S],valueSpec:u[S],style:g,styleSpec:o}):[new Mt(S,i[S],`unknown property "${S}"`)]);return b},projectionDefinition:function(l){const i=l.key;let o=l.value;o=o instanceof String?o.valueOf():o;const u=li(o);return u!=="array"||function(g){return Array.isArray(g)&&g.length===3&&typeof g[0]=="string"&&typeof g[1]=="string"&&typeof g[2]=="number"}(o)||function(g){return!!["interpolate","step","literal"].includes(g[0])}(o)?["array","string"].includes(u)?[]:[new Mt(i,o,`projection expected, invalid type "${u}" found`)]:[new Mt(i,o,`projection expected, invalid array ${JSON.stringify(o)} found`)]},string:ur,formatted:function(l){return ur(l).length===0?[]:vo(l)},resolvedImage:function(l){return ur(l).length===0?[]:vo(l)},padding:function(l){const i=l.key,o=l.value;if(li(o)==="array"){if(o.length<1||o.length>4)return[new Mt(i,o,`padding requires 1 to 4 values; ${o.length} values found`)];const u={type:"number"};let g=[];for(let x=0;x<o.length;x++)g=g.concat(l.validateSpec({key:`${i}[${x}]`,value:o[x],validateSpec:l.validateSpec,valueSpec:u}));return g}return th({key:i,value:o,valueSpec:{}})},variableAnchorOffsetCollection:function(l){const i=l.key,o=l.value,u=li(o),g=l.styleSpec;if(u!=="array"||o.length<1||o.length%2!=0)return[new Mt(i,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let b=0;b<o.length;b+=2)x=x.concat(wo({key:`${i}[${b}]`,value:o[b],valueSpec:g.layout_symbol["text-anchor"]})),x=x.concat(Qc({key:`${i}[${b+1}]`,value:o[b+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:g}));return x},sprite:_d};function Pl(l){const i=l.value,o=l.valueSpec,u=l.styleSpec;return l.validateSpec=Pl,o.expression&&pl(Fi(i))?ud(l):o.expression&&gl(Br(i))?vo(l):o.type&&yd[o.type]?yd[o.type](l):pn(he({},l,{valueSpec:o.type?u[o.type]:o}))}function To(l){const i=l.value,o=l.key,u=ur(l);return u.length||(i.indexOf("{fontstack}")===-1&&u.push(new Mt(o,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&u.push(new Mt(o,i,'"glyphs" url must include a "{range}" token'))),u}function Fs(l,i=st){let o=[];return o=o.concat(Pl({key:"",value:l,valueSpec:i.$root,styleSpec:i,style:l,validateSpec:Pl,objectElementValidators:{glyphs:To,"*":()=>[]}})),l.constants&&(o=o.concat(Tl({key:"constants",value:l.constants}))),Mo(o)}function es(l){return function(i){return l({...i,validateSpec:Pl})}}function Mo(l){return[].concat(l).sort((i,o)=>i.line-o.line)}function wn(l){return function(...i){return Mo(l.apply(this,i))}}Fs.source=wn(es(So)),Fs.sprite=wn(es(_d)),Fs.glyphs=wn(es(To)),Fs.light=wn(es(pd)),Fs.sky=wn(es(md)),Fs.terrain=wn(es(gd)),Fs.layer=wn(es(fd)),Fs.filter=wn(es(Ml)),Fs.paintProperty=wn(es(eh)),Fs.layoutProperty=wn(es(ih));const Po=Fs,Op=Po.light,ya=Po.sky,xd=Po.paintProperty,nh=Po.layoutProperty;function bd(l,i){let o=!1;if(i&&i.length)for(const u of i)l.fire(new Js(new Error(u.message))),o=!0;return o}class jr{constructor(i,o,u){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const b=new Int32Array(this.arrayBuffer);i=b[0],this.d=(o=b[1])+2*(u=b[2]);for(let M=0;M<this.d*this.d;M++){const I=b[3+M],A=b[3+M+1];g.push(I===A?null:b.subarray(I,A))}const S=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],S),this.bboxes=b.subarray(S),this.insert=this._insertReadonly}else{this.d=o+2*u;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=u,this.scale=o/i,this.uid=0;const x=u/o*i;this.min=-x,this.max=i+x}insert(i,o,u,g,x){this._forEachCell(o,u,g,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,o,u,g,x,b){this.cells[x].push(b)}query(i,o,u,g,x){const b=this.min,S=this.max;if(i<=b&&o<=b&&S<=u&&S<=g&&!x)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(i,o,u,g,this._queryCell,M,{},x),M}}_queryCell(i,o,u,g,x,b,S,M){const I=this.cells[x];if(I!==null){const A=this.keys,z=this.bboxes;for(let j=0;j<I.length;j++){const U=I[j];if(S[U]===void 0){const H=4*U;(M?M(z[H+0],z[H+1],z[H+2],z[H+3]):i<=z[H+2]&&o<=z[H+3]&&u>=z[H+0]&&g>=z[H+1])?(S[U]=!0,b.push(A[U])):S[U]=!1}}}}_forEachCell(i,o,u,g,x,b,S,M){const I=this._convertToCellCoord(i),A=this._convertToCellCoord(o),z=this._convertToCellCoord(u),j=this._convertToCellCoord(g);for(let U=I;U<=z;U++)for(let H=A;H<=j;H++){const q=this.d*H+U;if((!M||M(this._convertFromCellCoord(U),this._convertFromCellCoord(H),this._convertFromCellCoord(U+1),this._convertFromCellCoord(H+1)))&&x.call(this,i,o,u,g,q,b,S,M))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,o=3+this.cells.length+1+1;let u=0;for(let b=0;b<this.cells.length;b++)u+=this.cells[b].length;const g=new Int32Array(o+u+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let x=o;for(let b=0;b<i.length;b++){const S=i[b];g[3+b]=x,g.set(S,x),x+=S.length}return g[3+i.length]=x,g.set(this.keys,x),x+=this.keys.length,g[3+i.length+1]=x,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer}static serialize(i,o){const u=i.toArrayBuffer();return o&&o.push(u),{buffer:u}}static deserialize(i){return new jr(i.buffer)}}const Gn={};function ge(l,i,o={}){if(Gn[l])throw new Error(`${l} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:l,writeable:!1}),Gn[l]={klass:i,omit:o.omit||[],shallow:o.shallow||[]}}ge("Object",Object),ge("TransferableGridIndex",jr),ge("Color",Ke),ge("Error",Error),ge("AJAXError",Ne),ge("ResolvedImage",As),ge("StylePropertyFunction",xl),ge("StyleExpression",ml,{omit:["_evaluator"]}),ge("ZoomDependentExpression",yl),ge("ZoomConstantExpression",bo),ge("CompoundExpression",fn,{omit:["_evaluate"]});for(const l in _o)_o[l]._classRegistryKey||ge(`Expression_${l}`,_o[l]);function vd(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Nr(l){return l.$name||l.constructor._classRegistryKey}function wd(l){return!function(i){if(i===null||typeof i!="object")return!1;const o=Nr(i);return!(!o||o==="Object")}(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||vd(l)||nt(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function xa(l,i){if(wd(l))return(vd(l)||nt(l))&&i&&i.push(l),ArrayBuffer.isView(l)&&i&&i.push(l.buffer),l instanceof ImageData&&i&&i.push(l.data.buffer),l;if(Array.isArray(l)){const x=[];for(const b of l)x.push(xa(b,i));return x}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);const o=Nr(l);if(!o)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!Gn[o])throw new Error(`${o} is not registered.`);const{klass:u}=Gn[o],g=u.serialize?u.serialize(l,i):{};if(u.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in l){if(!l.hasOwnProperty(x)||Gn[o].omit.indexOf(x)>=0)continue;const b=l[x];g[x]=Gn[o].shallow.indexOf(x)>=0?b:xa(b,i)}l instanceof Error&&(g.message=l.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(g.$name=o),g}function dr(l){if(wd(l))return l;if(Array.isArray(l))return l.map(dr);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);const i=Nr(l)||"Object";if(!Gn[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:o}=Gn[i];if(!o)throw new Error(`can't deserialize unregistered class ${i}`);if(o.deserialize)return o.deserialize(l);const u=Object.create(o.prototype);for(const g of Object.keys(l)){if(g==="$name")continue;const x=l[g];u[g]=Gn[i].shallow.indexOf(g)>=0?x:dr(x)}return u}class Sd{constructor(){this.first=!0}update(i,o){const u=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=u,!0))}}const Qe={"Latin-1 Supplement":l=>l>=128&&l<=255,"Hangul Jamo":l=>l>=4352&&l<=4607,Khmer:l=>l>=6016&&l<=6143,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Katakana:l=>l>=12448&&l<=12543,Kanbun:l=>l>=12688&&l<=12703,"CJK Strokes":l=>l>=12736&&l<=12783,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"Private Use Area":l=>l>=57344&&l<=63743,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function Co(l){for(const i of l)if(Il(i.charCodeAt(0)))return!0;return!1}function Td(l){for(const i of l)if(!Pd(i.charCodeAt(0)))return!1;return!0}function Cl(l){const i=l.map(o=>{try{return new RegExp(`\\p{sc=${o}}`,"u").source}catch{return null}}).filter(o=>o);return new RegExp(i.join("|"),"u")}const Md=Cl(["Arab","Dupl","Mong","Ougr","Syrc"]);function Pd(l){return!Md.test(String.fromCodePoint(l))}const kl=Cl(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Il(l){return!(l!==746&&l!==747&&(l<4352||!(Qe["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||Qe["CJK Compatibility"](l)||Qe["CJK Strokes"](l)||!(!Qe["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||Qe["Enclosed CJK Letters and Months"](l)||Qe["Ideographic Description Characters"](l)||Qe.Kanbun(l)||Qe.Katakana(l)&&l!==12540||!(!Qe["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!Qe["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||Qe["Vertical Forms"](l)||Qe["Yijing Hexagram Symbols"](l)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(l))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(l))||kl.test(String.fromCodePoint(l)))))}function Cd(l){return!(Il(l)||function(i){return!!(Qe["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Qe["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Qe["Letterlike Symbols"](i)||Qe["Number Forms"](i)||Qe["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Qe["Control Pictures"](i)&&i!==9251||Qe["Optical Character Recognition"](i)||Qe["Enclosed Alphanumerics"](i)||Qe["Geometric Shapes"](i)||Qe["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Qe["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Qe["CJK Symbols and Punctuation"](i)||Qe.Katakana(i)||Qe["Private Use Area"](i)||Qe["CJK Compatibility Forms"](i)||Qe["Small Form Variants"](i)||Qe["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(l))}const kd=Cl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Id(l){return kd.test(String.fromCodePoint(l))}function Dd(l,i){return!(!i&&Id(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||Qe.Khmer(l))}function Ad(l){for(const i of l)if(Id(i.charCodeAt(0)))return!0;return!1}const qn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(qn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,i){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;const o=l.pluginURL,u=new Promise(x=>{this.loadScriptResolve=x});i(o);const g=new Promise(x=>setTimeout(()=>x(),this.TIMEOUT));if(yield Promise.race([u,g]),this.isParsed()){const x={pluginStatus:"loaded",pluginURL:o};return this.setState(x),x}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${o}`)})}};class Oi{constructor(i,o){this.zoom=i,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sd,this.transition={})}isSupportedScript(i){return function(o,u){for(const g of o)if(!Dd(g.charCodeAt(0),u))return!1;return!0}(i,qn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,o=i-Math.floor(i),u=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}}}class Dl{constructor(i,o){this.property=i,this.value=o,this.expression=function(u,g){if(pl(u))return new xl(u,g);if(gl(u)){const x=ld(u,g);if(x.result==="error")throw new Error(x.value.map(b=>`${b.key}: ${b.message}`).join(", "));return x.value}{let x=u;return g.type==="color"&&typeof u=="string"?x=Ke.parse(u):g.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?x=Ds.parse(u):g.type==="projectionDefinition"&&typeof u=="string"&&(x=Es.parse(u)):x=fs.parse(u),{kind:"constant",evaluate:()=>x}}}(o===void 0?i.specification.default:o,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,o,u){return this.property.possiblyEvaluate(this,i,o,u)}}class Al{constructor(i){this.property=i,this.value=new Dl(i,void 0)}transitioned(i,o){return new oh(this.property,this.value,o,ai({},i.transition,this.transition),i.now)}untransitioned(){return new oh(this.property,this.value,null,{},0)}}class rh{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return ue(this._values[i].value.value)}setValue(i,o){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Al(this._values[i].property)),this._values[i].value=new Dl(this._values[i].property,o===null?void 0:ue(o))}getTransition(i){return ue(this._values[i].transition)}setTransition(i,o){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Al(this._values[i].property)),this._values[i].transition=ue(o)||void 0}serialize(){const i={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(i[o]=u);const g=this.getTransition(o);g!==void 0&&(i[`${o}-transition`]=g)}return i}transitioned(i,o){const u=new ah(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].transitioned(i,o._values[g]);return u}untransitioned(){const i=new ah(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].untransitioned();return i}}class oh{constructor(i,o,u,g,x){this.property=i,this.value=o,this.begin=x+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=u)}possiblyEvaluate(i,o,u){const g=i.now||0,x=this.value.possiblyEvaluate(i,o,u),b=this.prior;if(b){if(g>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(g<this.begin)return b.possiblyEvaluate(i,o,u);{const S=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(i,o,u),x,zi(S))}}return x}}class ah{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,o,u){const g=new ko(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(i,o,u);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class El{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return ue(this._values[i].value)}setValue(i,o){this._values[i]=new Dl(this._values[i].property,o===null?void 0:ue(o))}serialize(){const i={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(i[o]=u)}return i}possiblyEvaluate(i,o,u){const g=new ko(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(i,o,u);return g}}class Fn{constructor(i,o,u){this.property=i,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,o,u,g){return this.property.evaluate(this.value,this.parameters,i,o,u,g)}}class ko{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class ke{constructor(i){this.specification=i}possiblyEvaluate(i,o){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(o)}interpolate(i,o,u){const g=vn[this.specification.type];return g?g(i,o,u):i}}class Re{constructor(i,o){this.specification=i,this.overrides=o}possiblyEvaluate(i,o,u,g){return new Fn(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(o,null,{},u,g)}:i.expression,o)}interpolate(i,o,u){if(i.value.kind!=="constant"||o.value.kind!=="constant")return i;if(i.value.value===void 0||o.value.value===void 0)return new Fn(this,{kind:"constant",value:void 0},i.parameters);const g=vn[this.specification.type];if(g){const x=g(i.value.value,o.value.value,u);return new Fn(this,{kind:"constant",value:x},i.parameters)}return i}evaluate(i,o,u,g,x,b){return i.kind==="constant"?i.value:i.evaluate(o,u,g,x,b)}}class ba extends Re{possiblyEvaluate(i,o,u,g){if(i.value===void 0)return new Fn(this,{kind:"constant",value:void 0},o);if(i.expression.kind==="constant"){const x=i.expression.evaluate(o,null,{},u,g),b=i.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,S=this._calculate(b,b,b,o);return new Fn(this,{kind:"constant",value:S},o)}if(i.expression.kind==="camera"){const x=this._calculate(i.expression.evaluate({zoom:o.zoom-1}),i.expression.evaluate({zoom:o.zoom}),i.expression.evaluate({zoom:o.zoom+1}),o);return new Fn(this,{kind:"constant",value:x},o)}return new Fn(this,i.expression,o)}evaluate(i,o,u,g,x,b){if(i.kind==="source"){const S=i.evaluate(o,u,g,x,b);return this._calculate(S,S,S,o)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(o.zoom)-1},u,g),i.evaluate({zoom:Math.floor(o.zoom)},u,g),i.evaluate({zoom:Math.floor(o.zoom)+1},u,g),o):i.value}_calculate(i,o,u,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:o}:{from:u,to:o}}interpolate(i){return i}}class zl{constructor(i){this.specification=i}possiblyEvaluate(i,o,u,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const x=i.expression.evaluate(o,null,{},u,g);return this._calculate(x,x,x,o)}return this._calculate(i.expression.evaluate(new Oi(Math.floor(o.zoom-1),o)),i.expression.evaluate(new Oi(Math.floor(o.zoom),o)),i.expression.evaluate(new Oi(Math.floor(o.zoom+1),o)),o)}}_calculate(i,o,u,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:o}:{from:u,to:o}}interpolate(i){return i}}class Rl{constructor(i){this.specification=i}possiblyEvaluate(i,o,u,g){return!!i.expression.evaluate(o,null,{},u,g)}interpolate(){return!1}}class Ns{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in i){const u=i[o];u.specification.overridable&&this.overridableProperties.push(o);const g=this.defaultPropertyValues[o]=new Dl(u,void 0),x=this.defaultTransitionablePropertyValues[o]=new Al(u);this.defaultTransitioningPropertyValues[o]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=g.possiblyEvaluate({})}}}ge("DataDrivenProperty",Re),ge("DataConstantProperty",ke),ge("CrossFadedDataDrivenProperty",ba),ge("CrossFadedProperty",zl),ge("ColorRampProperty",Rl);const Ed="-transition";class On extends Qs{constructor(i,o){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),o.layout&&(this._unevaluatedLayout=new El(o.layout)),o.paint)){this._transitionablePaint=new rh(o.paint);for(const u in i.paint)this.setPaintProperty(u,i.paint[u],{validate:!1});for(const u in i.layout)this.setLayoutProperty(u,i.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ko(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,o,u={}){o!=null&&this._validate(nh,`layers.${this.id}.layout.${i}`,i,o,u)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,o):this.visibility=o)}getPaintProperty(i){return i.endsWith(Ed)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,o,u={}){if(o!=null&&this._validate(xd,`layers.${this.id}.paint.${i}`,i,o,u))return!1;if(i.endsWith(Ed))return this._transitionablePaint.setTransition(i.slice(0,-11),o||void 0),!1;{const g=this._transitionablePaint._values[i],x=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),S=g.value;this._transitionablePaint.setValue(i,o),this._handleSpecialPaintPropertyUpdate(i);const M=this._transitionablePaint._values[i].value;return M.isDataDriven()||b||x||this._handleOverridablePaintPropertyUpdate(i,S,M)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,o,u){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,o){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,o)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),me(i,(o,u)=>!(o===void 0||u==="layout"&&!Object.keys(o).length||u==="paint"&&!Object.keys(o).length))}_validate(i,o,u,g,x={}){return(!x||x.validate!==!1)&&bd(this,i.call(Po,{key:o,layerType:this.type,objectKey:u,value:g,styleSpec:st,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const o=this.paint.get(i);if(o instanceof Fn&&xo(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const Bp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class va{constructor(i,o){this._structArray=i,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Si{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,o){return i._trim(),o&&(i.isTransferred=!0,o.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const o=Object.create(this.prototype);return o.arrayBuffer=i.arrayBuffer,o.length=i.length,o.capacity=i.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function rs(l,i=1){let o=0,u=0;return{members:l.map(g=>{const x=Bp[g.type].BYTES_PER_ELEMENT,b=o=zd(o,Math.max(i,x)),S=g.components||1;return u=Math.max(u,x),o+=x*S,{name:g.name,type:g.type,components:S,offset:b}}),size:zd(o,Math.max(u,i)),alignment:i}}function zd(l,i){return Math.ceil(l/i)*i}class wa extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o){const u=this.length;return this.resize(u+1),this.emplace(u,i,o)}emplace(i,o,u){const g=2*i;return this.int16[g+0]=o,this.int16[g+1]=u,i}}wa.prototype.bytesPerElement=4,ge("StructArrayLayout2i4",wa);class Sa extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,u)}emplace(i,o,u,g){const x=3*i;return this.int16[x+0]=o,this.int16[x+1]=u,this.int16[x+2]=g,i}}Sa.prototype.bytesPerElement=6,ge("StructArrayLayout3i6",Sa);class lh extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,g){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,u,g)}emplace(i,o,u,g,x){const b=4*i;return this.int16[b+0]=o,this.int16[b+1]=u,this.int16[b+2]=g,this.int16[b+3]=x,i}}lh.prototype.bytesPerElement=8,ge("StructArrayLayout4i8",lh);class ch extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x,b){const S=this.length;return this.resize(S+1),this.emplace(S,i,o,u,g,x,b)}emplace(i,o,u,g,x,b,S){const M=6*i;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=g,this.int16[M+3]=x,this.int16[M+4]=b,this.int16[M+5]=S,i}}ch.prototype.bytesPerElement=12,ge("StructArrayLayout2i4i12",ch);class Wn extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x,b){const S=this.length;return this.resize(S+1),this.emplace(S,i,o,u,g,x,b)}emplace(i,o,u,g,x,b,S){const M=4*i,I=8*i;return this.int16[M+0]=o,this.int16[M+1]=u,this.uint8[I+4]=g,this.uint8[I+5]=x,this.uint8[I+6]=b,this.uint8[I+7]=S,i}}Wn.prototype.bytesPerElement=8,ge("StructArrayLayout2i4ub8",Wn);class Io extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o){const u=this.length;return this.resize(u+1),this.emplace(u,i,o)}emplace(i,o,u){const g=2*i;return this.float32[g+0]=o,this.float32[g+1]=u,i}}Io.prototype.bytesPerElement=8,ge("StructArrayLayout2f8",Io);class Ta extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x,b,S,M,I,A){const z=this.length;return this.resize(z+1),this.emplace(z,i,o,u,g,x,b,S,M,I,A)}emplace(i,o,u,g,x,b,S,M,I,A,z){const j=10*i;return this.uint16[j+0]=o,this.uint16[j+1]=u,this.uint16[j+2]=g,this.uint16[j+3]=x,this.uint16[j+4]=b,this.uint16[j+5]=S,this.uint16[j+6]=M,this.uint16[j+7]=I,this.uint16[j+8]=A,this.uint16[j+9]=z,i}}Ta.prototype.bytesPerElement=20,ge("StructArrayLayout10ui20",Ta);class Ll extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x,b,S,M,I,A,z,j){const U=this.length;return this.resize(U+1),this.emplace(U,i,o,u,g,x,b,S,M,I,A,z,j)}emplace(i,o,u,g,x,b,S,M,I,A,z,j,U){const H=12*i;return this.int16[H+0]=o,this.int16[H+1]=u,this.int16[H+2]=g,this.int16[H+3]=x,this.uint16[H+4]=b,this.uint16[H+5]=S,this.uint16[H+6]=M,this.uint16[H+7]=I,this.int16[H+8]=A,this.int16[H+9]=z,this.int16[H+10]=j,this.int16[H+11]=U,i}}Ll.prototype.bytesPerElement=24,ge("StructArrayLayout4i4ui4i24",Ll);class Ma extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,u)}emplace(i,o,u,g){const x=3*i;return this.float32[x+0]=o,this.float32[x+1]=u,this.float32[x+2]=g,i}}Ma.prototype.bytesPerElement=12,ge("StructArrayLayout3f12",Ma);class hh extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint32[1*i+0]=o,i}}hh.prototype.bytesPerElement=4,ge("StructArrayLayout1ul4",hh);class Do extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x,b,S,M,I){const A=this.length;return this.resize(A+1),this.emplace(A,i,o,u,g,x,b,S,M,I)}emplace(i,o,u,g,x,b,S,M,I,A){const z=10*i,j=5*i;return this.int16[z+0]=o,this.int16[z+1]=u,this.int16[z+2]=g,this.int16[z+3]=x,this.int16[z+4]=b,this.int16[z+5]=S,this.uint32[j+3]=M,this.uint16[z+8]=I,this.uint16[z+9]=A,i}}Do.prototype.bytesPerElement=20,ge("StructArrayLayout6i1ul2ui20",Do);class Vr extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x,b){const S=this.length;return this.resize(S+1),this.emplace(S,i,o,u,g,x,b)}emplace(i,o,u,g,x,b,S){const M=6*i;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=g,this.int16[M+3]=x,this.int16[M+4]=b,this.int16[M+5]=S,i}}Vr.prototype.bytesPerElement=12,ge("StructArrayLayout2i2i2i12",Vr);class uh extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,i,o,u,g,x)}emplace(i,o,u,g,x,b){const S=4*i,M=8*i;return this.float32[S+0]=o,this.float32[S+1]=u,this.float32[S+2]=g,this.int16[M+6]=x,this.int16[M+7]=b,i}}uh.prototype.bytesPerElement=16,ge("StructArrayLayout2f1f2i16",uh);class Fl extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x,b){const S=this.length;return this.resize(S+1),this.emplace(S,i,o,u,g,x,b)}emplace(i,o,u,g,x,b,S){const M=16*i,I=4*i,A=8*i;return this.uint8[M+0]=o,this.uint8[M+1]=u,this.float32[I+1]=g,this.float32[I+2]=x,this.int16[A+6]=b,this.int16[A+7]=S,i}}Fl.prototype.bytesPerElement=16,ge("StructArrayLayout2ub2f2i16",Fl);class fr extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,u)}emplace(i,o,u,g){const x=3*i;return this.uint16[x+0]=o,this.uint16[x+1]=u,this.uint16[x+2]=g,i}}fr.prototype.bytesPerElement=6,ge("StructArrayLayout3ui6",fr);class dh extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x,b,S,M,I,A,z,j,U,H,q,it,ct){const St=this.length;return this.resize(St+1),this.emplace(St,i,o,u,g,x,b,S,M,I,A,z,j,U,H,q,it,ct)}emplace(i,o,u,g,x,b,S,M,I,A,z,j,U,H,q,it,ct,St){const ft=24*i,$=12*i,tt=48*i;return this.int16[ft+0]=o,this.int16[ft+1]=u,this.uint16[ft+2]=g,this.uint16[ft+3]=x,this.uint32[$+2]=b,this.uint32[$+3]=S,this.uint32[$+4]=M,this.uint16[ft+10]=I,this.uint16[ft+11]=A,this.uint16[ft+12]=z,this.float32[$+7]=j,this.float32[$+8]=U,this.uint8[tt+36]=H,this.uint8[tt+37]=q,this.uint8[tt+38]=it,this.uint32[$+10]=ct,this.int16[ft+22]=St,i}}dh.prototype.bytesPerElement=48,ge("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",dh);class fh extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,g,x,b,S,M,I,A,z,j,U,H,q,it,ct,St,ft,$,tt,pt,Rt,Qt,Nt,Ht,ne,ee){const oe=this.length;return this.resize(oe+1),this.emplace(oe,i,o,u,g,x,b,S,M,I,A,z,j,U,H,q,it,ct,St,ft,$,tt,pt,Rt,Qt,Nt,Ht,ne,ee)}emplace(i,o,u,g,x,b,S,M,I,A,z,j,U,H,q,it,ct,St,ft,$,tt,pt,Rt,Qt,Nt,Ht,ne,ee,oe){const Wt=32*i,we=16*i;return this.int16[Wt+0]=o,this.int16[Wt+1]=u,this.int16[Wt+2]=g,this.int16[Wt+3]=x,this.int16[Wt+4]=b,this.int16[Wt+5]=S,this.int16[Wt+6]=M,this.int16[Wt+7]=I,this.uint16[Wt+8]=A,this.uint16[Wt+9]=z,this.uint16[Wt+10]=j,this.uint16[Wt+11]=U,this.uint16[Wt+12]=H,this.uint16[Wt+13]=q,this.uint16[Wt+14]=it,this.uint16[Wt+15]=ct,this.uint16[Wt+16]=St,this.uint16[Wt+17]=ft,this.uint16[Wt+18]=$,this.uint16[Wt+19]=tt,this.uint16[Wt+20]=pt,this.uint16[Wt+21]=Rt,this.uint16[Wt+22]=Qt,this.uint32[we+12]=Nt,this.float32[we+13]=Ht,this.float32[we+14]=ne,this.uint16[Wt+30]=ee,this.uint16[Wt+31]=oe,i}}fh.prototype.bytesPerElement=64,ge("StructArrayLayout8i15ui1ul2f2ui64",fh);class Pa extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.float32[1*i+0]=o,i}}Pa.prototype.bytesPerElement=4,ge("StructArrayLayout1f4",Pa);class ph extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,u)}emplace(i,o,u,g){const x=3*i;return this.uint16[6*i+0]=o,this.float32[x+1]=u,this.float32[x+2]=g,i}}ph.prototype.bytesPerElement=12,ge("StructArrayLayout1ui2f12",ph);class _ extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,u)}emplace(i,o,u,g){const x=4*i;return this.uint32[2*i+0]=o,this.uint16[x+2]=u,this.uint16[x+3]=g,i}}_.prototype.bytesPerElement=8,ge("StructArrayLayout1ul2ui8",_);class t extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o){const u=this.length;return this.resize(u+1),this.emplace(u,i,o)}emplace(i,o,u){const g=2*i;return this.uint16[g+0]=o,this.uint16[g+1]=u,i}}t.prototype.bytesPerElement=4,ge("StructArrayLayout2ui4",t);class r extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint16[1*i+0]=o,i}}r.prototype.bytesPerElement=2,ge("StructArrayLayout1ui2",r);class d extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,u,g){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,u,g)}emplace(i,o,u,g,x){const b=4*i;return this.float32[b+0]=o,this.float32[b+1]=u,this.float32[b+2]=g,this.float32[b+3]=x,i}}d.prototype.bytesPerElement=16,ge("StructArrayLayout4f16",d);class m extends va{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new J(this.anchorPointX,this.anchorPointY)}}m.prototype.size=20;class y extends Do{get(i){return new m(this,i)}}ge("CollisionBoxArray",y);class v extends va{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}v.prototype.size=48;class T extends dh{get(i){return new v(this,i)}}ge("PlacedSymbolArray",T);class C extends va{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}C.prototype.size=64;class D extends fh{get(i){return new C(this,i)}}ge("SymbolInstanceArray",D);class L extends Pa{getoffsetX(i){return this.float32[1*i+0]}}ge("GlyphOffsetArray",L);class B extends Sa{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}ge("SymbolLineVertexArray",B);class V extends va{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}V.prototype.size=12;class Z extends ph{get(i){return new V(this,i)}}ge("TextAnchorOffsetArray",Z);class W extends va{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}W.prototype.size=8;class at extends _{get(i){return new W(this,i)}}ge("FeatureIndexArray",at);class ot extends wa{}class lt extends wa{}class ut extends wa{}class gt extends ch{}class _t extends Wn{}class yt extends Io{}class wt extends Ta{}class vt extends Ll{}class zt extends Ma{}class Ot extends hh{}class qt extends Vr{}class Kt extends Fl{}class Ut extends fr{}class ce extends t{}const ae=rs([{name:"a_pos",components:2,type:"Int16"}],4),{members:te}=ae;class pe{constructor(i=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=i}prepareSegment(i,o,u,g){const x=this.segments[this.segments.length-1];return i>pe.MAX_VERTEX_ARRAY_LENGTH&&X(`Max vertices per segment is ${pe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${pe.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!x||x.vertexLength+i>pe.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==g?this.createNewSegment(o,u,g):x}createNewSegment(i,o,u){const g={vertexOffset:i.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0,vaos:{}};return u!==void 0&&(g.sortKey=u),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(g),g}getOrCreateLatestSegment(i,o,u){return this.prepareSegment(0,i,o,u)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const i of this.segments)for(const o in i.vaos)i.vaos[o].destroy()}static simpleSegment(i,o,u,g){return new pe([{vertexOffset:i,primitiveOffset:o,vertexLength:u,primitiveLength:g,vaos:{},sortKey:0}])}}function Ge(l,i){return 256*(l=Ii(Math.floor(l),0,255))+Ii(Math.floor(i),0,255)}pe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ge("SegmentVector",pe);const oi=rs([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Bi,yi,ji,xi={exports:{}},gi={exports:{}},bi={exports:{}},Ts=function(){if(ji)return xi.exports;ji=1;var l=(Bi||(Bi=1,gi.exports=function(o,u){var g,x,b,S,M,I,A,z;for(x=o.length-(g=3&o.length),b=u,M=3432918353,I=461845907,z=0;z<x;)A=255&o.charCodeAt(z)|(255&o.charCodeAt(++z))<<8|(255&o.charCodeAt(++z))<<16|(255&o.charCodeAt(++z))<<24,++z,b=27492+(65535&(S=5*(65535&(b=(b^=A=(65535&(A=(A=(65535&A)*M+(((A>>>16)*M&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(A=0,g){case 3:A^=(255&o.charCodeAt(z+2))<<16;case 2:A^=(255&o.charCodeAt(z+1))<<8;case 1:b^=A=(65535&(A=(A=(65535&(A^=255&o.charCodeAt(z)))*M+(((A>>>16)*M&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),gi.exports),i=(yi||(yi=1,bi.exports=function(o,u){for(var g,x=o.length,b=u^x,S=0;x>=4;)g=1540483477*(65535&(g=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(g>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),x-=4,++S;switch(x){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),bi.exports);return xi.exports=l,xi.exports.murmur3=l,xi.exports.murmur2=i,xi.exports}(),ls=w(Ts);class cs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,o,u,g){this.ids.push(Os(i)),this.positions.push(o,u,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=Os(i);let u=0,g=this.ids.length-1;for(;u<g;){const b=u+g>>1;this.ids[b]>=o?g=b:u=b+1}const x=[];for(;this.ids[u]===o;)x.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return x}static serialize(i,o){const u=new Float64Array(i.ids),g=new Uint32Array(i.positions);return Xn(u,g,0,u.length-1),o&&o.push(u.buffer,g.buffer),{ids:u,positions:g}}static deserialize(i){const o=new cs;return o.ids=i.ids,o.positions=i.positions,o.indexed=!0,o}}function Os(l){const i=+l;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:ls(String(l))}function Xn(l,i,o,u){for(;o<u;){const g=l[o+u>>1];let x=o-1,b=u+1;for(;;){do x++;while(l[x]<g);do b--;while(l[b]>g);if(x>=b)break;Bn(l,x,b),Bn(i,3*x,3*b),Bn(i,3*x+1,3*b+1),Bn(i,3*x+2,3*b+2)}b-o<u-b?(Xn(l,i,o,b),o=b+1):(Xn(l,i,b+1,u),u=b)}}function Bn(l,i,o){const u=l[i];l[i]=l[o],l[o]=u}ge("FeaturePositionMap",cs);class sn{constructor(i,o){this.gl=i.gl,this.location=o}}class Kn extends sn{constructor(i,o){super(i,o),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ca extends sn{constructor(i,o){super(i,o),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class ka extends sn{constructor(i,o){super(i,o),this.current=Ke.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Ao=new Float32Array(16);function Vs(l){return[Ge(255*l.r,255*l.g),Ge(255*l.b,255*l.a)]}class mn{constructor(i,o,u){this.value=i,this.uniformNames=o.map(g=>`u_${g}`),this.type=u}setUniform(i,o,u){i.set(u.constantOr(this.value))}getBinding(i,o,u){return this.type==="color"?new ka(i,o):new Kn(i,o)}}class gn{constructor(i,o){this.uniformNames=o.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=i.tlbr}setUniform(i,o,u,g){const x=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&i.set(x)}getBinding(i,o,u){return u.substr(0,9)==="u_pattern"?new Ca(i,o):new Kn(i,o)}}class nn{constructor(i,o,u,g){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,o,u,g,x){const b=this.paintVertexArray.length,S=this.expression.evaluate(new Oi(0),o,{},g,[],x);this.paintVertexArray.resize(i),this._setPaintValue(b,i,S)}updatePaintArray(i,o,u,g){const x=this.expression.evaluate({zoom:0},u,g);this._setPaintValue(i,o,x)}_setPaintValue(i,o,u){if(this.type==="color"){const g=Vs(u);for(let x=i;x<o;x++)this.paintVertexArray.emplace(x,g[0],g[1])}else{for(let g=i;g<o;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vi{constructor(i,o,u,g,x,b){this.expression=i,this.uniformNames=o.map(S=>`u_${S}_t`),this.type=u,this.useIntegerZoom=g,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=o.map(S=>({name:`a_${S}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(i,o,u,g,x){const b=this.expression.evaluate(new Oi(this.zoom),o,{},g,[],x),S=this.expression.evaluate(new Oi(this.zoom+1),o,{},g,[],x),M=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(M,i,b,S)}updatePaintArray(i,o,u,g){const x=this.expression.evaluate({zoom:this.zoom},u,g),b=this.expression.evaluate({zoom:this.zoom+1},u,g);this._setPaintValue(i,o,x,b)}_setPaintValue(i,o,u,g){if(this.type==="color"){const x=Vs(u),b=Vs(g);for(let S=i;S<o;S++)this.paintVertexArray.emplace(S,x[0],x[1],b[0],b[1])}else{for(let x=i;x<o;x++)this.paintVertexArray.emplace(x,u,g);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,o){const u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=Ii(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,o,u){return new Kn(i,o)}}class Ni{constructor(i,o,u,g,x,b){this.expression=i,this.type=o,this.useIntegerZoom=u,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(i,o,u){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(i,o,u,g,x){this._setPaintValues(i,o,u.patterns&&u.patterns[this.layerId],x)}_setPaintValues(i,o,u,g){if(!g||!u)return;const{min:x,mid:b,max:S}=u,M=g[x],I=g[b],A=g[S];if(M&&I&&A)for(let z=i;z<o;z++)this.zoomInPaintVertexArray.emplace(z,I.tl[0],I.tl[1],I.br[0],I.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],I.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,I.tl[0],I.tl[1],I.br[0],I.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],I.pixelRatio,A.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,oi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,oi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class rn{constructor(i,o,u){this.binders={},this._buffers=[];const g=[];for(const x in i.paint._values){if(!u(x))continue;const b=i.paint.get(x);if(!(b instanceof Fn&&xo(b.property.specification)))continue;const S=jp(x,i.type),M=b.value,I=b.property.specification.type,A=b.property.useIntegerZoom,z=b.property.specification["property-type"],j=z==="cross-faded"||z==="cross-faded-data-driven";if(M.kind==="constant")this.binders[x]=j?new gn(M.value,S):new mn(M.value,S,I),g.push(`/u_${x}`);else if(M.kind==="source"||j){const U=Rd(x,I,"source");this.binders[x]=j?new Ni(M,I,A,o,U,i.id):new nn(M,S,I,U),g.push(`/a_${x}`)}else{const U=Rd(x,I,"composite");this.binders[x]=new vi(M,S,I,A,o,U),g.push(`/z_${x}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const o=this.binders[i];return o instanceof nn||o instanceof vi?o.maxValue:0}populatePaintArrays(i,o,u,g,x){for(const b in this.binders){const S=this.binders[b];(S instanceof nn||S instanceof vi||S instanceof Ni)&&S.populatePaintArray(i,o,u,g,x)}}setConstantPatternPositions(i,o){for(const u in this.binders){const g=this.binders[u];g instanceof gn&&g.setConstantPatternPositions(i,o)}}updatePaintArrays(i,o,u,g,x){let b=!1;for(const S in i){const M=o.getPositions(S);for(const I of M){const A=u.feature(I.index);for(const z in this.binders){const j=this.binders[z];if((j instanceof nn||j instanceof vi||j instanceof Ni)&&j.expression.isStateDependent===!0){const U=g.paint.get(z);j.expression=U.value,j.updatePaintArray(I.start,I.end,A,i[S],x),b=!0}}}}return b}defines(){const i=[];for(const o in this.binders){const u=this.binders[o];(u instanceof mn||u instanceof gn)&&i.push(...u.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof nn||u instanceof vi)for(let g=0;g<u.paintVertexAttributes.length;g++)i.push(u.paintVertexAttributes[g].name);else if(u instanceof Ni)for(let g=0;g<oi.members.length;g++)i.push(oi.members[g].name)}return i}getBinderUniforms(){const i=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof mn||u instanceof gn||u instanceof vi)for(const g of u.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,o){const u=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof mn||x instanceof gn||x instanceof vi){for(const b of x.uniformNames)if(o[b]){const S=x.getBinding(i,o[b],b);u.push({name:b,property:g,binding:S})}}}return u}setUniforms(i,o,u,g){for(const{name:x,property:b,binding:S}of o)this.binders[b].setUniform(S,g,u.get(b),x)}updatePaintBuffers(i){this._buffers=[];for(const o in this.binders){const u=this.binders[o];if(i&&u instanceof Ni){const g=i.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(u instanceof nn||u instanceof vi)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(i){for(const o in this.binders){const u=this.binders[o];(u instanceof nn||u instanceof vi||u instanceof Ni)&&u.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const o=this.binders[i];(o instanceof nn||o instanceof vi||o instanceof Ni)&&o.destroy()}}}class Ui{constructor(i,o,u=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new rn(g,o,u);this.needsUpload=!1,this._featureMap=new cs,this._bufferOffset=0}populatePaintArrays(i,o,u,g,x,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(i,o,g,x,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,o,u,g){for(const x of u)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(i,this._featureMap,o,x,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function jp(l,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${i}-`,"").replace(/-/g,"_")]}function Rd(l,i,o){const u={color:{source:Io,composite:d},number:{source:Pa,composite:Io}},g=function(x){return{"line-pattern":{source:wt,composite:wt},"fill-pattern":{source:wt,composite:wt},"fill-extrusion-pattern":{source:wt,composite:wt}}[x]}(l);return g&&g[o]||u[i][o]}ge("ConstantBinder",mn),ge("CrossFadedConstantBinder",gn),ge("SourceExpressionBinder",nn),ge("CrossFadedCompositeBinder",Ni),ge("CompositeExpressionBinder",vi),ge("ProgramConfiguration",rn,{omit:["_buffers"]}),ge("ProgramConfigurationSet",Ui);const mh=Math.pow(2,14)-1,Ld=-mh-1;function $r(l){const i=xe/l.extent,o=l.loadGeometry();for(let u=0;u<o.length;u++){const g=o[u];for(let x=0;x<g.length;x++){const b=g[x],S=Math.round(b.x*i),M=Math.round(b.y*i);b.x=Ii(S,Ld,mh),b.y=Ii(M,Ld,mh),(S<b.x||S>b.x+1||M<b.y||M>b.y+1)&&X("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function Ur(l,i){return{type:l.type,id:l.id,properties:l.properties,geometry:i?$r(l):[]}}const pr=-32768;function Fd(l,i,o,u,g){l.emplaceBack(pr+8*i+u,pr+8*o+g)}class Ol{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new lt,this.indexArray=new Ut,this.segments=new pe,this.programConfigurations=new Ui(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,u){const g=this.layers[0],x=[];let b=null,S=!1,M=g.type==="heatmap";if(g.type==="circle"){const A=g;b=A.layout.get("circle-sort-key"),S=!b.isConstant(),M=M||A.paint.get("circle-pitch-alignment")==="map"}const I=M?o.subdivisionGranularity.circle:1;for(const{feature:A,id:z,index:j,sourceLayerIndex:U}of i){const H=this.layers[0]._featureFilter.needGeometry,q=Ur(A,H);if(!this.layers[0]._featureFilter.filter(new Oi(this.zoom),q,u))continue;const it=S?b.evaluate(q,{},u):void 0,ct={id:z,properties:A.properties,type:A.type,sourceLayerIndex:U,index:j,geometry:H?q.geometry:$r(A),patterns:{},sortKey:it};x.push(ct)}S&&x.sort((A,z)=>A.sortKey-z.sortKey);for(const A of x){const{geometry:z,index:j,sourceLayerIndex:U}=A,H=i[j].feature;this.addFeature(A,z,j,u,I),o.featureIndex.insert(H,z,j,U,this.index)}}update(i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,te),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,o,u,g,x=1){let b;switch(x){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${x}; valid values are 1, 3, 5, 7.`)}const S=b.length;for(const M of o)for(const I of M){const A=I.x,z=I.y;if(A<0||A>=xe||z<0||z>=xe)continue;const j=this.segments.prepareSegment(S*S,this.layoutVertexArray,this.indexArray,i.sortKey),U=j.vertexLength;for(let H=0;H<S;H++)for(let q=0;q<S;q++)Fd(this.layoutVertexArray,A,z,b[q],b[H]);for(let H=0;H<S-1;H++)for(let q=0;q<S-1;q++){const it=U+H*S+q,ct=U+(H+1)*S+q;this.indexArray.emplaceBack(it,ct+1,it+1),this.indexArray.emplaceBack(it,ct,ct+1)}j.vertexLength+=S*S,j.primitiveLength+=(S-1)*(S-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},g)}}function gh(l,i){for(let o=0;o<l.length;o++)if(Bl(i,l[o]))return!0;for(let o=0;o<i.length;o++)if(Bl(l,i[o]))return!0;return!!Np(l,i)}function _h(l,i,o){return!!Bl(l,i)||!!Vp(i,l,o)}function yh(l,i){if(l.length===1)return g_(i,l[0]);for(let o=0;o<i.length;o++){const u=i[o];for(let g=0;g<u.length;g++)if(Bl(l,u[g]))return!0}for(let o=0;o<l.length;o++)if(g_(i,l[o]))return!0;for(let o=0;o<i.length;o++)if(Np(l,i[o]))return!0;return!1}function xh(l,i,o){if(l.length>1){if(Np(l,i))return!0;for(let u=0;u<i.length;u++)if(Vp(i[u],l,o))return!0}for(let u=0;u<l.length;u++)if(Vp(l[u],i,o))return!0;return!1}function Np(l,i){if(l.length===0||i.length===0)return!1;for(let o=0;o<l.length-1;o++){const u=l[o],g=l[o+1];for(let x=0;x<i.length-1;x++)if(V1(u,g,i[x],i[x+1]))return!0}return!1}function V1(l,i,o,u){return N(l,o,u)!==N(i,o,u)&&N(l,i,o)!==N(l,i,u)}function Vp(l,i,o){const u=o*o;if(i.length===1)return l.distSqr(i[0])<u;for(let g=1;g<i.length;g++)if(m_(l,i[g-1],i[g])<u)return!0;return!1}function m_(l,i,o){const u=i.distSqr(o);if(u===0)return l.distSqr(i);const g=((l.x-i.x)*(o.x-i.x)+(l.y-i.y)*(o.y-i.y))/u;return l.distSqr(g<0?i:g>1?o:o.sub(i)._mult(g)._add(i))}function g_(l,i){let o,u,g,x=!1;for(let b=0;b<l.length;b++){o=l[b];for(let S=0,M=o.length-1;S<o.length;M=S++)u=o[S],g=o[M],u.y>i.y!=g.y>i.y&&i.x<(g.x-u.x)*(i.y-u.y)/(g.y-u.y)+u.x&&(x=!x)}return x}function Bl(l,i){let o=!1;for(let u=0,g=l.length-1;u<l.length;g=u++){const x=l[u],b=l[g];x.y>i.y!=b.y>i.y&&i.x<(b.x-x.x)*(i.y-x.y)/(b.y-x.y)+x.x&&(o=!o)}return o}function $1(l,i,o){const u=o[0],g=o[2];if(l.x<u.x&&i.x<u.x||l.x>g.x&&i.x>g.x||l.y<u.y&&i.y<u.y||l.y>g.y&&i.y>g.y)return!1;const x=N(l,i,o[0]);return x!==N(l,i,o[1])||x!==N(l,i,o[2])||x!==N(l,i,o[3])}function bh(l,i,o){const u=i.paint.get(l).value;return u.kind==="constant"?u.value:o.programConfigurations.get(i.id).getMaxValue(l)}function Od(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Bd(l,i,o,u,g){if(!i[0]&&!i[1])return l;const x=J.convert(i)._mult(g);o==="viewport"&&x._rotate(-u);const b=[];for(let S=0;S<l.length;S++)b.push(l[S].sub(x));return b}let __,y_;ge("CircleBucket",Ol,{omit:["layers"]});var U1={get paint(){return y_=y_||new Ns({"circle-radius":new Re(st.paint_circle["circle-radius"]),"circle-color":new Re(st.paint_circle["circle-color"]),"circle-blur":new Re(st.paint_circle["circle-blur"]),"circle-opacity":new Re(st.paint_circle["circle-opacity"]),"circle-translate":new ke(st.paint_circle["circle-translate"]),"circle-translate-anchor":new ke(st.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ke(st.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ke(st.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Re(st.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Re(st.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Re(st.paint_circle["circle-stroke-opacity"])})},get layout(){return __=__||new Ns({"circle-sort-key":new Re(st.layout_circle["circle-sort-key"])})}};class H1 extends On{constructor(i){super(i,U1)}createBucket(i){return new Ol(i)}queryRadius(i){const o=i;return bh("circle-radius",this,o)+bh("circle-stroke-width",this,o)+Od(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:u,geometry:g,transform:x,pixelsToTileUnits:b,pixelPosMatrix:S}){const M=Bd(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-x.bearingInRadians,b),I=this.paint.get("circle-radius").evaluate(o,u)+this.paint.get("circle-stroke-width").evaluate(o,u),A=this.paint.get("circle-pitch-alignment")==="map",z=A?M:function(U,H){return U.map(q=>x_(q,H))}(M,S),j=A?I*b:I;for(const U of g)for(const H of U){const q=A?H:x_(H,S);let it=j;const ct=Fe([],[H.x,H.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?it*=ct[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(it*=x.cameraToCenterDistance/ct[3]),_h(z,q,it))return!0}return!1}}function x_(l,i){const o=Fe([],[l.x,l.y,0,1],i);return new J(o[0]/o[3],o[1]/o[3])}class b_ extends Ol{}let v_;ge("HeatmapBucket",b_,{omit:["layers"]});var Z1={get paint(){return v_=v_||new Ns({"heatmap-radius":new Re(st.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Re(st.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ke(st.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Rl(st.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ke(st.paint_heatmap["heatmap-opacity"])})}};function $p(l,{width:i,height:o},u,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*o*u)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*o*u}`)}else g=new Uint8Array(i*o*u);return l.width=i,l.height=o,l.data=g,l}function w_(l,{width:i,height:o},u){if(i===l.width&&o===l.height)return;const g=$p({},{width:i,height:o},u);Up(l,g,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,i),height:Math.min(l.height,o)},u),l.width=i,l.height=o,l.data=g.data}function Up(l,i,o,u,g,x){if(g.width===0||g.height===0)return i;if(g.width>l.width||g.height>l.height||o.x>l.width-g.width||o.y>l.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||u.x>i.width-g.width||u.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=l.data,S=i.data;if(b===S)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<g.height;M++){const I=((o.y+M)*l.width+o.x)*x,A=((u.y+M)*i.width+u.x)*x;for(let z=0;z<g.width*x;z++)S[A+z]=b[I+z]}return i}class vh{constructor(i,o){$p(this,i,1,o)}resize(i){w_(this,i,1)}clone(){return new vh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,u,g,x){Up(i,o,u,g,x,1)}}class Sn{constructor(i,o){$p(this,i,4,o)}resize(i){w_(this,i,4)}replace(i,o){o?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Sn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,u,g,x){Up(i,o,u,g,x,4)}}function S_(l){const i={},o=l.resolution||256,u=l.clips?l.clips.length:1,g=l.image||new Sn({width:o,height:u});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const x=(b,S,M)=>{i[l.evaluationKey]=M;const I=l.expression.evaluate(i);g.data[b+S+0]=Math.floor(255*I.r/I.a),g.data[b+S+1]=Math.floor(255*I.g/I.a),g.data[b+S+2]=Math.floor(255*I.b/I.a),g.data[b+S+3]=Math.floor(255*I.a)};if(l.clips)for(let b=0,S=0;b<u;++b,S+=4*o)for(let M=0,I=0;M<o;M++,I+=4){const A=M/(o-1),{start:z,end:j}=l.clips[b];x(S,I,z*(1-A)+j*A)}else for(let b=0,S=0;b<o;b++,S+=4)x(0,S,b/(o-1));return g}ge("AlphaImage",vh),ge("RGBAImage",Sn);const Hp="big-fb";class G1 extends On{createBucket(i){return new b_(i)}constructor(i){super(i,Z1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=S_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Hp)&&this.heatmapFbos.delete(Hp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let T_;var q1={get paint(){return T_=T_||new Ns({"hillshade-illumination-direction":new ke(st.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ke(st.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ke(st.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ke(st.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ke(st.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ke(st.paint_hillshade["hillshade-accent-color"])})}};class W1 extends On{constructor(i){super(i,q1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const X1=rs([{name:"a_pos",components:2,type:"Int16"}],4),{members:K1}=X1;function Zp(l,i,o){const u=o.patternDependencies;let g=!1;for(const x of i){const b=x.paint.get(`${l}-pattern`);b.isConstant()||(g=!0);const S=b.constantOr(null);S&&(g=!0,u[S.to]=!0,u[S.from]=!0)}return g}function Gp(l,i,o,u,g){const x=g.patternDependencies;for(const b of i){const S=b.paint.get(`${l}-pattern`).value;if(S.kind!=="constant"){let M=S.evaluate({zoom:u-1},o,{},g.availableImages),I=S.evaluate({zoom:u},o,{},g.availableImages),A=S.evaluate({zoom:u+1},o,{},g.availableImages);M=M&&M.name?M.name:M,I=I&&I.name?I.name:I,A=A&&A.name?A.name:A,x[M]=!0,x[I]=!0,x[A]=!0,o.patterns[b.id]={min:M,mid:I,max:A}}}return o}function M_(l,i,o,u,g){let x;if(g===function(b,S,M,I){let A=0;for(let z=S,j=M-I;z<M;z+=I)A+=(b[j]-b[z])*(b[z+1]+b[j+1]),j=z;return A}(l,i,o,u)>0)for(let b=i;b<o;b+=u)x=I_(b/u|0,l[b],l[b+1],x);else for(let b=o-u;b>=i;b-=u)x=I_(b/u|0,l[b],l[b+1],x);return x&&jl(x,x.next)&&(Mh(x),x=x.next),x}function Ia(l,i){if(!l)return l;i||(i=l);let o,u=l;do if(o=!1,u.steiner||!jl(u,u.next)&&os(u.prev,u,u.next)!==0)u=u.next;else{if(Mh(u),u=i=u.prev,u===u.next)break;o=!0}while(o||u!==i);return i}function wh(l,i,o,u,g,x,b){if(!l)return;!b&&x&&function(M,I,A,z){let j=M;do j.z===0&&(j.z=qp(j.x,j.y,I,A,z)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==M);j.prevZ.nextZ=null,j.prevZ=null,function(U){let H,q=1;do{let it,ct=U;U=null;let St=null;for(H=0;ct;){H++;let ft=ct,$=0;for(let pt=0;pt<q&&($++,ft=ft.nextZ,ft);pt++);let tt=q;for(;$>0||tt>0&&ft;)$!==0&&(tt===0||!ft||ct.z<=ft.z)?(it=ct,ct=ct.nextZ,$--):(it=ft,ft=ft.nextZ,tt--),St?St.nextZ=it:U=it,it.prevZ=St,St=it;ct=ft}St.nextZ=null,q*=2}while(H>1)}(j)}(l,u,g,x);let S=l;for(;l.prev!==l.next;){const M=l.prev,I=l.next;if(x?J1(l,u,g,x):Y1(l))i.push(M.i,l.i,I.i),Mh(l),l=I.next,S=I.next;else if((l=I)===S){b?b===1?wh(l=Q1(Ia(l),i),i,o,u,g,x,2):b===2&&tw(l,i,o,u,g,x):wh(Ia(l),i,o,u,g,x,1);break}}}function Y1(l){const i=l.prev,o=l,u=l.next;if(os(i,o,u)>=0)return!1;const g=i.x,x=o.x,b=u.x,S=i.y,M=o.y,I=u.y,A=Math.min(g,x,b),z=Math.min(S,M,I),j=Math.max(g,x,b),U=Math.max(S,M,I);let H=u.next;for(;H!==i;){if(H.x>=A&&H.x<=j&&H.y>=z&&H.y<=U&&Sh(g,S,x,M,b,I,H.x,H.y)&&os(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function J1(l,i,o,u){const g=l.prev,x=l,b=l.next;if(os(g,x,b)>=0)return!1;const S=g.x,M=x.x,I=b.x,A=g.y,z=x.y,j=b.y,U=Math.min(S,M,I),H=Math.min(A,z,j),q=Math.max(S,M,I),it=Math.max(A,z,j),ct=qp(U,H,i,o,u),St=qp(q,it,i,o,u);let ft=l.prevZ,$=l.nextZ;for(;ft&&ft.z>=ct&&$&&$.z<=St;){if(ft.x>=U&&ft.x<=q&&ft.y>=H&&ft.y<=it&&ft!==g&&ft!==b&&Sh(S,A,M,z,I,j,ft.x,ft.y)&&os(ft.prev,ft,ft.next)>=0||(ft=ft.prevZ,$.x>=U&&$.x<=q&&$.y>=H&&$.y<=it&&$!==g&&$!==b&&Sh(S,A,M,z,I,j,$.x,$.y)&&os($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;ft&&ft.z>=ct;){if(ft.x>=U&&ft.x<=q&&ft.y>=H&&ft.y<=it&&ft!==g&&ft!==b&&Sh(S,A,M,z,I,j,ft.x,ft.y)&&os(ft.prev,ft,ft.next)>=0)return!1;ft=ft.prevZ}for(;$&&$.z<=St;){if($.x>=U&&$.x<=q&&$.y>=H&&$.y<=it&&$!==g&&$!==b&&Sh(S,A,M,z,I,j,$.x,$.y)&&os($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function Q1(l,i){let o=l;do{const u=o.prev,g=o.next.next;!jl(u,g)&&C_(u,o,o.next,g)&&Th(u,g)&&Th(g,u)&&(i.push(u.i,o.i,g.i),Mh(o),Mh(o.next),o=l=g),o=o.next}while(o!==l);return Ia(o)}function tw(l,i,o,u,g,x){let b=l;do{let S=b.next.next;for(;S!==b.prev;){if(b.i!==S.i&&rw(b,S)){let M=k_(b,S);return b=Ia(b,b.next),M=Ia(M,M.next),wh(b,i,o,u,g,x,0),void wh(M,i,o,u,g,x,0)}S=S.next}b=b.next}while(b!==l)}function ew(l,i){let o=l.x-i.x;return o===0&&(o=l.y-i.y,o===0)&&(o=(l.next.y-l.y)/(l.next.x-l.x)-(i.next.y-i.y)/(i.next.x-i.x)),o}function iw(l,i){const o=function(g,x){let b=x;const S=g.x,M=g.y;let I,A=-1/0;if(jl(g,b))return b;do{if(jl(g,b.next))return b.next;if(M<=b.y&&M>=b.next.y&&b.next.y!==b.y){const q=b.x+(M-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(q<=S&&q>A&&(A=q,I=b.x<b.next.x?b:b.next,q===S))return I}b=b.next}while(b!==x);if(!I)return null;const z=I,j=I.x,U=I.y;let H=1/0;b=I;do{if(S>=b.x&&b.x>=j&&S!==b.x&&P_(M<U?S:A,M,j,U,M<U?A:S,M,b.x,b.y)){const q=Math.abs(M-b.y)/(S-b.x);Th(b,g)&&(q<H||q===H&&(b.x>I.x||b.x===I.x&&sw(I,b)))&&(I=b,H=q)}b=b.next}while(b!==z);return I}(l,i);if(!o)return i;const u=k_(o,l);return Ia(u,u.next),Ia(o,o.next)}function sw(l,i){return os(l.prev,l,i.prev)<0&&os(i.next,l,l.next)<0}function qp(l,i,o,u,g){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-o)*g|0)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-u)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function nw(l){let i=l,o=l;do(i.x<o.x||i.x===o.x&&i.y<o.y)&&(o=i),i=i.next;while(i!==l);return o}function P_(l,i,o,u,g,x,b,S){return(g-b)*(i-S)>=(l-b)*(x-S)&&(l-b)*(u-S)>=(o-b)*(i-S)&&(o-b)*(x-S)>=(g-b)*(u-S)}function Sh(l,i,o,u,g,x,b,S){return!(l===b&&i===S)&&P_(l,i,o,u,g,x,b,S)}function rw(l,i){return l.next.i!==i.i&&l.prev.i!==i.i&&!function(o,u){let g=o;do{if(g.i!==o.i&&g.next.i!==o.i&&g.i!==u.i&&g.next.i!==u.i&&C_(g,g.next,o,u))return!0;g=g.next}while(g!==o);return!1}(l,i)&&(Th(l,i)&&Th(i,l)&&function(o,u){let g=o,x=!1;const b=(o.x+u.x)/2,S=(o.y+u.y)/2;do g.y>S!=g.next.y>S&&g.next.y!==g.y&&b<(g.next.x-g.x)*(S-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==o);return x}(l,i)&&(os(l.prev,l,i.prev)||os(l,i.prev,i))||jl(l,i)&&os(l.prev,l,l.next)>0&&os(i.prev,i,i.next)>0)}function os(l,i,o){return(i.y-l.y)*(o.x-i.x)-(i.x-l.x)*(o.y-i.y)}function jl(l,i){return l.x===i.x&&l.y===i.y}function C_(l,i,o,u){const g=Nd(os(l,i,o)),x=Nd(os(l,i,u)),b=Nd(os(o,u,l)),S=Nd(os(o,u,i));return g!==x&&b!==S||!(g!==0||!jd(l,o,i))||!(x!==0||!jd(l,u,i))||!(b!==0||!jd(o,l,u))||!(S!==0||!jd(o,i,u))}function jd(l,i,o){return i.x<=Math.max(l.x,o.x)&&i.x>=Math.min(l.x,o.x)&&i.y<=Math.max(l.y,o.y)&&i.y>=Math.min(l.y,o.y)}function Nd(l){return l>0?1:l<0?-1:0}function Th(l,i){return os(l.prev,l,l.next)<0?os(l,i,l.next)>=0&&os(l,l.prev,i)>=0:os(l,i,l.prev)<0||os(l,l.next,i)<0}function k_(l,i){const o=Wp(l.i,l.x,l.y),u=Wp(i.i,i.x,i.y),g=l.next,x=i.prev;return l.next=i,i.prev=l,o.next=g,g.prev=o,u.next=o,o.prev=u,x.next=u,u.prev=x,u}function I_(l,i,o,u){const g=Wp(l,i,o);return u?(g.next=u.next,g.prev=u,u.next.prev=g,u.next=g):(g.prev=g,g.next=g),g}function Mh(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Wp(l,i,o){return{i:l,x:i,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Nl{constructor(i,o){if(o>i)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=i,this._minGranularity=o}getGranularityForZoomLevel(i){return Math.max(Math.floor(this._baseZoomGranularity/(1<<i)),this._minGranularity,1)}}class Vd{constructor(i){this.fill=i.fill,this.line=i.line,this.tile=i.tile,this.stencil=i.stencil,this.circle=i.circle}}Vd.noSubdivision=new Vd({fill:new Nl(0,0),line:new Nl(0,0),tile:new Nl(0,0),stencil:new Nl(0,0),circle:1}),ge("SubdivisionGranularityExpression",Nl),ge("SubdivisionGranularitySetting",Vd);const Vl=-32768,Ph=32767;class ow{constructor(i,o){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=i,this._granularityCellSize=xe/i,this._canonical=o}_getKey(i,o){return(i+=32768)<<16|(o+=32768)<<0}_vertexToIndex(i,o){if(i<-32768||o<-32768||i>32767||o>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const u=0|Math.round(i),g=0|Math.round(o),x=this._getKey(u,g);if(this._vertexDictionary.has(x))return this._vertexDictionary.get(x);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(x,b),this._vertexBuffer.push(u,g),b}_subdivideTrianglesScanline(i){if(this._granularity<2)return function(g,x){const b=[];for(let S=0;S<x.length;S+=3){const M=x[S],I=x[S+1],A=x[S+2],z=g[2*M],j=g[2*M+1];(g[2*I]-z)*(g[2*A+1]-j)-(g[2*I+1]-j)*(g[2*A]-z)>0?(b.push(M),b.push(A),b.push(I)):(b.push(M),b.push(I),b.push(A))}return b}(this._vertexBuffer,i);const o=[],u=i.length;for(let g=0;g<u;g+=3){const x=[i[g+0],i[g+1],i[g+2]],b=[this._vertexBuffer[2*i[g+0]+0],this._vertexBuffer[2*i[g+0]+1],this._vertexBuffer[2*i[g+1]+0],this._vertexBuffer[2*i[g+1]+1],this._vertexBuffer[2*i[g+2]+0],this._vertexBuffer[2*i[g+2]+1]];let S=1/0,M=1/0,I=-1/0,A=-1/0;for(let q=0;q<3;q++){const it=b[2*q],ct=b[2*q+1];S=Math.min(S,it),I=Math.max(I,it),M=Math.min(M,ct),A=Math.max(A,ct)}if(S===I||M===A)continue;const z=Math.floor(S/this._granularityCellSize),j=Math.ceil(I/this._granularityCellSize),U=Math.floor(M/this._granularityCellSize),H=Math.ceil(A/this._granularityCellSize);if(z!==j||U!==H)for(let q=U;q<H;q++){const it=this._scanlineGenerateVertexRingForCellRow(q,b,x);aw(this._vertexBuffer,it,o)}else o.push(...x)}return o}_scanlineGenerateVertexRingForCellRow(i,o,u){const g=i*this._granularityCellSize,x=g+this._granularityCellSize,b=[];for(let S=0;S<3;S++){const M=o[2*S],I=o[2*S+1],A=o[2*(S+1)%6],z=o[(2*(S+1)+1)%6],j=o[2*(S+2)%6],U=o[(2*(S+2)+1)%6],H=A-M,q=z-I,it=H===0,ct=q===0,St=(g-I)/q,ft=(x-I)/q,$=Math.min(St,ft),tt=Math.max(St,ft);if(!ct&&($>=1||tt<=0)||ct&&(I<g||I>x)){z>=g&&z<=x&&b.push(u[(S+1)%3]);continue}!ct&&$>0&&b.push(this._vertexToIndex(M+H*$,I+q*$));const pt=M+H*Math.max($,0),Rt=M+H*Math.min(tt,1);it||this._generateIntraEdgeVertices(b,M,I,A,z,pt,Rt),!ct&&tt<1&&b.push(this._vertexToIndex(M+H*tt,I+q*tt)),(ct||z>=g&&z<=x)&&b.push(u[(S+1)%3]),!ct&&(z<=g||z>=x)&&this._generateInterEdgeVertices(b,M,I,A,z,j,U,Rt,g,x)}return b}_generateIntraEdgeVertices(i,o,u,g,x,b,S){const M=g-o,I=x-u,A=I===0,z=A?Math.min(o,g):Math.min(b,S),j=A?Math.max(o,g):Math.max(b,S),U=Math.floor(z/this._granularityCellSize)+1,H=Math.ceil(j/this._granularityCellSize)-1;if(A?o<g:b<S)for(let q=U;q<=H;q++){const it=q*this._granularityCellSize;i.push(this._vertexToIndex(it,u+I*(it-o)/M))}else for(let q=H;q>=U;q--){const it=q*this._granularityCellSize;i.push(this._vertexToIndex(it,u+I*(it-o)/M))}}_generateInterEdgeVertices(i,o,u,g,x,b,S,M,I,A){const z=x-u,j=b-g,U=S-x,H=(I-x)/U,q=(A-x)/U,it=Math.min(H,q),ct=Math.max(H,q),St=g+j*it;let ft=Math.floor(Math.min(St,M)/this._granularityCellSize)+1,$=Math.ceil(Math.max(St,M)/this._granularityCellSize)-1,tt=M<St;const pt=U===0;if(pt&&(S===I||S===A))return;if(pt||it>=1||ct<=0){const Qt=u-S,Nt=b+(o-b)*Math.min((I-S)/Qt,(A-S)/Qt);ft=Math.floor(Math.min(Nt,M)/this._granularityCellSize)+1,$=Math.ceil(Math.max(Nt,M)/this._granularityCellSize)-1,tt=M<Nt}const Rt=z>0?A:I;if(tt)for(let Qt=ft;Qt<=$;Qt++)i.push(this._vertexToIndex(Qt*this._granularityCellSize,Rt));else for(let Qt=$;Qt>=ft;Qt--)i.push(this._vertexToIndex(Qt*this._granularityCellSize,Rt))}_generateOutline(i){const o=[];for(const u of i){const g=Da(u,this._granularity,!0),x=this._pointArrayToIndices(g),b=[];for(let S=1;S<x.length;S++)b.push(x[S-1]),b.push(x[S]);o.push(b)}return o}_handlePoles(i){let o=!1,u=!1;this._canonical&&(this._canonical.y===0&&(o=!0),this._canonical.y===(1<<this._canonical.z)-1&&(u=!0)),(o||u)&&this._fillPoles(i,o,u)}_ensureNoPoleVertices(){const i=this._vertexBuffer;for(let o=0;o<i.length;o+=2){const u=i[o+1];u===Vl&&(i[o+1]=-32767),u===Ph&&(i[o+1]=32766)}}_generatePoleQuad(i,o,u,g,x,b){g>x!=(b===Vl)?(i.push(o),i.push(u),i.push(this._vertexToIndex(g,b)),i.push(u),i.push(this._vertexToIndex(x,b)),i.push(this._vertexToIndex(g,b))):(i.push(u),i.push(o),i.push(this._vertexToIndex(g,b)),i.push(this._vertexToIndex(x,b)),i.push(u),i.push(this._vertexToIndex(g,b)))}_fillPoles(i,o,u){const g=this._vertexBuffer,x=xe,b=i.length;for(let S=2;S<b;S+=3){const M=i[S-2],I=i[S-1],A=i[S],z=g[2*M],j=g[2*M+1],U=g[2*I],H=g[2*I+1],q=g[2*A],it=g[2*A+1];o&&(j===0&&H===0&&this._generatePoleQuad(i,M,I,z,U,Vl),H===0&&it===0&&this._generatePoleQuad(i,I,A,U,q,Vl),it===0&&j===0&&this._generatePoleQuad(i,A,M,q,z,Vl)),u&&(j===x&&H===x&&this._generatePoleQuad(i,M,I,z,U,Ph),H===x&&it===x&&this._generatePoleQuad(i,I,A,U,q,Ph),it===x&&j===x&&this._generatePoleQuad(i,A,M,q,z,Ph))}}_initializeVertices(i){for(let o=0;o<i.length;o+=2)this._vertexToIndex(i[o],i[o+1])}subdividePolygonInternal(i,o){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:u,holeIndices:g}=function(S){const M=[],I=[];for(const A of S)if(A.length!==0){A!==S[0]&&M.push(I.length/2);for(let z=0;z<A.length;z++)I.push(A[z].x),I.push(A[z].y)}return{flattened:I,holeIndices:M}}(i);let x;this._initializeVertices(u);try{const S=function(I,A,z=2){const j=A&&A.length,U=j?A[0]*z:I.length;let H=M_(I,0,U,z,!0);const q=[];if(!H||H.next===H.prev)return q;let it,ct,St;if(j&&(H=function(ft,$,tt,pt){const Rt=[];for(let Qt=0,Nt=$.length;Qt<Nt;Qt++){const Ht=M_(ft,$[Qt]*pt,Qt<Nt-1?$[Qt+1]*pt:ft.length,pt,!1);Ht===Ht.next&&(Ht.steiner=!0),Rt.push(nw(Ht))}Rt.sort(ew);for(let Qt=0;Qt<Rt.length;Qt++)tt=iw(Rt[Qt],tt);return tt}(I,A,H,z)),I.length>80*z){it=1/0,ct=1/0;let ft=-1/0,$=-1/0;for(let tt=z;tt<U;tt+=z){const pt=I[tt],Rt=I[tt+1];pt<it&&(it=pt),Rt<ct&&(ct=Rt),pt>ft&&(ft=pt),Rt>$&&($=Rt)}St=Math.max(ft-it,$-ct),St=St!==0?32767/St:0}return wh(H,q,z,it,ct,St,0),q}(u,g),M=this._convertIndices(u,S);x=this._subdivideTrianglesScanline(M)}catch(S){console.error(S)}let b=[];return o&&(b=this._generateOutline(i)),this._ensureNoPoleVertices(),this._handlePoles(x),{verticesFlattened:this._vertexBuffer,indicesTriangles:x,indicesLineList:b}}_convertIndices(i,o){const u=[];for(let g=0;g<o.length;g++)u.push(this._vertexToIndex(i[2*o[g]],i[2*o[g]+1]));return u}_pointArrayToIndices(i){const o=[];for(let u=0;u<i.length;u++){const g=i[u];o.push(this._vertexToIndex(g.x,g.y))}return o}}function D_(l,i,o,u=!0){return new ow(o,i).subdividePolygonInternal(l,u)}function Da(l,i,o=!1){if(!l||l.length<1)return[];if(l.length<2)return[];const u=l[0],g=l[l.length-1],x=o&&(u.x!==g.x||u.y!==g.y);if(i<2)return x?[...l,l[0]]:[...l];const b=Math.floor(xe/i),S=[];S.push(new J(l[0].x,l[0].y));const M=l.length,I=x?M:M-1;for(let A=0;A<I;A++){const z=l[A],j=A<M-1?l[A+1]:l[0],U=z.x,H=z.y,q=j.x,it=j.y,ct=U!==q,St=H!==it;if(!ct&&!St)continue;const ft=q-U,$=it-H,tt=Math.abs(ft),pt=Math.abs($);let Rt=U,Qt=H;for(;;){const Ht=ft>0?(Math.floor(Rt/b)+1)*b:(Math.ceil(Rt/b)-1)*b,ne=$>0?(Math.floor(Qt/b)+1)*b:(Math.ceil(Qt/b)-1)*b,ee=Math.abs(Rt-Ht),oe=Math.abs(Qt-ne),Wt=Math.abs(Rt-q),we=Math.abs(Qt-it),Ae=ct?ee/tt:Number.POSITIVE_INFINITY,Ie=St?oe/pt:Number.POSITIVE_INFINITY;if((Wt<=ee||!ct)&&(we<=oe||!St))break;if(Ae<Ie&&ct||!St){Rt=Ht,Qt+=$*Ae;const Pe=new J(Rt,Math.round(Qt));S[S.length-1].x===Pe.x&&S[S.length-1].y===Pe.y||S.push(Pe)}else{Rt+=ft*Ie,Qt=ne;const Pe=new J(Math.round(Rt),Qt);S[S.length-1].x===Pe.x&&S[S.length-1].y===Pe.y||S.push(Pe)}}const Nt=new J(q,it);S[S.length-1].x===Nt.x&&S[S.length-1].y===Nt.y||S.push(Nt)}return S}function aw(l,i,o){if(i.length===0)throw new Error("Subdivision vertex ring is empty.");let u=0,g=l[2*i[0]];for(let M=1;M<i.length;M++){const I=l[2*i[M]];I<g&&(g=I,u=M)}const x=i.length;let b=u,S=(b+1)%x;for(;;){const M=b-1>=0?b-1:x-1,I=(S+1)%x,A=l[2*i[M]],z=l[2*i[I]],j=l[2*i[b]],U=l[2*i[b]+1],H=l[2*i[S]+1];let q=!1;if(A<z)q=!0;else if(A>z)q=!1;else{const it=H-U,ct=-(l[2*i[S]]-j),St=U<H?1:-1;((A-j)*it+(l[2*i[M]+1]-U)*ct)*St>((z-j)*it+(l[2*i[I]+1]-U)*ct)*St&&(q=!0)}if(q){const it=i[M],ct=i[b],St=i[S];it!==ct&&it!==St&&ct!==St&&o.push(St,ct,it),b--,b<0&&(b=x-1)}else{const it=i[I],ct=i[b],St=i[S];it!==ct&&it!==St&&ct!==St&&o.push(St,ct,it),S++,S>=x&&(S=0)}if(M===I)break}}function A_(l,i,o,u,g,x,b,S,M){const I=g.length/2,A=b&&S&&M;if(I<pe.MAX_VERTEX_ARRAY_LENGTH){const z=i.prepareSegment(I,o,u),j=z.vertexLength;for(let q=0;q<x.length;q+=3)u.emplaceBack(j+x[q],j+x[q+1],j+x[q+2]);let U,H;z.vertexLength+=I,z.primitiveLength+=x.length/3,A&&(H=b.prepareSegment(I,o,S),U=H.vertexLength,H.vertexLength+=I);for(let q=0;q<g.length;q+=2)l(g[q],g[q+1]);if(A)for(let q=0;q<M.length;q++){const it=M[q];for(let ct=1;ct<it.length;ct+=2)S.emplaceBack(U+it[ct-1],U+it[ct]);H.primitiveLength+=it.length/2}}else(function(z,j,U,H,q,it){const ct=[];for(let pt=0;pt<H.length/2;pt++)ct.push(-1);const St={count:0};let ft=0,$=z.getOrCreateLatestSegment(j,U),tt=$.vertexLength;for(let pt=2;pt<q.length;pt+=3){const Rt=q[pt-2],Qt=q[pt-1],Nt=q[pt];let Ht=ct[Rt]<ft,ne=ct[Qt]<ft,ee=ct[Nt]<ft;$.vertexLength+((Ht?1:0)+(ne?1:0)+(ee?1:0))>pe.MAX_VERTEX_ARRAY_LENGTH&&($=z.createNewSegment(j,U),ft=St.count,Ht=!0,ne=!0,ee=!0,tt=0);const oe=Ch(ct,H,it,St,Rt,Ht,$),Wt=Ch(ct,H,it,St,Qt,ne,$),we=Ch(ct,H,it,St,Nt,ee,$);U.emplaceBack(tt+oe-ft,tt+Wt-ft,tt+we-ft),$.primitiveLength++}})(i,o,u,g,x,l),A&&function(z,j,U,H,q,it){const ct=[];for(let pt=0;pt<H.length/2;pt++)ct.push(-1);const St={count:0};let ft=0,$=z.getOrCreateLatestSegment(j,U),tt=$.vertexLength;for(let pt=0;pt<q.length;pt++){const Rt=q[pt];for(let Qt=1;Qt<q[pt].length;Qt+=2){const Nt=Rt[Qt-1],Ht=Rt[Qt];let ne=ct[Nt]<ft,ee=ct[Ht]<ft;$.vertexLength+((ne?1:0)+(ee?1:0))>pe.MAX_VERTEX_ARRAY_LENGTH&&($=z.createNewSegment(j,U),ft=St.count,ne=!0,ee=!0,tt=0);const oe=Ch(ct,H,it,St,Nt,ne,$),Wt=Ch(ct,H,it,St,Ht,ee,$);U.emplaceBack(tt+oe-ft,tt+Wt-ft),$.primitiveLength++}}}(b,o,S,g,M,l),i.forceNewSegmentOnNextPrepare(),b==null||b.forceNewSegmentOnNextPrepare()}function Ch(l,i,o,u,g,x,b){if(x){const S=u.count;return o(i[2*g],i[2*g+1]),l[g]=u.count,u.count++,b.vertexLength++,S}return l[g]}class Xp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ut,this.indexArray=new Ut,this.indexArray2=new ce,this.programConfigurations=new Ui(i.layers,i.zoom),this.segments=new pe,this.segments2=new pe,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,u){this.hasPattern=Zp("fill",this.layers,o);const g=this.layers[0].layout.get("fill-sort-key"),x=!g.isConstant(),b=[];for(const{feature:S,id:M,index:I,sourceLayerIndex:A}of i){const z=this.layers[0]._featureFilter.needGeometry,j=Ur(S,z);if(!this.layers[0]._featureFilter.filter(new Oi(this.zoom),j,u))continue;const U=x?g.evaluate(j,{},u,o.availableImages):void 0,H={id:M,properties:S.properties,type:S.type,sourceLayerIndex:A,index:I,geometry:z?j.geometry:$r(S),patterns:{},sortKey:U};b.push(H)}x&&b.sort((S,M)=>S.sortKey-M.sortKey);for(const S of b){const{geometry:M,index:I,sourceLayerIndex:A}=S;if(this.hasPattern){const z=Gp("fill",this.layers,S,this.zoom,o);this.patternFeatures.push(z)}else this.addFeature(S,M,I,u,{},o.subdivisionGranularity);o.featureIndex.insert(i[I].feature,M,I,A,this.index)}}update(i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,u)}addFeatures(i,o,u){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,o,u,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,K1),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,o,u,g,x,b){for(const S of ol(o,500)){const M=D_(S,g,b.fill.getGranularityForZoomLevel(g.z)),I=this.layoutVertexArray;A_((A,z)=>{I.emplaceBack(A,z)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles,this.segments2,this.indexArray2,M.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,x,g)}}let E_,z_;ge("FillBucket",Xp,{omit:["layers","patternFeatures"]});var lw={get paint(){return z_=z_||new Ns({"fill-antialias":new ke(st.paint_fill["fill-antialias"]),"fill-opacity":new Re(st.paint_fill["fill-opacity"]),"fill-color":new Re(st.paint_fill["fill-color"]),"fill-outline-color":new Re(st.paint_fill["fill-outline-color"]),"fill-translate":new ke(st.paint_fill["fill-translate"]),"fill-translate-anchor":new ke(st.paint_fill["fill-translate-anchor"]),"fill-pattern":new ba(st.paint_fill["fill-pattern"])})},get layout(){return E_=E_||new Ns({"fill-sort-key":new Re(st.layout_fill["fill-sort-key"])})}};class cw extends On{constructor(i){super(i,lw)}recalculate(i,o){super.recalculate(i,o);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Xp(i)}queryRadius(){return Od(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:i,geometry:o,transform:u,pixelsToTileUnits:g}){return yh(Bd(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-u.bearingInRadians,g),o)}isTileClipped(){return!0}}const hw=rs([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),uw=rs([{name:"a_centroid",components:2,type:"Int16"}],4),{members:dw}=hw;var Kp,R_,Yp,L_,Jp,F_,O_,$d={};function B_(){if(R_)return Kp;R_=1;var l=E();function i(g,x,b,S,M){this.properties={},this.extent=b,this.type=0,this._pbf=g,this._geometry=-1,this._keys=S,this._values=M,g.readFields(o,this,x)}function o(g,x,b){g==1?x.id=b.readVarint():g==2?function(S,M){for(var I=S.readVarint()+S.pos;S.pos<I;){var A=M._keys[S.readVarint()],z=M._values[S.readVarint()];M.properties[A]=z}}(b,x):g==3?x.type=b.readVarint():g==4&&(x._geometry=b.pos)}function u(g){for(var x,b,S=0,M=0,I=g.length,A=I-1;M<I;A=M++)S+=((b=g[A]).x-(x=g[M]).x)*(x.y+b.y);return S}return Kp=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var x,b=g.readVarint()+g.pos,S=1,M=0,I=0,A=0,z=[];g.pos<b;){if(M<=0){var j=g.readVarint();S=7&j,M=j>>3}if(M--,S===1||S===2)I+=g.readSVarint(),A+=g.readSVarint(),S===1&&(x&&z.push(x),x=[]),x.push(new l(I,A));else{if(S!==7)throw new Error("unknown command "+S);x&&x.push(x[0].clone())}}return x&&z.push(x),z},i.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var x=g.readVarint()+g.pos,b=1,S=0,M=0,I=0,A=1/0,z=-1/0,j=1/0,U=-1/0;g.pos<x;){if(S<=0){var H=g.readVarint();b=7&H,S=H>>3}if(S--,b===1||b===2)(M+=g.readSVarint())<A&&(A=M),M>z&&(z=M),(I+=g.readSVarint())<j&&(j=I),I>U&&(U=I);else if(b!==7)throw new Error("unknown command "+b)}return[A,j,z,U]},i.prototype.toGeoJSON=function(g,x,b){var S,M,I=this.extent*Math.pow(2,b),A=this.extent*g,z=this.extent*x,j=this.loadGeometry(),U=i.types[this.type];function H(ct){for(var St=0;St<ct.length;St++){var ft=ct[St];ct[St]=[360*(ft.x+A)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(ft.y+z)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(S=0;S<j.length;S++)q[S]=j[S][0];H(j=q);break;case 2:for(S=0;S<j.length;S++)H(j[S]);break;case 3:for(j=function(ct){var St=ct.length;if(St<=1)return[ct];for(var ft,$,tt=[],pt=0;pt<St;pt++){var Rt=u(ct[pt]);Rt!==0&&($===void 0&&($=Rt<0),$===Rt<0?(ft&&tt.push(ft),ft=[ct[pt]]):ft.push(ct[pt]))}return ft&&tt.push(ft),tt}(j),S=0;S<j.length;S++)for(M=0;M<j[S].length;M++)H(j[S][M])}j.length===1?j=j[0]:U="Multi"+U;var it={type:"Feature",geometry:{type:U,coordinates:j},properties:this.properties};return"id"in this&&(it.id=this.id),it},Kp}function j_(){if(L_)return Yp;L_=1;var l=B_();function i(u,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(o,this,g),this.length=this._features.length}function o(u,g,x){u===15?g.version=x.readVarint():u===1?g.name=x.readString():u===5?g.extent=x.readVarint():u===2?g._features.push(x.pos):u===3?g._keys.push(x.readString()):u===4&&g._values.push(function(b){for(var S=null,M=b.readVarint()+b.pos;b.pos<M;){var I=b.readVarint()>>3;S=I===1?b.readString():I===2?b.readFloat():I===3?b.readDouble():I===4?b.readVarint64():I===5?b.readVarint():I===6?b.readSVarint():I===7?b.readBoolean():null}return S}(x))}return Yp=i,i.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var g=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,g,this.extent,this._keys,this._values)},Yp}function N_(){return O_||(O_=1,$d.VectorTile=function(){if(F_)return Jp;F_=1;var l=j_();function i(o,u,g){if(o===3){var x=new l(g,g.readVarint()+g.pos);x.length&&(u[x.name]=x)}}return Jp=function(o,u){this.layers=o.readFields(i,{},u)},Jp}(),$d.VectorTileFeature=B_(),$d.VectorTileLayer=j_()),$d}var kh=w(N_());const fw=kh.VectorTileFeature.types,Qp=Math.pow(2,13);function Ih(l,i,o,u,g,x,b,S){l.emplaceBack(i,o,2*Math.floor(u*Qp)+b,g*Qp*2,x*Qp*2,Math.round(S))}class tm{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new gt,this.centroidVertexArray=new ot,this.indexArray=new Ut,this.programConfigurations=new Ui(i.layers,i.zoom),this.segments=new pe,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,u){this.features=[],this.hasPattern=Zp("fill-extrusion",this.layers,o);for(const{feature:g,id:x,index:b,sourceLayerIndex:S}of i){const M=this.layers[0]._featureFilter.needGeometry,I=Ur(g,M);if(!this.layers[0]._featureFilter.filter(new Oi(this.zoom),I,u))continue;const A={id:x,sourceLayerIndex:S,index:b,geometry:M?I.geometry:$r(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Gp("fill-extrusion",this.layers,A,this.zoom,o)):this.addFeature(A,A.geometry,b,u,{},o.subdivisionGranularity),o.featureIndex.insert(g,A.geometry,b,S,this.index,!0)}}addFeatures(i,o,u){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,o,u,i.subdivisionGranularity)}}update(i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,dw),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,uw.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,o,u,g,x,b){for(const S of ol(o,500)){const M={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(M,g,i,S,b);const A=this.layoutVertexArray.length-I,z=Math.floor(M.x/M.sampleCount),j=Math.floor(M.y/M.sampleCount);for(let U=0;U<A;U++)this.centroidVertexArray.emplaceBack(z,j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,x,g)}processPolygon(i,o,u,g,x){if(g.length<1||V_(g[0]))return;for(const z of g)z.length!==0&&pw(i,z);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},S=x.fill.getGranularityForZoomLevel(o.z),M=fw[u.type]==="Polygon";for(const z of g){if(z.length===0||V_(z))continue;const j=Da(z,S,M);this._generateSideFaces(j,b)}if(!M)return;const I=D_(g,o,S,!1),A=this.layoutVertexArray;A_((z,j)=>{Ih(A,z,j,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(i,o){let u=0;for(let g=1;g<i.length;g++){const x=i[g],b=i[g-1];if(mw(x,b))continue;o.segment.vertexLength+4>pe.MAX_VERTEX_ARRAY_LENGTH&&(o.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const S=x.sub(b)._perp()._unit(),M=b.dist(x);u+M>32768&&(u=0),Ih(this.layoutVertexArray,x.x,x.y,S.x,S.y,0,0,u),Ih(this.layoutVertexArray,x.x,x.y,S.x,S.y,0,1,u),u+=M,Ih(this.layoutVertexArray,b.x,b.y,S.x,S.y,0,0,u),Ih(this.layoutVertexArray,b.x,b.y,S.x,S.y,0,1,u);const I=o.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),o.segment.vertexLength+=4,o.segment.primitiveLength+=2}}}function pw(l,i){for(let o=0;o<i.length;o++){const u=i[o];o===i.length-1&&i[0].x===u.x&&i[0].y===u.y||(l.x+=u.x,l.y+=u.y,l.sampleCount++)}}function mw(l,i){return l.x===i.x&&(l.x<0||l.x>xe)||l.y===i.y&&(l.y<0||l.y>xe)}function V_(l){return l.every(i=>i.x<0)||l.every(i=>i.x>xe)||l.every(i=>i.y<0)||l.every(i=>i.y>xe)}let $_;ge("FillExtrusionBucket",tm,{omit:["layers","features"]});var gw={get paint(){return $_=$_||new Ns({"fill-extrusion-opacity":new ke(st["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Re(st["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ke(st["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ke(st["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ba(st["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Re(st["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Re(st["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ke(st["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class _w extends On{constructor(i){super(i,gw)}createBucket(i){return new tm(i)}queryRadius(){return Od(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:u,geometry:g,transform:x,pixelsToTileUnits:b,pixelPosMatrix:S}){const M=Bd(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-x.bearingInRadians,b),I=this.paint.get("fill-extrusion-height").evaluate(o,u),A=this.paint.get("fill-extrusion-base").evaluate(o,u),z=function(U,H,q){const it=[];for(const ct of U){const St=[ct.x,ct.y,0,1];Fe(St,St,H),it.push(new J(St[0]/St[3],St[1]/St[3]))}return it}(M,S),j=function(U,H,q,it){const ct=[],St=[],ft=it[8]*H,$=it[9]*H,tt=it[10]*H,pt=it[11]*H,Rt=it[8]*q,Qt=it[9]*q,Nt=it[10]*q,Ht=it[11]*q;for(const ne of U){const ee=[],oe=[];for(const Wt of ne){const we=Wt.x,Ae=Wt.y,Ie=it[0]*we+it[4]*Ae+it[12],Pe=it[1]*we+it[5]*Ae+it[13],ei=it[2]*we+it[6]*Ae+it[14],Xi=it[3]*we+it[7]*Ae+it[15],gs=ei+tt,Rs=Xi+pt,Mn=Ie+Rt,an=Pe+Qt,Ms=ei+Nt,Hi=Xi+Ht,xs=new J((Ie+ft)/Rs,(Pe+$)/Rs);xs.z=gs/Rs,ee.push(xs);const Ps=new J(Mn/Hi,an/Hi);Ps.z=Ms/Hi,oe.push(Ps)}ct.push(ee),St.push(oe)}return[ct,St]}(g,A,I,S);return function(U,H,q){let it=1/0;yh(q,H)&&(it=U_(q,H[0]));for(let ct=0;ct<H.length;ct++){const St=H[ct],ft=U[ct];for(let $=0;$<St.length-1;$++){const tt=St[$],pt=[tt,St[$+1],ft[$+1],ft[$],tt];gh(q,pt)&&(it=Math.min(it,U_(q,pt)))}}return it!==1/0&&it}(j[0],j[1],z)}}function Dh(l,i){return l.x*i.x+l.y*i.y}function U_(l,i){if(l.length===1){let o=0;const u=i[o++];let g;for(;!g||u.equals(g);)if(g=i[o++],!g)return 1/0;for(;o<i.length;o++){const x=i[o],b=l[0],S=g.sub(u),M=x.sub(u),I=b.sub(u),A=Dh(S,S),z=Dh(S,M),j=Dh(M,M),U=Dh(I,S),H=Dh(I,M),q=A*j-z*z,it=(j*U-z*H)/q,ct=(A*H-z*U)/q,St=u.z*(1-it-ct)+g.z*it+x.z*ct;if(isFinite(St))return St}return 1/0}{let o=1/0;for(const u of i)o=Math.min(o,u.z);return o}}const yw=rs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:xw}=yw,bw=rs([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:vw}=bw,ww=kh.VectorTileFeature.types,Sw=Math.cos(Math.PI/180*37.5),H_=Math.pow(2,14)/.5;class em{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new _t,this.layoutVertexArray2=new yt,this.indexArray=new Ut,this.programConfigurations=new Ui(i.layers,i.zoom),this.segments=new pe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(i,o,u){this.hasPattern=Zp("line",this.layers,o);const g=this.layers[0].layout.get("line-sort-key"),x=!g.isConstant(),b=[];for(const{feature:S,id:M,index:I,sourceLayerIndex:A}of i){const z=this.layers[0]._featureFilter.needGeometry,j=Ur(S,z);if(!this.layers[0]._featureFilter.filter(new Oi(this.zoom),j,u))continue;const U=x?g.evaluate(j,{},u):void 0,H={id:M,properties:S.properties,type:S.type,sourceLayerIndex:A,index:I,geometry:z?j.geometry:$r(S),patterns:{},sortKey:U};b.push(H)}x&&b.sort((S,M)=>S.sortKey-M.sortKey);for(const S of b){const{geometry:M,index:I,sourceLayerIndex:A}=S;if(this.hasPattern){const z=Gp("line",this.layers,S,this.zoom,o);this.patternFeatures.push(z)}else this.addFeature(S,M,I,u,{},o.subdivisionGranularity);o.featureIndex.insert(i[I].feature,M,I,A,this.index)}}update(i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,o,this.stateDependentLayers,u)}addFeatures(i,o,u){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,o,u,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,vw)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,xw),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,o,u,g,x,b){const S=this.layers[0].layout,M=S.get("line-join").evaluate(i,{}),I=S.get("line-cap"),A=S.get("line-miter-limit"),z=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const j of o)this.addLine(j,i,M,I,A,z,g,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,x,g)}addLine(i,o,u,g,x,b,S,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,i=Da(i,S?M.line.getGranularityForZoomLevel(S.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ft=0;ft<i.length-1;ft++)this.totalDistance+=i[ft].dist(i[ft+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=ww[o.type]==="Polygon";let A=i.length;for(;A>=2&&i[A-1].equals(i[A-2]);)A--;let z=0;for(;z<A-1&&i[z].equals(i[z+1]);)z++;if(A<(I?3:2))return;u==="bevel"&&(x=1.05);const j=this.overscaling<=16?15*xe/(512*this.overscaling):0,U=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let H,q,it,ct,St;this.e1=this.e2=-1,I&&(H=i[A-2],St=i[z].sub(H)._unit()._perp());for(let ft=z;ft<A;ft++){if(it=ft===A-1?I?i[z+1]:void 0:i[ft+1],it&&i[ft].equals(it))continue;St&&(ct=St),H&&(q=H),H=i[ft],St=it?it.sub(H)._unit()._perp():ct,ct=ct||St;let $=ct.add(St);$.x===0&&$.y===0||$._unit();const tt=ct.x*St.x+ct.y*St.y,pt=$.x*St.x+$.y*St.y,Rt=pt!==0?1/pt:1/0,Qt=2*Math.sqrt(2-2*pt),Nt=pt<Sw&&q&&it,Ht=ct.x*St.y-ct.y*St.x>0;if(Nt&&ft>z){const oe=H.dist(q);if(oe>2*j){const Wt=H.sub(H.sub(q)._mult(j/oe)._round());this.updateDistance(q,Wt),this.addCurrentVertex(Wt,ct,0,0,U),q=Wt}}const ne=q&&it;let ee=ne?u:I?"butt":g;if(ne&&ee==="round"&&(Rt<b?ee="miter":Rt<=2&&(ee="fakeround")),ee==="miter"&&Rt>x&&(ee="bevel"),ee==="bevel"&&(Rt>2&&(ee="flipbevel"),Rt<x&&(ee="miter")),q&&this.updateDistance(q,H),ee==="miter")$._mult(Rt),this.addCurrentVertex(H,$,0,0,U);else if(ee==="flipbevel"){if(Rt>100)$=St.mult(-1);else{const oe=Rt*ct.add(St).mag()/ct.sub(St).mag();$._perp()._mult(oe*(Ht?-1:1))}this.addCurrentVertex(H,$,0,0,U),this.addCurrentVertex(H,$.mult(-1),0,0,U)}else if(ee==="bevel"||ee==="fakeround"){const oe=-Math.sqrt(Rt*Rt-1),Wt=Ht?oe:0,we=Ht?0:oe;if(q&&this.addCurrentVertex(H,ct,Wt,we,U),ee==="fakeround"){const Ae=Math.round(180*Qt/Math.PI/20);for(let Ie=1;Ie<Ae;Ie++){let Pe=Ie/Ae;if(Pe!==.5){const Xi=Pe-.5;Pe+=Pe*Xi*(Pe-1)*((1.0904+tt*(tt*(3.55645-1.43519*tt)-3.2452))*Xi*Xi+(.848013+tt*(.215638*tt-1.06021)))}const ei=St.sub(ct)._mult(Pe)._add(ct)._unit()._mult(Ht?-1:1);this.addHalfVertex(H,ei.x,ei.y,!1,Ht,0,U)}}it&&this.addCurrentVertex(H,St,-Wt,-we,U)}else if(ee==="butt")this.addCurrentVertex(H,$,0,0,U);else if(ee==="square"){const oe=q?1:-1;this.addCurrentVertex(H,$,oe,oe,U)}else ee==="round"&&(q&&(this.addCurrentVertex(H,ct,0,0,U),this.addCurrentVertex(H,ct,1,1,U,!0)),it&&(this.addCurrentVertex(H,St,-1,-1,U,!0),this.addCurrentVertex(H,St,0,0,U)));if(Nt&&ft<A-1){const oe=H.dist(it);if(oe>2*j){const Wt=H.add(it.sub(H)._mult(j/oe)._round());this.updateDistance(H,Wt),this.addCurrentVertex(Wt,St,0,0,U),H=Wt}}}}addCurrentVertex(i,o,u,g,x,b=!1){const S=o.y*g-o.x,M=-o.y-o.x*g;this.addHalfVertex(i,o.x+o.y*u,o.y-o.x*u,b,!1,u,x),this.addHalfVertex(i,S,M,b,!0,-g,x),this.distance>H_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,o,u,g,x,b))}addHalfVertex({x:i,y:o},u,g,x,b,S,M){const I=.5*(this.lineClips?this.scaledDistance*(H_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(x?1:0),(o<<1)+(b?1:0),Math.round(63*u)+128,Math.round(63*g)+128,1+(S===0?0:S<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,A,this.e2),M.primitiveLength++),b?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,o){this.distance+=i.dist(o),this.updateScaledDistance()}}let Z_,G_;ge("LineBucket",em,{omit:["layers","patternFeatures"]});var q_={get paint(){return G_=G_||new Ns({"line-opacity":new Re(st.paint_line["line-opacity"]),"line-color":new Re(st.paint_line["line-color"]),"line-translate":new ke(st.paint_line["line-translate"]),"line-translate-anchor":new ke(st.paint_line["line-translate-anchor"]),"line-width":new Re(st.paint_line["line-width"]),"line-gap-width":new Re(st.paint_line["line-gap-width"]),"line-offset":new Re(st.paint_line["line-offset"]),"line-blur":new Re(st.paint_line["line-blur"]),"line-dasharray":new zl(st.paint_line["line-dasharray"]),"line-pattern":new ba(st.paint_line["line-pattern"]),"line-gradient":new Rl(st.paint_line["line-gradient"])})},get layout(){return Z_=Z_||new Ns({"line-cap":new ke(st.layout_line["line-cap"]),"line-join":new Re(st.layout_line["line-join"]),"line-miter-limit":new ke(st.layout_line["line-miter-limit"]),"line-round-limit":new ke(st.layout_line["line-round-limit"]),"line-sort-key":new Re(st.layout_line["line-sort-key"])})}};class Tw extends Re{possiblyEvaluate(i,o){return o=new Oi(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(i,o)}evaluate(i,o,u,g){return o=ai({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(i,o,u,g)}}let Ud;class Mw extends On{constructor(i){super(i,q_),this.gradientVersion=0,Ud||(Ud=new Tw(q_.paint.properties["line-width"].specification),Ud.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!function(u){return u._styleExpression!==void 0}(o)&&o._styleExpression.expression instanceof Ar,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,o){super.recalculate(i,o),this.paint._values["line-floorwidth"]=Ud.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new em(i)}queryRadius(i){const o=i,u=W_(bh("line-width",this,o),bh("line-gap-width",this,o)),g=bh("line-offset",this,o);return u/2+Math.abs(g)+Od(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:i,feature:o,featureState:u,geometry:g,transform:x,pixelsToTileUnits:b}){const S=Bd(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-x.bearingInRadians,b),M=b/2*W_(this.paint.get("line-width").evaluate(o,u),this.paint.get("line-gap-width").evaluate(o,u)),I=this.paint.get("line-offset").evaluate(o,u);return I&&(g=function(A,z){const j=[];for(let U=0;U<A.length;U++){const H=A[U],q=[];for(let it=0;it<H.length;it++){const ct=H[it-1],St=H[it],ft=H[it+1],$=it===0?new J(0,0):St.sub(ct)._unit()._perp(),tt=it===H.length-1?new J(0,0):ft.sub(St)._unit()._perp(),pt=$._add(tt)._unit(),Rt=pt.x*tt.x+pt.y*tt.y;Rt!==0&&pt._mult(1/Rt),q.push(pt._mult(z)._add(St))}j.push(q)}return j}(g,I*b)),function(A,z,j){for(let U=0;U<z.length;U++){const H=z[U];if(A.length>=3){for(let q=0;q<H.length;q++)if(Bl(A,H[q]))return!0}if(xh(A,H,j))return!0}return!1}(S,g,M)}isTileClipped(){return!0}}function W_(l,i){return i>0?i+2*l:l}const Pw=rs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cw=rs([{name:"a_projected_pos",components:3,type:"Float32"}],4);rs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kw=rs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);rs([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const X_=rs([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Iw=rs([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Dw(l,i,o){return l.sections.forEach(u=>{u.text=function(g,x,b){const S=x.layout.get("text-transform").evaluate(b,{});return S==="uppercase"?g=g.toLocaleUpperCase():S==="lowercase"&&(g=g.toLocaleLowerCase()),qn.applyArabicShaping&&(g=qn.applyArabicShaping(g)),g}(u.text,i,o)}),l}rs([{name:"triangle",components:3,type:"Uint16"}]),rs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),rs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),rs([{type:"Float32",name:"offsetX"}]),rs([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),rs([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ah={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var K_,im,Y_,ms=24,sm={};function Aw(){return K_||(K_=1,sm.read=function(l,i,o,u,g){var x,b,S=8*g-u-1,M=(1<<S)-1,I=M>>1,A=-7,z=o?g-1:0,j=o?-1:1,U=l[i+z];for(z+=j,x=U&(1<<-A)-1,U>>=-A,A+=S;A>0;x=256*x+l[i+z],z+=j,A-=8);for(b=x&(1<<-A)-1,x>>=-A,A+=u;A>0;b=256*b+l[i+z],z+=j,A-=8);if(x===0)x=1-I;else{if(x===M)return b?NaN:1/0*(U?-1:1);b+=Math.pow(2,u),x-=I}return(U?-1:1)*b*Math.pow(2,x-u)},sm.write=function(l,i,o,u,g,x){var b,S,M,I=8*x-g-1,A=(1<<I)-1,z=A>>1,j=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=u?0:x-1,H=u?1:-1,q=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(S=isNaN(i)?1:0,b=A):(b=Math.floor(Math.log(i)/Math.LN2),i*(M=Math.pow(2,-b))<1&&(b--,M*=2),(i+=b+z>=1?j/M:j*Math.pow(2,1-z))*M>=2&&(b++,M/=2),b+z>=A?(S=0,b=A):b+z>=1?(S=(i*M-1)*Math.pow(2,g),b+=z):(S=i*Math.pow(2,z-1)*Math.pow(2,g),b=0));g>=8;l[o+U]=255&S,U+=H,S/=256,g-=8);for(b=b<<g|S,I+=g;I>0;l[o+U]=255&b,U+=H,b/=256,I-=8);l[o+U-H]|=128*q}),sm}function J_(){if(Y_)return im;Y_=1,im=i;var l=Aw();function i($){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView($)?$:new Uint8Array($||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,u=1/o,g=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function x($){return $.type===i.Bytes?$.readVarint()+$.pos:$.pos+1}function b($,tt,pt){return pt?4294967296*tt+($>>>0):4294967296*(tt>>>0)+($>>>0)}function S($,tt,pt){var Rt=tt<=16383?1:tt<=2097151?2:tt<=268435455?3:Math.floor(Math.log(tt)/(7*Math.LN2));pt.realloc(Rt);for(var Qt=pt.pos-1;Qt>=$;Qt--)pt.buf[Qt+Rt]=pt.buf[Qt]}function M($,tt){for(var pt=0;pt<$.length;pt++)tt.writeVarint($[pt])}function I($,tt){for(var pt=0;pt<$.length;pt++)tt.writeSVarint($[pt])}function A($,tt){for(var pt=0;pt<$.length;pt++)tt.writeFloat($[pt])}function z($,tt){for(var pt=0;pt<$.length;pt++)tt.writeDouble($[pt])}function j($,tt){for(var pt=0;pt<$.length;pt++)tt.writeBoolean($[pt])}function U($,tt){for(var pt=0;pt<$.length;pt++)tt.writeFixed32($[pt])}function H($,tt){for(var pt=0;pt<$.length;pt++)tt.writeSFixed32($[pt])}function q($,tt){for(var pt=0;pt<$.length;pt++)tt.writeFixed64($[pt])}function it($,tt){for(var pt=0;pt<$.length;pt++)tt.writeSFixed64($[pt])}function ct($,tt){return($[tt]|$[tt+1]<<8|$[tt+2]<<16)+16777216*$[tt+3]}function St($,tt,pt){$[pt]=tt,$[pt+1]=tt>>>8,$[pt+2]=tt>>>16,$[pt+3]=tt>>>24}function ft($,tt){return($[tt]|$[tt+1]<<8|$[tt+2]<<16)+($[tt+3]<<24)}return i.prototype={destroy:function(){this.buf=null},readFields:function($,tt,pt){for(pt=pt||this.length;this.pos<pt;){var Rt=this.readVarint(),Qt=Rt>>3,Nt=this.pos;this.type=7&Rt,$(Qt,tt,this),this.pos===Nt&&this.skip(Rt)}return tt},readMessage:function($,tt){return this.readFields($,tt,this.readVarint()+this.pos)},readFixed32:function(){var $=ct(this.buf,this.pos);return this.pos+=4,$},readSFixed32:function(){var $=ft(this.buf,this.pos);return this.pos+=4,$},readFixed64:function(){var $=ct(this.buf,this.pos)+ct(this.buf,this.pos+4)*o;return this.pos+=8,$},readSFixed64:function(){var $=ct(this.buf,this.pos)+ft(this.buf,this.pos+4)*o;return this.pos+=8,$},readFloat:function(){var $=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,$},readDouble:function(){var $=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,$},readVarint:function($){var tt,pt,Rt=this.buf;return tt=127&(pt=Rt[this.pos++]),pt<128?tt:(tt|=(127&(pt=Rt[this.pos++]))<<7,pt<128?tt:(tt|=(127&(pt=Rt[this.pos++]))<<14,pt<128?tt:(tt|=(127&(pt=Rt[this.pos++]))<<21,pt<128?tt:function(Qt,Nt,Ht){var ne,ee,oe=Ht.buf;if(ne=(112&(ee=oe[Ht.pos++]))>>4,ee<128||(ne|=(127&(ee=oe[Ht.pos++]))<<3,ee<128)||(ne|=(127&(ee=oe[Ht.pos++]))<<10,ee<128)||(ne|=(127&(ee=oe[Ht.pos++]))<<17,ee<128)||(ne|=(127&(ee=oe[Ht.pos++]))<<24,ee<128)||(ne|=(1&(ee=oe[Ht.pos++]))<<31,ee<128))return b(Qt,ne,Nt);throw new Error("Expected varint not more than 10 bytes")}(tt|=(15&(pt=Rt[this.pos]))<<28,$,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var $=this.readVarint();return $%2==1?($+1)/-2:$/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var $=this.readVarint()+this.pos,tt=this.pos;return this.pos=$,$-tt>=12&&g?function(pt,Rt,Qt){return g.decode(pt.subarray(Rt,Qt))}(this.buf,tt,$):function(pt,Rt,Qt){for(var Nt="",Ht=Rt;Ht<Qt;){var ne,ee,oe,Wt=pt[Ht],we=null,Ae=Wt>239?4:Wt>223?3:Wt>191?2:1;if(Ht+Ae>Qt)break;Ae===1?Wt<128&&(we=Wt):Ae===2?(192&(ne=pt[Ht+1]))==128&&(we=(31&Wt)<<6|63&ne)<=127&&(we=null):Ae===3?(ee=pt[Ht+2],(192&(ne=pt[Ht+1]))==128&&(192&ee)==128&&((we=(15&Wt)<<12|(63&ne)<<6|63&ee)<=2047||we>=55296&&we<=57343)&&(we=null)):Ae===4&&(ee=pt[Ht+2],oe=pt[Ht+3],(192&(ne=pt[Ht+1]))==128&&(192&ee)==128&&(192&oe)==128&&((we=(15&Wt)<<18|(63&ne)<<12|(63&ee)<<6|63&oe)<=65535||we>=1114112)&&(we=null)),we===null?(we=65533,Ae=1):we>65535&&(we-=65536,Nt+=String.fromCharCode(we>>>10&1023|55296),we=56320|1023&we),Nt+=String.fromCharCode(we),Ht+=Ae}return Nt}(this.buf,tt,$)},readBytes:function(){var $=this.readVarint()+this.pos,tt=this.buf.subarray(this.pos,$);return this.pos=$,tt},readPackedVarint:function($,tt){if(this.type!==i.Bytes)return $.push(this.readVarint(tt));var pt=x(this);for($=$||[];this.pos<pt;)$.push(this.readVarint(tt));return $},readPackedSVarint:function($){if(this.type!==i.Bytes)return $.push(this.readSVarint());var tt=x(this);for($=$||[];this.pos<tt;)$.push(this.readSVarint());return $},readPackedBoolean:function($){if(this.type!==i.Bytes)return $.push(this.readBoolean());var tt=x(this);for($=$||[];this.pos<tt;)$.push(this.readBoolean());return $},readPackedFloat:function($){if(this.type!==i.Bytes)return $.push(this.readFloat());var tt=x(this);for($=$||[];this.pos<tt;)$.push(this.readFloat());return $},readPackedDouble:function($){if(this.type!==i.Bytes)return $.push(this.readDouble());var tt=x(this);for($=$||[];this.pos<tt;)$.push(this.readDouble());return $},readPackedFixed32:function($){if(this.type!==i.Bytes)return $.push(this.readFixed32());var tt=x(this);for($=$||[];this.pos<tt;)$.push(this.readFixed32());return $},readPackedSFixed32:function($){if(this.type!==i.Bytes)return $.push(this.readSFixed32());var tt=x(this);for($=$||[];this.pos<tt;)$.push(this.readSFixed32());return $},readPackedFixed64:function($){if(this.type!==i.Bytes)return $.push(this.readFixed64());var tt=x(this);for($=$||[];this.pos<tt;)$.push(this.readFixed64());return $},readPackedSFixed64:function($){if(this.type!==i.Bytes)return $.push(this.readSFixed64());var tt=x(this);for($=$||[];this.pos<tt;)$.push(this.readSFixed64());return $},skip:function($){var tt=7&$;if(tt===i.Varint)for(;this.buf[this.pos++]>127;);else if(tt===i.Bytes)this.pos=this.readVarint()+this.pos;else if(tt===i.Fixed32)this.pos+=4;else{if(tt!==i.Fixed64)throw new Error("Unimplemented type: "+tt);this.pos+=8}},writeTag:function($,tt){this.writeVarint($<<3|tt)},realloc:function($){for(var tt=this.length||16;tt<this.pos+$;)tt*=2;if(tt!==this.length){var pt=new Uint8Array(tt);pt.set(this.buf),this.buf=pt,this.length=tt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function($){this.realloc(4),St(this.buf,$,this.pos),this.pos+=4},writeSFixed32:function($){this.realloc(4),St(this.buf,$,this.pos),this.pos+=4},writeFixed64:function($){this.realloc(8),St(this.buf,-1&$,this.pos),St(this.buf,Math.floor($*u),this.pos+4),this.pos+=8},writeSFixed64:function($){this.realloc(8),St(this.buf,-1&$,this.pos),St(this.buf,Math.floor($*u),this.pos+4),this.pos+=8},writeVarint:function($){($=+$||0)>268435455||$<0?function(tt,pt){var Rt,Qt;if(tt>=0?(Rt=tt%4294967296|0,Qt=tt/4294967296|0):(Qt=~(-tt/4294967296),4294967295^(Rt=~(-tt%4294967296))?Rt=Rt+1|0:(Rt=0,Qt=Qt+1|0)),tt>=18446744073709552e3||tt<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");pt.realloc(10),function(Nt,Ht,ne){ne.buf[ne.pos++]=127&Nt|128,Nt>>>=7,ne.buf[ne.pos++]=127&Nt|128,Nt>>>=7,ne.buf[ne.pos++]=127&Nt|128,Nt>>>=7,ne.buf[ne.pos++]=127&Nt|128,ne.buf[ne.pos]=127&(Nt>>>=7)}(Rt,0,pt),function(Nt,Ht){var ne=(7&Nt)<<4;Ht.buf[Ht.pos++]|=ne|((Nt>>>=3)?128:0),Nt&&(Ht.buf[Ht.pos++]=127&Nt|((Nt>>>=7)?128:0),Nt&&(Ht.buf[Ht.pos++]=127&Nt|((Nt>>>=7)?128:0),Nt&&(Ht.buf[Ht.pos++]=127&Nt|((Nt>>>=7)?128:0),Nt&&(Ht.buf[Ht.pos++]=127&Nt|((Nt>>>=7)?128:0),Nt&&(Ht.buf[Ht.pos++]=127&Nt)))))}(Qt,pt)}($,this):(this.realloc(4),this.buf[this.pos++]=127&$|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=$>>>7&127))))},writeSVarint:function($){this.writeVarint($<0?2*-$-1:2*$)},writeBoolean:function($){this.writeVarint(!!$)},writeString:function($){$=String($),this.realloc(4*$.length),this.pos++;var tt=this.pos;this.pos=function(Rt,Qt,Nt){for(var Ht,ne,ee=0;ee<Qt.length;ee++){if((Ht=Qt.charCodeAt(ee))>55295&&Ht<57344){if(!ne){Ht>56319||ee+1===Qt.length?(Rt[Nt++]=239,Rt[Nt++]=191,Rt[Nt++]=189):ne=Ht;continue}if(Ht<56320){Rt[Nt++]=239,Rt[Nt++]=191,Rt[Nt++]=189,ne=Ht;continue}Ht=ne-55296<<10|Ht-56320|65536,ne=null}else ne&&(Rt[Nt++]=239,Rt[Nt++]=191,Rt[Nt++]=189,ne=null);Ht<128?Rt[Nt++]=Ht:(Ht<2048?Rt[Nt++]=Ht>>6|192:(Ht<65536?Rt[Nt++]=Ht>>12|224:(Rt[Nt++]=Ht>>18|240,Rt[Nt++]=Ht>>12&63|128),Rt[Nt++]=Ht>>6&63|128),Rt[Nt++]=63&Ht|128)}return Nt}(this.buf,$,this.pos);var pt=this.pos-tt;pt>=128&&S(tt,pt,this),this.pos=tt-1,this.writeVarint(pt),this.pos+=pt},writeFloat:function($){this.realloc(4),l.write(this.buf,$,this.pos,!0,23,4),this.pos+=4},writeDouble:function($){this.realloc(8),l.write(this.buf,$,this.pos,!0,52,8),this.pos+=8},writeBytes:function($){var tt=$.length;this.writeVarint(tt),this.realloc(tt);for(var pt=0;pt<tt;pt++)this.buf[this.pos++]=$[pt]},writeRawMessage:function($,tt){this.pos++;var pt=this.pos;$(tt,this);var Rt=this.pos-pt;Rt>=128&&S(pt,Rt,this),this.pos=pt-1,this.writeVarint(Rt),this.pos+=Rt},writeMessage:function($,tt,pt){this.writeTag($,i.Bytes),this.writeRawMessage(tt,pt)},writePackedVarint:function($,tt){tt.length&&this.writeMessage($,M,tt)},writePackedSVarint:function($,tt){tt.length&&this.writeMessage($,I,tt)},writePackedBoolean:function($,tt){tt.length&&this.writeMessage($,j,tt)},writePackedFloat:function($,tt){tt.length&&this.writeMessage($,A,tt)},writePackedDouble:function($,tt){tt.length&&this.writeMessage($,z,tt)},writePackedFixed32:function($,tt){tt.length&&this.writeMessage($,U,tt)},writePackedSFixed32:function($,tt){tt.length&&this.writeMessage($,H,tt)},writePackedFixed64:function($,tt){tt.length&&this.writeMessage($,q,tt)},writePackedSFixed64:function($,tt){tt.length&&this.writeMessage($,it,tt)},writeBytesField:function($,tt){this.writeTag($,i.Bytes),this.writeBytes(tt)},writeFixed32Field:function($,tt){this.writeTag($,i.Fixed32),this.writeFixed32(tt)},writeSFixed32Field:function($,tt){this.writeTag($,i.Fixed32),this.writeSFixed32(tt)},writeFixed64Field:function($,tt){this.writeTag($,i.Fixed64),this.writeFixed64(tt)},writeSFixed64Field:function($,tt){this.writeTag($,i.Fixed64),this.writeSFixed64(tt)},writeVarintField:function($,tt){this.writeTag($,i.Varint),this.writeVarint(tt)},writeSVarintField:function($,tt){this.writeTag($,i.Varint),this.writeSVarint(tt)},writeStringField:function($,tt){this.writeTag($,i.Bytes),this.writeString(tt)},writeFloatField:function($,tt){this.writeTag($,i.Fixed32),this.writeFloat(tt)},writeDoubleField:function($,tt){this.writeTag($,i.Fixed64),this.writeDouble(tt)},writeBooleanField:function($,tt){this.writeVarintField($,!!tt)}},im}var nm=w(J_());const rm=3;function Ew(l,i,o){l===1&&o.readMessage(zw,i)}function zw(l,i,o){if(l===3){const{id:u,bitmap:g,width:x,height:b,left:S,top:M,advance:I}=o.readMessage(Rw,{});i.push({id:u,bitmap:new vh({width:x+2*rm,height:b+2*rm},g),metrics:{width:x,height:b,left:S,top:M,advance:I}})}}function Rw(l,i,o){l===1?i.id=o.readVarint():l===2?i.bitmap=o.readBytes():l===3?i.width=o.readVarint():l===4?i.height=o.readVarint():l===5?i.left=o.readSVarint():l===6?i.top=o.readSVarint():l===7&&(i.advance=o.readVarint())}const Lw=rm;function Q_(l){let i=0,o=0;for(const b of l)i+=b.w*b.h,o=Math.max(o,b.w);l.sort((b,S)=>S.h-b.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),o),h:1/0}];let g=0,x=0;for(const b of l)for(let S=u.length-1;S>=0;S--){const M=u[S];if(!(b.w>M.w||b.h>M.h)){if(b.x=M.x,b.y=M.y,x=Math.max(x,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===M.w&&b.h===M.h){const I=u.pop();S<u.length&&(u[S]=I)}else b.h===M.h?(M.x+=b.w,M.w-=b.w):b.w===M.w?(M.y+=b.h,M.h-=b.h):(u.push({x:M.x+b.w,y:M.y,w:M.w-b.w,h:b.h}),M.y+=b.h,M.h-=b.h);break}}return{w:g,h:x,fill:i/(g*x)||0}}const on=1;class om{constructor(i,{pixelRatio:o,version:u,stretchX:g,stretchY:x,content:b,textFitWidth:S,textFitHeight:M}){this.paddedRect=i,this.pixelRatio=o,this.stretchX=g,this.stretchY=x,this.content=b,this.version=u,this.textFitWidth=S,this.textFitHeight=M}get tl(){return[this.paddedRect.x+on,this.paddedRect.y+on]}get br(){return[this.paddedRect.x+this.paddedRect.w-on,this.paddedRect.y+this.paddedRect.h-on]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*on)/this.pixelRatio,(this.paddedRect.h-2*on)/this.pixelRatio]}}class ty{constructor(i,o){const u={},g={};this.haveRenderCallbacks=[];const x=[];this.addImages(i,u,x),this.addImages(o,g,x);const{w:b,h:S}=Q_(x),M=new Sn({width:b||1,height:S||1});for(const I in i){const A=i[I],z=u[I].paddedRect;Sn.copy(A.data,M,{x:0,y:0},{x:z.x+on,y:z.y+on},A.data)}for(const I in o){const A=o[I],z=g[I].paddedRect,j=z.x+on,U=z.y+on,H=A.data.width,q=A.data.height;Sn.copy(A.data,M,{x:0,y:0},{x:j,y:U},A.data),Sn.copy(A.data,M,{x:0,y:q-1},{x:j,y:U-1},{width:H,height:1}),Sn.copy(A.data,M,{x:0,y:0},{x:j,y:U+q},{width:H,height:1}),Sn.copy(A.data,M,{x:H-1,y:0},{x:j-1,y:U},{width:1,height:q}),Sn.copy(A.data,M,{x:0,y:0},{x:j+H,y:U},{width:1,height:q})}this.image=M,this.iconPositions=u,this.patternPositions=g}addImages(i,o,u){for(const g in i){const x=i[g],b={x:0,y:0,w:x.data.width+2*on,h:x.data.height+2*on};u.push(b),o[g]=new om(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,o){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in i.updatedImages)this.patchUpdatedImage(this.iconPositions[u],i.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],i.getImage(u),o)}patchUpdatedImage(i,o,u){if(!i||!o||i.version===o.version)return;i.version=o.version;const[g,x]=i.tl;u.update(o.data,void 0,{x:g,y:x})}}var Eo;ge("ImagePosition",om),ge("ImageAtlas",ty),f.ai=void 0,(Eo=f.ai||(f.ai={}))[Eo.none=0]="none",Eo[Eo.horizontal=1]="horizontal",Eo[Eo.vertical=2]="vertical",Eo[Eo.horizontalOnly=3]="horizontalOnly";const Hd=-17;class Eh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(i,o,u){const g=new Eh;return g.scale=i||1,g.fontStack=o,g.verticalAlign=u||"bottom",g}static forImage(i,o){const u=new Eh;return u.imageName=i,u.verticalAlign=o||"bottom",u}}class $l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,o){const u=new $l;for(let g=0;g<i.sections.length;g++){const x=i.sections[g];x.image?u.addImageSection(x):u.addTextSection(x,o)}return u}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let o="";for(let u=0;u<i.length;u++){const g=i.charCodeAt(u+1)||null,x=i.charCodeAt(u-1)||null;o+=g&&Cd(g)&&!Ah[i[u+1]]||x&&Cd(x)&&!Ah[i[u-1]]||!Ah[i[u]]?i[u]:Ah[i[u]]}return o}(this.text)}trim(){let i=0;for(let u=0;u<this.text.length&&Gd[this.text.charCodeAt(u)];u++)i++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=i&&Gd[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(i,o),this.sectionIndex=this.sectionIndex.slice(i,o)}substring(i,o){const u=new $l;return u.text=this.text.substring(i,o),u.sectionIndex=this.sectionIndex.slice(i,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,o)=>Math.max(i,this.sections[o].scale),0)}getMaxImageSize(i){let o=0,u=0;for(let g=0;g<this.length();g++){const x=this.getSection(g);if(x.imageName){const b=i[x.imageName];if(!b)continue;const S=b.displaySize;o=Math.max(o,S[0]),u=Math.max(u,S[1])}}return{maxImageWidth:o,maxImageHeight:u}}addTextSection(i,o){this.text+=i.text,this.sections.push(Eh.forText(i.scale,i.fontStack||o,i.verticalAlign));const u=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(u)}addImageSection(i){const o=i.image?i.image.name:"";if(o.length===0)return void X("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Eh.forImage(o,i.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):X("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zd(l,i,o,u,g,x,b,S,M,I,A,z,j,U,H){const q=$l.fromFeature(l,g);let it;z===f.ai.vertical&&q.verticalizePunctuation();const{processBidirectionalText:ct,processStyledBidirectionalText:St}=qn;if(ct&&q.sections.length===1){it=[];const tt=ct(q.toString(),am(q,I,x,i,u,U));for(const pt of tt){const Rt=new $l;Rt.text=pt,Rt.sections=q.sections;for(let Qt=0;Qt<pt.length;Qt++)Rt.sectionIndex.push(0);it.push(Rt)}}else if(St){it=[];const tt=St(q.text,q.sectionIndex,am(q,I,x,i,u,U));for(const pt of tt){const Rt=new $l;Rt.text=pt[0],Rt.sectionIndex=pt[1],Rt.sections=q.sections,it.push(Rt)}}else it=function(tt,pt){const Rt=[],Qt=tt.text;let Nt=0;for(const Ht of pt)Rt.push(tt.substring(Nt,Ht)),Nt=Ht;return Nt<Qt.length&&Rt.push(tt.substring(Nt,Qt.length)),Rt}(q,am(q,I,x,i,u,U));const ft=[],$={positionedLines:ft,text:q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(tt,pt,Rt,Qt,Nt,Ht,ne,ee,oe,Wt,we,Ae){let Ie=0,Pe=0,ei=0,Xi=0;const gs=ee==="right"?1:ee==="left"?0:.5,Rs=ms/Ae;let Mn=0;for(const Hi of Nt){Hi.trim();const xs=Hi.getMaxScale(),Ps={positionedGlyphs:[],lineOffset:0};tt.positionedLines[Mn]=Ps;const Cs=Ps.positionedGlyphs;let $s=0;if(!Hi.length()){Pe+=Ht,++Mn;continue}const Pn=jw(Qt,Hi,Rs);for(let ln=0;ln<Hi.length();ln++){const _s=Hi.getSection(ln),vs=Hi.getSectionIndex(ln),ws=Hi.getCharCode(ln),hs=Nw(oe,we,ws);let Ei;if(_s.imageName){if(tt.iconsInText=!0,_s.scale=_s.scale*Rs,Ei=$w(_s,hs,xs,Pn,Qt),!Ei)continue;$s=Math.max($s,Ei.imageOffset)}else if(Ei=Vw(_s,ws,hs,Pn,pt,Rt),!Ei)continue;const{rect:Yn,metrics:Gl,baselineOffset:Jn}=Ei;Cs.push({glyph:ws,imageName:_s.imageName,x:Ie,y:Pe+Jn+Hd,vertical:hs,scale:_s.scale,fontStack:_s.fontStack,sectionIndex:vs,metrics:Gl,rect:Yn}),hs?(tt.verticalizable=!0,Ie+=(_s.imageName?Gl.advance:ms)*_s.scale+Wt):Ie+=Gl.advance*_s.scale+Wt}Cs.length!==0&&(ei=Math.max(Ie-Wt,ei),Uw(Cs,0,Cs.length-1,gs)),Ie=0,Ps.lineOffset=Math.max($s,(xs-1)*ms);const bs=Ht*xs+$s;Pe+=bs,Xi=Math.max(bs,Xi),++Mn}const{horizontalAlign:an,verticalAlign:Ms}=lm(ne);(function(Hi,xs,Ps,Cs,$s,Pn,bs,ln,_s){const vs=(xs-Ps)*$s;let ws=0;ws=Pn!==bs?-ln*Cs-Hd:-Cs*_s*bs+.5*bs;for(const hs of Hi)for(const Ei of hs.positionedGlyphs)Ei.x+=vs,Ei.y+=ws})(tt.positionedLines,gs,an,Ms,ei,Xi,Ht,Pe,Nt.length),tt.top+=-Ms*Pe,tt.bottom=tt.top+Pe,tt.left+=-an*ei,tt.right=tt.left+ei}($,i,o,u,it,b,S,M,z,I,j,H),!function(tt){for(const pt of tt)if(pt.positionedGlyphs.length!==0)return!1;return!0}(ft)&&$}const Gd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Fw={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ow={40:!0};function ey(l,i,o,u,g,x){if(i.imageName){const b=u[i.imageName];return b?b.displaySize[0]*i.scale*ms/x+g:0}{const b=o[i.fontStack],S=b&&b[l];return S?S.metrics.advance*i.scale+g:0}}function iy(l,i,o,u){const g=Math.pow(l-i,2);return u?l<i?g/2:2*g:g+Math.abs(o)*o}function Bw(l,i,o){let u=0;return l===10&&(u-=1e4),o&&(u+=150),l!==40&&l!==65288||(u+=50),i!==41&&i!==65289||(u+=50),u}function sy(l,i,o,u,g,x){let b=null,S=iy(i,o,g,x);for(const M of u){const I=iy(i-M.x,o,g,x)+M.badness;I<=S&&(b=M,S=I)}return{index:l,x:i,priorBreak:b,badness:S}}function ny(l){return l?ny(l.priorBreak).concat(l.index):[]}function am(l,i,o,u,g,x){if(!l)return[];const b=[],S=function(z,j,U,H,q,it){let ct=0;for(let St=0;St<z.length();St++){const ft=z.getSection(St);ct+=ey(z.getCharCode(St),ft,H,q,j,it)}return ct/Math.max(1,Math.ceil(ct/U))}(l,i,o,u,g,x),M=l.text.indexOf("​")>=0;let I=0;for(let z=0;z<l.length();z++){const j=l.getSection(z),U=l.getCharCode(z);if(Gd[U]||(I+=ey(U,j,u,g,i,x)),z<l.length()-1){const H=!((A=U)<11904)&&(!!Qe["CJK Compatibility Forms"](A)||!!Qe["CJK Compatibility"](A)||!!Qe["CJK Strokes"](A)||!!Qe["CJK Symbols and Punctuation"](A)||!!Qe["Enclosed CJK Letters and Months"](A)||!!Qe["Halfwidth and Fullwidth Forms"](A)||!!Qe["Ideographic Description Characters"](A)||!!Qe["Vertical Forms"](A)||kl.test(String.fromCodePoint(A)));(Fw[U]||H||j.imageName||z!==l.length()-2&&Ow[l.getCharCode(z+1)])&&b.push(sy(z+1,I,S,b,Bw(U,l.getCharCode(z+1),H&&M),!1))}}var A;return ny(sy(l.length(),I,S,b,0,!0))}function lm(l){let i=.5,o=.5;switch(l){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:i,verticalAlign:o}}function jw(l,i,o){const u=i.getMaxScale()*ms,{maxImageWidth:g,maxImageHeight:x}=i.getMaxImageSize(l),b=Math.max(u,x*o);return{verticalLineContentWidth:Math.max(u,g*o),horizontalLineContentHeight:b}}function ry(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function Nw(l,i,o){return!(l===f.ai.horizontal||!i&&!Il(o)||i&&(Gd[o]||(u=o,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(u)))));var u}function Vw(l,i,o,u,g,x){const b=x[l.fontStack],S=function(I,A,z,j){if(I&&I.rect)return I;const U=A[z.fontStack],H=U&&U[j];return H?{rect:null,metrics:H.metrics}:null}(b&&b[i],g,l,i);if(S===null)return null;let M;if(o)M=u.verticalLineContentWidth-l.scale*ms;else{const I=ry(l.verticalAlign);M=(u.horizontalLineContentHeight-l.scale*ms)*I}return{rect:S.rect,metrics:S.metrics,baselineOffset:M}}function $w(l,i,o,u,g){const x=g[l.imageName];if(!x)return null;const b=x.paddedRect,S=x.displaySize,M={width:S[0],height:S[1],left:on,top:-3,advance:i?S[1]:S[0]};let I;if(i)I=u.verticalLineContentWidth-S[1]*l.scale;else{const A=ry(l.verticalAlign);I=(u.horizontalLineContentHeight-S[1]*l.scale)*A}return{rect:b,metrics:M,baselineOffset:I,imageOffset:(i?S[0]:S[1])*l.scale-ms*o}}function Uw(l,i,o,u){if(u===0)return;const g=l[o],x=(l[o].x+g.metrics.advance*g.scale)*u;for(let b=i;b<=o;b++)l[b].x-=x}function Hw(l,i,o){const{horizontalAlign:u,verticalAlign:g}=lm(o),x=i[0]-l.displaySize[0]*u,b=i[1]-l.displaySize[1]*g;return{image:l,top:b,bottom:b+l.displaySize[1],left:x,right:x+l.displaySize[0]}}function oy(l){var i,o;let u=l.left,g=l.top,x=l.right-u,b=l.bottom-g;const S=(i=l.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",M=(o=l.image.textFitHeight)!==null&&o!==void 0?o:"stretchOrShrink",I=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(M==="proportional"){if(S==="stretchOnly"&&x/b<I||S==="proportional"){const A=Math.ceil(b*I);u*=A/x,x=A}}else if(S==="proportional"&&M==="stretchOnly"&&I!==0&&x/b>I){const A=Math.ceil(x/I);g*=A/b,b=A}return{x1:u,y1:g,x2:u+x,y2:g+b}}function ay(l,i,o,u,g,x){const b=l.image;let S;if(b.content){const it=b.content,ct=b.pixelRatio||1;S=[it[0]/ct,it[1]/ct,b.displaySize[0]-it[2]/ct,b.displaySize[1]-it[3]/ct]}const M=i.left*x,I=i.right*x;let A,z,j,U;o==="width"||o==="both"?(U=g[0]+M-u[3],z=g[0]+I+u[1]):(U=g[0]+(M+I-b.displaySize[0])/2,z=U+b.displaySize[0]);const H=i.top*x,q=i.bottom*x;return o==="height"||o==="both"?(A=g[1]+H-u[0],j=g[1]+q+u[2]):(A=g[1]+(H+q-b.displaySize[1])/2,j=A+b.displaySize[1]),{image:b,top:A,right:z,bottom:j,left:U,collisionPadding:S}}const zh=255,mr=128,zo=zh*mr;function ly(l,i){const{expression:o}=i;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Oi(l+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:g}=o;let x=0;for(;x<u.length&&u[x]<=l;)x++;x=Math.max(0,x-1);let b=x;for(;b<u.length&&u[b]<l+1;)b++;b=Math.min(u.length-1,b);const S=u[x],M=u[b];return o.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:M,interpolationType:g}:{kind:"camera",minZoom:S,maxZoom:M,minSize:o.evaluate(new Oi(S)),maxSize:o.evaluate(new Oi(M)),interpolationType:g}}}function cm(l,i,o){let u="never";const g=l.get(i);return g?u=g:l.get(o)&&(u="always"),u}const Zw=kh.VectorTileFeature.types,Gw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qd(l,i,o,u,g,x,b,S,M,I,A,z,j){const U=S?Math.min(zo,Math.round(S[0])):0,H=S?Math.min(zo,Math.round(S[1])):0;l.emplaceBack(i,o,Math.round(32*u),Math.round(32*g),x,b,(U<<1)+(M?1:0),H,16*I,16*A,256*z,256*j)}function hm(l,i,o){l.emplaceBack(i.x,i.y,o),l.emplaceBack(i.x,i.y,o),l.emplaceBack(i.x,i.y,o),l.emplaceBack(i.x,i.y,o)}function qw(l){for(const i of l.sections)if(Ad(i.text))return!0;return!1}class um{constructor(i){this.layoutVertexArray=new vt,this.indexArray=new Ut,this.programConfigurations=i,this.segments=new pe,this.dynamicLayoutVertexArray=new zt,this.opacityVertexArray=new Ot,this.hasVisibleVertices=!1,this.placedSymbolArray=new T}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,o,u,g){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Pw.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Cw.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Gw,!0),this.opacityVertexBuffer.itemSize=1),(u||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ge("SymbolBuffers",um);class dm{constructor(i,o,u){this.layoutVertexArray=new i,this.layoutAttributes=o,this.indexArray=new u,this.segments=new pe,this.collisionVertexArray=new Kt}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,kw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ge("CollisionBuffers",dm);class Ul{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(b=>b.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ly(this.zoom,o["text-size"]),this.iconSizeData=ly(this.zoom,o["icon-size"]);const u=this.layers[0].layout,g=u.get("symbol-sort-key"),x=u.get("symbol-z-order");this.canOverlap=cm(u,"text-overlap","text-allow-overlap")!=="never"||cm(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(b=>f.ai[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=i.sourceID}createArrays(){this.text=new um(new Ui(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new um(new Ui(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new L,this.lineVertexArray=new B,this.symbolInstances=new D,this.textAnchorOffsets=new Z}calculateGlyphDependencies(i,o,u,g,x){for(let b=0;b<i.length;b++)if(o[i.charCodeAt(b)]=!0,(u||g)&&x){const S=Ah[i.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}}populate(i,o,u){const g=this.layers[0],x=g.layout,b=x.get("text-font"),S=x.get("text-field"),M=x.get("icon-image"),I=(S.value.kind!=="constant"||S.value.value instanceof ts&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),A=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,z=x.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const j=o.iconDependencies,U=o.glyphDependencies,H=o.availableImages,q=new Oi(this.zoom);for(const{feature:it,id:ct,index:St,sourceLayerIndex:ft}of i){const $=g._featureFilter.needGeometry,tt=Ur(it,$);if(!g._featureFilter.filter(q,tt,u))continue;let pt,Rt;if($||(tt.geometry=$r(it)),I){const Nt=g.getValueAndResolveTokens("text-field",tt,u,H),Ht=ts.factory(Nt),ne=this.hasRTLText=this.hasRTLText||qw(Ht);(!ne||qn.getRTLTextPluginStatus()==="unavailable"||ne&&qn.isParsed())&&(pt=Dw(Ht,g,tt))}if(A){const Nt=g.getValueAndResolveTokens("icon-image",tt,u,H);Rt=Nt instanceof As?Nt:As.fromString(Nt)}if(!pt&&!Rt)continue;const Qt=this.sortFeaturesByKey?z.evaluate(tt,{},u):void 0;if(this.features.push({id:ct,text:pt,icon:Rt,index:St,sourceLayerIndex:ft,geometry:tt.geometry,properties:it.properties,type:Zw[it.type],sortKey:Qt}),Rt&&(j[Rt.name]=!0),pt){const Nt=b.evaluate(tt,{},u).join(","),Ht=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ai.vertical)>=0;for(const ne of pt.sections)if(ne.image)j[ne.image.name]=!0;else{const ee=Co(pt.toString()),oe=ne.fontStack||Nt,Wt=U[oe]=U[oe]||{};this.calculateGlyphDependencies(ne.text,Wt,Ht,this.allowVerticalPlacement,ee)}}}x.get("symbol-placement")==="line"&&(this.features=function(it){const ct={},St={},ft=[];let $=0;function tt(Nt){ft.push(it[Nt]),$++}function pt(Nt,Ht,ne){const ee=St[Nt];return delete St[Nt],St[Ht]=ee,ft[ee].geometry[0].pop(),ft[ee].geometry[0]=ft[ee].geometry[0].concat(ne[0]),ee}function Rt(Nt,Ht,ne){const ee=ct[Ht];return delete ct[Ht],ct[Nt]=ee,ft[ee].geometry[0].shift(),ft[ee].geometry[0]=ne[0].concat(ft[ee].geometry[0]),ee}function Qt(Nt,Ht,ne){const ee=ne?Ht[0][Ht[0].length-1]:Ht[0][0];return`${Nt}:${ee.x}:${ee.y}`}for(let Nt=0;Nt<it.length;Nt++){const Ht=it[Nt],ne=Ht.geometry,ee=Ht.text?Ht.text.toString():null;if(!ee){tt(Nt);continue}const oe=Qt(ee,ne),Wt=Qt(ee,ne,!0);if(oe in St&&Wt in ct&&St[oe]!==ct[Wt]){const we=Rt(oe,Wt,ne),Ae=pt(oe,Wt,ft[we].geometry);delete ct[oe],delete St[Wt],St[Qt(ee,ft[Ae].geometry,!0)]=Ae,ft[we].geometry=null}else oe in St?pt(oe,Wt,ne):Wt in ct?Rt(oe,Wt,ne):(tt(Nt),ct[oe]=$-1,St[Wt]=$-1)}return ft.filter(Nt=>Nt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((it,ct)=>it.sortKey-ct.sortKey)}update(i,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(i,o,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,o){const u=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(o[i.segment+1]),x=i.dist(o[i.segment]);const b={};for(let S=i.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:g},S<o.length-1&&(g+=o[S+1].dist(o[S]));for(let S=i.segment||0;S>=0;S--)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:x},S>0&&(x+=o[S-1].dist(o[S]));for(let S=0;S<o.length;S++){const M=b[S];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(i,o,u,g,x,b,S,M,I,A,z,j){const U=i.indexArray,H=i.layoutVertexArray,q=i.segments.prepareSegment(4*o.length,H,U,this.canOverlap?b.sortKey:void 0),it=this.glyphOffsetArray.length,ct=q.vertexLength,St=this.allowVerticalPlacement&&S===f.ai.vertical?Math.PI/2:0,ft=b.text&&b.text.sections;for(let $=0;$<o.length;$++){const{tl:tt,tr:pt,bl:Rt,br:Qt,tex:Nt,pixelOffsetTL:Ht,pixelOffsetBR:ne,minFontScaleX:ee,minFontScaleY:oe,glyphOffset:Wt,isSDF:we,sectionIndex:Ae}=o[$],Ie=q.vertexLength,Pe=Wt[1];qd(H,M.x,M.y,tt.x,Pe+tt.y,Nt.x,Nt.y,u,we,Ht.x,Ht.y,ee,oe),qd(H,M.x,M.y,pt.x,Pe+pt.y,Nt.x+Nt.w,Nt.y,u,we,ne.x,Ht.y,ee,oe),qd(H,M.x,M.y,Rt.x,Pe+Rt.y,Nt.x,Nt.y+Nt.h,u,we,Ht.x,ne.y,ee,oe),qd(H,M.x,M.y,Qt.x,Pe+Qt.y,Nt.x+Nt.w,Nt.y+Nt.h,u,we,ne.x,ne.y,ee,oe),hm(i.dynamicLayoutVertexArray,M,St),U.emplaceBack(Ie,Ie+2,Ie+1),U.emplaceBack(Ie+1,Ie+2,Ie+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wt[0]),$!==o.length-1&&Ae===o[$+1].sectionIndex||i.programConfigurations.populatePaintArrays(H.length,b,b.index,{},j,ft&&ft[Ae])}i.placedSymbolArray.emplaceBack(M.x,M.y,it,this.glyphOffsetArray.length-it,ct,I,A,M.segment,u?u[0]:0,u?u[1]:0,g[0],g[1],S,0,!1,0,z)}_addCollisionDebugVertex(i,o,u,g,x,b){return o.emplaceBack(0,0),i.emplaceBack(u.x,u.y,g,x,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(i,o,u,g,x,b,S){const M=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),I=M.vertexLength,A=x.layoutVertexArray,z=x.collisionVertexArray,j=S.anchorX,U=S.anchorY;this._addCollisionDebugVertex(A,z,b,j,U,new J(i,o)),this._addCollisionDebugVertex(A,z,b,j,U,new J(u,o)),this._addCollisionDebugVertex(A,z,b,j,U,new J(u,g)),this._addCollisionDebugVertex(A,z,b,j,U,new J(i,g)),M.vertexLength+=4;const H=x.indexArray;H.emplaceBack(I,I+1),H.emplaceBack(I+1,I+2),H.emplaceBack(I+2,I+3),H.emplaceBack(I+3,I),M.primitiveLength+=4}addDebugCollisionBoxes(i,o,u,g){for(let x=i;x<o;x++){const b=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dm(qt,X_.members,ce),this.iconCollisionBox=new dm(qt,X_.members,ce);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(i,o,u,g,x,b,S,M,I){const A={};for(let z=o;z<u;z++){const j=i.get(z);A.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},A.textFeatureIndex=j.featureIndex;break}for(let z=g;z<x;z++){const j=i.get(z);A.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},A.verticalTextFeatureIndex=j.featureIndex;break}for(let z=b;z<S;z++){const j=i.get(z);A.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},A.iconFeatureIndex=j.featureIndex;break}for(let z=M;z<I;z++){const j=i.get(z);A.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},A.verticalIconFeatureIndex=j.featureIndex;break}return A}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,o){const u=i.placedSymbolArray.get(o),g=u.vertexStartIndex+4*u.numGlyphs;for(let x=u.vertexStartIndex;x<g;x+=4)i.indexArray.emplaceBack(x,x+2,x+1),i.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(i),u=Math.cos(i),g=[],x=[],b=[];for(let S=0;S<this.symbolInstances.length;++S){b.push(S);const M=this.symbolInstances.get(S);g.push(0|Math.round(o*M.anchorX+u*M.anchorY)),x.push(M.featureIndex)}return b.sort((S,M)=>g[S]-g[M]||x[M]-x[S]),b}addToSortKeyRanges(i,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((g,x,b)=>{g>=0&&b.indexOf(g)===x&&this.addIndicesForPlacedSymbol(this.text,g)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let cy,hy;ge("SymbolBucket",Ul,{omit:["layers","collisionBoxArray","features","compareText"]}),Ul.MAX_GLYPHS=65535,Ul.addDynamicAttributes=hm;var fm={get paint(){return hy=hy||new Ns({"icon-opacity":new Re(st.paint_symbol["icon-opacity"]),"icon-color":new Re(st.paint_symbol["icon-color"]),"icon-halo-color":new Re(st.paint_symbol["icon-halo-color"]),"icon-halo-width":new Re(st.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Re(st.paint_symbol["icon-halo-blur"]),"icon-translate":new ke(st.paint_symbol["icon-translate"]),"icon-translate-anchor":new ke(st.paint_symbol["icon-translate-anchor"]),"text-opacity":new Re(st.paint_symbol["text-opacity"]),"text-color":new Re(st.paint_symbol["text-color"],{runtimeType:We,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Re(st.paint_symbol["text-halo-color"]),"text-halo-width":new Re(st.paint_symbol["text-halo-width"]),"text-halo-blur":new Re(st.paint_symbol["text-halo-blur"]),"text-translate":new ke(st.paint_symbol["text-translate"]),"text-translate-anchor":new ke(st.paint_symbol["text-translate-anchor"])})},get layout(){return cy=cy||new Ns({"symbol-placement":new ke(st.layout_symbol["symbol-placement"]),"symbol-spacing":new ke(st.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ke(st.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Re(st.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ke(st.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ke(st.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ke(st.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ke(st.layout_symbol["icon-ignore-placement"]),"icon-optional":new ke(st.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ke(st.layout_symbol["icon-rotation-alignment"]),"icon-size":new Re(st.layout_symbol["icon-size"]),"icon-text-fit":new ke(st.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ke(st.layout_symbol["icon-text-fit-padding"]),"icon-image":new Re(st.layout_symbol["icon-image"]),"icon-rotate":new Re(st.layout_symbol["icon-rotate"]),"icon-padding":new Re(st.layout_symbol["icon-padding"]),"icon-keep-upright":new ke(st.layout_symbol["icon-keep-upright"]),"icon-offset":new Re(st.layout_symbol["icon-offset"]),"icon-anchor":new Re(st.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ke(st.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ke(st.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ke(st.layout_symbol["text-rotation-alignment"]),"text-field":new Re(st.layout_symbol["text-field"]),"text-font":new Re(st.layout_symbol["text-font"]),"text-size":new Re(st.layout_symbol["text-size"]),"text-max-width":new Re(st.layout_symbol["text-max-width"]),"text-line-height":new ke(st.layout_symbol["text-line-height"]),"text-letter-spacing":new Re(st.layout_symbol["text-letter-spacing"]),"text-justify":new Re(st.layout_symbol["text-justify"]),"text-radial-offset":new Re(st.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ke(st.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Re(st.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Re(st.layout_symbol["text-anchor"]),"text-max-angle":new ke(st.layout_symbol["text-max-angle"]),"text-writing-mode":new ke(st.layout_symbol["text-writing-mode"]),"text-rotate":new Re(st.layout_symbol["text-rotate"]),"text-padding":new ke(st.layout_symbol["text-padding"]),"text-keep-upright":new ke(st.layout_symbol["text-keep-upright"]),"text-transform":new Re(st.layout_symbol["text-transform"]),"text-offset":new Re(st.layout_symbol["text-offset"]),"text-allow-overlap":new ke(st.layout_symbol["text-allow-overlap"]),"text-overlap":new ke(st.layout_symbol["text-overlap"]),"text-ignore-placement":new ke(st.layout_symbol["text-ignore-placement"]),"text-optional":new ke(st.layout_symbol["text-optional"])})}};class uy{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Be,this.defaultValue=i}evaluate(i){if(i.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(i.formattedSection))return o.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ge("FormatSectionOverride",uy,{omit:["defaultValue"]});class Wd extends On{constructor(i){super(i,fm)}recalculate(i,o){if(super.recalculate(i,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const g=[];for(const x of u)g.indexOf(x)<0&&g.push(x);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,o,u,g){const x=this.layout.get(i).evaluate(o,{},u,g),b=this._unevaluatedLayout._values[i];return b.isDataDriven()||gl(b.value)||!x?x:function(S,M){return M.replace(/{([^{}]+)}/g,(I,A)=>S&&A in S?String(S[A]):"")}(o.properties,x)}createBucket(i){return new Ul(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of fm.paint.overridableProperties){if(!Wd.hasPaintOverride(this.layout,i))continue;const o=this.paint.get(i),u=new uy(o),g=new ml(u,o.property.specification);let x=null;x=o.value.kind==="constant"||o.value.kind==="source"?new bo("source",g):new yl("composite",g,o.value.zoomStops),this.paint._values[i]=new Fn(o.property,x,o.parameters)}}_handleOverridablePaintPropertyUpdate(i,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&Wd.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,o){const u=i.get("text-field"),g=fm.paint.properties[o];let x=!1;const b=S=>{for(const M of S)if(g.overrides&&g.overrides.hasOverride(M))return void(x=!0)};if(u.value.kind==="constant"&&u.value.value instanceof ts)b(u.value.value.sections);else if(u.value.kind==="source"){const S=I=>{x||(I instanceof Ln&&Di(I.value)===lr?b(I.value.sections):I instanceof la?b(I.sections):I.eachChild(S))},M=u.value;M._styleExpression&&S(M._styleExpression.expression)}return x}}let dy;var Ww={get paint(){return dy=dy||new Ns({"background-color":new ke(st.paint_background["background-color"]),"background-pattern":new zl(st.paint_background["background-pattern"]),"background-opacity":new ke(st.paint_background["background-opacity"])})}};class Xw extends On{constructor(i){super(i,Ww)}}let fy;var Kw={get paint(){return fy=fy||new Ns({"raster-opacity":new ke(st.paint_raster["raster-opacity"]),"raster-hue-rotate":new ke(st.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ke(st.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ke(st.paint_raster["raster-brightness-max"]),"raster-saturation":new ke(st.paint_raster["raster-saturation"]),"raster-contrast":new ke(st.paint_raster["raster-contrast"]),"raster-resampling":new ke(st.paint_raster["raster-resampling"]),"raster-fade-duration":new ke(st.paint_raster["raster-fade-duration"])})}};class Yw extends On{constructor(i){super(i,Kw)}}class Jw extends On{constructor(i){super(i,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Qw{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const pm=63710088e-1;class Ro{constructor(i,o){if(isNaN(i)||isNaN(o))throw new Error(`Invalid LngLat object: (${i}, ${o})`);if(this.lng=+i,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ro(Ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const o=Math.PI/180,u=this.lat*o,g=i.lat*o,x=Math.sin(u)*Math.sin(g)+Math.cos(u)*Math.cos(g)*Math.cos((i.lng-this.lng)*o);return pm*Math.acos(Math.min(x,1))}static convert(i){if(i instanceof Ro)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Ro(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Ro(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const py=2*Math.PI*pm;function my(l){return py*Math.cos(l*Math.PI/180)}function gy(l){return(180+l)/360}function _y(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function yy(l,i){return l/my(i)}function mm(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function xy(l,i){return l*my(mm(i))}class Rh{constructor(i,o,u=0){this.x=+i,this.y=+o,this.z=+u}static fromLngLat(i,o=0){const u=Ro.convert(i);return new Rh(gy(u.lng),_y(u.lat),yy(o,u.lat))}toLngLat(){return new Ro(360*this.x-180,mm(this.y))}toAltitude(){return xy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/py*(i=mm(this.y),1/Math.cos(i*Math.PI/180));var i}}function by(l,i,o){var u=2*Math.PI*6378137/256/Math.pow(2,o);return[l*u-2*Math.PI*6378137/2,i*u-2*Math.PI*6378137/2]}class gm{constructor(i,o,u){if(!function(g,x,b){return!(g<0||g>25||b<0||b>=Math.pow(2,g)||x<0||x>=Math.pow(2,g))}(i,o,u))throw new Error(`x=${o}, y=${u}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=o,this.y=u,this.key=Hl(0,i,i,o,u)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,o,u){const g=(b=this.y,S=this.z,M=by(256*(x=this.x),256*(b=Math.pow(2,S)-b-1),S),I=by(256*(x+1),256*(b+1),S),M[0]+","+M[1]+","+I[0]+","+I[1]);var x,b,S,M,I;const A=function(z,j,U){let H,q="";for(let it=z;it>0;it--)H=1<<it-1,q+=(j&H?1:0)+(U&H?2:0);return q}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const o=this.z-i.z;return o>0&&i.x===this.x>>o&&i.y===this.y>>o}getTilePoint(i){const o=Math.pow(2,this.z);return new J((i.x*o-this.x)*xe,(i.y*o-this.y)*xe)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vy{constructor(i,o){this.wrap=i,this.canonical=o,this.key=Hl(i,o.z,o.z,o.x,o.y)}}class Tn{constructor(i,o,u,g,x){if(this.terrainRttPosMatrix32f=null,i<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${u}`);this.overscaledZ=i,this.wrap=o,this.canonical=new gm(u,+g,+x),this.key=Hl(o,i,u,g,x)}clone(){return new Tn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-i;return i>this.canonical.z?new Tn(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Tn(i,this.wrap,i,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(i,o){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-i;return i>this.canonical.z?Hl(this.wrap*+o,i,this.canonical.z,this.canonical.x,this.canonical.y):Hl(this.wrap*+o,i,i,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const o=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>o&&i.canonical.y===this.canonical.y>>o}children(i){if(this.overscaledZ>=i)return[new Tn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,g=2*this.canonical.y;return[new Tn(o,this.wrap,o,u,g),new Tn(o,this.wrap,o,u+1,g),new Tn(o,this.wrap,o,u,g+1),new Tn(o,this.wrap,o,u+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Tn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Tn(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Rh(i.x-this.wrap,i.y))}}function Hl(l,i,o,u,g){(l*=2)<0&&(l=-1*l-1);const x=1<<o;return(x*x*l+x*g+u).toString(36)+o.toString(36)+i.toString(36)}ge("CanonicalTileID",gm),ge("OverscaledTileID",Tn,{omit:["terrainRttPosMatrix32f"]});class wy{constructor(i,o,u,g=1,x=1,b=1,S=0){if(this.uid=i,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void X(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const M=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=x,this.blueFactor=b,this.baseShift=S;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<M;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(M,I)]=this.data[this._idx(M-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,M)]=this.data[this._idx(I,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<M;I++)for(let A=0;A<M;A++){const z=this.get(I,A);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(i,o){const u=new Uint8Array(this.data.buffer),g=4*this._idx(i,o);return this.unpack(u[g],u[g+1],u[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,o){if(i<-1||i>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(i+1)}unpack(i,o,u){return i*this.redFactor+o*this.greenFactor+u*this.blueFactor-this.baseShift}getPixels(){return new Sn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,o,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=o*this.dim,x=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:g=x-1;break;case 1:x=g+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}const M=-o*this.dim,I=-u*this.dim;for(let A=b;A<S;A++)for(let z=g;z<x;z++)this.data[this._idx(z,A)]=i.data[this._idx(z+M,A+I)]}}ge("DEMData",wy);class Sy{constructor(i){this._stringToNumber={},this._numberToString=[];for(let o=0;o<i.length;o++){const u=i[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class Ty{constructor(i,o,u,g,x){this.type="Feature",this._vectorTileFeature=i,i._z=o,i._x=u,i._y=g,this.properties=i.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(i[o]=this[o]);return i}}class My{constructor(i,o){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new jr(xe,16,0),this.grid3D=new jr(xe,16,0),this.featureIndexArray=new at,this.promoteId=o}insert(i,o,u,g,x,b){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,g,x);const M=b?this.grid3D:this.grid;for(let I=0;I<o.length;I++){const A=o[I],z=[1/0,1/0,-1/0,-1/0];for(let j=0;j<A.length;j++){const U=A[j];z[0]=Math.min(z[0],U.x),z[1]=Math.min(z[1],U.y),z[2]=Math.max(z[2],U.x),z[3]=Math.max(z[3],U.y)}z[0]<xe&&z[1]<xe&&z[2]>=0&&z[3]>=0&&M.insert(S,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new kh.VectorTile(new nm(this.rawTileData)).layers,this.sourceLayerCoder=new Sy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,o,u,g){this.loadVTLayers();const x=i.params,b=xe/i.tileSize/i.scale,S=vl(x.filter),M=i.queryGeometry,I=i.queryPadding*b,A=Cy(M),z=this.grid.query(A.minX-I,A.minY-I,A.maxX+I,A.maxY+I),j=Cy(i.cameraQueryGeometry),U=this.grid3D.query(j.minX-I,j.minY-I,j.maxX+I,j.maxY+I,(it,ct,St,ft)=>function($,tt,pt,Rt,Qt){for(const Ht of $)if(tt<=Ht.x&&pt<=Ht.y&&Rt>=Ht.x&&Qt>=Ht.y)return!0;const Nt=[new J(tt,pt),new J(tt,Qt),new J(Rt,Qt),new J(Rt,pt)];if($.length>2){for(const Ht of Nt)if(Bl($,Ht))return!0}for(let Ht=0;Ht<$.length-1;Ht++)if($1($[Ht],$[Ht+1],Nt))return!0;return!1}(i.cameraQueryGeometry,it-I,ct-I,St+I,ft+I));for(const it of U)z.push(it);z.sort(t2);const H={};let q;for(let it=0;it<z.length;it++){const ct=z[it];if(ct===q)continue;q=ct;const St=this.featureIndexArray.get(ct);let ft=null;this.loadMatchingFeature(H,St.bucketIndex,St.sourceLayerIndex,St.featureIndex,S,x.layers,x.availableImages,o,u,g,($,tt,pt)=>(ft||(ft=$r($)),tt.queryIntersectsFeature({queryGeometry:M,feature:$,featureState:pt,geometry:ft,zoom:this.z,transform:i.transform,pixelsToTileUnits:b,pixelPosMatrix:i.pixelPosMatrix})))}return H}loadMatchingFeature(i,o,u,g,x,b,S,M,I,A,z){const j=this.bucketLayerIDs[o];if(b&&!j.some(it=>b.has(it)))return;const U=this.sourceLayerCoder.decode(u),H=this.vtLayers[U].feature(g);if(x.needGeometry){const it=Ur(H,!0);if(!x.filter(new Oi(this.tileID.overscaledZ),it,this.tileID.canonical))return}else if(!x.filter(new Oi(this.tileID.overscaledZ),H))return;const q=this.getId(H,U);for(let it=0;it<j.length;it++){const ct=j[it];if(b&&!b.has(ct))continue;const St=M[ct];if(!St)continue;let ft={};q&&A&&(ft=A.getState(St.sourceLayer||"_geojsonTileLayer",q));const $=ai({},I[ct]);$.paint=Py($.paint,St.paint,H,ft,S),$.layout=Py($.layout,St.layout,H,ft,S);const tt=!z||z(H,St,ft);if(!tt)continue;const pt=new Ty(H,this.z,this.x,this.y,q);pt.layer=$;let Rt=i[ct];Rt===void 0&&(Rt=i[ct]=[]),Rt.push({featureIndex:g,feature:pt,intersectionZ:tt})}}lookupSymbolFeatures(i,o,u,g,x,b,S,M){const I={};this.loadVTLayers();const A=vl(x);for(const z of i)this.loadMatchingFeature(I,u,g,z,A,b,S,M,o);return I}hasLayer(i){for(const o of this.bucketLayerIDs)for(const u of o)if(i===u)return!0;return!1}getId(i,o){var u;let g=i.id;return this.promoteId&&(g=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof g=="boolean"&&(g=Number(g)),g===void 0&&(!((u=i.properties)===null||u===void 0)&&u.cluster)&&this.promoteId&&(g=Number(i.properties.cluster_id))),g}}function Py(l,i,o,u,g){return Jt(l,(x,b)=>{const S=i instanceof ko?i.get(b):null;return S&&S.evaluate?S.evaluate(o,u,g):S})}function Cy(l){let i=1/0,o=1/0,u=-1/0,g=-1/0;for(const x of l)i=Math.min(i,x.x),o=Math.min(o,x.y),u=Math.max(u,x.x),g=Math.max(g,x.y);return{minX:i,minY:o,maxX:u,maxY:g}}function t2(l,i){return i-l}function ky(l,i,o,u,g){const x=[];for(let b=0;b<l.length;b++){const S=l[b];let M;for(let I=0;I<S.length-1;I++){let A=S[I],z=S[I+1];A.x<i&&z.x<i||(A.x<i?A=new J(i,A.y+(i-A.x)/(z.x-A.x)*(z.y-A.y))._round():z.x<i&&(z=new J(i,A.y+(i-A.x)/(z.x-A.x)*(z.y-A.y))._round()),A.y<o&&z.y<o||(A.y<o?A=new J(A.x+(o-A.y)/(z.y-A.y)*(z.x-A.x),o)._round():z.y<o&&(z=new J(A.x+(o-A.y)/(z.y-A.y)*(z.x-A.x),o)._round()),A.x>=u&&z.x>=u||(A.x>=u?A=new J(u,A.y+(u-A.x)/(z.x-A.x)*(z.y-A.y))._round():z.x>=u&&(z=new J(u,A.y+(u-A.x)/(z.x-A.x)*(z.y-A.y))._round()),A.y>=g&&z.y>=g||(A.y>=g?A=new J(A.x+(g-A.y)/(z.y-A.y)*(z.x-A.x),g)._round():z.y>=g&&(z=new J(A.x+(g-A.y)/(z.y-A.y)*(z.x-A.x),g)._round()),M&&A.equals(M[M.length-1])||(M=[A],x.push(M)),M.push(z)))))}}return x}ge("FeatureIndex",My,{omit:["rawTileData","sourceLayerCoder"]});class Lo extends J{constructor(i,o,u,g){super(i,o),this.angle=u,g!==void 0&&(this.segment=g)}clone(){return new Lo(this.x,this.y,this.angle,this.segment)}}function Iy(l,i,o,u,g){if(i.segment===void 0||o===0)return!0;let x=i,b=i.segment+1,S=0;for(;S>-o/2;){if(b--,b<0)return!1;S-=l[b].dist(x),x=l[b]}S+=l[b].dist(l[b+1]),b++;const M=[];let I=0;for(;S<o/2;){const A=l[b],z=l[b+1];if(!z)return!1;let j=l[b-1].angleTo(A)-A.angleTo(z);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:S,angleDelta:j}),I+=j;S-M[0].distance>u;)I-=M.shift().angleDelta;if(I>g)return!1;b++,S+=A.dist(z)}return!0}function Dy(l){let i=0;for(let o=0;o<l.length-1;o++)i+=l[o].dist(l[o+1]);return i}function Ay(l,i,o){return l?.6*i*o:0}function Ey(l,i){return Math.max(l?l.right-l.left:0,i?i.right-i.left:0)}function e2(l,i,o,u,g,x){const b=Ay(o,g,x),S=Ey(o,u)*x;let M=0;const I=Dy(l)/2;for(let A=0;A<l.length-1;A++){const z=l[A],j=l[A+1],U=z.dist(j);if(M+U>I){const H=(I-M)/U,q=vn.number(z.x,j.x,H),it=vn.number(z.y,j.y,H),ct=new Lo(q,it,j.angleTo(z),A);return ct._round(),!b||Iy(l,ct,S,b,i)?ct:void 0}M+=U}}function i2(l,i,o,u,g,x,b,S,M){const I=Ay(u,x,b),A=Ey(u,g),z=A*b,j=l[0].x===0||l[0].x===M||l[0].y===0||l[0].y===M;return i-z<i/4&&(i=z+i/4),zy(l,j?i/2*S%i:(A/2+2*x)*b*S%i,i,I,o,z,j,!1,M)}function zy(l,i,o,u,g,x,b,S,M){const I=x/2,A=Dy(l);let z=0,j=i-o,U=[];for(let H=0;H<l.length-1;H++){const q=l[H],it=l[H+1],ct=q.dist(it),St=it.angleTo(q);for(;j+o<z+ct;){j+=o;const ft=(j-z)/ct,$=vn.number(q.x,it.x,ft),tt=vn.number(q.y,it.y,ft);if($>=0&&$<M&&tt>=0&&tt<M&&j-I>=0&&j+I<=A){const pt=new Lo($,tt,St,H);pt._round(),u&&!Iy(l,pt,x,u,g)||U.push(pt)}}z+=ct}return S||U.length||b||(U=zy(l,z/2,o,u,g,x,b,!0,M)),U}ge("Anchor",Lo);const Lh=on;function Ry(l,i,o,u){const g=[],x=l.image,b=x.pixelRatio,S=x.paddedRect.w-2*Lh,M=x.paddedRect.h-2*Lh;let I={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom};const A=x.stretchX||[[0,S]],z=x.stretchY||[[0,M]],j=(Wt,we)=>Wt+we[1]-we[0],U=A.reduce(j,0),H=z.reduce(j,0),q=S-U,it=M-H;let ct=0,St=U,ft=0,$=H,tt=0,pt=q,Rt=0,Qt=it;if(x.content&&u){const Wt=x.content,we=Wt[2]-Wt[0],Ae=Wt[3]-Wt[1];(x.textFitWidth||x.textFitHeight)&&(I=oy(l)),ct=Xd(A,0,Wt[0]),ft=Xd(z,0,Wt[1]),St=Xd(A,Wt[0],Wt[2]),$=Xd(z,Wt[1],Wt[3]),tt=Wt[0]-ct,Rt=Wt[1]-ft,pt=we-St,Qt=Ae-$}const Nt=I.x1,Ht=I.y1,ne=I.x2-Nt,ee=I.y2-Ht,oe=(Wt,we,Ae,Ie)=>{const Pe=Kd(Wt.stretch-ct,St,ne,Nt),ei=Yd(Wt.fixed-tt,pt,Wt.stretch,U),Xi=Kd(we.stretch-ft,$,ee,Ht),gs=Yd(we.fixed-Rt,Qt,we.stretch,H),Rs=Kd(Ae.stretch-ct,St,ne,Nt),Mn=Yd(Ae.fixed-tt,pt,Ae.stretch,U),an=Kd(Ie.stretch-ft,$,ee,Ht),Ms=Yd(Ie.fixed-Rt,Qt,Ie.stretch,H),Hi=new J(Pe,Xi),xs=new J(Rs,Xi),Ps=new J(Rs,an),Cs=new J(Pe,an),$s=new J(ei/b,gs/b),Pn=new J(Mn/b,Ms/b),bs=i*Math.PI/180;if(bs){const vs=Math.sin(bs),ws=Math.cos(bs),hs=[ws,-vs,vs,ws];Hi._matMult(hs),xs._matMult(hs),Cs._matMult(hs),Ps._matMult(hs)}const ln=Wt.stretch+Wt.fixed,_s=we.stretch+we.fixed;return{tl:Hi,tr:xs,bl:Cs,br:Ps,tex:{x:x.paddedRect.x+Lh+ln,y:x.paddedRect.y+Lh+_s,w:Ae.stretch+Ae.fixed-ln,h:Ie.stretch+Ie.fixed-_s},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$s,pixelOffsetBR:Pn,minFontScaleX:pt/b/ne,minFontScaleY:Qt/b/ee,isSDF:o}};if(u&&(x.stretchX||x.stretchY)){const Wt=Ly(A,q,U),we=Ly(z,it,H);for(let Ae=0;Ae<Wt.length-1;Ae++){const Ie=Wt[Ae],Pe=Wt[Ae+1];for(let ei=0;ei<we.length-1;ei++)g.push(oe(Ie,we[ei],Pe,we[ei+1]))}}else g.push(oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:M+1}));return g}function Xd(l,i,o){let u=0;for(const g of l)u+=Math.max(i,Math.min(o,g[1]))-Math.max(i,Math.min(o,g[0]));return u}function Ly(l,i,o){const u=[{fixed:-1,stretch:0}];for(const[g,x]of l){const b=u[u.length-1];u.push({fixed:g-b.stretch,stretch:b.stretch}),u.push({fixed:g-b.stretch,stretch:b.stretch+(x-g)})}return u.push({fixed:i+Lh,stretch:o}),u}function Kd(l,i,o,u){return l/i*o+u}function Yd(l,i,o,u){return l-i*o/u}class Jd{constructor(i,o,u,g,x,b,S,M,I,A){var z;if(this.boxStartIndex=i.length,I){let j=b.top,U=b.bottom;const H=b.collisionPadding;H&&(j-=H[1],U+=H[3]);let q=U-j;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const j=!((z=b.image)===null||z===void 0)&&z.content&&(b.image.textFitWidth||b.image.textFitHeight)?oy(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};j.y1=j.y1*S-M[0],j.y2=j.y2*S+M[2],j.x1=j.x1*S-M[3],j.x2=j.x2*S+M[1];const U=b.collisionPadding;if(U&&(j.x1-=U[0]*S,j.y1-=U[1]*S,j.x2+=U[2]*S,j.y2+=U[3]*S),A){const H=new J(j.x1,j.y1),q=new J(j.x2,j.y1),it=new J(j.x1,j.y2),ct=new J(j.x2,j.y2),St=A*Math.PI/180;H._rotate(St),q._rotate(St),it._rotate(St),ct._rotate(St),j.x1=Math.min(H.x,q.x,it.x,ct.x),j.x2=Math.max(H.x,q.x,it.x,ct.x),j.y1=Math.min(H.y,q.y,it.y,ct.y),j.y2=Math.max(H.y,q.y,it.y,ct.y)}i.emplaceBack(o.x,o.y,j.x1,j.y1,j.x2,j.y2,u,g,x)}this.boxEndIndex=i.length}}class s2{constructor(i=[],o=(u,g)=>u<g?-1:u>g?1:0){if(this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:o,compare:u}=this,g=o[i];for(;i>0;){const x=i-1>>1,b=o[x];if(u(g,b)>=0)break;o[i]=b,i=x}o[i]=g}_down(i){const{data:o,compare:u}=this,g=this.length>>1,x=o[i];for(;i<g;){let b=1+(i<<1);const S=b+1;if(S<this.length&&u(o[S],o[b])<0&&(b=S),u(o[b],x)>=0)break;o[i]=o[b],i=b}o[i]=x}}function n2(l,i=1,o=!1){let u=1/0,g=1/0,x=-1/0,b=-1/0;const S=l[0];for(let U=0;U<S.length;U++){const H=S[U];(!U||H.x<u)&&(u=H.x),(!U||H.y<g)&&(g=H.y),(!U||H.x>x)&&(x=H.x),(!U||H.y>b)&&(b=H.y)}const M=Math.min(x-u,b-g);let I=M/2;const A=new s2([],r2);if(M===0)return new J(u,g);for(let U=u;U<x;U+=M)for(let H=g;H<b;H+=M)A.push(new Zl(U+I,H+I,I,l));let z=function(U){let H=0,q=0,it=0;const ct=U[0];for(let St=0,ft=ct.length,$=ft-1;St<ft;$=St++){const tt=ct[St],pt=ct[$],Rt=tt.x*pt.y-pt.x*tt.y;q+=(tt.x+pt.x)*Rt,it+=(tt.y+pt.y)*Rt,H+=3*Rt}return new Zl(q/H,it/H,0,U)}(l),j=A.length;for(;A.length;){const U=A.pop();(U.d>z.d||!z.d)&&(z=U,o&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,j)),U.max-z.d<=i||(I=U.h/2,A.push(new Zl(U.p.x-I,U.p.y-I,I,l)),A.push(new Zl(U.p.x+I,U.p.y-I,I,l)),A.push(new Zl(U.p.x-I,U.p.y+I,I,l)),A.push(new Zl(U.p.x+I,U.p.y+I,I,l)),j+=4)}return o&&(console.log(`num probes: ${j}`),console.log(`best distance: ${z.d}`)),z.p}function r2(l,i){return i.max-l.max}function Zl(l,i,o,u){this.p=new J(l,i),this.h=o,this.d=function(g,x){let b=!1,S=1/0;for(let M=0;M<x.length;M++){const I=x[M];for(let A=0,z=I.length,j=z-1;A<z;j=A++){const U=I[A],H=I[j];U.y>g.y!=H.y>g.y&&g.x<(H.x-U.x)*(g.y-U.y)/(H.y-U.y)+U.x&&(b=!b),S=Math.min(S,m_(g,U,H))}}return(b?1:-1)*Math.sqrt(S)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}var zs;f.av=void 0,(zs=f.av||(f.av={}))[zs.center=1]="center",zs[zs.left=2]="left",zs[zs.right=3]="right",zs[zs.top=4]="top",zs[zs.bottom=5]="bottom",zs[zs["top-left"]=6]="top-left",zs[zs["top-right"]=7]="top-right",zs[zs["bottom-left"]=8]="bottom-left",zs[zs["bottom-right"]=9]="bottom-right";const Fo=7,_m=Number.POSITIVE_INFINITY;function Fy(l,i){return i[1]!==_m?function(o,u,g){let x=0,b=0;switch(u=Math.abs(u),g=Math.abs(g),o){case"top-right":case"top-left":case"top":b=g-Fo;break;case"bottom-right":case"bottom-left":case"bottom":b=-g+Fo}switch(o){case"top-right":case"bottom-right":case"right":x=-u;break;case"top-left":case"bottom-left":case"left":x=u}return[x,b]}(l,i[0],i[1]):function(o,u){let g=0,x=0;u<0&&(u=0);const b=u/Math.SQRT2;switch(o){case"top-right":case"top-left":x=b-Fo;break;case"bottom-right":case"bottom-left":x=-b+Fo;break;case"bottom":x=-u+Fo;break;case"top":x=u-Fo}switch(o){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=u;break;case"right":g=-u}return[g,x]}(l,i[0])}function Oy(l,i,o){var u;const g=l.layout,x=(u=g.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(i,{},o);if(x){const S=x.values,M=[];for(let I=0;I<S.length;I+=2){const A=M[I]=S[I],z=S[I+1].map(j=>j*ms);A.startsWith("top")?z[1]-=Fo:A.startsWith("bottom")&&(z[1]+=Fo),M[I+1]=z}return new Ds(M)}const b=g.get("text-variable-anchor");if(b){let S;S=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},o)*ms,_m]:g.get("text-offset").evaluate(i,{},o).map(I=>I*ms);const M=[];for(const I of b)M.push(I,Fy(I,S));return new Ds(M)}return null}function ym(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function o2(l,i,o,u,g,x,b,S,M,I,A,z){let j=x.textMaxSize.evaluate(i,{});j===void 0&&(j=b);const U=l.layers[0].layout,H=U.get("icon-offset").evaluate(i,{},A),q=jy(o.horizontal),it=b/24,ct=l.tilePixelRatio*it,St=l.tilePixelRatio*j/24,ft=l.tilePixelRatio*S,$=l.tilePixelRatio*U.get("symbol-spacing"),tt=U.get("text-padding")*l.tilePixelRatio,pt=function(Ae,Ie,Pe,ei=1){const Xi=Ae.get("icon-padding").evaluate(Ie,{},Pe),gs=Xi&&Xi.values;return[gs[0]*ei,gs[1]*ei,gs[2]*ei,gs[3]*ei]}(U,i,A,l.tilePixelRatio),Rt=U.get("text-max-angle")/180*Math.PI,Qt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",Nt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Ht=U.get("symbol-placement"),ne=$/2,ee=U.get("icon-text-fit");let oe;u&&ee!=="none"&&(l.allowVerticalPlacement&&o.vertical&&(oe=ay(u,o.vertical,ee,U.get("icon-text-fit-padding"),H,it)),q&&(u=ay(u,q,ee,U.get("icon-text-fit-padding"),H,it)));const Wt=A?z.line.getGranularityForZoomLevel(A.z):1,we=(Ae,Ie)=>{Ie.x<0||Ie.x>=xe||Ie.y<0||Ie.y>=xe||function(Pe,ei,Xi,gs,Rs,Mn,an,Ms,Hi,xs,Ps,Cs,$s,Pn,bs,ln,_s,vs,ws,hs,Ei,Yn,Gl,Jn,c2){const ql=Pe.addToLineVertexArray(ei,Xi);let Aa,Wl,Xl,Kl,Uy=0,Hy=0,Zy=0,Gy=0,Pm=-1,Cm=-1;const Hr={};let qy=ls("");if(Pe.allowVerticalPlacement&&gs.vertical){const Bs=Ms.layout.get("text-rotate").evaluate(Ei,{},Jn)+90;Xl=new Jd(Hi,ei,xs,Ps,Cs,gs.vertical,$s,Pn,bs,Bs),an&&(Kl=new Jd(Hi,ei,xs,Ps,Cs,an,_s,vs,bs,Bs))}if(Rs){const Bs=Ms.layout.get("icon-rotate").evaluate(Ei,{}),Cn=Ms.layout.get("icon-text-fit")!=="none",Ea=Ry(Rs,Bs,Gl,Cn),tr=an?Ry(an,Bs,Gl,Cn):void 0;Wl=new Jd(Hi,ei,xs,Ps,Cs,Rs,_s,vs,!1,Bs),Uy=4*Ea.length;const za=Pe.iconSizeData;let gr=null;za.kind==="source"?(gr=[mr*Ms.layout.get("icon-size").evaluate(Ei,{})],gr[0]>zo&&X(`${Pe.layerIds[0]}: Value for "icon-size" is >= ${zh}. Reduce your "icon-size".`)):za.kind==="composite"&&(gr=[mr*Yn.compositeIconSizes[0].evaluate(Ei,{},Jn),mr*Yn.compositeIconSizes[1].evaluate(Ei,{},Jn)],(gr[0]>zo||gr[1]>zo)&&X(`${Pe.layerIds[0]}: Value for "icon-size" is >= ${zh}. Reduce your "icon-size".`)),Pe.addSymbols(Pe.icon,Ea,gr,hs,ws,Ei,f.ai.none,ei,ql.lineStartIndex,ql.lineLength,-1,Jn),Pm=Pe.icon.placedSymbolArray.length-1,tr&&(Hy=4*tr.length,Pe.addSymbols(Pe.icon,tr,gr,hs,ws,Ei,f.ai.vertical,ei,ql.lineStartIndex,ql.lineLength,-1,Jn),Cm=Pe.icon.placedSymbolArray.length-1)}const Wy=Object.keys(gs.horizontal);for(const Bs of Wy){const Cn=gs.horizontal[Bs];if(!Aa){qy=ls(Cn.text);const tr=Ms.layout.get("text-rotate").evaluate(Ei,{},Jn);Aa=new Jd(Hi,ei,xs,Ps,Cs,Cn,$s,Pn,bs,tr)}const Ea=Cn.positionedLines.length===1;if(Zy+=By(Pe,ei,Cn,Mn,Ms,bs,Ei,ln,ql,gs.vertical?f.ai.horizontal:f.ai.horizontalOnly,Ea?Wy:[Bs],Hr,Pm,Yn,Jn),Ea)break}gs.vertical&&(Gy+=By(Pe,ei,gs.vertical,Mn,Ms,bs,Ei,ln,ql,f.ai.vertical,["vertical"],Hr,Cm,Yn,Jn));const h2=Aa?Aa.boxStartIndex:Pe.collisionBoxArray.length,u2=Aa?Aa.boxEndIndex:Pe.collisionBoxArray.length,d2=Xl?Xl.boxStartIndex:Pe.collisionBoxArray.length,f2=Xl?Xl.boxEndIndex:Pe.collisionBoxArray.length,p2=Wl?Wl.boxStartIndex:Pe.collisionBoxArray.length,m2=Wl?Wl.boxEndIndex:Pe.collisionBoxArray.length,g2=Kl?Kl.boxStartIndex:Pe.collisionBoxArray.length,_2=Kl?Kl.boxEndIndex:Pe.collisionBoxArray.length;let Qn=-1;const tf=(Bs,Cn)=>Bs&&Bs.circleDiameter?Math.max(Bs.circleDiameter,Cn):Cn;Qn=tf(Aa,Qn),Qn=tf(Xl,Qn),Qn=tf(Wl,Qn),Qn=tf(Kl,Qn);const Xy=Qn>-1?1:0;Xy&&(Qn*=c2/ms),Pe.glyphOffsetArray.length>=Ul.MAX_GLYPHS&&X("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ei.sortKey!==void 0&&Pe.addToSortKeyRanges(Pe.symbolInstances.length,Ei.sortKey);const y2=Oy(Ms,Ei,Jn),[x2,b2]=function(Bs,Cn){const Ea=Bs.length,tr=Cn==null?void 0:Cn.values;if((tr==null?void 0:tr.length)>0)for(let za=0;za<tr.length;za+=2){const gr=tr[za+1];Bs.emplaceBack(f.av[tr[za]],gr[0],gr[1])}return[Ea,Bs.length]}(Pe.textAnchorOffsets,y2);Pe.symbolInstances.emplaceBack(ei.x,ei.y,Hr.right>=0?Hr.right:-1,Hr.center>=0?Hr.center:-1,Hr.left>=0?Hr.left:-1,Hr.vertical||-1,Pm,Cm,qy,h2,u2,d2,f2,p2,m2,g2,_2,xs,Zy,Gy,Uy,Hy,Xy,0,$s,Qn,x2,b2)}(l,Ie,Ae,o,u,g,oe,l.layers[0],l.collisionBoxArray,i.index,i.sourceLayerIndex,l.index,ct,[tt,tt,tt,tt],Qt,M,ft,pt,Nt,H,i,x,I,A,b)};if(Ht==="line")for(const Ae of ky(i.geometry,0,0,xe,xe)){const Ie=Da(Ae,Wt),Pe=i2(Ie,$,Rt,o.vertical||q,u,24,St,l.overscaling,xe);for(const ei of Pe)q&&a2(l,q.text,ne,ei)||we(Ie,ei)}else if(Ht==="line-center"){for(const Ae of i.geometry)if(Ae.length>1){const Ie=Da(Ae,Wt),Pe=e2(Ie,Rt,o.vertical||q,u,24,St);Pe&&we(Ie,Pe)}}else if(i.type==="Polygon")for(const Ae of ol(i.geometry,0)){const Ie=n2(Ae,16);we(Da(Ae[0],Wt,!0),new Lo(Ie.x,Ie.y,0))}else if(i.type==="LineString")for(const Ae of i.geometry){const Ie=Da(Ae,Wt);we(Ie,new Lo(Ie[0].x,Ie[0].y,0))}else if(i.type==="Point")for(const Ae of i.geometry)for(const Ie of Ae)we([Ie],new Lo(Ie.x,Ie.y,0))}function By(l,i,o,u,g,x,b,S,M,I,A,z,j,U,H){const q=function(St,ft,$,tt,pt,Rt,Qt,Nt){const Ht=tt.layout.get("text-rotate").evaluate(Rt,{})*Math.PI/180,ne=[];for(const ee of ft.positionedLines)for(const oe of ee.positionedGlyphs){if(!oe.rect)continue;const Wt=oe.rect||{};let we=Lw+1,Ae=!0,Ie=1,Pe=0;const ei=(pt||Nt)&&oe.vertical,Xi=oe.metrics.advance*oe.scale/2;if(Nt&&ft.verticalizable&&(Pe=ee.lineOffset/2-(oe.imageName?-(ms-oe.metrics.width*oe.scale)/2:(oe.scale-1)*ms)),oe.imageName){const vs=Qt[oe.imageName];Ae=vs.sdf,Ie=vs.pixelRatio,we=on/Ie}const gs=pt?[oe.x+Xi,oe.y]:[0,0];let Rs=pt?[0,0]:[oe.x+Xi+$[0],oe.y+$[1]-Pe],Mn=[0,0];ei&&(Mn=Rs,Rs=[0,0]);const an=oe.metrics.isDoubleResolution?2:1,Ms=(oe.metrics.left-we)*oe.scale-Xi+Rs[0],Hi=(-oe.metrics.top-we)*oe.scale+Rs[1],xs=Ms+Wt.w/an*oe.scale/Ie,Ps=Hi+Wt.h/an*oe.scale/Ie,Cs=new J(Ms,Hi),$s=new J(xs,Hi),Pn=new J(Ms,Ps),bs=new J(xs,Ps);if(ei){const vs=new J(-Xi,Xi-Hd),ws=-Math.PI/2,hs=ms/2-Xi,Ei=new J(5-Hd-hs,-(oe.imageName?hs:0)),Yn=new J(...Mn);Cs._rotateAround(ws,vs)._add(Ei)._add(Yn),$s._rotateAround(ws,vs)._add(Ei)._add(Yn),Pn._rotateAround(ws,vs)._add(Ei)._add(Yn),bs._rotateAround(ws,vs)._add(Ei)._add(Yn)}if(Ht){const vs=Math.sin(Ht),ws=Math.cos(Ht),hs=[ws,-vs,vs,ws];Cs._matMult(hs),$s._matMult(hs),Pn._matMult(hs),bs._matMult(hs)}const ln=new J(0,0),_s=new J(0,0);ne.push({tl:Cs,tr:$s,bl:Pn,br:bs,tex:Wt,writingMode:ft.writingMode,glyphOffset:gs,sectionIndex:oe.sectionIndex,isSDF:Ae,pixelOffsetTL:ln,pixelOffsetBR:_s,minFontScaleX:0,minFontScaleY:0})}return ne}(0,o,S,g,x,b,u,l.allowVerticalPlacement),it=l.textSizeData;let ct=null;it.kind==="source"?(ct=[mr*g.layout.get("text-size").evaluate(b,{})],ct[0]>zo&&X(`${l.layerIds[0]}: Value for "text-size" is >= ${zh}. Reduce your "text-size".`)):it.kind==="composite"&&(ct=[mr*U.compositeTextSizes[0].evaluate(b,{},H),mr*U.compositeTextSizes[1].evaluate(b,{},H)],(ct[0]>zo||ct[1]>zo)&&X(`${l.layerIds[0]}: Value for "text-size" is >= ${zh}. Reduce your "text-size".`)),l.addSymbols(l.text,q,ct,S,x,b,I,i,M.lineStartIndex,M.lineLength,j,H);for(const St of A)z[St]=l.text.placedSymbolArray.length-1;return 4*q.length}function jy(l){for(const i in l)return l[i];return null}function a2(l,i,o,u){const g=l.compareText;if(i in g){const x=g[i];for(let b=x.length-1;b>=0;b--)if(u.dist(x[b])<o)return!0}else g[i]=[];return g[i].push(u),!1}const Ny=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xm{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(i,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=u>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const x=Ny[15&u];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(i,2,1),[S]=new Uint32Array(i,4,1);return new xm(S,b,x,i)}constructor(i,o=64,u=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const x=Ny.indexOf(this.ArrayType),b=2*i*this.ArrayType.BYTES_PER_ELEMENT,S=i*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-S%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${u}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+M,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+b+S+M),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+M,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=i)}add(i,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=i,this.coords[this._pos++]=o,u}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return bm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,o,u,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:S}=this,M=[0,x.length-1,0],I=[];for(;M.length;){const A=M.pop()||0,z=M.pop()||0,j=M.pop()||0;if(z-j<=S){for(let it=j;it<=z;it++){const ct=b[2*it],St=b[2*it+1];ct>=i&&ct<=u&&St>=o&&St<=g&&I.push(x[it])}continue}const U=j+z>>1,H=b[2*U],q=b[2*U+1];H>=i&&H<=u&&q>=o&&q<=g&&I.push(x[U]),(A===0?i<=H:o<=q)&&(M.push(j),M.push(U-1),M.push(1-A)),(A===0?u>=H:g>=q)&&(M.push(U+1),M.push(z),M.push(1-A))}return I}within(i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:b}=this,S=[0,g.length-1,0],M=[],I=u*u;for(;S.length;){const A=S.pop()||0,z=S.pop()||0,j=S.pop()||0;if(z-j<=b){for(let it=j;it<=z;it++)$y(x[2*it],x[2*it+1],i,o)<=I&&M.push(g[it]);continue}const U=j+z>>1,H=x[2*U],q=x[2*U+1];$y(H,q,i,o)<=I&&M.push(g[U]),(A===0?i-u<=H:o-u<=q)&&(S.push(j),S.push(U-1),S.push(1-A)),(A===0?i+u>=H:o+u>=q)&&(S.push(U+1),S.push(z),S.push(1-A))}return M}}function bm(l,i,o,u,g,x){if(g-u<=o)return;const b=u+g>>1;Vy(l,i,b,u,g,x),bm(l,i,o,u,b-1,1-x),bm(l,i,o,b+1,g,1-x)}function Vy(l,i,o,u,g,x){for(;g>u;){if(g-u>600){const I=g-u+1,A=o-u+1,z=Math.log(I),j=.5*Math.exp(2*z/3),U=.5*Math.sqrt(z*j*(I-j)/I)*(A-I/2<0?-1:1);Vy(l,i,o,Math.max(u,Math.floor(o-A*j/I+U)),Math.min(g,Math.floor(o+(I-A)*j/I+U)),x)}const b=i[2*o+x];let S=u,M=g;for(Fh(l,i,u,o),i[2*g+x]>b&&Fh(l,i,u,g);S<M;){for(Fh(l,i,S,M),S++,M--;i[2*S+x]<b;)S++;for(;i[2*M+x]>b;)M--}i[2*u+x]===b?Fh(l,i,u,M):(M++,Fh(l,i,M,g)),M<=o&&(u=M+1),o<=M&&(g=M-1)}}function Fh(l,i,o,u){vm(l,o,u),vm(i,2*o,2*u),vm(i,2*o+1,2*u+1)}function vm(l,i,o){const u=l[i];l[i]=l[o],l[o]=u}function $y(l,i,o,u){const g=l-o,x=i-u;return g*g+x*x}var wm;f.ce=void 0,(wm=f.ce||(f.ce={})).create="create",wm.load="load",wm.fullLoad="fullLoad";let Qd=null,Oh=[];const Sm=1e3/60,Tm="loadTime",Mm="fullLoadTime",l2={mark(l){performance.mark(l)},frame(l){const i=l;Qd!=null&&Oh.push(i-Qd),Qd=i},clearMetrics(){Qd=null,Oh=[],performance.clearMeasures(Tm),performance.clearMeasures(Mm);for(const l in f.ce)performance.clearMarks(f.ce[l])},getPerformanceMetrics(){performance.measure(Tm,f.ce.create,f.ce.load),performance.measure(Mm,f.ce.create,f.ce.fullLoad);const l=performance.getEntriesByName(Tm)[0].duration,i=performance.getEntriesByName(Mm)[0].duration,o=Oh.length,u=1/(Oh.reduce((x,b)=>x+b,0)/o/1e3),g=Oh.filter(x=>x>Sm).reduce((x,b)=>x+(b-Sm)/Sm,0);return{loadTime:l,fullLoadTime:i,fps:u,percentDroppedFrames:g/(o+g)*100,totalFrames:o}}};f.$=Mt,f.A=Gt,f.B=ya,f.C=function(l){if(K==null){const i=l.navigator?l.navigator.userAgent:null;K=!!l.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return K},f.D=ke,f.E=Qs,f.F=class{constructor(l,i){this.target=l,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Qw(()=>this.process()),this.subscription=function(o,u,g,x){return o.addEventListener(u,g,!1),{unsubscribe:()=>{o.removeEventListener(u,g,!1)}}}(this.target,"message",o=>this.receive(o)),this.globalScope=O(self)?l:window}registerMessageHandler(l,i){this.messageHandlers[l]=i}sendAsync(l,i){return new Promise((o,u)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:o,reject:u},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const S={id:g,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(S)},{once:!0});const x=[],b=Object.assign(Object.assign({},l),{id:g,sourceMapId:this.mapId,origin:location.origin,data:xa(l.data,x)});this.target.postMessage(b,{transfer:x})})}receive(l){const i=l.data,o=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[o];const u=this.abortControllers[o];return delete this.abortControllers[o],void(u&&u.abort())}if(O(self)||i.mustQueue)return this.tasks[o]=i,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,i)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),i=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(l,i)}processTask(l,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[l];return delete this.resolveRejects[l],g?void(i.error?g.reject(dr(i.error)):g.resolve(dr(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const o=dr(i.data),u=new AbortController;this.abortControllers[l]=u;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,o,u);this.completeTask(l,null,g)}catch(g){this.completeTask(l,g)}})}completeTask(l,i,o){const u=[];delete this.abortControllers[l];const g={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?xa(i):null,data:xa(o,u)};this.target.postMessage(g,{transfer:u})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.G=Te,f.H=function(){var l=new Gt(16);return Gt!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},f.I=om,f.J=function(l,i,o){var u,g,x,b,S,M,I,A,z,j,U,H,q=o[0],it=o[1],ct=o[2];return i===l?(l[12]=i[0]*q+i[4]*it+i[8]*ct+i[12],l[13]=i[1]*q+i[5]*it+i[9]*ct+i[13],l[14]=i[2]*q+i[6]*it+i[10]*ct+i[14],l[15]=i[3]*q+i[7]*it+i[11]*ct+i[15]):(g=i[1],x=i[2],b=i[3],S=i[4],M=i[5],I=i[6],A=i[7],z=i[8],j=i[9],U=i[10],H=i[11],l[0]=u=i[0],l[1]=g,l[2]=x,l[3]=b,l[4]=S,l[5]=M,l[6]=I,l[7]=A,l[8]=z,l[9]=j,l[10]=U,l[11]=H,l[12]=u*q+S*it+z*ct+i[12],l[13]=g*q+M*it+j*ct+i[13],l[14]=x*q+I*it+U*ct+i[14],l[15]=b*q+A*it+H*ct+i[15]),l},f.K=function(l,i,o){var u=o[0],g=o[1],x=o[2];return l[0]=i[0]*u,l[1]=i[1]*u,l[2]=i[2]*u,l[3]=i[3]*u,l[4]=i[4]*g,l[5]=i[5]*g,l[6]=i[6]*g,l[7]=i[7]*g,l[8]=i[8]*x,l[9]=i[9]*x,l[10]=i[10]*x,l[11]=i[11]*x,l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l},f.L=function(l,i,o){var u=i[0],g=i[1],x=i[2],b=i[3],S=i[4],M=i[5],I=i[6],A=i[7],z=i[8],j=i[9],U=i[10],H=i[11],q=i[12],it=i[13],ct=i[14],St=i[15],ft=o[0],$=o[1],tt=o[2],pt=o[3];return l[0]=ft*u+$*S+tt*z+pt*q,l[1]=ft*g+$*M+tt*j+pt*it,l[2]=ft*x+$*I+tt*U+pt*ct,l[3]=ft*b+$*A+tt*H+pt*St,l[4]=(ft=o[4])*u+($=o[5])*S+(tt=o[6])*z+(pt=o[7])*q,l[5]=ft*g+$*M+tt*j+pt*it,l[6]=ft*x+$*I+tt*U+pt*ct,l[7]=ft*b+$*A+tt*H+pt*St,l[8]=(ft=o[8])*u+($=o[9])*S+(tt=o[10])*z+(pt=o[11])*q,l[9]=ft*g+$*M+tt*j+pt*it,l[10]=ft*x+$*I+tt*U+pt*ct,l[11]=ft*b+$*A+tt*H+pt*St,l[12]=(ft=o[12])*u+($=o[13])*S+(tt=o[14])*z+(pt=o[15])*q,l[13]=ft*g+$*M+tt*j+pt*it,l[14]=ft*x+$*I+tt*U+pt*ct,l[15]=ft*b+$*A+tt*H+pt*St,l},f.M=function(l,i){const o={};for(let u=0;u<i.length;u++){const g=i[u];g in l&&(o[g]=l[g])}return o},f.N=Ro,f.O=gy,f.P=J,f.Q=_y,f.R=Sn,f.S=Tn,f.T=rh,f.U=Lt,f.V=At,f.W=ht,f.X=xe,f.Y=Rh,f.Z=gm,f._=a,f.a=re,f.a$=function(){return new Float64Array(16)},f.a0=l=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(o=>{i.onloadstart=()=>{o(i)};for(const u of l){const g=window.document.createElement("source");_i(u)||(i.crossOrigin="Anonymous"),g.src=u,i.appendChild(g)}})},f.a1=function(){return ii++},f.a2=y,f.a3=Ul,f.a4=vl,f.a5=Ur,f.a6=Ty,f.a7=function(l){const i={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,g,x)=>{const b=g||x;return i[u]=!b||b.toLowerCase(),""}),i["max-age"]){const o=parseInt(i["max-age"],10);isNaN(o)?delete i["max-age"]:i["max-age"]=o}return i},f.a8=function(l){return Math.log(l)/Math.LN2},f.a9=function(l){var i=l[0],o=l[1];return i*i+o*o},f.aA=rs,f.aB=Vd,f.aC=ot,f.aD=pe,f.aE=Ut,f.aF=85.051129,f.aG=function(l){return Math.pow(2,l)},f.aH=yy,f.aI=Ce,f.aJ=jt,f.aK=xy,f.aL=function(l,i,o){return l[0]=i[0]*o,l[1]=i[1]*o,l[2]=i[2]*o,l},f.aM=function(l,i,o){return l[0]=i[0]+o[0],l[1]=i[1]+o[1],l[2]=i[2]+o[2],l},f.aN=function(l){var i=new Gt(3);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i},f.aO=function(l,i,o){return l[0]=i[0]*o[0],l[1]=i[1]*o[1],l[2]=i[2]*o[2],l[3]=i[3]*o[3],l},f.aP=function(l,i,o){return l[0]=i[0]-o[0],l[1]=i[1]-o[1],l[2]=i[2]-o[2],l},f.aQ=function(l,i){var o=i[0],u=i[1],g=i[2],x=o*o+u*u+g*g;return x>0&&(x=1/Math.sqrt(x)),l[0]=i[0]*x,l[1]=i[1]*x,l[2]=i[2]*x,l},f.aR=function(l,i,o){var u=i[0],g=i[1],x=i[2],b=o[0],S=o[1],M=o[2];return l[0]=g*M-x*S,l[1]=x*b-u*M,l[2]=u*S-g*b,l},f.aS=function(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]},f.aT=vy,f.aU=Hl,f.aV=function(l,i,o,u,g){var x,b=1/Math.tan(i/2);return l[0]=b/o,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=b,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,g!=null&&g!==1/0?(l[10]=(g+u)*(x=1/(u-g)),l[14]=2*g*u*x):(l[10]=-1,l[14]=-2*u),l},f.aW=function(l){var i=new Gt(16);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],i},f.aX=function(l,i,o){var u=Math.sin(o),g=Math.cos(o),x=i[0],b=i[1],S=i[2],M=i[3],I=i[4],A=i[5],z=i[6],j=i[7];return i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=x*g+I*u,l[1]=b*g+A*u,l[2]=S*g+z*u,l[3]=M*g+j*u,l[4]=I*g-x*u,l[5]=A*g-b*u,l[6]=z*g-S*u,l[7]=j*g-M*u,l},f.aY=function(l,i,o){var u=Math.sin(o),g=Math.cos(o),x=i[4],b=i[5],S=i[6],M=i[7],I=i[8],A=i[9],z=i[10],j=i[11];return i!==l&&(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[4]=x*g+I*u,l[5]=b*g+A*u,l[6]=S*g+z*u,l[7]=M*g+j*u,l[8]=I*g-x*u,l[9]=A*g-b*u,l[10]=z*g-S*u,l[11]=j*g-M*u,l},f.aZ=function(){const l=new Float32Array(16);return be(l),l},f.a_=function(){const l=new Float64Array(16);return be(l),l},f.aa=function(l){return l*Math.PI/180},f.ab=Ii,f.ac=function(l,i){const o=[];for(const u in l)u in i||o.push(u);return o},f.ad=He,f.ae=function(l){return Math.hypot(l[0],l[1])},f.af=function(l){return l[0]=0,l[1]=0,l},f.ag=function(l,i,o){return l[0]=i[0]*o,l[1]=i[1]*o,l},f.ah=function(l,i){let o=0,u=0;if(l.kind==="constant")u=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:g,minZoom:x,maxZoom:b}=l,S=g?Ii(wi.interpolationFactor(g,i,x,b),0,1):0;l.kind==="camera"?u=vn.number(l.minSize,l.maxSize,S):o=S}return{uSizeT:o,uSize:u}},f.aj=function(l,{uSize:i,uSizeT:o},{lowerSize:u,upperSize:g}){return l.kind==="source"?u/mr:l.kind==="composite"?vn.number(u/mr,g/mr,o):i},f.ak=hm,f.al=Fe,f.am=function(l,i,o,u){const g=i.y-l.y,x=i.x-l.x,b=u.y-o.y,S=u.x-o.x,M=b*x-S*g;if(M===0)return null;const I=(S*(l.y-o.y)-b*(l.x-o.x))/M;return new J(l.x+I*x,l.y+I*g)},f.an=function(l,i){var o=i[0],u=i[1],g=i[2],x=i[3],b=i[4],S=i[5],M=i[6],I=i[7],A=i[8],z=i[9],j=i[10],U=i[11],H=i[12],q=i[13],it=i[14],ct=i[15],St=o*S-u*b,ft=o*M-g*b,$=o*I-x*b,tt=u*M-g*S,pt=u*I-x*S,Rt=g*I-x*M,Qt=A*q-z*H,Nt=A*it-j*H,Ht=A*ct-U*H,ne=z*it-j*q,ee=z*ct-U*q,oe=j*ct-U*it,Wt=St*oe-ft*ee+$*ne+tt*Ht-pt*Nt+Rt*Qt;return Wt?(l[0]=(S*oe-M*ee+I*ne)*(Wt=1/Wt),l[1]=(g*ee-u*oe-x*ne)*Wt,l[2]=(q*Rt-it*pt+ct*tt)*Wt,l[3]=(j*pt-z*Rt-U*tt)*Wt,l[4]=(M*Ht-b*oe-I*Nt)*Wt,l[5]=(o*oe-g*Ht+x*Nt)*Wt,l[6]=(it*$-H*Rt-ct*ft)*Wt,l[7]=(A*Rt-j*$+U*ft)*Wt,l[8]=(b*ee-S*Ht+I*Qt)*Wt,l[9]=(u*Ht-o*ee-x*Qt)*Wt,l[10]=(H*pt-q*$+ct*St)*Wt,l[11]=(z*$-A*pt-U*St)*Wt,l[12]=(S*Nt-b*ne-M*Qt)*Wt,l[13]=(o*ne-u*Nt+g*Qt)*Wt,l[14]=(q*ft-H*tt-it*St)*Wt,l[15]=(A*tt-z*ft+j*St)*Wt,l):null},f.ao=ky,f.ap=gh,f.aq=be,f.ar=function(l){let i=1/0,o=1/0,u=-1/0,g=-1/0;for(const x of l)i=Math.min(i,x.x),o=Math.min(o,x.y),u=Math.max(u,x.x),g=Math.max(g,x.y);return[i,o,u,g]},f.as=ms,f.at=De,f.au=function(l,i,o,u,g=!1){if(!o[0]&&!o[1])return[0,0];const x=g?u==="map"?-l.bearingInRadians:0:u==="viewport"?l.bearingInRadians:0;if(x){const b=Math.sin(x),S=Math.cos(x);o=[o[0]*S-o[1]*b,o[0]*b+o[1]*S]}return[g?o[0]:De(i,o[0],l.zoom),g?o[1]:De(i,o[1],l.zoom)]},f.aw=cm,f.ax=ym,f.ay=lm,f.az=xm,f.b=nt,f.b$=l=>l.type==="line",f.b0=function(l,i,o){const u=new Float64Array(4);return function(g,x,b,S){var M=.5*Math.PI/180;x*=M,b*=M,S*=M;var I=Math.sin(x),A=Math.cos(x),z=Math.sin(b),j=Math.cos(b),U=Math.sin(S),H=Math.cos(S);g[0]=I*j*H-A*z*U,g[1]=A*z*H+I*j*U,g[2]=A*j*U-I*z*H,g[3]=A*j*H+I*z*U}(u,l,i-90,o),u},f.b1=function(l,i,o,u){var g,x,b,S,M,I=i[0],A=i[1],z=i[2],j=i[3],U=o[0],H=o[1],q=o[2],it=o[3];return(x=I*U+A*H+z*q+j*it)<0&&(x=-x,U=-U,H=-H,q=-q,it=-it),1-x>Yt?(g=Math.acos(x),b=Math.sin(g),S=Math.sin((1-u)*g)/b,M=Math.sin(u*g)/b):(S=1-u,M=u),l[0]=S*I+M*U,l[1]=S*A+M*H,l[2]=S*z+M*q,l[3]=S*j+M*it,l},f.b2=function(l){const i=new Float64Array(9);var o,u,g,x,b,S,M,I,A,z,j,U,H,q,it,ct,St,ft;z=(g=(u=l)[0])*(M=g+g),j=(x=u[1])*M,H=(b=u[2])*M,q=b*(I=x+x),ct=(S=u[3])*M,St=S*I,ft=S*(A=b+b),(o=i)[0]=1-(U=x*I)-(it=b*A),o[3]=j-ft,o[6]=H+St,o[1]=j+ft,o[4]=1-z-it,o[7]=q-ct,o[2]=H-St,o[5]=q+ct,o[8]=1-z-U;const $=jt(-Math.asin(Ii(i[2],-1,1)));let tt,pt;return Math.hypot(i[5],i[8])<.001?(tt=0,pt=-jt(Math.atan2(i[3],i[4]))):(tt=jt(i[5]===0&&i[8]===0?0:Math.atan2(i[5],i[8])),pt=jt(i[1]===0&&i[0]===0?0:Math.atan2(i[1],i[0]))),{roll:tt,pitch:$+90,bearing:pt}},f.b3=function(l,i){return l.roll==i.roll&&l.pitch==i.pitch&&l.bearing==i.bearing},f.b4=Ke,f.b5=Kn,f.b6=Vl,f.b7=Ph,f.b8=Nl,f.b9=qe,f.bA=Jt,f.bB=me,f.bC=class extends sn{constructor(l,i){super(l,i),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},f.bD=class extends sn{constructor(l,i){super(l,i),this.current=Ao}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let i=1;i<16;i++)if(l[i]!==this.current[i]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},f.bE=Ca,f.bF=ka,f.bG=class extends sn{constructor(l,i){super(l,i),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},f.bH=class extends sn{constructor(l,i){super(l,i),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},f.bI=ie,f.bJ=function(l,i){var o=Math.sin(i),u=Math.cos(i);return l[0]=u,l[1]=o,l[2]=0,l[3]=-o,l[4]=u,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},f.bK=function(l,i,o){var u=i[0],g=i[1],x=i[2];return l[0]=u*o[0]+g*o[3]+x*o[6],l[1]=u*o[1]+g*o[4]+x*o[7],l[2]=u*o[2]+g*o[5]+x*o[8],l},f.bL=function(l,i,o,u,g,x,b){var S=1/(i-o),M=1/(u-g),I=1/(x-b);return l[0]=-2*S,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*M,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*I,l[11]=0,l[12]=(i+o)*S,l[13]=(g+u)*M,l[14]=(b+x)*I,l[15]=1,l},f.bM=class extends uh{},f.bN=Iw,f.bO=class extends fr{},f.bP=Hp,f.bQ=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},f.bR=S_,f.bS=function(l,i,o){var u=i[0],g=i[1],x=i[2],b=o[3]*u+o[7]*g+o[11]*x+o[15];return l[0]=(o[0]*u+o[4]*g+o[8]*x+o[12])/(b=b||1),l[1]=(o[1]*u+o[5]*g+o[9]*x+o[13])/b,l[2]=(o[2]*u+o[6]*g+o[10]*x+o[14])/b,l},f.bT=class extends lh{},f.bU=class extends r{},f.bV=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]&&l[3]===i[3]&&l[4]===i[4]&&l[5]===i[5]&&l[6]===i[6]&&l[7]===i[7]&&l[8]===i[8]&&l[9]===i[9]&&l[10]===i[10]&&l[11]===i[11]&&l[12]===i[12]&&l[13]===i[13]&&l[14]===i[14]&&l[15]===i[15]},f.bW=function(l,i){var o=l[0],u=l[1],g=l[2],x=l[3],b=l[4],S=l[5],M=l[6],I=l[7],A=l[8],z=l[9],j=l[10],U=l[11],H=l[12],q=l[13],it=l[14],ct=l[15],St=i[0],ft=i[1],$=i[2],tt=i[3],pt=i[4],Rt=i[5],Qt=i[6],Nt=i[7],Ht=i[8],ne=i[9],ee=i[10],oe=i[11],Wt=i[12],we=i[13],Ae=i[14],Ie=i[15];return Math.abs(o-St)<=Yt*Math.max(1,Math.abs(o),Math.abs(St))&&Math.abs(u-ft)<=Yt*Math.max(1,Math.abs(u),Math.abs(ft))&&Math.abs(g-$)<=Yt*Math.max(1,Math.abs(g),Math.abs($))&&Math.abs(x-tt)<=Yt*Math.max(1,Math.abs(x),Math.abs(tt))&&Math.abs(b-pt)<=Yt*Math.max(1,Math.abs(b),Math.abs(pt))&&Math.abs(S-Rt)<=Yt*Math.max(1,Math.abs(S),Math.abs(Rt))&&Math.abs(M-Qt)<=Yt*Math.max(1,Math.abs(M),Math.abs(Qt))&&Math.abs(I-Nt)<=Yt*Math.max(1,Math.abs(I),Math.abs(Nt))&&Math.abs(A-Ht)<=Yt*Math.max(1,Math.abs(A),Math.abs(Ht))&&Math.abs(z-ne)<=Yt*Math.max(1,Math.abs(z),Math.abs(ne))&&Math.abs(j-ee)<=Yt*Math.max(1,Math.abs(j),Math.abs(ee))&&Math.abs(U-oe)<=Yt*Math.max(1,Math.abs(U),Math.abs(oe))&&Math.abs(H-Wt)<=Yt*Math.max(1,Math.abs(H),Math.abs(Wt))&&Math.abs(q-we)<=Yt*Math.max(1,Math.abs(q),Math.abs(we))&&Math.abs(it-Ae)<=Yt*Math.max(1,Math.abs(it),Math.abs(Ae))&&Math.abs(ct-Ie)<=Yt*Math.max(1,Math.abs(ct),Math.abs(Ie))},f.bX=function(l,i){return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l},f.bY=l=>l.type==="symbol",f.bZ=l=>l.type==="circle",f.b_=l=>l.type==="heatmap",f.ba=zi,f.bb=Es,f.bc=function(l,i,o,u,g){return qe(u,g,Ii((l-i)/(o-i),0,1))},f.bd=Oe,f.be=function(){return new Float64Array(4)},f.bf=function(){return new Float64Array(3)},f.bg=function(l,i,o,u){var g=[],x=[];return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],x[0]=g[0]*Math.cos(u)-g[1]*Math.sin(u),x[1]=g[0]*Math.sin(u)+g[1]*Math.cos(u),x[2]=g[2],l[0]=x[0]+o[0],l[1]=x[1]+o[1],l[2]=x[2]+o[2],l},f.bh=function(l,i,o,u){var g=[],x=[];return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],x[0]=g[0],x[1]=g[1]*Math.cos(u)-g[2]*Math.sin(u),x[2]=g[1]*Math.sin(u)+g[2]*Math.cos(u),l[0]=x[0]+o[0],l[1]=x[1]+o[1],l[2]=x[2]+o[2],l},f.bi=function(l,i,o,u){var g=[],x=[];return g[0]=i[0]-o[0],g[1]=i[1]-o[1],g[2]=i[2]-o[2],x[0]=g[2]*Math.sin(u)+g[0]*Math.cos(u),x[1]=g[1],x[2]=g[2]*Math.cos(u)-g[0]*Math.sin(u),l[0]=x[0]+o[0],l[1]=x[1]+o[1],l[2]=x[2]+o[2],l},f.bj=function(l,i,o){var u=Math.sin(o),g=Math.cos(o),x=i[0],b=i[1],S=i[2],M=i[3],I=i[8],A=i[9],z=i[10],j=i[11];return i!==l&&(l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=x*g-I*u,l[1]=b*g-A*u,l[2]=S*g-z*u,l[3]=M*g-j*u,l[8]=x*u+I*g,l[9]=b*u+A*g,l[10]=S*u+z*g,l[11]=M*u+j*g,l},f.bk=function(l,i){const o=Oe(l,360),u=Oe(i,360),g=u-o,x=u>o?g-360:g+360;return Math.abs(g)<Math.abs(x)?g:x},f.bl=function(l){return l[0]=0,l[1]=0,l[2]=0,l},f.bm=function(l,i,o,u){const g=Math.sqrt(l*l+i*i),x=Math.sqrt(o*o+u*u);l/=g,i/=g,o/=x,u/=x;const b=Math.acos(l*o+i*u);return-i*o+l*u>0?b:-b},f.bn=function(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]+l[3]},f.bo=pm,f.bp=function(l,i){const o=Oe(l,2*Math.PI),u=Oe(i,2*Math.PI);return Math.min(Math.abs(o-u),Math.abs(o-u+2*Math.PI),Math.abs(o-u-2*Math.PI))},f.bq=function(l){return Math.hypot(l[0],l[1],l[2])},f.br=function(){const l={},i=st.$version;for(const o in st.$root){const u=st.$root[o];if(u.required){let g=null;g=o==="version"?i:u.type==="array"?[]:{},g!=null&&(l[o]=g)}}return l},f.bs=Sd,f.bt=Je,f.bu=function(l){l=l.slice();const i=Object.create(null);for(let o=0;o<l.length;o++)i[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=Y(l[o],i[l[o].ref]));return l},f.bv=function(l){if(l.type==="custom")return new Jw(l);switch(l.type){case"background":return new Xw(l);case"circle":return new H1(l);case"fill":return new cw(l);case"fill-extrusion":return new _w(l);case"heatmap":return new G1(l);case"hillshade":return new W1(l);case"line":return new Mw(l);case"raster":return new Yw(l);case"symbol":return new Wd(l)}},f.bw=ue,f.bx=function(l,i){if(!l)return[{command:"setStyle",args:[i]}];let o=[];try{if(!Q(l.version,i.version))return[{command:"setStyle",args:[i]}];Q(l.center,i.center)||o.push({command:"setCenter",args:[i.center]}),Q(l.centerAltitude,i.centerAltitude)||o.push({command:"setCenterAltitude",args:[i.centerAltitude]}),Q(l.zoom,i.zoom)||o.push({command:"setZoom",args:[i.zoom]}),Q(l.bearing,i.bearing)||o.push({command:"setBearing",args:[i.bearing]}),Q(l.pitch,i.pitch)||o.push({command:"setPitch",args:[i.pitch]}),Q(l.roll,i.roll)||o.push({command:"setRoll",args:[i.roll]}),Q(l.sprite,i.sprite)||o.push({command:"setSprite",args:[i.sprite]}),Q(l.glyphs,i.glyphs)||o.push({command:"setGlyphs",args:[i.glyphs]}),Q(l.transition,i.transition)||o.push({command:"setTransition",args:[i.transition]}),Q(l.light,i.light)||o.push({command:"setLight",args:[i.light]}),Q(l.terrain,i.terrain)||o.push({command:"setTerrain",args:[i.terrain]}),Q(l.sky,i.sky)||o.push({command:"setSky",args:[i.sky]}),Q(l.projection,i.projection)||o.push({command:"setProjection",args:[i.projection]});const u={},g=[];(function(b,S,M,I){let A;for(A in S=S||{},b=b||{})Object.prototype.hasOwnProperty.call(b,A)&&(Object.prototype.hasOwnProperty.call(S,A)||It(A,M,I));for(A in S)Object.prototype.hasOwnProperty.call(S,A)&&(Object.prototype.hasOwnProperty.call(b,A)?Q(b[A],S[A])||(b[A].type==="geojson"&&S[A].type==="geojson"&&kt(b,S,A)?dt(M,{command:"setGeoJSONSourceData",args:[A,S[A].data]}):Bt(A,S,M,I)):bt(A,S,M))})(l.sources,i.sources,g,u);const x=[];l.layers&&l.layers.forEach(b=>{"source"in b&&u[b.source]?o.push({command:"removeLayer",args:[b.id]}):x.push(b)}),o=o.concat(g),function(b,S,M){S=S||[];const I=(b=b||[]).map($t),A=S.map($t),z=b.reduce(Dt,{}),j=S.reduce(Dt,{}),U=I.slice(),H=Object.create(null);let q,it,ct,St,ft;for(let $=0,tt=0;$<I.length;$++)q=I[$],Object.prototype.hasOwnProperty.call(j,q)?tt++:(dt(M,{command:"removeLayer",args:[q]}),U.splice(U.indexOf(q,tt),1));for(let $=0,tt=0;$<A.length;$++)q=A[A.length-1-$],U[U.length-1-$]!==q&&(Object.prototype.hasOwnProperty.call(z,q)?(dt(M,{command:"removeLayer",args:[q]}),U.splice(U.lastIndexOf(q,U.length-tt),1)):tt++,St=U[U.length-$],dt(M,{command:"addLayer",args:[j[q],St]}),U.splice(U.length-$,0,q),H[q]=!0);for(let $=0;$<A.length;$++)if(q=A[$],it=z[q],ct=j[q],!H[q]&&!Q(it,ct))if(Q(it.source,ct.source)&&Q(it["source-layer"],ct["source-layer"])&&Q(it.type,ct.type)){for(ft in Zt(it.layout,ct.layout,M,q,null,"setLayoutProperty"),Zt(it.paint,ct.paint,M,q,null,"setPaintProperty"),Q(it.filter,ct.filter)||dt(M,{command:"setFilter",args:[q,ct.filter]}),Q(it.minzoom,ct.minzoom)&&Q(it.maxzoom,ct.maxzoom)||dt(M,{command:"setLayerZoomRange",args:[q,ct.minzoom,ct.maxzoom]}),it)Object.prototype.hasOwnProperty.call(it,ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?Zt(it[ft],ct[ft],M,q,ft.slice(6),"setPaintProperty"):Q(it[ft],ct[ft])||dt(M,{command:"setLayerProperty",args:[q,ft,ct[ft]]}));for(ft in ct)Object.prototype.hasOwnProperty.call(ct,ft)&&!Object.prototype.hasOwnProperty.call(it,ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?Zt(it[ft],ct[ft],M,q,ft.slice(6),"setPaintProperty"):Q(it[ft],ct[ft])||dt(M,{command:"setLayerProperty",args:[q,ft,ct[ft]]}))}else dt(M,{command:"removeLayer",args:[q]}),St=U[U.lastIndexOf(q)+1],dt(M,{command:"addLayer",args:[ct,St]})}(x,i.layers,o)}catch(u){console.warn("Unable to compute style diff:",u),o=[{command:"setStyle",args:[i]}]}return o},f.by=function(l){const i=[],o=l.id;return o===void 0&&i.push({message:`layers.${o}: missing required property "id"`}),l.render===void 0&&i.push({message:`layers.${o}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&i.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),i},f.bz=function l(i,o){if(Array.isArray(i)){if(!Array.isArray(o)||i.length!==o.length)return!1;for(let u=0;u<i.length;u++)if(!l(i[u],o[u]))return!1;return!0}if(typeof i=="object"&&i!==null&&o!==null){if(typeof o!="object"||Object.keys(i).length!==Object.keys(o).length)return!1;for(const u in i)if(!l(i[u],o[u]))return!1;return!0}return i===o},f.c=se,f.c0=l=>l.type==="fill",f.c1=l=>l.type==="fill-extrusion",f.c2=l=>l.type==="hillshade",f.c3=l=>l.type==="raster",f.c4=l=>l.type==="background",f.c5=l=>l.type==="custom",f.c6=mi,f.c7=function(l,i,o){const u=je(i.x-o.x,i.y-o.y),g=je(l.x-o.x,l.y-o.y);var x,b;return jt(Math.atan2(u[0]*g[1]-u[1]*g[0],(x=u)[0]*(b=g)[0]+x[1]*b[1]))},f.c8=ci,f.c9=function(l,i,o){var u=i[0],g=i[1];return l[0]=o[0]*u+o[4]*g+o[12],l[1]=o[1]*u+o[5]*g+o[13],l},f.cA=J_,f.cB=_l,f.cC=qn,f.ca=function(l,i){const{x:o,y:u}=Rh.fromLngLat(i);return!(l<0||l>25||u<0||u>=1||o<0||o>=1)},f.cb=function(l,i){return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},f.cc=class extends Sa{},f.cd=l2,f.cf=function(l){return l.message===Ft},f.cg=Ne,f.ch=function(l,i){re.REGISTERED_PROTOCOLS[l]=i},f.ci=function(l){delete re.REGISTERED_PROTOCOLS[l]},f.cj=function(l,i){const o={};for(let g=0;g<l.length;g++){const x=i&&i[l[g].id]||Jc(l[g]);i&&(i[l[g].id]=x);let b=o[x];b||(b=o[x]=[]),b.push(l[g])}const u=[];for(const g in o)u.push(o[g]);return u},f.ck=ge,f.cl=Sy,f.cm=My,f.cn=ty,f.co=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=xe/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const i=l.bucket.layers[0],o=i.layout,u=i._unevaluatedLayout._values,g={layoutIconSize:u["icon-size"].possiblyEvaluate(new Oi(l.bucket.zoom+1),l.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new Oi(l.bucket.zoom+1),l.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new Oi(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=l.bucket.textSizeData;g.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Oi(I),l.canonical),u["text-size"].possiblyEvaluate(new Oi(A),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=l.bucket.iconSizeData;g.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Oi(I),l.canonical),u["icon-size"].possiblyEvaluate(new Oi(A),l.canonical)]}const x=o.get("text-line-height")*ms,b=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",S=o.get("text-keep-upright"),M=o.get("text-size");for(const I of l.bucket.features){const A=o.get("text-font").evaluate(I,{},l.canonical).join(","),z=M.evaluate(I,{},l.canonical),j=g.layoutTextSize.evaluate(I,{},l.canonical),U=g.layoutIconSize.evaluate(I,{},l.canonical),H={horizontal:{},vertical:void 0},q=I.text;let it,ct=[0,0];if(q){const $=q.toString(),tt=o.get("text-letter-spacing").evaluate(I,{},l.canonical)*ms,pt=Td($)?tt:0,Rt=o.get("text-anchor").evaluate(I,{},l.canonical),Qt=Oy(i,I,l.canonical);if(!Qt){const ee=o.get("text-radial-offset").evaluate(I,{},l.canonical);ct=ee?Fy(Rt,[ee*ms,_m]):o.get("text-offset").evaluate(I,{},l.canonical).map(oe=>oe*ms)}let Nt=b?"center":o.get("text-justify").evaluate(I,{},l.canonical);const Ht=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(I,{},l.canonical)*ms:1/0,ne=()=>{l.bucket.allowVerticalPlacement&&Co($)&&(H.vertical=Zd(q,l.glyphMap,l.glyphPositions,l.imagePositions,A,Ht,x,Rt,"left",pt,ct,f.ai.vertical,!0,j,z))};if(!b&&Qt){const ee=new Set;if(Nt==="auto")for(let Wt=0;Wt<Qt.values.length;Wt+=2)ee.add(ym(Qt.values[Wt]));else ee.add(Nt);let oe=!1;for(const Wt of ee)if(!H.horizontal[Wt])if(oe)H.horizontal[Wt]=H.horizontal[0];else{const we=Zd(q,l.glyphMap,l.glyphPositions,l.imagePositions,A,Ht,x,"center",Wt,pt,ct,f.ai.horizontal,!1,j,z);we&&(H.horizontal[Wt]=we,oe=we.positionedLines.length===1)}ne()}else{Nt==="auto"&&(Nt=ym(Rt));const ee=Zd(q,l.glyphMap,l.glyphPositions,l.imagePositions,A,Ht,x,Rt,Nt,pt,ct,f.ai.horizontal,!1,j,z);ee&&(H.horizontal[Nt]=ee),ne(),Co($)&&b&&S&&(H.vertical=Zd(q,l.glyphMap,l.glyphPositions,l.imagePositions,A,Ht,x,Rt,Nt,pt,ct,f.ai.vertical,!1,j,z))}}let St=!1;if(I.icon&&I.icon.name){const $=l.imageMap[I.icon.name];$&&(it=Hw(l.imagePositions[I.icon.name],o.get("icon-offset").evaluate(I,{},l.canonical),o.get("icon-anchor").evaluate(I,{},l.canonical)),St=!!$.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=St:l.bucket.sdfIcons!==St&&X("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($.pixelRatio!==l.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const ft=jy(H.horizontal)||H.vertical;l.bucket.iconsInText=!!ft&&ft.iconsInText,(ft||it)&&o2(l.bucket,I,H,it,l.imageMap,g,j,U,ct,St,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},f.cp=em,f.cq=Xp,f.cr=tm,f.cs=kh,f.ct=nm,f.cu=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},f.cv=function(l,i,o,u,g){return a(this,void 0,void 0,function*(){if(At())try{return yield ht(l,i,o,u,g)}catch{}return function(x,b,S,M,I){const A=x.width,z=x.height;Tt&&Et||(Tt=new OffscreenCanvas(A,z),Et=Tt.getContext("2d",{willReadFrequently:!0})),Tt.width=A,Tt.height=z,Et.drawImage(x,0,0,A,z);const j=Et.getImageData(b,S,M,I);return Et.clearRect(0,0,A,z),j.data}(l,i,o,u,g)})},f.cw=wy,f.cx=w,f.cy=E,f.cz=N_,f.d=l=>a(void 0,void 0,void 0,function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(i)}catch(o){throw new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.e=ai,f.f=l=>new Promise((i,o)=>{const u=new Image;u.onload=()=>{i(u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame(()=>{u.src=et})},u.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(l)],{type:"image/png"});u.src=l.byteLength?URL.createObjectURL(g):et}),f.g=ve,f.h=(l,i)=>$e(ai(l,{type:"json"}),i),f.i=O,f.j=Js,f.k=Qi,f.l=(l,i)=>$e(ai(l,{type:"arrayBuffer"}),i),f.m=$e,f.n=function(l){return new nm(l).readFields(Ew,[])},f.o=vh,f.p=Q_,f.q=Ns,f.r=Op,f.s=_i,f.t=bd,f.u=Po,f.v=st,f.w=X,f.x=function([l,i,o]){return i+=90,i*=Math.PI/180,o*=Math.PI/180,{x:l*Math.cos(i)*Math.sin(o),y:l*Math.sin(i)*Math.sin(o),z:l*Math.cos(o)}},f.y=vn,f.z=Oi}),h("worker",["./shared"],function(f){class a{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,Y){for(const dt of G){this._layerConfigs[dt.id]=dt;const bt=this._layers[dt.id]=f.bv(dt);bt._featureFilter=f.a4(bt.filter),this.keyCache[dt.id]&&delete this.keyCache[dt.id]}for(const dt of Y)delete this.keyCache[dt],delete this._layerConfigs[dt],delete this._layers[dt];this.familiesBySource={};const Q=f.cj(Object.values(this._layerConfigs),this.keyCache);for(const dt of Q){const bt=dt.map(Dt=>this._layers[Dt.id]),It=bt[0];if(It.visibility==="none")continue;const Bt=It.source||"";let kt=this.familiesBySource[Bt];kt||(kt=this.familiesBySource[Bt]={});const Zt=It.sourceLayer||"_geojsonTileLayer";let $t=kt[Zt];$t||($t=kt[Zt]=[]),$t.push(bt)}}}class w{constructor(G){const Y={},Q=[];for(const Bt in G){const kt=G[Bt],Zt=Y[Bt]={};for(const $t in kt){const Dt=kt[+$t];if(!Dt||Dt.bitmap.width===0||Dt.bitmap.height===0)continue;const Mt={x:0,y:0,w:Dt.bitmap.width+2,h:Dt.bitmap.height+2};Q.push(Mt),Zt[$t]={rect:Mt,metrics:Dt.metrics}}}const{w:dt,h:bt}=f.p(Q),It=new f.o({width:dt||1,height:bt||1});for(const Bt in G){const kt=G[Bt];for(const Zt in kt){const $t=kt[+Zt];if(!$t||$t.bitmap.width===0||$t.bitmap.height===0)continue;const Dt=Y[Bt][Zt].rect;f.o.copy($t.bitmap,It,{x:0,y:0},{x:Dt.x+1,y:Dt.y+1},$t.bitmap)}}this.image=It,this.positions=Y}}f.ck("GlyphAtlas",w);class P{constructor(G){this.tileID=new f.S(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId,this.inFlightDependencies=[]}parse(G,Y,Q,dt,bt){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=G,this.collisionBoxArray=new f.a2;const It=new f.cl(Object.keys(G.layers).sort()),Bt=new f.cm(this.tileID,this.promoteId);Bt.bucketLayerIDs=[];const kt={},Zt={featureIndex:Bt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Q,subdivisionGranularity:bt},$t=Y.familiesBySource[this.source];for(const Le in $t){const ye=G.layers[Le];if(!ye)continue;ye.version===1&&f.w(`Vector tile source "${this.source}" layer "${Le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wi=It.encode(Le),lr=[];for(let ds=0;ds<ye.length;ds++){const as=ye.feature(ds),Ri=Bt.getId(as,Le);lr.push({feature:as,id:Ri,index:ds,sourceLayerIndex:Wi})}for(const ds of $t[Le]){const as=ds[0];as.source!==this.source&&f.w(`layer.source = ${as.source} does not equal this.source = ${this.source}`),as.minzoom&&this.zoom<Math.floor(as.minzoom)||as.maxzoom&&this.zoom>=as.maxzoom||as.visibility!=="none"&&(k(ds,this.zoom,Q),(kt[as.id]=as.createBucket({index:Bt.bucketLayerIDs.length,layers:ds,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wi,sourceID:this.source})).populate(lr,Zt,this.tileID.canonical),Bt.bucketLayerIDs.push(ds.map(Ri=>Ri.id)))}}const Dt=f.bA(Zt.glyphDependencies,Le=>Object.keys(Le).map(Number));this.inFlightDependencies.forEach(Le=>Le==null?void 0:Le.abort()),this.inFlightDependencies=[];let Mt=Promise.resolve({});if(Object.keys(Dt).length){const Le=new AbortController;this.inFlightDependencies.push(Le),Mt=dt.sendAsync({type:"GG",data:{stacks:Dt,source:this.source,tileID:this.tileID,type:"glyphs"}},Le)}const he=Object.keys(Zt.iconDependencies);let le=Promise.resolve({});if(he.length){const Le=new AbortController;this.inFlightDependencies.push(Le),le=dt.sendAsync({type:"GI",data:{icons:he,source:this.source,tileID:this.tileID,type:"icons"}},Le)}const Ee=Object.keys(Zt.patternDependencies);let Be=Promise.resolve({});if(Ee.length){const Le=new AbortController;this.inFlightDependencies.push(Le),Be=dt.sendAsync({type:"GI",data:{icons:Ee,source:this.source,tileID:this.tileID,type:"patterns"}},Le)}const[Xt,de,Se]=yield Promise.all([Mt,le,Be]),We=new w(Xt),ni=new f.cn(de,Se);for(const Le in kt){const ye=kt[Le];ye instanceof f.a3?(k(ye.layers,this.zoom,Q),f.co({bucket:ye,glyphMap:Xt,glyphPositions:We.positions,imageMap:de,imagePositions:ni.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Zt.subdivisionGranularity})):ye.hasPattern&&(ye instanceof f.cp||ye instanceof f.cq||ye instanceof f.cr)&&(k(ye.layers,this.zoom,Q),ye.addFeatures(Zt,this.tileID.canonical,ni.patternPositions))}return this.status="done",{buckets:Object.values(kt).filter(Le=>!Le.isEmpty()),featureIndex:Bt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:We.image,imageAtlas:ni,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?de:null,glyphPositions:this.returnDependencies?We.positions:null}})}}function k(st,G,Y){const Q=new f.z(G);for(const dt of st)dt.recalculate(Q,Y)}class E{constructor(G,Y,Q){this.actor=G,this.layerIndex=Y,this.availableImages=Q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(G,Y){return f._(this,void 0,void 0,function*(){const Q=yield f.l(G.request,Y);try{return{vectorTile:new f.cs.VectorTile(new f.ct(Q.data)),rawData:Q.data,cacheControl:Q.cacheControl,expires:Q.expires}}catch(dt){const bt=new Uint8Array(Q.data);let It=`Unable to parse the tile at ${G.request.url}, `;throw It+=bt[0]===31&&bt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${dt.message}`,new Error(It)}})}loadTile(G){return f._(this,void 0,void 0,function*(){const Y=G.uid,Q=!!(G&&G.request&&G.request.collectResourceTiming)&&new f.cu(G.request),dt=new P(G);this.loading[Y]=dt;const bt=new AbortController;dt.abort=bt;try{const It=yield this.loadVectorTile(G,bt);if(delete this.loading[Y],!It)return null;const Bt=It.rawData,kt={};It.expires&&(kt.expires=It.expires),It.cacheControl&&(kt.cacheControl=It.cacheControl);const Zt={};if(Q){const Dt=Q.finish();Dt&&(Zt.resourceTiming=JSON.parse(JSON.stringify(Dt)))}dt.vectorTile=It.vectorTile;const $t=dt.parse(It.vectorTile,this.layerIndex,this.availableImages,this.actor,G.subdivisionGranularity);this.loaded[Y]=dt,this.fetching[Y]={rawTileData:Bt,cacheControl:kt,resourceTiming:Zt};try{const Dt=yield $t;return f.e({rawTileData:Bt.slice(0)},Dt,kt,Zt)}finally{delete this.fetching[Y]}}catch(It){throw delete this.loading[Y],dt.status="done",this.loaded[Y]=dt,It}})}reloadTile(G){return f._(this,void 0,void 0,function*(){const Y=G.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Q=this.loaded[Y];if(Q.showCollisionBoxes=G.showCollisionBoxes,Q.status==="parsing"){const dt=yield Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,G.subdivisionGranularity);let bt;if(this.fetching[Y]){const{rawTileData:It,cacheControl:Bt,resourceTiming:kt}=this.fetching[Y];delete this.fetching[Y],bt=f.e({rawTileData:It.slice(0)},dt,Bt,kt)}else bt=dt;return bt}if(Q.status==="done"&&Q.vectorTile)return Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,G.subdivisionGranularity)})}abortTile(G){return f._(this,void 0,void 0,function*(){const Y=this.loading,Q=G.uid;Y&&Y[Q]&&Y[Q].abort&&(Y[Q].abort.abort(),delete Y[Q])})}removeTile(G){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[G.uid]&&delete this.loaded[G.uid]})}}class F{constructor(){this.loaded={}}loadTile(G){return f._(this,void 0,void 0,function*(){const{uid:Y,encoding:Q,rawImageData:dt,redFactor:bt,greenFactor:It,blueFactor:Bt,baseShift:kt}=G,Zt=dt.width+2,$t=dt.height+2,Dt=f.b(dt)?new f.R({width:Zt,height:$t},yield f.cv(dt,-1,-1,Zt,$t)):dt,Mt=new f.cw(Y,Dt,Q,bt,It,Bt,kt);return this.loaded=this.loaded||{},this.loaded[Y]=Mt,Mt})}removeTile(G){const Y=this.loaded,Q=G.uid;Y&&Y[Q]&&delete Y[Q]}}var R,J,rt=function(){if(J)return R;function st(Y,Q){if(Y.length!==0){G(Y[0],Q);for(var dt=1;dt<Y.length;dt++)G(Y[dt],!Q)}}function G(Y,Q){for(var dt=0,bt=0,It=0,Bt=Y.length,kt=Bt-1;It<Bt;kt=It++){var Zt=(Y[It][0]-Y[kt][0])*(Y[kt][1]+Y[It][1]),$t=dt+Zt;bt+=Math.abs(dt)>=Math.abs(Zt)?dt-$t+Zt:Zt-$t+dt,dt=$t}dt+bt>=0!=!!Q&&Y.reverse()}return J=1,R=function Y(Q,dt){var bt,It=Q&&Q.type;if(It==="FeatureCollection")for(bt=0;bt<Q.features.length;bt++)Y(Q.features[bt],dt);else if(It==="GeometryCollection")for(bt=0;bt<Q.geometries.length;bt++)Y(Q.geometries[bt],dt);else if(It==="Feature")Y(Q.geometry,dt);else if(It==="Polygon")st(Q.coordinates,dt);else if(It==="MultiPolygon")for(bt=0;bt<Q.coordinates.length;bt++)st(Q.coordinates[bt],dt);return Q}}(),mt=f.cx(rt);const xt=f.cs.VectorTileFeature.prototype.toGeoJSON;class Ct{constructor(G){this._feature=G,this.extent=f.X,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(this._feature.type===1){const G=[];for(const Y of this._feature.geometry)G.push([new f.P(Y[0],Y[1])]);return G}{const G=[];for(const Y of this._feature.geometry){const Q=[];for(const dt of Y)Q.push(new f.P(dt[0],dt[1]));G.push(Q)}return G}}toGeoJSON(G,Y,Q){return xt.call(this,G,Y,Q)}}class Lt{constructor(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.X,this.length=G.length,this._features=G}feature(G){return new Ct(this._features[G])}}var At,Vt,Yt,Gt={exports:{}},ie=function(){if(Yt)return Gt.exports;Yt=1;var st=f.cA(),G=function(){if(Vt)return At;Vt=1;var $t=f.cy(),Dt=f.cz().VectorTileFeature;function Mt(le,Ee){this.options=Ee||{},this.features=le,this.length=le.length}function he(le,Ee){this.id=typeof le.id=="number"?le.id:void 0,this.type=le.type,this.rawGeometry=le.type===1?[le.geometry]:le.geometry,this.properties=le.tags,this.extent=Ee||4096}return At=Mt,Mt.prototype.feature=function(le){return new he(this.features[le],this.options.extent)},he.prototype.loadGeometry=function(){var le=this.rawGeometry;this.geometry=[];for(var Ee=0;Ee<le.length;Ee++){for(var Be=le[Ee],Xt=[],de=0;de<Be.length;de++)Xt.push(new $t(Be[de][0],Be[de][1]));this.geometry.push(Xt)}return this.geometry},he.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var le=this.geometry,Ee=1/0,Be=-1/0,Xt=1/0,de=-1/0,Se=0;Se<le.length;Se++)for(var We=le[Se],ni=0;ni<We.length;ni++){var Le=We[ni];Ee=Math.min(Ee,Le.x),Be=Math.max(Be,Le.x),Xt=Math.min(Xt,Le.y),de=Math.max(de,Le.y)}return[Ee,Xt,Be,de]},he.prototype.toGeoJSON=Dt.prototype.toGeoJSON,At}();function Y($t){var Dt=new st;return function(Mt,he){for(var le in Mt.layers)he.writeMessage(3,Q,Mt.layers[le])}($t,Dt),Dt.finish()}function Q($t,Dt){var Mt;Dt.writeVarintField(15,$t.version||1),Dt.writeStringField(1,$t.name||""),Dt.writeVarintField(5,$t.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(Mt=0;Mt<$t.length;Mt++)he.feature=$t.feature(Mt),Dt.writeMessage(2,dt,he);var le=he.keys;for(Mt=0;Mt<le.length;Mt++)Dt.writeStringField(3,le[Mt]);var Ee=he.values;for(Mt=0;Mt<Ee.length;Mt++)Dt.writeMessage(4,Zt,Ee[Mt])}function dt($t,Dt){var Mt=$t.feature;Mt.id!==void 0&&Dt.writeVarintField(1,Mt.id),Dt.writeMessage(2,bt,$t),Dt.writeVarintField(3,Mt.type),Dt.writeMessage(4,kt,Mt)}function bt($t,Dt){var Mt=$t.feature,he=$t.keys,le=$t.values,Ee=$t.keycache,Be=$t.valuecache;for(var Xt in Mt.properties){var de=Mt.properties[Xt],Se=Ee[Xt];if(de!==null){Se===void 0&&(he.push(Xt),Ee[Xt]=Se=he.length-1),Dt.writeVarint(Se);var We=typeof de;We!=="string"&&We!=="boolean"&&We!=="number"&&(de=JSON.stringify(de));var ni=We+":"+de,Le=Be[ni];Le===void 0&&(le.push(de),Be[ni]=Le=le.length-1),Dt.writeVarint(Le)}}}function It($t,Dt){return(Dt<<3)+(7&$t)}function Bt($t){return $t<<1^$t>>31}function kt($t,Dt){for(var Mt=$t.loadGeometry(),he=$t.type,le=0,Ee=0,Be=Mt.length,Xt=0;Xt<Be;Xt++){var de=Mt[Xt],Se=1;he===1&&(Se=de.length),Dt.writeVarint(It(1,Se));for(var We=he===3?de.length-1:de.length,ni=0;ni<We;ni++){ni===1&&he!==1&&Dt.writeVarint(It(2,We-1));var Le=de[ni].x-le,ye=de[ni].y-Ee;Dt.writeVarint(Bt(Le)),Dt.writeVarint(Bt(ye)),le+=Le,Ee+=ye}he===3&&Dt.writeVarint(It(7,1))}}function Zt($t,Dt){var Mt=typeof $t;Mt==="string"?Dt.writeStringField(1,$t):Mt==="boolean"?Dt.writeBooleanField(7,$t):Mt==="number"&&($t%1!=0?Dt.writeDoubleField(3,$t):$t<0?Dt.writeSVarintField(6,$t):Dt.writeVarintField(5,$t))}return Gt.exports=Y,Gt.exports.fromVectorTileJs=Y,Gt.exports.fromGeojsonVt=function($t,Dt){Dt=Dt||{};var Mt={};for(var he in $t)Mt[he]=new G($t[he].features,Dt),Mt[he].name=he,Mt[he].version=Dt.version,Mt[he].extent=Dt.extent;return Y({layers:Mt})},Gt.exports.GeoJSONWrapper=G,Gt.exports}(),be=f.cx(ie);const ze={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:st=>st},Me=Math.fround||(Fe=new Float32Array(1),st=>(Fe[0]=+st,Fe[0]));var Fe;const Ve=3,He=5,je=6;class xe{constructor(G){this.options=Object.assign(Object.create(ze),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:Y,minZoom:Q,maxZoom:dt}=this.options;Y&&console.time("total time");const bt=`prepare ${G.length} points`;Y&&console.time(bt),this.points=G;const It=[];for(let kt=0;kt<G.length;kt++){const Zt=G[kt];if(!Zt.geometry)continue;const[$t,Dt]=Zt.geometry.coordinates,Mt=Me(qe($t)),he=Me(zi(Dt));It.push(Mt,he,1/0,kt,-1,1),this.options.reduce&&It.push(0)}let Bt=this.trees[dt+1]=this._createTree(It);Y&&console.timeEnd(bt);for(let kt=dt;kt>=Q;kt--){const Zt=+Date.now();Bt=this.trees[kt]=this._createTree(this._cluster(Bt,kt)),Y&&console.log("z%d: %d clusters in %dms",kt,Bt.numItems,+Date.now()-Zt)}return Y&&console.timeEnd("total time"),this}getClusters(G,Y){let Q=((G[0]+180)%360+360)%360-180;const dt=Math.max(-90,Math.min(90,G[1]));let bt=G[2]===180?180:((G[2]+180)%360+360)%360-180;const It=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)Q=-180,bt=180;else if(Q>bt){const Dt=this.getClusters([Q,dt,180,It],Y),Mt=this.getClusters([-180,dt,bt,It],Y);return Dt.concat(Mt)}const Bt=this.trees[this._limitZoom(Y)],kt=Bt.range(qe(Q),zi(It),qe(bt),zi(dt)),Zt=Bt.data,$t=[];for(const Dt of kt){const Mt=this.stride*Dt;$t.push(Zt[Mt+He]>1?De(Zt,Mt,this.clusterProps):this.points[Zt[Mt+Ve]])}return $t}getChildren(G){const Y=this._getOriginId(G),Q=this._getOriginZoom(G),dt="No cluster with the specified id.",bt=this.trees[Q];if(!bt)throw new Error(dt);const It=bt.data;if(Y*this.stride>=It.length)throw new Error(dt);const Bt=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),kt=bt.within(It[Y*this.stride],It[Y*this.stride+1],Bt),Zt=[];for(const $t of kt){const Dt=$t*this.stride;It[Dt+4]===G&&Zt.push(It[Dt+He]>1?De(It,Dt,this.clusterProps):this.points[It[Dt+Ve]])}if(Zt.length===0)throw new Error(dt);return Zt}getLeaves(G,Y,Q){const dt=[];return this._appendLeaves(dt,G,Y=Y||10,Q=Q||0,0),dt}getTile(G,Y,Q){const dt=this.trees[this._limitZoom(G)],bt=Math.pow(2,G),{extent:It,radius:Bt}=this.options,kt=Bt/It,Zt=(Q-kt)/bt,$t=(Q+1+kt)/bt,Dt={features:[]};return this._addTileFeatures(dt.range((Y-kt)/bt,Zt,(Y+1+kt)/bt,$t),dt.data,Y,Q,bt,Dt),Y===0&&this._addTileFeatures(dt.range(1-kt/bt,Zt,1,$t),dt.data,bt,Q,bt,Dt),Y===bt-1&&this._addTileFeatures(dt.range(0,Zt,kt/bt,$t),dt.data,-1,Q,bt,Dt),Dt.features.length?Dt:null}getClusterExpansionZoom(G){let Y=this._getOriginZoom(G)-1;for(;Y<=this.options.maxZoom;){const Q=this.getChildren(G);if(Y++,Q.length!==1)break;G=Q[0].properties.cluster_id}return Y}_appendLeaves(G,Y,Q,dt,bt){const It=this.getChildren(Y);for(const Bt of It){const kt=Bt.properties;if(kt&&kt.cluster?bt+kt.point_count<=dt?bt+=kt.point_count:bt=this._appendLeaves(G,kt.cluster_id,Q,dt,bt):bt<dt?bt++:G.push(Bt),G.length===Q)break}return bt}_createTree(G){const Y=new f.az(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Q=0;Q<G.length;Q+=this.stride)Y.add(G[Q],G[Q+1]);return Y.finish(),Y.data=G,Y}_addTileFeatures(G,Y,Q,dt,bt,It){for(const Bt of G){const kt=Bt*this.stride,Zt=Y[kt+He]>1;let $t,Dt,Mt;if(Zt)$t=Oe(Y,kt,this.clusterProps),Dt=Y[kt],Mt=Y[kt+1];else{const Ee=this.points[Y[kt+Ve]];$t=Ee.properties;const[Be,Xt]=Ee.geometry.coordinates;Dt=qe(Be),Mt=zi(Xt)}const he={type:1,geometry:[[Math.round(this.options.extent*(Dt*bt-Q)),Math.round(this.options.extent*(Mt*bt-dt))]],tags:$t};let le;le=Zt||this.options.generateId?Y[kt+Ve]:this.points[Y[kt+Ve]].id,le!==void 0&&(he.id=le),It.features.push(he)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,Y){const{radius:Q,extent:dt,reduce:bt,minPoints:It}=this.options,Bt=Q/(dt*Math.pow(2,Y)),kt=G.data,Zt=[],$t=this.stride;for(let Dt=0;Dt<kt.length;Dt+=$t){if(kt[Dt+2]<=Y)continue;kt[Dt+2]=Y;const Mt=kt[Dt],he=kt[Dt+1],le=G.within(kt[Dt],kt[Dt+1],Bt),Ee=kt[Dt+He];let Be=Ee;for(const Xt of le){const de=Xt*$t;kt[de+2]>Y&&(Be+=kt[de+He])}if(Be>Ee&&Be>=It){let Xt,de=Mt*Ee,Se=he*Ee,We=-1;const ni=((Dt/$t|0)<<5)+(Y+1)+this.points.length;for(const Le of le){const ye=Le*$t;if(kt[ye+2]<=Y)continue;kt[ye+2]=Y;const Wi=kt[ye+He];de+=kt[ye]*Wi,Se+=kt[ye+1]*Wi,kt[ye+4]=ni,bt&&(Xt||(Xt=this._map(kt,Dt,!0),We=this.clusterProps.length,this.clusterProps.push(Xt)),bt(Xt,this._map(kt,ye)))}kt[Dt+4]=ni,Zt.push(de/Be,Se/Be,1/0,ni,-1,Be),bt&&Zt.push(We)}else{for(let Xt=0;Xt<$t;Xt++)Zt.push(kt[Dt+Xt]);if(Be>1)for(const Xt of le){const de=Xt*$t;if(!(kt[de+2]<=Y)){kt[de+2]=Y;for(let Se=0;Se<$t;Se++)Zt.push(kt[de+Se])}}}}return Zt}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,Y,Q){if(G[Y+He]>1){const It=this.clusterProps[G[Y+je]];return Q?Object.assign({},It):It}const dt=this.points[G[Y+Ve]].properties,bt=this.options.map(dt);return Q&&bt===dt?Object.assign({},bt):bt}}function De(st,G,Y){return{type:"Feature",id:st[G+Ve],properties:Oe(st,G,Y),geometry:{type:"Point",coordinates:[(Q=st[G],360*(Q-.5)),mi(st[G+1])]}};var Q}function Oe(st,G,Y){const Q=st[G+He],dt=Q>=1e4?`${Math.round(Q/1e3)}k`:Q>=1e3?Math.round(Q/100)/10+"k":Q,bt=st[G+je],It=bt===-1?{}:Object.assign({},Y[bt]);return Object.assign(It,{cluster:!0,cluster_id:st[G+Ve],point_count:Q,point_count_abbreviated:dt})}function qe(st){return st/360+.5}function zi(st){const G=Math.sin(st*Math.PI/180),Y=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return Y<0?0:Y>1?1:Y}function mi(st){const G=(180-360*st)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function ci(st,G,Y,Q){let dt=Q;const bt=G+(Y-G>>1);let It,Bt=Y-G;const kt=st[G],Zt=st[G+1],$t=st[Y],Dt=st[Y+1];for(let Mt=G+3;Mt<Y;Mt+=3){const he=Ii(st[Mt],st[Mt+1],kt,Zt,$t,Dt);if(he>dt)It=Mt,dt=he;else if(he===dt){const le=Math.abs(Mt-bt);le<Bt&&(It=Mt,Bt=le)}}dt>Q&&(It-G>3&&ci(st,G,It,Q),st[It+2]=dt,Y-It>3&&ci(st,It,Y,Q))}function Ii(st,G,Y,Q,dt,bt){let It=dt-Y,Bt=bt-Q;if(It!==0||Bt!==0){const kt=((st-Y)*It+(G-Q)*Bt)/(It*It+Bt*Bt);kt>1?(Y=dt,Q=bt):kt>0&&(Y+=It*kt,Q+=Bt*kt)}return It=st-Y,Bt=G-Q,It*It+Bt*Bt}function Ce(st,G,Y,Q){const dt={id:st??null,type:G,geometry:Y,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")ai(dt,Y);else if(G==="Polygon")ai(dt,Y[0]);else if(G==="MultiLineString")for(const bt of Y)ai(dt,bt);else if(G==="MultiPolygon")for(const bt of Y)ai(dt,bt[0]);return dt}function ai(st,G){for(let Y=0;Y<G.length;Y+=3)st.minX=Math.min(st.minX,G[Y]),st.minY=Math.min(st.minY,G[Y+1]),st.maxX=Math.max(st.maxX,G[Y]),st.maxY=Math.max(st.maxY,G[Y+1])}function ii(st,G,Y,Q){if(!G.geometry)return;const dt=G.geometry.coordinates;if(dt&&dt.length===0)return;const bt=G.geometry.type,It=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let Bt=[],kt=G.id;if(Y.promoteId?kt=G.properties[Y.promoteId]:Y.generateId&&(kt=Q||0),bt==="Point")Jt(dt,Bt);else if(bt==="MultiPoint")for(const Zt of dt)Jt(Zt,Bt);else if(bt==="LineString")me(dt,Bt,It,!1);else if(bt==="MultiLineString"){if(Y.lineMetrics){for(const Zt of dt)Bt=[],me(Zt,Bt,It,!1),st.push(Ce(kt,"LineString",Bt,G.properties));return}ue(dt,Bt,It,!1)}else if(bt==="Polygon")ue(dt,Bt,It,!0);else{if(bt!=="MultiPolygon"){if(bt==="GeometryCollection"){for(const Zt of G.geometry.geometries)ii(st,{id:kt,geometry:Zt,properties:G.properties},Y,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Zt of dt){const $t=[];ue(Zt,$t,It,!0),Bt.push($t)}}st.push(Ce(kt,bt,Bt,G.properties))}function Jt(st,G){G.push(Pt(st[0]),X(st[1]),0)}function me(st,G,Y,Q){let dt,bt,It=0;for(let kt=0;kt<st.length;kt++){const Zt=Pt(st[kt][0]),$t=X(st[kt][1]);G.push(Zt,$t,0),kt>0&&(It+=Q?(dt*$t-Zt*bt)/2:Math.sqrt(Math.pow(Zt-dt,2)+Math.pow($t-bt,2))),dt=Zt,bt=$t}const Bt=G.length-3;G[2]=1,ci(G,0,Bt,Y),G[Bt+2]=1,G.size=Math.abs(It),G.start=0,G.end=G.size}function ue(st,G,Y,Q){for(let dt=0;dt<st.length;dt++){const bt=[];me(st[dt],bt,Y,Q),G.push(bt)}}function Pt(st){return st/360+.5}function X(st){const G=Math.sin(st*Math.PI/180),Y=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return Y<0?0:Y>1?1:Y}function N(st,G,Y,Q,dt,bt,It,Bt){if(Q/=G,bt>=(Y/=G)&&It<Q)return st;if(It<Y||bt>=Q)return null;const kt=[];for(const Zt of st){const $t=Zt.geometry;let Dt=Zt.type;const Mt=dt===0?Zt.minX:Zt.minY,he=dt===0?Zt.maxX:Zt.maxY;if(Mt>=Y&&he<Q){kt.push(Zt);continue}if(he<Y||Mt>=Q)continue;let le=[];if(Dt==="Point"||Dt==="MultiPoint")O($t,le,Y,Q,dt);else if(Dt==="LineString")K($t,le,Y,Q,dt,!1,Bt.lineMetrics);else if(Dt==="MultiLineString")et($t,le,Y,Q,dt,!1);else if(Dt==="Polygon")et($t,le,Y,Q,dt,!0);else if(Dt==="MultiPolygon")for(const Ee of $t){const Be=[];et(Ee,Be,Y,Q,dt,!0),Be.length&&le.push(Be)}if(le.length){if(Bt.lineMetrics&&Dt==="LineString"){for(const Ee of le)kt.push(Ce(Zt.id,Dt,Ee,Zt.tags));continue}Dt!=="LineString"&&Dt!=="MultiLineString"||(le.length===1?(Dt="LineString",le=le[0]):Dt="MultiLineString"),Dt!=="Point"&&Dt!=="MultiPoint"||(Dt=le.length===3?"Point":"MultiPoint"),kt.push(Ce(Zt.id,Dt,le,Zt.tags))}}return kt.length?kt:null}function O(st,G,Y,Q,dt){for(let bt=0;bt<st.length;bt+=3){const It=st[bt+dt];It>=Y&&It<=Q&&ht(G,st[bt],st[bt+1],st[bt+2])}}function K(st,G,Y,Q,dt,bt,It){let Bt=nt(st);const kt=dt===0?Tt:Et;let Zt,$t,Dt=st.start;for(let Be=0;Be<st.length-3;Be+=3){const Xt=st[Be],de=st[Be+1],Se=st[Be+2],We=st[Be+3],ni=st[Be+4],Le=dt===0?Xt:de,ye=dt===0?We:ni;let Wi=!1;It&&(Zt=Math.sqrt(Math.pow(Xt-We,2)+Math.pow(de-ni,2))),Le<Y?ye>Y&&($t=kt(Bt,Xt,de,We,ni,Y),It&&(Bt.start=Dt+Zt*$t)):Le>Q?ye<Q&&($t=kt(Bt,Xt,de,We,ni,Q),It&&(Bt.start=Dt+Zt*$t)):ht(Bt,Xt,de,Se),ye<Y&&Le>=Y&&($t=kt(Bt,Xt,de,We,ni,Y),Wi=!0),ye>Q&&Le<=Q&&($t=kt(Bt,Xt,de,We,ni,Q),Wi=!0),!bt&&Wi&&(It&&(Bt.end=Dt+Zt*$t),G.push(Bt),Bt=nt(st)),It&&(Dt+=Zt)}let Mt=st.length-3;const he=st[Mt],le=st[Mt+1],Ee=dt===0?he:le;Ee>=Y&&Ee<=Q&&ht(Bt,he,le,st[Mt+2]),Mt=Bt.length-3,bt&&Mt>=3&&(Bt[Mt]!==Bt[0]||Bt[Mt+1]!==Bt[1])&&ht(Bt,Bt[0],Bt[1],Bt[2]),Bt.length&&G.push(Bt)}function nt(st){const G=[];return G.size=st.size,G.start=st.start,G.end=st.end,G}function et(st,G,Y,Q,dt,bt){for(const It of st)K(It,G,Y,Q,dt,bt,!1)}function ht(st,G,Y,Q){st.push(G,Y,Q)}function Tt(st,G,Y,Q,dt,bt){const It=(bt-G)/(Q-G);return ht(st,bt,Y+(dt-Y)*It,1),It}function Et(st,G,Y,Q,dt,bt){const It=(bt-Y)/(dt-Y);return ht(st,G+(Q-G)*It,bt,1),It}function jt(st,G){const Y=[];for(let Q=0;Q<st.length;Q++){const dt=st[Q],bt=dt.type;let It;if(bt==="Point"||bt==="MultiPoint"||bt==="LineString")It=Ft(dt.geometry,G);else if(bt==="MultiLineString"||bt==="Polygon"){It=[];for(const Bt of dt.geometry)It.push(Ft(Bt,G))}else if(bt==="MultiPolygon"){It=[];for(const Bt of dt.geometry){const kt=[];for(const Zt of Bt)kt.push(Ft(Zt,G));It.push(kt)}}Y.push(Ce(dt.id,bt,It,dt.tags))}return Y}function Ft(st,G){const Y=[];Y.size=st.size,st.start!==void 0&&(Y.start=st.start,Y.end=st.end);for(let Q=0;Q<st.length;Q+=3)Y.push(st[Q]+G,st[Q+1],st[Q+2]);return Y}function se(st,G){if(st.transformed)return st;const Y=1<<st.z,Q=st.x,dt=st.y;for(const bt of st.features){const It=bt.geometry,Bt=bt.type;if(bt.geometry=[],Bt===1)for(let kt=0;kt<It.length;kt+=2)bt.geometry.push(re(It[kt],It[kt+1],G,Y,Q,dt));else for(let kt=0;kt<It.length;kt++){const Zt=[];for(let $t=0;$t<It[kt].length;$t+=2)Zt.push(re(It[kt][$t],It[kt][$t+1],G,Y,Q,dt));bt.geometry.push(Zt)}}return st.transformed=!0,st}function re(st,G,Y,Q,dt,bt){return[Math.round(Y*(st*Q-dt)),Math.round(Y*(G*Q-bt))]}function ve(st,G,Y,Q,dt){const bt=G===dt.maxZoom?0:dt.tolerance/((1<<G)*dt.extent),It={features:[],numPoints:0,numSimplified:0,numFeatures:st.length,source:null,x:Y,y:Q,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Bt of st)Te(It,Bt,bt,dt);return It}function Te(st,G,Y,Q){const dt=G.geometry,bt=G.type,It=[];if(st.minX=Math.min(st.minX,G.minX),st.minY=Math.min(st.minY,G.minY),st.maxX=Math.max(st.maxX,G.maxX),st.maxY=Math.max(st.maxY,G.maxY),bt==="Point"||bt==="MultiPoint")for(let Bt=0;Bt<dt.length;Bt+=3)It.push(dt[Bt],dt[Bt+1]),st.numPoints++,st.numSimplified++;else if(bt==="LineString")Ne(It,dt,st,Y,!1,!1);else if(bt==="MultiLineString"||bt==="Polygon")for(let Bt=0;Bt<dt.length;Bt++)Ne(It,dt[Bt],st,Y,bt==="Polygon",Bt===0);else if(bt==="MultiPolygon")for(let Bt=0;Bt<dt.length;Bt++){const kt=dt[Bt];for(let Zt=0;Zt<kt.length;Zt++)Ne(It,kt[Zt],st,Y,!0,Zt===0)}if(It.length){let Bt=G.tags||null;if(bt==="LineString"&&Q.lineMetrics){Bt={};for(const Zt in G.tags)Bt[Zt]=G.tags[Zt];Bt.mapbox_clip_start=dt.start/dt.size,Bt.mapbox_clip_end=dt.end/dt.size}const kt={geometry:It,type:bt==="Polygon"||bt==="MultiPolygon"?3:bt==="LineString"||bt==="MultiLineString"?2:1,tags:Bt};G.id!==null&&(kt.id=G.id),st.features.push(kt)}}function Ne(st,G,Y,Q,dt,bt){const It=Q*Q;if(Q>0&&G.size<(dt?It:Q))return void(Y.numPoints+=G.length/3);const Bt=[];for(let kt=0;kt<G.length;kt+=3)(Q===0||G[kt+2]>It)&&(Y.numSimplified++,Bt.push(G[kt],G[kt+1])),Y.numPoints++;dt&&function(kt,Zt){let $t=0;for(let Dt=0,Mt=kt.length,he=Mt-2;Dt<Mt;he=Dt,Dt+=2)$t+=(kt[Dt]-kt[he])*(kt[Dt+1]+kt[he+1]);if($t>0===Zt)for(let Dt=0,Mt=kt.length;Dt<Mt/2;Dt+=2){const he=kt[Dt],le=kt[Dt+1];kt[Dt]=kt[Mt-2-Dt],kt[Dt+1]=kt[Mt-1-Dt],kt[Mt-2-Dt]=he,kt[Mt-1-Dt]=le}}(Bt,bt),st.push(Bt)}const Je={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $e{constructor(G,Y){const Q=(Y=this.options=function(bt,It){for(const Bt in It)bt[Bt]=It[Bt];return bt}(Object.create(Je),Y)).debug;if(Q&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let dt=function(bt,It){const Bt=[];if(bt.type==="FeatureCollection")for(let kt=0;kt<bt.features.length;kt++)ii(Bt,bt.features[kt],It,kt);else ii(Bt,bt.type==="Feature"?bt:{geometry:bt},It);return Bt}(G,Y);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),dt=function(bt,It){const Bt=It.buffer/It.extent;let kt=bt;const Zt=N(bt,1,-1-Bt,Bt,0,-1,2,It),$t=N(bt,1,1-Bt,2+Bt,0,-1,2,It);return(Zt||$t)&&(kt=N(bt,1,-Bt,1+Bt,0,-1,2,It)||[],Zt&&(kt=jt(Zt,1).concat(kt)),$t&&(kt=kt.concat(jt($t,-1)))),kt}(dt,Y),dt.length&&this.splitTile(dt,0,0,0),Q&&(dt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,Y,Q,dt,bt,It,Bt){const kt=[G,Y,Q,dt],Zt=this.options,$t=Zt.debug;for(;kt.length;){dt=kt.pop(),Q=kt.pop(),Y=kt.pop(),G=kt.pop();const Dt=1<<Y,Mt=_i(Y,Q,dt);let he=this.tiles[Mt];if(!he&&($t>1&&console.time("creation"),he=this.tiles[Mt]=ve(G,Y,Q,dt,Zt),this.tileCoords.push({z:Y,x:Q,y:dt}),$t)){$t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,Q,dt,he.numFeatures,he.numPoints,he.numSimplified),console.timeEnd("creation"));const Wi=`z${Y}`;this.stats[Wi]=(this.stats[Wi]||0)+1,this.total++}if(he.source=G,bt==null){if(Y===Zt.indexMaxZoom||he.numPoints<=Zt.indexMaxPoints)continue}else{if(Y===Zt.maxZoom||Y===bt)continue;if(bt!=null){const Wi=bt-Y;if(Q!==It>>Wi||dt!==Bt>>Wi)continue}}if(he.source=null,G.length===0)continue;$t>1&&console.time("clipping");const le=.5*Zt.buffer/Zt.extent,Ee=.5-le,Be=.5+le,Xt=1+le;let de=null,Se=null,We=null,ni=null,Le=N(G,Dt,Q-le,Q+Be,0,he.minX,he.maxX,Zt),ye=N(G,Dt,Q+Ee,Q+Xt,0,he.minX,he.maxX,Zt);G=null,Le&&(de=N(Le,Dt,dt-le,dt+Be,1,he.minY,he.maxY,Zt),Se=N(Le,Dt,dt+Ee,dt+Xt,1,he.minY,he.maxY,Zt),Le=null),ye&&(We=N(ye,Dt,dt-le,dt+Be,1,he.minY,he.maxY,Zt),ni=N(ye,Dt,dt+Ee,dt+Xt,1,he.minY,he.maxY,Zt),ye=null),$t>1&&console.timeEnd("clipping"),kt.push(de||[],Y+1,2*Q,2*dt),kt.push(Se||[],Y+1,2*Q,2*dt+1),kt.push(We||[],Y+1,2*Q+1,2*dt),kt.push(ni||[],Y+1,2*Q+1,2*dt+1)}}getTile(G,Y,Q){G=+G,Y=+Y,Q=+Q;const dt=this.options,{extent:bt,debug:It}=dt;if(G<0||G>24)return null;const Bt=1<<G,kt=_i(G,Y=Y+Bt&Bt-1,Q);if(this.tiles[kt])return se(this.tiles[kt],bt);It>1&&console.log("drilling down to z%d-%d-%d",G,Y,Q);let Zt,$t=G,Dt=Y,Mt=Q;for(;!Zt&&$t>0;)$t--,Dt>>=1,Mt>>=1,Zt=this.tiles[_i($t,Dt,Mt)];return Zt&&Zt.source?(It>1&&(console.log("found parent tile z%d-%d-%d",$t,Dt,Mt),console.time("drilling down")),this.splitTile(Zt.source,$t,Dt,Mt,G,Y,Q),It>1&&console.timeEnd("drilling down"),this.tiles[kt]?se(this.tiles[kt],bt):null):null}}function _i(st,G,Y){return 32*((1<<st)*Y+G)+st}function fi(st,G){return G?st.properties[G]:st.id}function ns(st,G){if(st==null)return!0;if(st.type==="Feature")return fi(st,G)!=null;if(st.type==="FeatureCollection"){const Y=new Set;for(const Q of st.features){const dt=fi(Q,G);if(dt==null||Y.has(dt))return!1;Y.add(dt)}return!0}return!1}function Qi(st,G){const Y=new Map;if(st!=null)if(st.type==="Feature")Y.set(fi(st,G),st);else for(const Q of st.features)Y.set(fi(Q,G),Q);return Y}class Js extends E{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(G,Y){return f._(this,void 0,void 0,function*(){const Q=G.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const dt=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!dt)return null;const bt=new Lt(dt.features);let It=be(bt);return It.byteOffset===0&&It.byteLength===It.buffer.byteLength||(It=new Uint8Array(It)),{vectorTile:bt,rawData:It.buffer}})}loadData(G){return f._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const Q=!!(G&&G.request&&G.request.collectResourceTiming)&&new f.cu(G.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(G,this._pendingRequest),this._geoJSONIndex=G.cluster?new xe(function({superclusterOptions:It,clusterProperties:Bt}){if(!Bt||!It)return It;const kt={},Zt={},$t={accumulated:null,zoom:0},Dt={properties:null},Mt=Object.keys(Bt);for(const he of Mt){const[le,Ee]=Bt[he],Be=f.cB(Ee),Xt=f.cB(typeof le=="string"?[le,["accumulated"],["get",he]]:le);kt[he]=Be.value,Zt[he]=Xt.value}return It.map=he=>{Dt.properties=he;const le={};for(const Ee of Mt)le[Ee]=kt[Ee].evaluate($t,Dt);return le},It.reduce=(he,le)=>{Dt.properties=le;for(const Ee of Mt)$t.accumulated=he[Ee],he[Ee]=Zt[Ee].evaluate($t,Dt)},It}(G)).load((yield this._pendingData).features):(dt=yield this._pendingData,new $e(dt,G.geojsonVtOptions)),this.loaded={};const bt={};if(Q){const It=Q.finish();It&&(bt.resourceTiming={},bt.resourceTiming[G.source]=JSON.parse(JSON.stringify(It)))}return bt}catch(bt){if(delete this._pendingRequest,f.cf(bt))return{abandoned:!0};throw bt}var dt})}getData(){return f._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(G){const Y=this.loaded;return Y&&Y[G.uid]?super.reloadTile(G):this.loadTile(G)}loadAndProcessGeoJSON(G,Y){return f._(this,void 0,void 0,function*(){let Q=yield this.loadGeoJSON(G,Y);if(delete this._pendingRequest,typeof Q!="object")throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);if(mt(Q,!0),G.filter){const dt=f.cB(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(dt.result==="error")throw new Error(dt.value.map(It=>`${It.key}: ${It.message}`).join(", "));Q={type:"FeatureCollection",features:Q.features.filter(It=>dt.value.evaluate({zoom:0},It))}}return Q})}loadGeoJSON(G,Y){return f._(this,void 0,void 0,function*(){const{promoteId:Q}=G;if(G.request){const dt=yield f.h(G.request,Y);return this._dataUpdateable=ns(dt.data,Q)?Qi(dt.data,Q):void 0,dt.data}if(typeof G.data=="string")try{const dt=JSON.parse(G.data);return this._dataUpdateable=ns(dt,Q)?Qi(dt,Q):void 0,dt}catch{throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`)}if(!G.dataDiff)throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${G.source}`);return function(dt,bt,It){var Bt,kt,Zt,$t;if(bt.removeAll&&dt.clear(),bt.remove)for(const Dt of bt.remove)dt.delete(Dt);if(bt.add)for(const Dt of bt.add){const Mt=fi(Dt,It);Mt!=null&&dt.set(Mt,Dt)}if(bt.update)for(const Dt of bt.update){let Mt=dt.get(Dt.id);if(Mt==null)continue;const he=!Dt.removeAllProperties&&(((Bt=Dt.removeProperties)===null||Bt===void 0?void 0:Bt.length)>0||((kt=Dt.addOrUpdateProperties)===null||kt===void 0?void 0:kt.length)>0);if((Dt.newGeometry||Dt.removeAllProperties||he)&&(Mt=Object.assign({},Mt),dt.set(Dt.id,Mt),he&&(Mt.properties=Object.assign({},Mt.properties))),Dt.newGeometry&&(Mt.geometry=Dt.newGeometry),Dt.removeAllProperties)Mt.properties={};else if(((Zt=Dt.removeProperties)===null||Zt===void 0?void 0:Zt.length)>0)for(const le of Dt.removeProperties)Object.prototype.hasOwnProperty.call(Mt.properties,le)&&delete Mt.properties[le];if((($t=Dt.addOrUpdateProperties)===null||$t===void 0?void 0:$t.length)>0)for(const{key:le,value:Ee}of Dt.addOrUpdateProperties)Mt.properties[le]=Ee}}(this._dataUpdateable,G.dataDiff,Q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(G){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(G){return this._geoJSONIndex.getClusterExpansionZoom(G.clusterId)}getClusterChildren(G){return this._geoJSONIndex.getChildren(G.clusterId)}getClusterLeaves(G){return this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset)}}class Qs{constructor(G){this.self=G,this.actor=new f.F(G),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,Q)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=Q},this.self.addProtocol=f.ch,this.self.removeProtocol=f.ci,this.self.registerRTLTextPlugin=Y=>{f.cC.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,Q)=>this._getDEMWorkerSource(Y,Q.source).loadTile(Q)),this.actor.registerMessageHandler("RDT",(Y,Q)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,Q.source).removeTile(Q)})),this.actor.registerMessageHandler("GCEZ",(Y,Q)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,Q.type,Q.source).getClusterExpansionZoom(Q)})),this.actor.registerMessageHandler("GCC",(Y,Q)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,Q.type,Q.source).getClusterChildren(Q)})),this.actor.registerMessageHandler("GCL",(Y,Q)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,Q.type,Q.source).getClusterLeaves(Q)})),this.actor.registerMessageHandler("LD",(Y,Q)=>this._getWorkerSource(Y,Q.type,Q.source).loadData(Q)),this.actor.registerMessageHandler("GD",(Y,Q)=>this._getWorkerSource(Y,Q.type,Q.source).getData()),this.actor.registerMessageHandler("LT",(Y,Q)=>this._getWorkerSource(Y,Q.type,Q.source).loadTile(Q)),this.actor.registerMessageHandler("RT",(Y,Q)=>this._getWorkerSource(Y,Q.type,Q.source).reloadTile(Q)),this.actor.registerMessageHandler("AT",(Y,Q)=>this._getWorkerSource(Y,Q.type,Q.source).abortTile(Q)),this.actor.registerMessageHandler("RMT",(Y,Q)=>this._getWorkerSource(Y,Q.type,Q.source).removeTile(Q)),this.actor.registerMessageHandler("RS",(Y,Q)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][Q.type]||!this.workerSources[Y][Q.type][Q.source])return;const dt=this.workerSources[Y][Q.type][Q.source];delete this.workerSources[Y][Q.type][Q.source],dt.removeSource!==void 0&&dt.removeSource(Q)})),this.actor.registerMessageHandler("RM",Y=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})),this.actor.registerMessageHandler("SR",(Y,Q)=>f._(this,void 0,void 0,function*(){this.referrer=Q})),this.actor.registerMessageHandler("SRPS",(Y,Q)=>this._syncRTLPluginState(Y,Q)),this.actor.registerMessageHandler("IS",(Y,Q)=>f._(this,void 0,void 0,function*(){this.self.importScripts(Q)})),this.actor.registerMessageHandler("SI",(Y,Q)=>this._setImages(Y,Q)),this.actor.registerMessageHandler("UL",(Y,Q)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(Q.layers,Q.removedIds)})),this.actor.registerMessageHandler("SL",(Y,Q)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(Q)}))}_setImages(G,Y){return f._(this,void 0,void 0,function*(){this.availableImages[G]=Y;for(const Q in this.workerSources[G]){const dt=this.workerSources[G][Q];for(const bt in dt)dt[bt].availableImages=Y}})}_syncRTLPluginState(G,Y){return f._(this,void 0,void 0,function*(){return yield f.cC.syncState(Y,this.self.importScripts)})}_getAvailableImages(G){let Y=this.availableImages[G];return Y||(Y=[]),Y}_getLayerIndex(G){let Y=this.layerIndexes[G];return Y||(Y=this.layerIndexes[G]=new a),Y}_getWorkerSource(G,Y,Q){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][Y]||(this.workerSources[G][Y]={}),!this.workerSources[G][Y][Q]){const dt={sendAsync:(bt,It)=>(bt.targetMapId=G,this.actor.sendAsync(bt,It))};switch(Y){case"vector":this.workerSources[G][Y][Q]=new E(dt,this._getLayerIndex(G),this._getAvailableImages(G));break;case"geojson":this.workerSources[G][Y][Q]=new Js(dt,this._getLayerIndex(G),this._getAvailableImages(G));break;default:this.workerSources[G][Y][Q]=new this.externalWorkerSourceTypes[Y](dt,this._getLayerIndex(G),this._getAvailableImages(G))}}return this.workerSources[G][Y][Q]}_getDEMWorkerSource(G,Y){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][Y]||(this.demWorkerSources[G][Y]=new F),this.demWorkerSources[G][Y]}}return f.i(self)&&(self.worker=new Qs(self)),Qs}),h("index",["exports","./shared"],function(f,a){var w="5.1.0";function P(){var _=new a.A(4);return a.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}let k,E;const F={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_,t,r){const d=requestAnimationFrame(t);_.signal.addEventListener("abort",()=>{cancelAnimationFrame(d),r(a.c())})},frameAsync(_){return new Promise((t,r)=>{this.frame(_,t,r)})},getImageData(_,t=0){return this.getImageCanvasContext(_).getImageData(-t,-t,_.width+2*t,_.height+2*t)},getImageCanvasContext(_){const t=window.document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return t.width=_.width,t.height=_.height,r.drawImage(_,0,0,_.width,_.height),r},resolveURL:_=>(k||(k=document.createElement("a")),k.href=_,k.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(E==null&&(E=matchMedia("(prefers-reduced-motion: reduce)")),E.matches)}};class R{static testProp(t){if(!R.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in R.docStyle)return t[r];return t[0]}static create(t,r,d){const m=window.document.createElement(t);return r!==void 0&&(m.className=r),d&&d.appendChild(m),m}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(t,r){t.style[R.transformProp]=r}static addEventListener(t,r,d,m={}){t.addEventListener(r,d,"passive"in m?m:m.capture)}static removeEventListener(t,r,d,m={}){t.removeEventListener(r,d,"passive"in m?m:m.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static getScale(t){const r=t.getBoundingClientRect();return{x:r.width/t.offsetWidth||1,y:r.height/t.offsetHeight||1,boundingClientRect:r}}static getPoint(t,r,d){const m=r.boundingClientRect;return new a.P((d.clientX-m.left)/r.x-t.clientLeft,(d.clientY-m.top)/r.y-t.clientTop)}static mousePos(t,r){const d=R.getScale(t);return R.getPoint(t,d,r)}static touchPos(t,r){const d=[],m=R.getScale(t);for(let y=0;y<r.length;y++)d.push(R.getPoint(t,m,r[y]));return d}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const r=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),d=r.querySelectorAll("script");for(const m of d)m.remove();return R.clean(r),r.innerHTML}static isPossiblyDangerous(t,r){const d=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!d.includes("javascript:")&&!d.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const r=t.children;for(const d of r)R.removeAttributes(d),R.clean(d)}static removeAttributes(t){for(const{name:r,value:d}of t.attributes)R.isPossiblyDangerous(r,d)&&t.removeAttribute(r)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const J={supported:!1,testSupport:function(_){!xt&&mt&&(Ct?Lt(_):rt=_)}};let rt,mt,xt=!1,Ct=!1;function Lt(_){const t=_.createTexture();_.bindTexture(_.TEXTURE_2D,t);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,mt),_.isContextLost())return;J.supported=!0}catch{}_.deleteTexture(t),xt=!0}var At;typeof document<"u"&&(mt=document.createElement("img"),mt.onload=()=>{rt&&Lt(rt),rt=null,Ct=!0},mt.onerror=()=>{xt=!0,rt=null},mt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let t,r,d,m;_.resetRequestQueue=()=>{t=[],r=0,d=0,m={}},_.addThrottleControl=C=>{const D=d++;return m[D]=C,D},_.removeThrottleControl=C=>{delete m[C],v()},_.getImage=(C,D,L=!0)=>new Promise((B,V)=>{J.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),a.e(C,{type:"image"}),t.push({abortController:D,requestParameters:C,supportImageRefresh:L,state:"queued",onError:Z=>{V(Z)},onSuccess:Z=>{B(Z)}}),v()});const y=C=>a._(this,void 0,void 0,function*(){C.state="running";const{requestParameters:D,supportImageRefresh:L,onError:B,onSuccess:V,abortController:Z}=C,W=L===!1&&!a.i(self)&&!a.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((lt,ut)=>lt&&ut==="accept",!0));r++;const at=W?T(D,Z):a.m(D,Z);try{const lt=yield at;delete C.abortController,C.state="completed",lt.data instanceof HTMLImageElement||a.b(lt.data)?V(lt):lt.data&&V({data:yield(ot=lt.data,typeof createImageBitmap=="function"?a.d(ot):a.f(ot)),cacheControl:lt.cacheControl,expires:lt.expires})}catch(lt){delete C.abortController,B(lt)}finally{r--,v()}var ot}),v=()=>{const C=(()=>{for(const D of Object.keys(m))if(m[D]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=r;D<C&&t.length>0;D++){const L=t.shift();L.abortController.signal.aborted?D--:y(L)}},T=(C,D)=>new Promise((L,B)=>{const V=new Image,Z=C.url,W=C.credentials;W&&W==="include"?V.crossOrigin="use-credentials":(W&&W==="same-origin"||!a.s(Z))&&(V.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{V.src="",B(a.c())}),V.fetchPriority="high",V.onload=()=>{V.onerror=V.onload=null,L({data:V})},V.onerror=()=>{V.onerror=V.onload=null,D.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},V.src=Z})}(At||(At={})),At.resetRequestQueue();class Vt{constructor(t){this._transformRequestFn=t}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Yt(_){const t=[];if(typeof _=="string")t.push({id:"default",url:_});else if(_&&_.length>0){const r=[];for(const{id:d,url:m}of _){const y=`${d}${m}`;r.indexOf(y)===-1&&(r.push(y),t.push({id:d,url:m}))}}return t}function Gt(_,t,r){try{const d=new URL(_);return d.pathname+=`${t}${r}`,d.toString()}catch{throw new Error(`Invalid sprite URL "${_}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class ie{constructor(t,r,d,m){this.context=t,this.format=d,this.texture=t.gl.createTexture(),this.update(r,m)}update(t,r,d){const{width:m,height:y}=t,v=!(this.size&&this.size[0]===m&&this.size[1]===y||d),{context:T}=this,{gl:C}=T;if(this.useMipmap=!!(r&&r.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!r||r.premultiply!==!1)),v)this.size=[m,y],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.b(t)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,t):C.texImage2D(C.TEXTURE_2D,0,this.format,m,y,0,this.format,C.UNSIGNED_BYTE,t.data);else{const{x:D,y:L}=d||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.b(t)?C.texSubImage2D(C.TEXTURE_2D,0,D,L,C.RGBA,C.UNSIGNED_BYTE,t):C.texSubImage2D(C.TEXTURE_2D,0,D,L,m,y,C.RGBA,C.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(t,r,d){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),d!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=y.LINEAR),t!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,t),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,d||t),this.filter=t),r!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function be(_){const{userImage:t}=_;return!!(t&&t.render&&t.render())&&(_.data.replace(new Uint8Array(t.data.buffer)),!0)}class ze extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,promiseResolve:d}of this.requestors)d(this._getImagesForIds(r));this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const d=r.spriteData;r.data=new a.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let d=!0;const m=r.data||r.spriteData;return this._validateStretch(r.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(r.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(r.content,r)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,r){if(!t)return!0;let d=0;for(const m of t){if(m[0]<d||m[1]<m[0]||r<m[1])return!1;d=m[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const d=r.spriteData,m=d&&d.width||r.data.width,y=d&&d.height||r.data.height;return!(t[0]<0||m<t[0]||t[1]<0||y<t[1]||t[2]<0||m<t[2]||t[3]<0||y<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,d=!0){const m=this.getImage(t);if(d&&(m.data.width!==r.data.width||m.data.height!==r.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=m.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((r,d)=>{let m=!0;if(!this.isLoaded())for(const y of t)this.images[y]||(m=!1);this.isLoaded()||m?r(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:r})})}_getImagesForIds(t){const r={};for(const d of t){let m=this.getImage(d);m||(this.fire(new a.k("styleimagemissing",{id:d})),m=this.getImage(d)),m?r[d]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],d=this.getImage(t);if(!d)return null;if(r&&r.position.version===d.version)return r.position;if(r)r.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},y=new a.I(m,d);this.patterns[t]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ie(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const y in this.patterns)t.push(this.patterns[y].bin);const{w:r,h:d}=a.p(t),m=this.atlasImage;m.resize({width:r||1,height:d||1});for(const y in this.patterns){const{bin:v}=this.patterns[y],T=v.x+1,C=v.y+1,D=this.getImage(y).data,L=D.width,B=D.height;a.R.copy(D,m,{x:0,y:0},{x:T,y:C},{width:L,height:B}),a.R.copy(D,m,{x:0,y:B-1},{x:T,y:C-1},{width:L,height:1}),a.R.copy(D,m,{x:0,y:0},{x:T,y:C+B},{width:L,height:1}),a.R.copy(D,m,{x:L-1,y:0},{x:T-1,y:C},{width:1,height:B}),a.R.copy(D,m,{x:0,y:0},{x:T+L,y:C},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const d=this.getImage(r);d||a.w(`Image with ID: "${r}" was not found`),be(d)&&this.updateImage(r,d)}}}const Me=1e20;function Fe(_,t,r,d,m,y,v,T,C){for(let D=t;D<t+d;D++)Ve(_,r*y+D,y,m,v,T,C);for(let D=r;D<r+m;D++)Ve(_,D*y+t,1,d,v,T,C)}function Ve(_,t,r,d,m,y,v){y[0]=0,v[0]=-1e20,v[1]=Me,m[0]=_[t];for(let T=1,C=0,D=0;T<d;T++){m[T]=_[t+T*r];const L=T*T;do{const B=y[C];D=(m[T]-m[B]+L-B*B)/(T-B)/2}while(D<=v[C]&&--C>-1);C++,y[C]=T,v[C]=D,v[C+1]=Me}for(let T=0,C=0;T<d;T++){for(;v[C+1]<T;)C++;const D=y[C],L=T-D;_[t+T*r]=m[D]+L*L}}class He{constructor(t,r){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return a._(this,void 0,void 0,function*(){const r=[];for(const y in t)for(const v of t[y])r.push(this._getAndCacheGlyphsPromise(y,v));const d=yield Promise.all(r),m={};for(const{stack:y,id:v,glyph:T}of d)m[y]||(m[y]={}),m[y][v]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return m})}_getAndCacheGlyphsPromise(t,r){return a._(this,void 0,void 0,function*(){let d=this.entries[t];d||(d=this.entries[t]={glyphs:{},requests:{},ranges:{}});let m=d.glyphs[r];if(m!==void 0)return{stack:t,id:r,glyph:m};if(m=this._tinySDF(d,t,r),m)return d.glyphs[r]=m,{stack:t,id:r,glyph:m};const y=Math.floor(r/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[y])return{stack:t,id:r,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[y]){const T=He.loadGlyphRange(t,y,this.url,this.requestManager);d.requests[y]=T}const v=yield d.requests[y];for(const T in v)this._doesCharSupportLocalGlyph(+T)||(d.glyphs[+T]=v[+T]);return d.ranges[y]=!0,{stack:t,id:r,glyph:v[r]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))}_tinySDF(t,r,d){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let y=t.tinySDF;if(!y){let T="400";/bold/i.test(r)?T="900":/medium/i.test(r)?T="500":/light/i.test(r)&&(T="200"),y=t.tinySDF=new He.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:T})}const v=y.draw(String.fromCharCode(d));return{id:d,bitmap:new a.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}He.loadGlyphRange=function(_,t,r,d){return a._(this,void 0,void 0,function*(){const m=256*t,y=m+255,v=d.transformRequest(r.replace("{fontstack}",_).replace("{range}",`${m}-${y}`),"Glyphs"),T=yield a.l(v,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${t}, ${m}-${y}`);const C={};for(const D of a.n(T.data))C[D.id]=D;return C})},He.TinySDF=class{constructor({fontSize:_=24,buffer:t=3,radius:r=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=d,this.radius=r;const T=this.size=_+4*t,C=this._createCanvas(T),D=this.ctx=C.getContext("2d",{willReadFrequently:!0});D.font=`${v} ${y} ${_}px ${m}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(_){const t=document.createElement("canvas");return t.width=t.height=_,t}draw(_){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(_),v=Math.ceil(r),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),C=Math.min(this.size-this.buffer,v+Math.ceil(d)),D=T+2*this.buffer,L=C+2*this.buffer,B=Math.max(D*L,0),V=new Uint8ClampedArray(B),Z={data:V,width:D,height:L,glyphWidth:T,glyphHeight:C,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(T===0||C===0)return Z;const{ctx:W,buffer:at,gridInner:ot,gridOuter:lt}=this;W.clearRect(at,at,T,C),W.fillText(_,at,at+v);const ut=W.getImageData(at,at,T,C);lt.fill(Me,0,B),ot.fill(0,0,B);for(let gt=0;gt<C;gt++)for(let _t=0;_t<T;_t++){const yt=ut.data[4*(gt*T+_t)+3]/255;if(yt===0)continue;const wt=(gt+at)*D+_t+at;if(yt===1)lt[wt]=0,ot[wt]=Me;else{const vt=.5-yt;lt[wt]=vt>0?vt*vt:0,ot[wt]=vt<0?vt*vt:0}}Fe(lt,0,0,D,L,D,this.f,this.v,this.z),Fe(ot,at,at,T,C,D,this.f,this.v,this.z);for(let gt=0;gt<B;gt++){const _t=Math.sqrt(lt[gt])-Math.sqrt(ot[gt]);V[gt]=Math.round(255-255*(_t/this.radius+this.cutoff))}return Z}};class je{constructor(){this.specification=a.v.light.position}possiblyEvaluate(t,r){return a.x(t.expression.evaluate(r))}interpolate(t,r,d){return{x:a.y.number(t.x,r.x,d),y:a.y.number(t.y,r.y,d),z:a.y.number(t.z,r.z,d)}}}let xe;class De extends a.E{constructor(t){super(),xe=xe||new a.q({anchor:new a.D(a.v.light.anchor),position:new je,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(xe),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(a.r,t,r))for(const d in t){const m=t[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,d){return(!d||d.validate!==!1)&&a.t(this,t.call(a.u,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const Oe=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class qe extends a.E{constructor(t){super(),this._transitionable=new a.T(Oe),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(t,r={}){if(!this._validate(a.B,t,r)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const d in t){const m=t[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,d={}){return(d==null?void 0:d.validate)!==!1&&a.t(this,t.call(a.u,a.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class zi{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const d=t.join(",")+String(r);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(t,r)),this.dashEntry[d]}getDashRanges(t,r,d){const m=[];let y=t.length%2==1?-t[t.length-1]*d:0,v=t[0]*d,T=!0;m.push({left:y,right:v,isDash:T,zeroLength:t[0]===0});let C=t[0];for(let D=1;D<t.length;D++){T=!T;const L=t[D];y=C*d,C+=L,v=C*d,m.push({left:y,right:v,isDash:T,zeroLength:L===0})}return m}addRoundDash(t,r,d){const m=r/2;for(let y=-d;y<=d;y++){const v=this.width*(this.nextRow+d+y);let T=0,C=t[T];for(let D=0;D<this.width;D++){D/C.right>1&&(C=t[++T]);const L=Math.abs(D-C.left),B=Math.abs(D-C.right),V=Math.min(L,B);let Z;const W=y/d*(m+1);if(C.isDash){const at=m-Math.abs(W);Z=Math.sqrt(V*V+at*at)}else Z=m-Math.sqrt(V*V+W*W);this.data[v+D]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(t){for(let T=t.length-1;T>=0;--T){const C=t[T],D=t[T+1];C.zeroLength?t.splice(T,1):D&&D.isDash===C.isDash&&(D.left=C.left,t.splice(T,1))}const r=t[0],d=t[t.length-1];r.isDash===d.isDash&&(r.left=d.left-this.width,d.right=r.right+this.width);const m=this.width*this.nextRow;let y=0,v=t[y];for(let T=0;T<this.width;T++){T/v.right>1&&(v=t[++y]);const C=Math.abs(T-v.left),D=Math.abs(T-v.right),L=Math.min(C,D);this.data[m+T]=Math.max(0,Math.min(255,(v.isDash?L:-L)+128))}}addDash(t,r){const d=r?7:0,m=2*d+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let y=0;for(let T=0;T<t.length;T++)y+=t[T];if(y!==0){const T=this.width/y,C=this.getDashRanges(t,this.width,T);r?this.addRoundDash(C,T,d):this.addRegularDash(C)}const v={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:y};return this.nextRow+=m,this.dirty=!0,v}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const mi="maplibre_preloaded_worker_pool";class ci{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ci.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mi]}numActive(){return Object.keys(this.active).length}}const Ii=Math.floor(F.hardwareConcurrency/2);let Ce,ai;function ii(){return Ce||(Ce=new ci),Ce}ci.workerCount=a.C(globalThis)?Math.max(Math.min(Ii,3),1):1;class Jt{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=r;const d=this.workerPool.acquire(r);for(let m=0;m<d.length;m++){const y=new a.F(d[m],r);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r){const d=[];for(const m of this.actors)d.push(m.sendAsync({type:t,data:r}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,r){for(const d of this.actors)d.registerMessageHandler(t,r)}}function me(){return ai||(ai=new Jt(ii(),a.G),ai.registerMessageHandler("GR",(_,t,r)=>a.m(t,r))),ai}function ue(_,t){const r=a.H();return a.J(r,r,[1,1,0]),a.K(r,r,[.5*_.width,.5*_.height,1]),_.calculatePosMatrix?a.L(r,r,_.calculatePosMatrix(t.toUnwrapped())):r}function Pt(_,t,r,d,m,y){var v;const T=function(B,V,Z){if(B)for(const W of B){const at=V[W];if(at&&at.source===Z&&at.type==="fill-extrusion")return!0}else for(const W in V){const at=V[W];if(at.source===Z&&at.type==="fill-extrusion")return!0}return!1}((v=m==null?void 0:m.layers)!==null&&v!==void 0?v:null,t,_.id),C=y.maxPitchScaleFactor(),D=_.tilesIn(d,C,T);D.sort(X);const L=[];for(const B of D)L.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(t,r,_._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,m,y,C,ue(_.transform,B.tileID))});return function(B,V){for(const Z in B)for(const W of B[Z])N(W,V);return B}(function(B){const V={},Z={};for(const W of B){const at=W.queryResults,ot=W.wrappedTileID,lt=Z[ot]=Z[ot]||{};for(const ut in at){const gt=at[ut],_t=lt[ut]=lt[ut]||{},yt=V[ut]=V[ut]||[];for(const wt of gt)_t[wt.featureIndex]||(_t[wt.featureIndex]=!0,yt.push(wt))}}return V}(L),_)}function X(_,t){const r=_.tileID,d=t.tileID;return r.overscaledZ-d.overscaledZ||r.canonical.y-d.canonical.y||r.wrap-d.wrap||r.canonical.x-d.canonical.x}function N(_,t){const r=_.feature,d=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=d}function O(_,t,r){return a._(this,void 0,void 0,function*(){let d=_;if(_.url?d=(yield a.h(t.transformRequest(_.url,"Source"),r)).data:yield F.frameAsync(r),!d)return null;const m=a.M(a.e(d,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(m.vectorLayerIds=d.vector_layers.map(y=>y.id)),m})}class K{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof a.N?new a.N(t.lng,t.lat):a.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof a.N?new a.N(t.lng,t.lat):a.N.convert(t),this}extend(t){const r=this._sw,d=this._ne;let m,y;if(t instanceof a.N)m=t,y=t;else{if(!(t instanceof K))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(K.convert(t)):this.extend(a.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(a.N.convert(t)):this;if(m=t._sw,y=t._ne,!m||!y)return this}return r||d?(r.lng=Math.min(m.lng,r.lng),r.lat=Math.min(m.lat,r.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new a.N(m.lng,m.lat),this._ne=new a.N(y.lng,y.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:d}=a.N.convert(t);let m=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(t){return t instanceof K?t:t&&new K(t)}static fromLngLat(t,r=0){const d=360*r/40075017,m=d/Math.cos(Math.PI/180*t.lat);return new K(new a.N(t.lng-m,t.lat-d),new a.N(t.lng+m,t.lat+d))}adjustAntiMeridian(){const t=new a.N(this._sw.lng,this._sw.lat),r=new a.N(this._ne.lng,this._ne.lat);return new K(t,t.lng>r.lng?new a.N(r.lng+360,r.lat):r)}}class nt{constructor(t,r,d){this.bounds=K.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),d=Math.floor(a.O(this.bounds.getWest())*r),m=Math.floor(a.Q(this.bounds.getNorth())*r),y=Math.ceil(a.O(this.bounds.getEast())*r),v=Math.ceil(a.Q(this.bounds.getSouth())*r);return t.x>=d&&t.x<y&&t.y>=m&&t.y<v}}class et extends a.E{constructor(t,r,d,m){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(r,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield O(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(a.e(this,t),t.bounds&&(this.tileBounds=new nt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new a.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(t){return a._(this,void 0,void 0,function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(r,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};d.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((y,v)=>{t.reloadPromise={resolve:y,reject:v}})}else t.actor=this.dispatcher.getActor(),m="LT";t.abortController=new AbortController;try{const y=yield t.actor.sendAsync({type:m,data:d},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,y)}catch(y){if(delete t.abortController,t.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,r){if(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),t.reloadPromise){const d=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(d.resolve).catch(d.reject)}}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ht extends a.E{constructor(t,r,d,m){super(),this.id=t,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},r),a.e(this,a.M(r,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield O(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(a.e(this,r),r.bounds&&(this.tileBounds=new nt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(r){this._tileJSONRequest=null,this.fire(new a.j(r))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return a.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return a._(this,void 0,void 0,function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const d=yield At.getImage(this.map._requestManager.transformRequest(r,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&t.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const m=this.map.painter.context,y=m.gl,v=d.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new ie(m,v,y.RGBA,{useMipmap:!0}),t.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(d){if(delete t.abortController,t.aborted)t.state="unloaded";else if(d)throw t.state="errored",d}})}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Tt extends ht{constructor(t,r,d,m){super(t,r,d,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(t){return a._(this,void 0,void 0,function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(r,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const m=yield At.getImage(d,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(m&&m.data){const y=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&t.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const v=a.b(y)&&a.U()?y:yield this.readImageNow(y),T={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const C=yield t.actor.sendAsync({type:"LDT",data:T});t.dem=C,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(m){if(delete t.abortController,t.aborted)t.state="unloaded";else if(m)throw t.state="errored",m}})}readImageNow(t){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const r=t.width+2,d=t.height+2;try{return new a.R({width:r,height:d},yield a.W(t,-1,-1,r,d))}catch{}}return F.getImageData(t,1)})}_getNeighboringTiles(t){const r=t.canonical,d=Math.pow(2,r.z),m=(r.x-1+d)%d,y=r.x===0?t.wrap-1:t.wrap,v=(r.x+1+d)%d,T=r.x+1===d?t.wrap+1:t.wrap,C={};return C[new a.S(t.overscaledZ,y,r.z,m,r.y).key]={backfilled:!1},C[new a.S(t.overscaledZ,T,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(C[new a.S(t.overscaledZ,y,r.z,m,r.y-1).key]={backfilled:!1},C[new a.S(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},C[new a.S(t.overscaledZ,T,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<d&&(C[new a.S(t.overscaledZ,y,r.z,m,r.y+1).key]={backfilled:!1},C[new a.S(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},C[new a.S(t.overscaledZ,T,r.z,v,r.y+1).key]={backfilled:!1}),C}unloadTile(t){return a._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Et extends a.E{constructor(t,r,d,m){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(m),this._data=r.data,this._options=a.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:a.X,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:a.X,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(a.X/this.tileSize)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return a._(this,void 0,void 0,function*(){const t=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,r,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:r,offset:d}})}_updateWorkerData(t){return a._(this,void 0,void 0,function*(){const r=a.e({type:this.type},this.workerOptions);t?r.dataDiff=t:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(F.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||d.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;d.resourceTiming&&d.resourceTiming[this.id]&&(m=d.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(y,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(d){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(d))}})}loaded(){return this._pendingLoads===0}loadTile(t){return a._(this,void 0,void 0,function*(){const r=t.actor?"RT":"LT";t.actor=this.actor;const d={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const m=yield this.actor.sendAsync({type:r,data:d},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(m,this.map.painter,r==="RT")})}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class jt extends a.E{constructor(t,r,d,m){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=d,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=r}load(t){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield At.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,t&&(this.coordinates=t),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new a.j(r))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(a.Y.fromLngLat);var d;return this.tileID=function(m){let y=1/0,v=1/0,T=-1/0,C=-1/0;for(const V of m)y=Math.min(y,V.x),v=Math.min(v,V.y),T=Math.max(T,V.x),C=Math.max(C,V.y);const D=Math.max(T-y,C-v),L=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),B=Math.pow(2,L);return new a.Z(L,Math.floor((y+T)/2*B),Math.floor((v+C)/2*B))}(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(m=>this.tileID.getTilePoint(m)._round()),this.flippedWindingOrder=((d=this.tileCoords)[1].x-d[0].x)*(d[2].y-d[0].y)-(d[1].y-d[0].y)*(d[2].x-d[0].x)<0,this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,r=t.gl;this.texture||(this.texture=new ie(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,d=!0)}d&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ft extends jt{constructor(t,r,d,m){super(t,r,d,m),this.roundZoom=!0,this.type="video",this.options=r}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield a.a0(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new a.j(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new a.j(new a.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new ie(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,d=!0)}d&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class se extends jt{constructor(t,r,d,m){super(t,r,d,m),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(v=>typeof v!="number"))||this.fire(new a.j(new a.$(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.$(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new a.j(new a.$(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.$(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.$(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,d=r.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ie(r,this.canvas,d.RGBA,{premultiply:!0});let m=!1;for(const y in this.tiles){const v=this.tiles[y];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const re={},ve=_=>{switch(_){case"geojson":return Et;case"image":return jt;case"raster":return ht;case"raster-dem":return Tt;case"vector":return et;case"video":return Ft;case"canvas":return se}return re[_]},Te="RTLPluginLoaded";class Ne extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=me()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return a._(this,arguments,void 0,function*(r,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=F.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(Te))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Je=null;function $e(){return Je||(Je=new Ne),Je}class _i{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=a.a1(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const r=t+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,y){const v={};if(!y)return v;for(const T of m){const C=T.layerIds.map(D=>y.getLayer(D)).filter(Boolean);if(C.length!==0){T.layers=C,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(D=>C.filter(L=>L.id===D)[0]));for(const D of C)v[D.id]=T}}return v}(t.buckets,r==null?void 0:r.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof a.a3){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof a.a3&&y.hasRTLText){this.hasRTLText=!0,$e().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(m).queryRadius(y))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.a2}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const d in this.buckets){const m=this.buckets[d];m.uploadPending()&&m.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ie(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ie(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,d,m,y,v,T,C,D,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:v,tileSize:this.tileSize,pixelPosMatrix:L,transform:C,params:T,queryPadding:this.queryPadding*D},t,r,d):{}}querySourceFeatures(t,r){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),y=r&&r.sourceLayer?r.sourceLayer:"",v=m._geojsonTileLayer||m[y];if(!v)return;const T=a.a4(r&&r.filter),{z:C,x:D,y:L}=this.tileID.canonical,B={z:C,x:D,y:L};for(let V=0;V<v.length;V++){const Z=v.feature(V);if(T.needGeometry){const ot=a.a5(Z,!0);if(!T.filter(new a.z(this.tileID.overscaledZ),ot,this.tileID.canonical))continue}else if(!T.filter(new a.z(this.tileID.overscaledZ),Z))continue;const W=d.getId(Z,y),at=new a.a6(Z,C,D,L,W);at.tile=B,t.push(at)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const d=a.a7(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(r)if(this.expirationTime<r)m=!0;else{const y=this.expirationTime-r;y?this.expirationTime=d+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!r.style.hasLayer(m))continue;const y=this.buckets[m],v=y.layers[0].sourceLayer||"_geojsonTileLayer",T=d[v],C=t[v];if(!T||!C||Object.keys(C).length===0)continue;y.update(C,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=r&&r.style&&r.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=F.now()+t}setDependencies(t,r){const d={};for(const m of r)d[m]=!0;this.dependencies[t]=d}hasDependency(t,r){for(const d of t){const m=this.dependencies[d];if(m){for(const y of r)if(m[y])return!0}}return!1}}class fi{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,d){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:r,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},d)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const d=t.wrapped().key,m=r===void 0?0:this.data[d].indexOf(r),y=this.data[d][m];return this.data[d].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const d in this.data)for(const m of this.data[d])t(m.value)||r.push(m);for(const d of r)this.remove(d.value.tileID,d)}}class ns{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,d){const m=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},a.e(this.stateChanges[t][m],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==m&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const y in this.state[t][m])d[y]||(this.deletedStates[t][m][y]=null)}else for(const y in d)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][y]===null&&delete this.deletedStates[t][m][y]}removeFeatureState(t,r,d){if(this.deletedStates[t]===null)return;const m=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&r!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][d]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(d in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][d]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,r){const d=String(r),m=a.e({},(this.state[t]||{})[d],(this.stateChanges[t]||{})[d]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const y=this.deletedStates[t][r];if(y===null)return{};for(const v in y)delete m[v]}return m}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const v in this.stateChanges[m])this.state[m][v]||(this.state[m][v]={}),a.e(this.state[m][v],this.stateChanges[m][v]),y[v]=this.state[m][v];d[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const v in this.state[m])y[v]={},this.state[m][v]={};else for(const v in this.deletedStates[m]){if(this.deletedStates[m][v]===null)this.state[m][v]={};else for(const T of Object.keys(this.deletedStates[m][v]))delete this.state[m][v][T];y[v]=this.state[m][v]}d[m]=d[m]||{},a.e(d[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in t)t[m].setFeatureState(d,r)}}function Qi(_,t,r){const d=t.intersectsFrustum(_);if(!r)return d;const m=t.intersectsPlane(r);return d===0||m===0?0:d===2&&m===2?2:1}function Js(_,t,r,d,m){let y=_;const v=Math.atan(t/r),T=Math.hypot(t,r);return y=_+a.a8(d/T/Math.max(.5,Math.cos(a.aa(m/2)))),y+=1*a.a8(Math.cos(v))/2,y+=a.ab(_-y,-0,0),y}function Qs(_,t){const r=(t.roundZoom?Math.round:Math.floor)(_.zoom+a.a8(_.tileSize/t.tileSize));return Math.max(0,r)}function st(_,t){const r=_.getCameraFrustum(),d=_.getClippingPlane(),m=_.screenPointToMercatorCoordinate(_.getCameraPoint()),y=a.Y.fromLngLat(_.center,_.elevation);m.z=y.z+Math.cos(_.pitchInRadians)*_.cameraToCenterDistance/_.worldSize;const v=_.getCoveringTilesDetailsProvider(),T=v.allowVariableZoom(_,t),C=Qs(_,t),D=t.minzoom||0,L=t.maxzoom!==void 0?t.maxzoom:_.maxZoom,B=Math.min(Math.max(0,C),L),V=Math.pow(2,B),Z=[V*m.x,V*m.y,0],W=[V*y.x,V*y.y,0],at=Math.hypot(y.x-m.x,y.y-m.y),ot=Math.abs(y.z-m.z),lt=Math.hypot(at,ot),ut=yt=>({zoom:0,x:0,y:0,wrap:yt,fullyVisible:!1}),gt=[],_t=[];if(_.renderWorldCopies&&v.allowWorldCopies())for(let yt=1;yt<=3;yt++)gt.push(ut(-yt)),gt.push(ut(yt));for(gt.push(ut(0));gt.length>0;){const yt=gt.pop(),wt=yt.x,vt=yt.y;let zt=yt.fullyVisible;const Ot={x:wt,y:vt,z:yt.zoom},qt=v.getTileAABB(Ot,yt.wrap,_.elevation,t);if(!zt){const ae=Qi(r,qt,d);if(ae===0)continue;zt=ae===2}const Kt=v.distanceToTile2d(m.x,m.y,Ot,qt);let Ut=C;T&&(Ut=(t.calculateTileZoom||Js)(_.zoom+a.a8(_.tileSize/t.tileSize),Kt,ot,lt,_.fov)),Ut=(t.roundZoom?Math.round:Math.floor)(Ut),Ut=Math.max(0,Ut);const ce=Math.min(Ut,L);if(yt.wrap=v.getWrap(y,Ot,yt.wrap),yt.zoom>=ce){if(yt.zoom<D)continue;const ae=B-yt.zoom,te=Z[0]-.5-(wt<<ae),pe=Z[1]-.5-(vt<<ae),Ge=t.reparseOverscaled?Math.max(yt.zoom,Ut):yt.zoom;_t.push({tileID:new a.S(yt.zoom===L?Ge:yt.zoom,yt.wrap,yt.zoom,wt,vt),distanceSq:a.a9([W[0]-.5-wt,W[1]-.5-vt]),tileDistanceToCamera:Math.sqrt(te*te+pe*pe)})}else for(let ae=0;ae<4;ae++)gt.push({zoom:yt.zoom+1,x:(wt<<1)+ae%2,y:(vt<<1)+(ae>>1),wrap:yt.wrap,fullyVisible:zt})}return _t.sort((yt,wt)=>yt.distanceSq-wt.distanceSq).map(yt=>yt.tileID)}class G extends a.E{constructor(t,r,d){super(),this.id=t,this.dispatcher=d,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,y,v,T)=>{const C=new(ve(y.type))(m,y,v,T);if(C.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${C.id}`);return C})(t,r,d,this),this._tiles={},this._cache=new fi(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ns,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r,d){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,r,d)}catch(m){t.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new a.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const d=this._tiles[r];d.upload(t),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Y).map(t=>t.key)}getRenderableIds(t){const r=[];for(const d in this._tiles)this._isIdRenderable(d,t)&&r.push(this._tiles[d]);return t?r.sort((d,m)=>{const y=d.tileID,v=m.tileID,T=new a.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians),C=new a.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians);return y.overscaledZ-v.overscaledZ||C.y-T.y||C.x-T.x}).map(d=>d.tileID.key):r.map(d=>d.tileID).sort(Y).map(d=>d.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)(t||this._tiles[r].state!=="errored")&&this._reloadTile(r,"reloading")}}_reloadTile(t,r){return a._(this,void 0,void 0,function*(){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=r),yield this._loadTile(d,t,r))})}_tileLoaded(t,r,d){t.timeAdded=F.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const r=this.getRenderableIds();for(let m=0;m<r.length;m++){const y=r[m];if(t.neighboringTiles&&t.neighboringTiles[y]){const v=this.getTileByID(y);d(t,v),d(v,t)}}function d(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let v=y.tileID.canonical.x-m.tileID.canonical.x;const T=y.tileID.canonical.y-m.tileID.canonical.y,C=Math.pow(2,m.tileID.canonical.z),D=y.tileID.key;v===0&&T===0||Math.abs(T)>1||(Math.abs(v)>1&&(Math.abs(v+C)===1?v+=C:Math.abs(v-C)===1&&(v-=C)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,v,T),m.neighboringTiles&&m.neighboringTiles[D]&&(m.neighboringTiles[D].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,d,m){for(const y in this._tiles){let v=this._tiles[y];if(m[y]||!v.hasData()||v.tileID.overscaledZ<=r||v.tileID.overscaledZ>d)continue;let T=v.tileID;for(;v&&v.tileID.overscaledZ>r+1;){const D=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[D.key],v&&v.hasData()&&(T=D)}let C=T;for(;C.overscaledZ>r;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]||t[C.canonical.key]){m[T.key]=T;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=r?d:null}for(let d=t.overscaledZ-1;d>=r;d--){const m=t.scaledTo(d),y=this._getLoadedTile(m);if(y)return y}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,d=Math.ceil(t.height/this._source.tileSize)+1,m=Math.floor(r*d*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const d={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+r),d[y.tileID.key]=y}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(t,r,d,m,y,v){const T={},C={},D=Object.keys(t),L=F.now();for(const B of D){const V=t[B],Z=this._tiles[B];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=L)continue;const W=this.findLoadedParent(V,r),at=this.findLoadedSibling(V),ot=W||at||null;ot&&(this._addTile(ot.tileID),T[ot.tileID.key]=ot.tileID),C[B]=V}this._retainLoadedChildren(C,m,d,t);for(const B in T)t[B]||(this._coveredTiles[B]=!0,t[B]=T[B]);if(v){const B={},V={};for(const Z of y)this._tiles[Z.key].hasData()?B[Z.key]=Z:V[Z.key]=Z;for(const Z in V){const W=V[Z].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(B[W[0].key]=t[W[0].key]=W[0],B[W[1].key]=t[W[1].key]=W[1],B[W[2].key]=t[W[2].key]=W[2],B[W[3].key]=t[W[3].key]=W[3],delete V[Z])}for(const Z in V){const W=V[Z],at=this.findLoadedParent(W,this._source.minzoom),ot=this.findLoadedSibling(W),lt=at||ot||null;if(lt){B[lt.tileID.key]=t[lt.tileID.key]=lt.tileID;for(const ut in B)B[ut].isChildOf(lt.tileID)&&delete B[ut]}}for(const Z in this._tiles)B[Z]||(this._coveredTiles[Z]=!0)}}update(t,r){if(!this._sourceLoaded||this._paused)return;let d;this.transform=t,this.terrain=r,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new a.S(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(d=st(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(d=d.filter(L=>this._source.hasTile(L)))):d=[];const m=Qs(t,this._source),y=Math.max(m-G.maxOverzooming,this._source.minzoom),v=Math.max(m+G.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const B of d)if(B.canonical.z>this._source.minzoom){const V=B.scaledTo(B.canonical.z-1);L[V.key]=V;const Z=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));L[Z.key]=Z}d=d.concat(Object.values(L))}const T=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(d,m);Q(this._source.type)&&this._updateCoveredAndRetainedTiles(C,y,v,m,d,r);for(const L in C)this._tiles[L].clearFadeHold();const D=a.ac(this._tiles,C);for(const L of D){const B=this._tiles[L];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){var d;const m={},y={},v=Math.max(r-G.maxOverzooming,this._source.minzoom),T=Math.max(r+G.maxUnderzooming,this._source.minzoom),C={};for(const D of t){const L=this._addTile(D);m[D.key]=D,L.hasData()||r<this._source.maxzoom&&(C[D.key]=D)}this._retainLoadedChildren(C,r,T,m);for(const D of t){let L=this._tiles[D.key];if(L.hasData())continue;if(r+1>this._source.maxzoom){const V=D.children(this._source.maxzoom)[0],Z=this.getTile(V);if(Z&&Z.hasData()){m[V.key]=V;continue}}else{const V=D.children(this._source.maxzoom);if(m[V[0].key]&&m[V[1].key]&&m[V[2].key]&&m[V[3].key])continue}let B=L.wasRequested();for(let V=D.overscaledZ-1;V>=v;--V){const Z=D.scaledTo(V);if(y[Z.key])break;if(y[Z.key]=!0,L=this.getTile(Z),!L&&B&&(L=this._addTile(Z)),L){const W=L.hasData();if((W||!(!((d=this.map)===null||d===void 0)&&d.cancelPendingTileRequestsWhileZooming)||B)&&(m[Z.key]=Z),B=L.wasRequested(),W)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let d,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}r.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;m=y}for(const y of r)this._loadedParentTiles[y]=d}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const r=this._tiles[t].tileID,d=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=d}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const d=r;return r||(r=new _i(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,t.key,r.state)),r.uses++,this._tiles[t.key]=r,d||this._source.fire(new a.k("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=r.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(t){const r=t.sourceDataType;t.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&r==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,r,d){const m=[],y=this.transform;if(!y)return m;const v=d?y.getCameraQueryGeometry(t):t,T=t.map(W=>y.screenPointToMercatorCoordinate(W,this.terrain)),C=v.map(W=>y.screenPointToMercatorCoordinate(W,this.terrain)),D=this.getIds();let L=1/0,B=1/0,V=-1/0,Z=-1/0;for(const W of C)L=Math.min(L,W.x),B=Math.min(B,W.y),V=Math.max(V,W.x),Z=Math.max(Z,W.y);for(let W=0;W<D.length;W++){const at=this._tiles[D[W]];if(at.holdingForFade())continue;const ot=at.tileID,lt=Math.pow(2,y.zoom-at.tileID.overscaledZ),ut=r*at.queryPadding*a.X/at.tileSize/lt,gt=[ot.getTilePoint(new a.Y(L,B)),ot.getTilePoint(new a.Y(V,Z))];if(gt[0].x-ut<a.X&&gt[0].y-ut<a.X&&gt[1].x+ut>=0&&gt[1].y+ut>=0){const _t=T.map(wt=>ot.getTilePoint(wt)),yt=C.map(wt=>ot.getTilePoint(wt));m.push({tile:at,tileID:ot,queryGeometry:_t,cameraQueryGeometry:yt,scale:lt})}}return m}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(d=>this._tiles[d].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(Q(this._source.type)){const t=F.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=t)return!0}return!1}setFeatureState(t,r,d){this._state.updateState(t=t||"_geojsonTileLayer",r,d)}removeFeatureState(t,r,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,d)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,d){const m=this._tiles[t];m&&m.setDependencies(r,d)}reloadTilesForDependencies(t,r){for(const d in this._tiles)this._tiles[d].hasDependency(t,r)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(t,r))}}function Y(_,t){const r=Math.abs(2*_.wrap)-+(_.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return _.overscaledZ-t.overscaledZ||d-r||t.canonical.y-_.canonical.y||t.canonical.x-_.canonical.x}function Q(_){return _==="raster"||_==="image"||_==="video"}G.maxOverzooming=10,G.maxUnderzooming=3;class dt{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.ab(t,0,1);let r=1,d=this._distances[r];const m=t*this.paddedLength+this.padding;for(;d<m&&r<this._distances.length;)d=this._distances[++r];const y=r-1,v=this._distances[y],T=d-v,C=T>0?(m-v)/T:0;return this.points[y].mult(1-C).add(this.points[r].mult(C))}}function bt(_,t){let r=!0;return _==="always"||_!=="never"&&t!=="never"||(r=!1),r}class It{constructor(t,r,d){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(r/d);for(let v=0;v<this.xCellCount*this.yCellCount;v++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,d,m,y){this._forEachCell(r,d,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(t,r,d,m){this._forEachCell(r-m,d-m,r+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(d),this.circles.push(m)}_insertBoxCell(t,r,d,m,y,v){this.boxCells[y].push(v)}_insertCircleCell(t,r,d,m,y,v){this.circleCells[y].push(v)}_query(t,r,d,m,y,v,T){if(d<0||t>this.width||m<0||r>this.height)return[];const C=[];if(t<=0&&r<=0&&this.width<=d&&this.height<=m){if(y)return[{key:null,x1:t,y1:r,x2:d,y2:m}];for(let D=0;D<this.boxKeys.length;D++)C.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const L=this.circles[3*D],B=this.circles[3*D+1],V=this.circles[3*D+2];C.push({key:this.circleKeys[D],x1:L-V,y1:B-V,x2:L+V,y2:B+V})}}else this._forEachCell(t,r,d,m,this._queryCell,C,{hitTest:y,overlapMode:v,seenUids:{box:{},circle:{}}},T);return C}query(t,r,d,m){return this._query(t,r,d,m,!1,null)}hitTest(t,r,d,m,y,v){return this._query(t,r,d,m,!0,y,v).length>0}hitTestCircle(t,r,d,m,y){const v=t-d,T=t+d,C=r-d,D=r+d;if(T<0||v>this.width||D<0||C>this.height)return!1;const L=[];return this._forEachCell(v,C,T,D,this._queryCellCircle,L,{hitTest:!0,overlapMode:m,circle:{x:t,y:r,radius:d},seenUids:{box:{},circle:{}}},y),L.length>0}_queryCell(t,r,d,m,y,v,T,C){const{seenUids:D,hitTest:L,overlapMode:B}=T,V=this.boxCells[y];if(V!==null){const W=this.bboxes;for(const at of V)if(!D.box[at]){D.box[at]=!0;const ot=4*at,lt=this.boxKeys[at];if(t<=W[ot+2]&&r<=W[ot+3]&&d>=W[ot+0]&&m>=W[ot+1]&&(!C||C(lt))&&(!L||!bt(B,lt.overlapMode))&&(v.push({key:lt,x1:W[ot],y1:W[ot+1],x2:W[ot+2],y2:W[ot+3]}),L))return!0}}const Z=this.circleCells[y];if(Z!==null){const W=this.circles;for(const at of Z)if(!D.circle[at]){D.circle[at]=!0;const ot=3*at,lt=this.circleKeys[at];if(this._circleAndRectCollide(W[ot],W[ot+1],W[ot+2],t,r,d,m)&&(!C||C(lt))&&(!L||!bt(B,lt.overlapMode))){const ut=W[ot],gt=W[ot+1],_t=W[ot+2];if(v.push({key:lt,x1:ut-_t,y1:gt-_t,x2:ut+_t,y2:gt+_t}),L)return!0}}}return!1}_queryCellCircle(t,r,d,m,y,v,T,C){const{circle:D,seenUids:L,overlapMode:B}=T,V=this.boxCells[y];if(V!==null){const W=this.bboxes;for(const at of V)if(!L.box[at]){L.box[at]=!0;const ot=4*at,lt=this.boxKeys[at];if(this._circleAndRectCollide(D.x,D.y,D.radius,W[ot+0],W[ot+1],W[ot+2],W[ot+3])&&(!C||C(lt))&&!bt(B,lt.overlapMode))return v.push(!0),!0}}const Z=this.circleCells[y];if(Z!==null){const W=this.circles;for(const at of Z)if(!L.circle[at]){L.circle[at]=!0;const ot=3*at,lt=this.circleKeys[at];if(this._circlesCollide(W[ot],W[ot+1],W[ot+2],D.x,D.y,D.radius)&&(!C||C(lt))&&!bt(B,lt.overlapMode))return v.push(!0),!0}}}_forEachCell(t,r,d,m,y,v,T,C){const D=this._convertToXCellCoord(t),L=this._convertToYCellCoord(r),B=this._convertToXCellCoord(d),V=this._convertToYCellCoord(m);for(let Z=D;Z<=B;Z++)for(let W=L;W<=V;W++)if(y.call(this,t,r,d,m,this.xCellCount*W+Z,v,T,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,d,m,y,v){const T=m-t,C=y-r,D=d+v;return D*D>T*T+C*C}_circleAndRectCollide(t,r,d,m,y,v,T){const C=(v-m)/2,D=Math.abs(t-(m+C));if(D>C+d)return!1;const L=(T-y)/2,B=Math.abs(r-(y+L));if(B>L+d)return!1;if(D<=C||B<=L)return!0;const V=D-C,Z=B-L;return V*V+Z*Z<=d*d}}function Bt(_,t,r){const d=a.H();if(!_){const{vecSouth:B,vecEast:V}=Zt(t),Z=P();Z[0]=V[0],Z[1]=V[1],Z[2]=B[0],Z[3]=B[1],m=Z,(L=(v=(y=Z)[0])*(D=y[3])-(C=y[2])*(T=y[1]))&&(m[0]=D*(L=1/L),m[1]=-T*L,m[2]=-C*L,m[3]=v*L),d[0]=Z[0],d[1]=Z[1],d[4]=Z[2],d[5]=Z[3]}var m,y,v,T,C,D,L;return a.K(d,d,[1/r,1/r,1]),d}function kt(_,t,r,d){if(_){const m=a.H();if(!t){const{vecSouth:y,vecEast:v}=Zt(r);m[0]=v[0],m[1]=v[1],m[4]=y[0],m[5]=y[1]}return a.K(m,m,[d,d,1]),m}return r.pixelsToClipSpaceMatrix}function Zt(_){const t=Math.cos(_.rollInRadians),r=Math.sin(_.rollInRadians),d=Math.cos(_.pitchInRadians),m=Math.cos(_.bearingInRadians),y=Math.sin(_.bearingInRadians),v=a.ad();v[0]=-m*d*r-y*t,v[1]=-y*d*r+m*t;const T=a.ae(v);T<1e-9?a.af(v):a.ag(v,v,1/T);const C=a.ad();C[0]=m*d*t-y*r,C[1]=y*d*t+m*r;const D=a.ae(C);return D<1e-9?a.af(C):a.ag(C,C,1/D),{vecEast:C,vecSouth:v}}function $t(_,t,r,d){let m;d?(m=[_,t,d(_,t),1],a.al(m,m,r)):(m=[_,t,0,1],as(m,m,r));const y=m[3];return{point:new a.P(m[0]/y,m[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function Dt(_,t){return .5+_/t*.5}function Mt(_,t){return _.x>=-t[0]&&_.x<=t[0]&&_.y>=-t[1]&&_.y<=t[1]}function he(_,t,r,d,m,y,v,T,C,D,L,B,V){const Z=r?_.textSizeData:_.iconSizeData,W=a.ah(Z,t.transform.zoom),at=[256/t.width*2+1,256/t.height*2+1],ot=r?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ot.clear();const lt=_.lineVertexArray,ut=r?_.text.placedSymbolArray:_.icon.placedSymbolArray,gt=t.transform.width/t.transform.height;let _t=!1;for(let yt=0;yt<ut.length;yt++){const wt=ut.get(yt);if(wt.hidden||wt.writingMode===a.ai.vertical&&!_t){ds(wt.numGlyphs,ot);continue}_t=!1;const vt=new a.P(wt.anchorX,wt.anchorY),zt={getElevation:V,pitchedLabelPlaneMatrix:d,lineVertexArray:lt,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:vt,unwrappedTileID:C,width:D,height:L,translation:B},Ot=ni(wt.anchorX,wt.anchorY,zt);if(!Mt(Ot.point,at)){ds(wt.numGlyphs,ot);continue}const qt=Dt(t.transform.cameraToCenterDistance,Ot.signedDistanceFromCamera),Kt=a.aj(Z,W,wt),Ut=y?Kt*t.transform.getPitchedTextCorrection(wt.anchorX,wt.anchorY,C)/qt:Kt*qt,ce=Be({projectionContext:zt,pitchedLabelPlaneMatrixInverse:m,symbol:wt,fontSize:Ut,flip:!1,keepUpright:v,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ot,aspectRatio:gt,rotateToLine:T});_t=ce.useVertical,(ce.notEnoughRoom||_t||ce.needsFlipping&&Be({projectionContext:zt,pitchedLabelPlaneMatrixInverse:m,symbol:wt,fontSize:Ut,flip:!0,keepUpright:v,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ot,aspectRatio:gt,rotateToLine:T}).notEnoughRoom)&&ds(wt.numGlyphs,ot)}r?_.text.dynamicLayoutVertexBuffer.updateData(ot):_.icon.dynamicLayoutVertexBuffer.updateData(ot)}function le(_,t,r,d,m,y,v,T){const C=y.glyphStartIndex+y.numGlyphs,D=y.lineStartIndex,L=y.lineStartIndex+y.lineLength,B=t.getoffsetX(y.glyphStartIndex),V=t.getoffsetX(C-1),Z=Wi(_*B,r,d,m,y.segment,D,L,T,v);if(!Z)return null;const W=Wi(_*V,r,d,m,y.segment,D,L,T,v);return W?T.projectionCache.anyProjectionOccluded?null:{first:Z,last:W}:null}function Ee(_,t,r,d){return _===a.ai.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*d?{useVertical:!0}:(_===a.ai.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function Be(_){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:r,symbol:d,fontSize:m,flip:y,keepUpright:v,glyphOffsetArray:T,dynamicLayoutVertexArray:C,aspectRatio:D,rotateToLine:L}=_,B=m/24,V=d.lineOffsetX*B,Z=d.lineOffsetY*B;let W;if(d.numGlyphs>1){const at=d.glyphStartIndex+d.numGlyphs,ot=d.lineStartIndex,lt=d.lineStartIndex+d.lineLength,ut=le(B,T,V,Z,y,d,L,t);if(!ut)return{notEnoughRoom:!0};const gt=We(ut.first.point.x,ut.first.point.y,t,r),_t=We(ut.last.point.x,ut.last.point.y,t,r);if(v&&!y){const yt=Ee(d.writingMode,gt,_t,D);if(yt)return yt}W=[ut.first];for(let yt=d.glyphStartIndex+1;yt<at-1;yt++)W.push(Wi(B*T.getoffsetX(yt),V,Z,y,d.segment,ot,lt,t,L));W.push(ut.last)}else{if(v&&!y){const ot=Se(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,lt=d.lineStartIndex+d.segment+1,ut=new a.P(t.lineVertexArray.getx(lt),t.lineVertexArray.gety(lt)),gt=Se(ut.x,ut.y,t),_t=gt.signedDistanceFromCamera>0?gt.point:Xt(t.tileAnchorPoint,ut,ot,1,t),yt=We(ot.x,ot.y,t,r),wt=We(_t.x,_t.y,t,r),vt=Ee(d.writingMode,yt,wt,D);if(vt)return vt}const at=Wi(B*T.getoffsetX(d.glyphStartIndex),V,Z,y,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,t,L);if(!at||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};W=[at]}for(const at of W)a.ak(C,at.point,at.angle);return{}}function Xt(_,t,r,d,m){const y=_.add(_.sub(t)._unit()),v=Se(y.x,y.y,m).point,T=r.sub(v);return r.add(T._mult(d/T.mag()))}function de(_,t,r){const d=t.projectionCache;if(d.projections[_])return d.projections[_];const m=new a.P(t.lineVertexArray.getx(_),t.lineVertexArray.gety(_)),y=Se(m.x,m.y,t);if(y.signedDistanceFromCamera>0)return d.projections[_]=y.point,d.anyProjectionOccluded=d.anyProjectionOccluded||y.isOccluded,y.point;const v=_-r.direction;return Xt(r.distanceFromAnchor===0?t.tileAnchorPoint:new a.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),m,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,t)}function Se(_,t,r){const d=_+r.translation[0],m=t+r.translation[1];let y;return r.pitchWithMap?(y=$t(d,m,r.pitchedLabelPlaneMatrix,r.getElevation),y.isOccluded=!1):(y=r.transform.projectTileCoordinates(d,m,r.unwrappedTileID,r.getElevation),y.point.x=(.5*y.point.x+.5)*r.width,y.point.y=(.5*-y.point.y+.5)*r.height),y}function We(_,t,r,d){if(r.pitchWithMap){const m=[_,t,0,1];return a.al(m,m,d),r.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],r.unwrappedTileID,r.getElevation).point}return{x:_/r.width*2-1,y:t/r.height*2-1}}function ni(_,t,r){return r.transform.projectTileCoordinates(_,t,r.unwrappedTileID,r.getElevation)}function Le(_,t,r){return _._unit()._perp()._mult(t*r)}function ye(_,t,r,d,m,y,v,T,C){if(T.projectionCache.offsets[_])return T.projectionCache.offsets[_];const D=r.add(t);if(_+C.direction<d||_+C.direction>=m)return T.projectionCache.offsets[_]=D,D;const L=de(_+C.direction,T,C),B=Le(L.sub(r),v,C.direction),V=r.add(B),Z=L.add(B);return T.projectionCache.offsets[_]=a.am(y,D,V,Z)||D,T.projectionCache.offsets[_]}function Wi(_,t,r,d,m,y,v,T,C){const D=d?_-t:_+t;let L=D>0?1:-1,B=0;d&&(L*=-1,B=Math.PI),L<0&&(B+=Math.PI);let V,Z=L>0?y+m:y+m+1;T.projectionCache.cachedAnchorPoint?V=T.projectionCache.cachedAnchorPoint:(V=Se(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=V);let W,at,ot=V,lt=V,ut=0,gt=0;const _t=Math.abs(D),yt=[];let wt;for(;ut+gt<=_t;){if(Z+=L,Z<y||Z>=v)return null;ut+=gt,lt=ot,at=W;const Ot={absOffsetX:_t,direction:L,distanceFromAnchor:ut,previousVertex:lt};if(ot=de(Z,T,Ot),r===0)yt.push(lt),wt=ot.sub(lt);else{let qt;const Kt=ot.sub(lt);qt=Kt.mag()===0?Le(de(Z+L,T,Ot).sub(ot),r,L):Le(Kt,r,L),at||(at=lt.add(qt)),W=ye(Z,qt,ot,y,v,at,r,T,Ot),yt.push(at),wt=W.sub(at)}gt=wt.mag()}const vt=wt._mult((_t-ut)/gt)._add(at||lt),zt=B+Math.atan2(ot.y-lt.y,ot.x-lt.x);return yt.push(vt),{point:vt,angle:C?zt:0,path:yt}}const lr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ds(_,t){for(let r=0;r<_;r++){const d=t.length;t.resize(d+4),t.float32.set(lr,3*d)}}function as(_,t,r){const d=t[0],m=t[1];return _[0]=r[0]*d+r[4]*m+r[12],_[1]=r[1]*d+r[5]*m+r[13],_[3]=r[3]*d+r[7]*m+r[15],_}const Ri=100;class tn{constructor(t,r=new It(t.width+200,t.height+200,25),d=new It(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=d,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ri,this.screenBottomBoundary=t.height+Ri,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,d,m,y,v,T,C,D,L,B,V){const Z=this.projectAndGetPerspectiveRatio(t.anchorPointX+C[0],t.anchorPointY+C[1],y,L,V),W=d*Z.perspectiveRatio;let at;if(v||T)at=this._projectCollisionBox(t,W,m,y,v,T,C,Z,L,B,V);else{const wt=Z.x+(B?B.x*W:0),vt=Z.y+(B?B.y*W:0);at={allPointsOccluded:!1,box:[wt+t.x1*W,vt+t.y1*W,wt+t.x2*W,vt+t.y2*W]}}const[ot,lt,ut,gt]=at.box,_t=v?at.allPointsOccluded:Z.isOccluded;let yt=_t;return yt||(yt=Z.perspectiveRatio<this.perspectiveRatioCutoff),yt||(yt=!this.isInsideGrid(ot,lt,ut,gt)),yt||r!=="always"&&this.grid.hitTest(ot,lt,ut,gt,r,D)?{box:[ot,lt,ut,gt],placeable:!1,offscreen:!1,occluded:_t}:{box:[ot,lt,ut,gt],placeable:!0,offscreen:this.isOffscreen(ot,lt,ut,gt),occluded:_t}}placeCollisionCircles(t,r,d,m,y,v,T,C,D,L,B,V,Z,W){const at=[],ot=new a.P(r.anchorX,r.anchorY),lt=this.getPerspectiveRatio(ot.x,ot.y,v,W),ut=(D?y*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,v)/lt:y*lt)/a.as,gt={getElevation:W,pitchedLabelPlaneMatrix:T,lineVertexArray:d,pitchWithMap:D,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ot,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:Z},_t=le(ut,m,r.lineOffsetX*ut,r.lineOffsetY*ut,!1,r,!1,gt);let yt=!1,wt=!1,vt=!0;if(_t){const zt=.5*B*lt+V,Ot=new a.P(-100,-100),qt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Kt=new dt,Ut=_t.first,ce=_t.last;let ae=[];for(let Ge=Ut.path.length-1;Ge>=1;Ge--)ae.push(Ut.path[Ge]);for(let Ge=1;Ge<ce.path.length;Ge++)ae.push(ce.path[Ge]);const te=2.5*zt;if(D){const Ge=this.projectPathToScreenSpace(ae,gt);ae=Ge.some(oi=>oi.signedDistanceFromCamera<=0)?[]:Ge.map(oi=>oi.point)}let pe=[];if(ae.length>0){const Ge=ae[0].clone(),oi=ae[0].clone();for(let Bi=1;Bi<ae.length;Bi++)Ge.x=Math.min(Ge.x,ae[Bi].x),Ge.y=Math.min(Ge.y,ae[Bi].y),oi.x=Math.max(oi.x,ae[Bi].x),oi.y=Math.max(oi.y,ae[Bi].y);pe=Ge.x>=Ot.x&&oi.x<=qt.x&&Ge.y>=Ot.y&&oi.y<=qt.y?[ae]:oi.x<Ot.x||Ge.x>qt.x||oi.y<Ot.y||Ge.y>qt.y?[]:a.ao([ae],Ot.x,Ot.y,qt.x,qt.y)}for(const Ge of pe){Kt.reset(Ge,.25*zt);let oi=0;oi=Kt.length<=.5*zt?1:Math.ceil(Kt.paddedLength/te)+1;for(let Bi=0;Bi<oi;Bi++){const yi=Bi/Math.max(oi-1,1),ji=Kt.lerp(yi),xi=ji.x+Ri,gi=ji.y+Ri;at.push(xi,gi,zt,0);const bi=xi-zt,Ts=gi-zt,ls=xi+zt,cs=gi+zt;if(vt=vt&&this.isOffscreen(bi,Ts,ls,cs),wt=wt||this.isInsideGrid(bi,Ts,ls,cs),t!=="always"&&this.grid.hitTestCircle(xi,gi,zt,t,L)&&(yt=!0,!C))return{circles:[],offscreen:!1,collisionDetected:yt}}}}return{circles:!C&&yt||!wt||lt<this.perspectiveRatioCutoff?[]:at,offscreen:vt,collisionDetected:yt}}projectPathToScreenSpace(t,r){const d=function(m,y){const v=a.H();return a.an(v,y.pitchedLabelPlaneMatrix),m.map(T=>{const C=$t(T.x,T.y,v,y.getElevation),D=y.transform.projectTileCoordinates(C.point.x,C.point.y,y.unwrappedTileID,y.getElevation);return D.point.x=(.5*D.point.x+.5)*y.width,D.point.y=(.5*-D.point.y+.5)*y.height,D})}(t,r);return function(m){let y=0,v=0,T=0,C=0;for(let D=0;D<m.length;D++)m[D].isOccluded?(T=D+1,C=0):(C++,C>v&&(v=C,y=T));return m.slice(y,y+v)}(d)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let d=1/0,m=1/0,y=-1/0,v=-1/0;for(const L of t){const B=new a.P(L.x+Ri,L.y+Ri);d=Math.min(d,B.x),m=Math.min(m,B.y),y=Math.max(y,B.x),v=Math.max(v,B.y),r.push(B)}const T=this.grid.query(d,m,y,v).concat(this.ignoredGrid.query(d,m,y,v)),C={},D={};for(const L of T){const B=L.key;if(C[B.bucketInstanceId]===void 0&&(C[B.bucketInstanceId]={}),C[B.bucketInstanceId][B.featureIndex])continue;const V=[new a.P(L.x1,L.y1),new a.P(L.x2,L.y1),new a.P(L.x2,L.y2),new a.P(L.x1,L.y2)];a.ap(r,V)&&(C[B.bucketInstanceId][B.featureIndex]=!0,D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]=[]),D[B.bucketInstanceId].push(B.featureIndex))}return D}insertCollisionBox(t,r,d,m,y,v){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:v,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,d,m,y,v){const T=d?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:y,collisionGroupID:v,overlapMode:r};for(let D=0;D<t.length;D+=4)T.insertCircle(C,t[D],t[D+1],t[D+2])}projectAndGetPerspectiveRatio(t,r,d,m,y){if(y){let v;m?(v=[t,r,m(t,r),1],a.al(v,v,y)):(v=[t,r,0,1],as(v,v,y));const T=v[3];return{x:(v[0]/T+1)/2*this.transform.width+Ri,y:(-v[1]/T+1)/2*this.transform.height+Ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}{const v=this.transform.projectTileCoordinates(t,r,d,m);return{x:(v.point.x+1)/2*this.transform.width+Ri,y:(1-v.point.y)/2*this.transform.height+Ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(t,r,d,m){const y=this.transform.projectTileCoordinates(t,r,d,m);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(t,r,d,m){return d<Ri||t>=this.screenRightBoundary||m<Ri||r>this.screenBottomBoundary}isInsideGrid(t,r,d,m){return d>=0&&t<this.gridRightBoundary&&m>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=a.aq([]);return a.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,r,d,m,y,v,T,C,D,L,B){let V=1,Z=0,W=0,at=1;const ot=t.anchorPointX+T[0],lt=t.anchorPointY+T[1];if(v&&!y){const ae=this.projectAndGetPerspectiveRatio(ot+1,lt,m,D,B),te=ae.x-C.x,pe=Math.atan((ae.y-C.y)/te)+(te<0?Math.PI:0),Ge=Math.sin(pe),oi=Math.cos(pe);V=oi,Z=Ge,W=-Ge,at=oi}else if(!v&&y){const ae=Zt(this.transform);V=ae.vecEast[0],Z=ae.vecEast[1],W=ae.vecSouth[0],at=ae.vecSouth[1]}let ut=C.x,gt=C.y,_t=r;y&&(ut=ot,gt=lt,_t=Math.pow(2,-(this.transform.zoom-d.overscaledZ)),_t*=this.transform.getPitchedTextCorrection(ot,lt,m),L||(_t*=a.ab(.5+C.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),L&&(ut+=V*L.x*_t+W*L.y*_t,gt+=Z*L.x*_t+at*L.y*_t);const yt=t.x1*_t,wt=t.x2*_t,vt=(yt+wt)/2,zt=t.y1*_t,Ot=t.y2*_t,qt=(zt+Ot)/2,Kt=[{offsetX:yt,offsetY:zt},{offsetX:vt,offsetY:zt},{offsetX:wt,offsetY:zt},{offsetX:wt,offsetY:qt},{offsetX:wt,offsetY:Ot},{offsetX:vt,offsetY:Ot},{offsetX:yt,offsetY:Ot},{offsetX:yt,offsetY:qt}];let Ut=[];for(const{offsetX:ae,offsetY:te}of Kt)Ut.push(new a.P(ut+V*ae+W*te,gt+Z*ae+at*te));let ce=!1;if(y){const ae=Ut.map(te=>this.projectAndGetPerspectiveRatio(te.x,te.y,m,D,B));ce=ae.some(te=>!te.isOccluded),Ut=ae.map(te=>new a.P(te.x,te.y))}else ce=!0;return{box:a.ar(Ut),allPointsOccluded:!ce}}}class Li{constructor(t,r,d,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ta{constructor(t,r,d,m,y){this.text=new Li(t?t.text:null,r,d,y),this.icon=new Li(t?t.icon:null,r,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ho{constructor(t,r,d){this.text=t,this.icon=r,this.skipFade=d}}class _c{constructor(t,r,d,m,y){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=y}}class Mr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:d=>d.collisionGroupID===r}}return this.collisionGroups[t]}}function Pr(_,t,r,d,m){const{horizontalAlign:y,verticalAlign:v}=a.ay(_);return new a.P(-(y-.5)*t+d[0]*m,-(v-.5)*r+d[1]*m)}class Fu{constructor(t,r,d,m,y){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new tn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Mr(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const r=this.terrain;return r?(d,m)=>r.getElevation(t,d,m):null}getBucketParts(t,r,d,m){const y=d.getBucket(r),v=d.latestFeatureIndex;if(!y||!v||r.id!==y.layerIds[0])return;const T=d.collisionBoxArray,C=y.layers[0].layout,D=y.layers[0].paint,L=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),B=d.tileSize/a.X,V=d.tileID.toUnwrapped(),Z=C.get("text-rotation-alignment")==="map",W=a.at(d,1,this.transform.zoom),at=a.au(this.collisionIndex.transform,d,D.get("text-translate"),D.get("text-translate-anchor")),ot=a.au(this.collisionIndex.transform,d,D.get("icon-translate"),D.get("icon-translate-anchor")),lt=Bt(Z,this.transform,W);this.retainedQueryData[y.bucketInstanceId]=new _c(y.bucketInstanceId,v,y.sourceLayerIndex,y.index,d.tileID);const ut={bucket:y,layout:C,translationText:at,translationIcon:ot,unwrappedTileID:V,pitchedLabelPlaneMatrix:lt,scale:L,textPixelRatio:B,holdingForFade:d.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:a.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const gt of y.sortKeyRanges){const{sortKey:_t,symbolInstanceStart:yt,symbolInstanceEnd:wt}=gt;t.push({sortKey:_t,symbolInstanceStart:yt,symbolInstanceEnd:wt,parameters:ut})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ut})}attemptAnchorPlacement(t,r,d,m,y,v,T,C,D,L,B,V,Z,W,at,ot,lt,ut,gt,_t){const yt=a.av[t.textAnchor],wt=[t.textOffset0,t.textOffset1],vt=Pr(yt,d,m,wt,y),zt=this.collisionIndex.placeCollisionBox(r,V,C,D,L,T,v,ot,B.predicate,gt,vt,_t);if((!ut||this.collisionIndex.placeCollisionBox(ut,V,C,D,L,T,v,lt,B.predicate,gt,vt,_t).placeable)&&zt.placeable){let Ot;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(Ot=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:wt,width:d,height:m,anchor:yt,textBoxScale:y,prevAnchor:Ot},this.markUsedJustification(W,yt,Z,at),W.allowVerticalPlacement&&(this.markUsedOrientation(W,at,Z),this.placedOrientations[Z.crossTileID]=at),{shift:vt,placedGlyphBoxes:zt}}}placeLayerBucketPart(t,r,d){const{bucket:m,layout:y,translationText:v,translationIcon:T,unwrappedTileID:C,pitchedLabelPlaneMatrix:D,textPixelRatio:L,holdingForFade:B,collisionBoxArray:V,partiallyEvaluatedTextSize:Z,collisionGroup:W}=t.parameters,at=y.get("text-optional"),ot=y.get("icon-optional"),lt=a.aw(y,"text-overlap","text-allow-overlap"),ut=lt==="always",gt=a.aw(y,"icon-overlap","icon-allow-overlap"),_t=gt==="always",yt=y.get("text-rotation-alignment")==="map",wt=y.get("text-pitch-alignment")==="map",vt=y.get("icon-text-fit")!=="none",zt=y.get("symbol-z-order")==="viewport-y",Ot=ut&&(_t||!m.hasIconData()||ot),qt=_t&&(ut||!m.hasTextData()||at);!m.collisionArrays&&V&&m.deserializeCollisionBoxes(V);const Kt=this.retainedQueryData[m.bucketInstanceId].tileID,Ut=this._getTerrainElevationFunc(Kt),ce=this.transform.getFastPathSimpleProjectionMatrix(Kt),ae=(te,pe,Ge)=>{var oi,Bi;if(r[te.crossTileID])return;if(B)return void(this.placements[te.crossTileID]=new ho(!1,!1,!1));let yi=!1,ji=!1,xi=!0,gi=null,bi={box:null,placeable:!1,offscreen:null,occluded:!1},Ts={placeable:!1},ls=null,cs=null,Os=null,Xn=0,Bn=0,sn=0;pe.textFeatureIndex?Xn=pe.textFeatureIndex:te.useRuntimeCollisionCircles&&(Xn=te.featureIndex),pe.verticalTextFeatureIndex&&(Bn=pe.verticalTextFeatureIndex);const Kn=pe.textBox;if(Kn){const Vs=vi=>{let Ni=a.ai.horizontal;if(m.allowVerticalPlacement&&!vi&&this.prevPlacement){const rn=this.prevPlacement.placedOrientations[te.crossTileID];rn&&(this.placedOrientations[te.crossTileID]=rn,Ni=rn,this.markUsedOrientation(m,Ni,te))}return Ni},mn=(vi,Ni)=>{if(m.allowVerticalPlacement&&te.numVerticalGlyphVertices>0&&pe.verticalTextBox){for(const rn of m.writingModes)if(rn===a.ai.vertical?(bi=Ni(),Ts=bi):bi=vi(),bi&&bi.placeable)break}else bi=vi()},gn=te.textAnchorOffsetStartIndex,nn=te.textAnchorOffsetEndIndex;if(nn===gn){const vi=(Ni,rn)=>{const Ui=this.collisionIndex.placeCollisionBox(Ni,lt,L,Kt,C,wt,yt,v,W.predicate,Ut,void 0,ce);return Ui&&Ui.placeable&&(this.markUsedOrientation(m,rn,te),this.placedOrientations[te.crossTileID]=rn),Ui};mn(()=>vi(Kn,a.ai.horizontal),()=>{const Ni=pe.verticalTextBox;return m.allowVerticalPlacement&&te.numVerticalGlyphVertices>0&&Ni?vi(Ni,a.ai.vertical):{box:null,offscreen:null}}),Vs(bi&&bi.placeable)}else{let vi=a.av[(Bi=(oi=this.prevPlacement)===null||oi===void 0?void 0:oi.variableOffsets[te.crossTileID])===null||Bi===void 0?void 0:Bi.anchor];const Ni=(Ui,jp,Rd)=>{const mh=Ui.x2-Ui.x1,Ld=Ui.y2-Ui.y1,$r=te.textBoxScale,Ur=vt&&gt==="never"?jp:null;let pr=null,Fd=lt==="never"?1:2,Ol="never";vi&&Fd++;for(let gh=0;gh<Fd;gh++){for(let _h=gn;_h<nn;_h++){const yh=m.textAnchorOffsets.get(_h);if(vi&&yh.textAnchor!==vi)continue;const xh=this.attemptAnchorPlacement(yh,Ui,mh,Ld,$r,yt,wt,L,Kt,C,W,Ol,te,m,Rd,v,T,Ur,Ut);if(xh&&(pr=xh.placedGlyphBoxes,pr&&pr.placeable))return yi=!0,gi=xh.shift,pr}vi?vi=null:Ol=lt}return d&&!pr&&(pr={box:this.collisionIndex.placeCollisionBox(Kn,"always",L,Kt,C,wt,yt,v,W.predicate,Ut,void 0,ce).box,offscreen:!1,placeable:!1,occluded:!1}),pr};mn(()=>Ni(Kn,pe.iconBox,a.ai.horizontal),()=>{const Ui=pe.verticalTextBox;return m.allowVerticalPlacement&&(!bi||!bi.placeable)&&te.numVerticalGlyphVertices>0&&Ui?Ni(Ui,pe.verticalIconBox,a.ai.vertical):{box:null,occluded:!0,offscreen:null}}),bi&&(yi=bi.placeable,xi=bi.offscreen);const rn=Vs(bi&&bi.placeable);if(!yi&&this.prevPlacement){const Ui=this.prevPlacement.variableOffsets[te.crossTileID];Ui&&(this.variableOffsets[te.crossTileID]=Ui,this.markUsedJustification(m,Ui.anchor,te,rn))}}}if(ls=bi,yi=ls&&ls.placeable,xi=ls&&ls.offscreen,te.useRuntimeCollisionCircles){const Vs=m.text.placedSymbolArray.get(te.centerJustifiedTextSymbolIndex),mn=a.aj(m.textSizeData,Z,Vs),gn=y.get("text-padding");cs=this.collisionIndex.placeCollisionCircles(lt,Vs,m.lineVertexArray,m.glyphOffsetArray,mn,C,D,d,wt,W.predicate,te.collisionCircleDiameter,gn,v,Ut),cs.circles.length&&cs.collisionDetected&&!d&&a.w("Collisions detected, but collision boxes are not shown"),yi=ut||cs.circles.length>0&&!cs.collisionDetected,xi=xi&&cs.offscreen}if(pe.iconFeatureIndex&&(sn=pe.iconFeatureIndex),pe.iconBox){const Vs=mn=>this.collisionIndex.placeCollisionBox(mn,gt,L,Kt,C,wt,yt,T,W.predicate,Ut,vt&&gi?gi:void 0,ce);Ts&&Ts.placeable&&pe.verticalIconBox?(Os=Vs(pe.verticalIconBox),ji=Os.placeable):(Os=Vs(pe.iconBox),ji=Os.placeable),xi=xi&&Os.offscreen}const Ca=at||te.numHorizontalGlyphVertices===0&&te.numVerticalGlyphVertices===0,ka=ot||te.numIconVertices===0;Ca||ka?ka?Ca||(ji=ji&&yi):yi=ji&&yi:ji=yi=ji&&yi;const Ao=ji&&Os.placeable;if(yi&&ls.placeable&&this.collisionIndex.insertCollisionBox(ls.box,lt,y.get("text-ignore-placement"),m.bucketInstanceId,Ts&&Ts.placeable&&Bn?Bn:Xn,W.ID),Ao&&this.collisionIndex.insertCollisionBox(Os.box,gt,y.get("icon-ignore-placement"),m.bucketInstanceId,sn,W.ID),cs&&yi&&this.collisionIndex.insertCollisionCircles(cs.circles,lt,y.get("text-ignore-placement"),m.bucketInstanceId,Xn,W.ID),d&&this.storeCollisionData(m.bucketInstanceId,Ge,pe,ls,Os,cs),te.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[te.crossTileID]=new ho((yi||Ot)&&!(ls!=null&&ls.occluded),(ji||qt)&&!(Os!=null&&Os.occluded),xi||m.justReloaded),r[te.crossTileID]=!0};if(zt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const te=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let pe=te.length-1;pe>=0;--pe){const Ge=te[pe];ae(m.symbolInstances.get(Ge),m.collisionArrays[Ge],Ge)}}else for(let te=t.symbolInstanceStart;te<t.symbolInstanceEnd;te++)ae(m.symbolInstances.get(te),m.collisionArrays[te],te);m.justReloaded=!1}storeCollisionData(t,r,d,m,y,v){if(d.textBox||d.iconBox){let T,C;this.collisionBoxArrays.has(t)?T=this.collisionBoxArrays.get(t):(T=new Map,this.collisionBoxArrays.set(t,T)),T.has(r)?C=T.get(r):(C={text:null,icon:null},T.set(r,C)),d.textBox&&(C.text=m.box),d.iconBox&&(C.icon=y.box)}if(v){let T=this.collisionCircleArrays[t];T===void 0&&(T=this.collisionCircleArrays[t]=[]);for(let C=0;C<v.circles.length;C+=4)T.push(v.circles[C+0]-Ri),T.push(v.circles[C+1]-Ri),T.push(v.circles[C+2]),T.push(v.collisionDetected?1:0)}}markUsedJustification(t,r,d,m){let y;y=m===a.ai.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[a.ax(r)];const v=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const T of v)T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=y>=0&&T!==y?0:d.crossTileID)}markUsedOrientation(t,r,d){const m=r===a.ai.horizontal||r===a.ai.horizontalOnly?r:0,y=r===a.ai.vertical?r:0,v=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const T of v)t.text.placedSymbolArray.get(T).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let d=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const m=r?r.symbolFadeChange(t):1,y=r?r.opacities:{},v=r?r.variableOffsets:{},T=r?r.placedOrientations:{};for(const C in this.placements){const D=this.placements[C],L=y[C];L?(this.opacities[C]=new ta(L,m,D.text,D.icon),d=d||D.text!==L.text.placed||D.icon!==L.icon.placed):(this.opacities[C]=new ta(null,m,D.text,D.icon,D.skipFade),d=d||D.text||D.icon)}for(const C in y){const D=y[C];if(!this.opacities[C]){const L=new ta(D,m,!1,!1);L.isHidden()||(this.opacities[C]=L,d=d||D.text.placed||D.icon.placed)}}for(const C in v)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=v[C]);for(const C in T)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=T[C]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const d={};for(const m of r){const y=m.getBucket(t);y&&m.latestFeatureIndex&&t.id===y.layerIds[0]&&this.updateBucketOpacities(y,m.tileID,d,m.collisionBoxArray)}}updateBucketOpacities(t,r,d,m){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const y=t.layers[0],v=y.layout,T=new ta(null,0,!1,!1,!0),C=v.get("text-allow-overlap"),D=v.get("icon-allow-overlap"),L=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=v.get("text-rotation-alignment")==="map",V=v.get("text-pitch-alignment")==="map",Z=v.get("icon-text-fit")!=="none",W=new ta(null,0,C&&(D||!t.hasIconData()||v.get("icon-optional")),D&&(C||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const at=(lt,ut,gt)=>{for(let _t=0;_t<ut/4;_t++)lt.opacityVertexArray.emplaceBack(gt);lt.hasVisibleVertices=lt.hasVisibleVertices||gt!==Cr},ot=this.collisionBoxArrays.get(t.bucketInstanceId);for(let lt=0;lt<t.symbolInstances.length;lt++){const ut=t.symbolInstances.get(lt),{numHorizontalGlyphVertices:gt,numVerticalGlyphVertices:_t,crossTileID:yt}=ut;let wt=this.opacities[yt];d[yt]?wt=T:wt||(wt=W,this.opacities[yt]=wt),d[yt]=!0;const vt=ut.numIconVertices>0,zt=this.placedOrientations[ut.crossTileID],Ot=zt===a.ai.vertical,qt=zt===a.ai.horizontal||zt===a.ai.horizontalOnly;if(gt>0||_t>0){const Ut=xc(wt.text);at(t.text,gt,Ot?Cr:Ut),at(t.text,_t,qt?Cr:Ut);const ce=wt.text.isHidden();[ut.rightJustifiedTextSymbolIndex,ut.centerJustifiedTextSymbolIndex,ut.leftJustifiedTextSymbolIndex].forEach(pe=>{pe>=0&&(t.text.placedSymbolArray.get(pe).hidden=ce||Ot?1:0)}),ut.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ut.verticalPlacedTextSymbolIndex).hidden=ce||qt?1:0);const ae=this.variableOffsets[ut.crossTileID];ae&&this.markUsedJustification(t,ae.anchor,ut,zt);const te=this.placedOrientations[ut.crossTileID];te&&(this.markUsedJustification(t,"left",ut,te),this.markUsedOrientation(t,te,ut))}if(vt){const Ut=xc(wt.icon),ce=!(Z&&ut.verticalPlacedIconSymbolIndex&&Ot);ut.placedIconSymbolIndex>=0&&(at(t.icon,ut.numIconVertices,ce?Ut:Cr),t.icon.placedSymbolArray.get(ut.placedIconSymbolIndex).hidden=wt.icon.isHidden()),ut.verticalPlacedIconSymbolIndex>=0&&(at(t.icon,ut.numVerticalIconVertices,ce?Cr:Ut),t.icon.placedSymbolArray.get(ut.verticalPlacedIconSymbolIndex).hidden=wt.icon.isHidden())}const Kt=ot&&ot.has(lt)?ot.get(lt):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ut=t.collisionArrays[lt];if(Ut){let ce=new a.P(0,0);if(Ut.textBox||Ut.verticalTextBox){let ae=!0;if(L){const te=this.variableOffsets[yt];te?(ce=Pr(te.anchor,te.width,te.height,te.textOffset,te.textBoxScale),B&&ce._rotate(V?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ae=!1}if(Ut.textBox||Ut.verticalTextBox){let te;Ut.textBox&&(te=Ot),Ut.verticalTextBox&&(te=qt),yc(t.textCollisionBox.collisionVertexArray,wt.text.placed,!ae||te,Kt.text,ce.x,ce.y)}}if(Ut.iconBox||Ut.verticalIconBox){const ae=!!(!qt&&Ut.verticalIconBox);let te;Ut.iconBox&&(te=ae),Ut.verticalIconBox&&(te=!ae),yc(t.iconCollisionBox.collisionVertexArray,wt.icon.placed,te,Kt.icon,Z?ce.x:0,Z?ce.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const d=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function yc(_,t,r,d,m,y){d&&d.length!==0||(d=[0,0,0,0]);const v=d[0]-Ri,T=d[1]-Ri,C=d[2]-Ri,D=d[3]-Ri;_.emplaceBack(t?1:0,r?1:0,m||0,y||0,v,T),_.emplaceBack(t?1:0,r?1:0,m||0,y||0,C,T),_.emplaceBack(t?1:0,r?1:0,m||0,y||0,C,D),_.emplaceBack(t?1:0,r?1:0,m||0,y||0,v,D)}const Ou=Math.pow(2,25),uo=Math.pow(2,24),Bu=Math.pow(2,17),xp=Math.pow(2,16),bp=Math.pow(2,9),vp=Math.pow(2,8),ju=Math.pow(2,1);function xc(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const t=_.placed?1:0,r=Math.floor(127*_.opacity);return r*Ou+t*uo+r*Bu+t*xp+r*bp+t*vp+r*ju+t}const Cr=0;class bc{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,d,m,y){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(v,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((T,C)=>T.sortKey-C.sortKey));this._currentPartIndex<v.length;)if(r.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,y())return!0;return!1}}class Nu{constructor(t,r,d,m,y,v,T,C){this.placement=new Fu(t,r,v,T,C),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,r,d){const m=F.now(),y=()=>!this._forceFullPlacement&&F.now()-m>2;for(;this._currentPlacementIndex>=0;){const v=r[t[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=T)&&(!v.maxzoom||v.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new bc(v)),this._inProgressLayer.continuePlacement(d[v.source],this.placement,this._showCollisionBoxes,v,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const kr=512/a.X/2;class vc{constructor(t,r,d){this.tileID=t,this.bucketInstanceId=d,this._symbolsByKey={};const m=new Map;for(let y=0;y<r.length;y++){const v=r.get(y),T=v.key,C=m.get(T);C?C.push(v):m.set(T,[v])}for(const[y,v]of m){const T={positions:v.map(C=>({x:Math.floor(C.anchorX*kr),y:Math.floor(C.anchorY*kr)})),crossTileIDs:v.map(C=>C.crossTileID)};if(T.positions.length>128){const C=new a.az(T.positions.length,16,Uint16Array);for(const{x:D,y:L}of T.positions)C.add(D,L);C.finish(),delete T.positions,T.index=C}this._symbolsByKey[y]=T}}getScaledCoordinates(t,r){const{x:d,y:m,z:y}=this.tileID.canonical,{x:v,y:T,z:C}=r.canonical,D=kr/Math.pow(2,C-y),L=(T*a.X+t.anchorY)*D,B=m*a.X*kr;return{x:Math.floor((v*a.X+t.anchorX)*D-d*a.X*kr),y:Math.floor(L-B)}}findMatches(t,r,d){const m=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let y=0;y<t.length;y++){const v=t.get(y);if(v.crossTileID)continue;const T=this._symbolsByKey[v.key];if(!T)continue;const C=this.getScaledCoordinates(v,r);if(T.index){const D=T.index.range(C.x-m,C.y-m,C.x+m,C.y+m).sort();for(const L of D){const B=T.crossTileIDs[L];if(!d[B]){d[B]=!0,v.crossTileID=B;break}}}else if(T.positions)for(let D=0;D<T.positions.length;D++){const L=T.positions[D],B=T.crossTileIDs[D];if(Math.abs(L.x-C.x)<=m&&Math.abs(L.y-C.y)<=m&&!d[B]){d[B]=!0,v.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Qa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const d in this.indexes){const m=this.indexes[d],y={};for(const v in m){const T=m[v];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+r),y[T.tileID.key]=T}this.indexes[d]=y}this.lng=t}addBucket(t,r,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<r.symbolInstances.length;y++)r.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const v=this.indexes[y];if(Number(y)>t.overscaledZ)for(const T in v){const C=v[T];C.tileID.isChildOf(t)&&C.findMatches(r.symbolInstances,t,m)}else{const T=v[t.scaledTo(Number(y)).key];T&&T.findMatches(r.symbolInstances,t,m)}}for(let y=0;y<r.symbolInstances.length;y++){const v=r.symbolInstances.get(y);v.crossTileID||(v.crossTileID=d.generate(),m[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new vc(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const d of r.getCrossTileIDsLists())for(const m of d)delete this.usedCrossTileIDs[t][m]}removeStaleBuckets(t){let r=!1;for(const d in this.indexes){const m=this.indexes[d];for(const y in m)t[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[y]),delete m[y],r=!0)}return r}}class Ir{constructor(){this.layerIndexes={},this.crossTileIDs=new Qa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,d){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new Vu);let y=!1;const v={};m.handleWrapJump(d);for(const T of r){const C=T.getBucket(t);C&&t.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(T.tileID,C,this.crossTileIDs)&&(y=!0),v[C.bucketInstanceId]=!0)}return m.removeStaleBuckets(v)&&(y=!0),y}pruneUnusedLayers(t){const r={};t.forEach(d=>{r[d]=!0});for(const d in this.layerIndexes)r[d]||delete this.layerIndexes[d]}}var wc="void main() {fragColor=vec4(1.0);}";const zn={prelude:Xe(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Xe("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Xe("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Xe(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Xe(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Xe(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Xe(wc,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Xe(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Xe(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xe("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xe("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xe("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Xe(wc,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Xe(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Xe(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Xe(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Xe(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Xe(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Xe(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Xe(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xe(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Xe(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Xe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Xe(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Xe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Xe(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Xe(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Xe(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Xe(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Xe("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Xe("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Xe("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Xe("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Xe(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Xe("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Xe(_,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=t.match(/in ([\w]+) ([\w]+)/g),m=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=y?y.concat(m):m,T={};return{fragmentSource:_=_.replace(r,(C,D,L,B,V)=>(T[V]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${L} ${B} ${V};
#else
uniform ${L} ${B} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${L} ${B} ${V} = u_${V};
#endif
`)),vertexSource:t=t.replace(r,(C,D,L,B,V)=>{const Z=B==="float"?"vec2":"vec4",W=V.match(/color/)?"color":Z;return T[V]?D==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${L} ${Z} a_${V};
out ${L} ${B} ${V};
#else
uniform ${L} ${B} u_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${L} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${L} ${B} ${V} = u_${V};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${L} ${Z} a_${V};
#else
uniform ${L} ${B} u_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${L} ${B} ${V} = a_${V};
#else
    ${L} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${L} ${B} ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${L} ${B} ${V} = u_${V};
#endif
`}),staticAttributes:d,staticUniforms:v}}class Rn{constructor(t,r,d){this.vertexBuffer=t,this.indexBuffer=r,this.segments=d}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ke=a.aA([{name:"a_pos",type:"Int16",components:2}]);const tl="#define PROJECTION_MERCATOR",$u="mercator";class ea{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return $u}get shaderDefine(){return tl}get shaderPreludeCode(){return zn.projectionMercator}get vertexShaderPreludeCode(){return zn.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,r,d,m,y){if(this._cachedMesh)return this._cachedMesh;const v=new a.aC;v.emplaceBack(0,0),v.emplaceBack(a.X,0),v.emplaceBack(0,a.X),v.emplaceBack(a.X,a.X);const T=t.createVertexBuffer(v,Ke.members),C=a.aD.simpleSegment(0,0,4,2),D=new a.aE;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3);const L=t.createIndexBuffer(D);return this._cachedMesh=new Rn(T,L,C),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}function ts(_,t){const r=a.ab(t.lat,-85.051129,a.aF);return new a.P(a.O(t.lng)*_,a.Q(r)*_)}function fs(_,t){return new a.Y(t.x/_,t.y/_).toLngLat()}function $i(_){return _.cameraToCenterDistance*Math.min(.85*Math.tan(a.aa(90-_.pitch)),Math.tan(a.aa(89.25-_.pitch)))}function Sc(_,t){const r=_.canonical,d=t/a.aG(r.z),m=r.x+Math.pow(2,r.z)*_.wrap,y=a.aq(new Float64Array(16));return a.J(y,y,[m*d,r.y*d,0]),a.K(y,y,[d/a.X,d/a.X,1]),y}function Ds(_,t,r,d,m){const y=a.Y.fromLngLat(_,t),v=m*a.aH(1,_.lat),T=v*Math.cos(a.aa(r)),C=Math.sqrt(v*v-T*T),D=C*Math.sin(a.aa(-d)),L=C*Math.cos(a.aa(-d));return new a.Y(y.x+D,y.y+L,y.z+T)}class As{constructor(t=0,r=0,d=0,m=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=d,this.right=m}interpolate(t,r,d){return r.top!=null&&t.top!=null&&(this.top=a.y.number(t.top,r.top,d)),r.bottom!=null&&t.bottom!=null&&(this.bottom=a.y.number(t.bottom,r.bottom,d)),r.left!=null&&t.left!=null&&(this.left=a.y.number(t.left,r.left,d)),r.right!=null&&t.right!=null&&(this.right=a.y.number(t.right,r.right,d)),this}getCenter(t,r){const d=a.ab((this.left+t-this.right)/2,0,t),m=a.ab((this.top+r-this.bottom)/2,0,r);return new a.P(d,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new As(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Es(_,t){if(!_.renderWorldCopies||_.lngRange)return;const r=t.lng-_.center.lng;t.lng+=r>180?-360:r<-180?360:0}function Tc(_){return Math.max(0,Math.floor(_))}class Dr{constructor(t,r,d,m,y,v){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=r||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=y??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Tc(this._zoom),this._scale=a.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new As,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,r,d){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Tc(this._zoom),this._scale=a.aG(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new As(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!d&&t.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const r=a.aI(t,-180,180)*Math.PI/180;var d,m,y,v,T,C,D,L,B;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=P(),d=this._rotationMatrix,y=-this._bearingInRadians,v=(m=this._rotationMatrix)[0],T=m[1],C=m[2],D=m[3],L=Math.sin(y),B=Math.cos(y),d[0]=v*B+C*L,d[1]=T*B+D*L,d[2]=v*-L+C*B,d[3]=T*-L+D*B)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const r=a.ab(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const r=t/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aJ(this._fovInRadians)}setFov(t){t=a.ab(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=a.aa(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const r=this.getConstrained(this._center,t).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=a.aG(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,r){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,d){this._unmodified=!1,this._edgeInsets.interpolate(t,r,d),this._constrain(),this._calcMatrices()}resize(t,r,d=!0){this._width=t,this._height=r,d&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new K([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,a.aF])}getConstrained(t,r){return this._callbacks.getConstrained(t,r)}getCameraQueryGeometry(t,r){if(r.length===1)return[r[0],t];{let d=t.x,m=t.y,y=t.x,v=t.y;for(const T of r)d=Math.min(d,T.x),m=Math.min(m,T.y),y=Math.max(y,T.x),v=Math.max(v,T.y);return[new a.P(d,m),new a.P(y,m),new a.P(y,v),new a.P(d,v),new a.P(d,m)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:r,zoom:d}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(d),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=a.aq(new Float64Array(16));a.K(t,t,[this._width/2,-this._height/2,1]),a.J(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=a.aq(new Float64Array(16)),a.K(t,t,[1,-1,1]),a.J(t,t,[-1,-1,0]),a.K(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,r,d,m){const y=d!==void 0?d:this.bearing,v=m=m!==void 0?m:this.pitch,T=a.Y.fromLngLat(t,r),C=-Math.cos(a.aa(v)),D=Math.sin(a.aa(v)),L=D*Math.sin(a.aa(y)),B=-D*Math.cos(a.aa(y));let V=this.elevation;const Z=r-V;let W;C*Z>=0||Math.abs(C)<.1?(W=1e4,V=r+W*C):W=-Z/C;let at,ot,lt=a.aK(1,T.y),ut=0;do{if(ut+=1,ut>10)break;ot=W/lt,at=new a.Y(T.x+L*ot,T.y+B*ot),lt=1/at.meterInMercatorCoordinateUnits()}while(Math.abs(W-ot*lt)>1e-12);return{center:at.toLngLat(),elevation:V,zoom:a.a8(this.height/2/Math.tan(this.fovInRadians/2)/ot/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const r=a.aH(1,this.center.lat)*this.worldSize,d=this.cameraToCenterDistance/r,m=a.Y.fromLngLat(this.center,this.elevation),y=Ds(this.center,this.elevation,this.pitch,this.bearing,d);this._elevation=t;const v=this.calculateCenterFromCameraLngLatAlt(y.toLngLat(),a.aK(y.z,m.y),this.bearing,this.pitch);this._elevation=v.elevation,this._center=v.center,this.setZoom(v.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=a.aH(1,this.center.lat)*this.worldSize;return Ds(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const r=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/r,t.canonical.y/r,1/r/a.X,1/r/a.X]}}class Di{constructor(t,r){this.min=t,this.max=r,this.center=a.aL([],a.aM([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],d=a.aN(this.min),m=a.aN(this.max);for(let y=0;y<r.length;y++)d[y]=r[y]?this.min[y]:this.center[y],m[y]=r[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new Di(d,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let r=!0;for(let d=0;d<t.planes.length;d++){const m=this.intersectsPlane(t.planes[d]);if(m===0)return 0;m===1&&(r=!1)}return r?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let r=t[3],d=t[3];for(let m=0;m<3;m++)t[m]>0?(r+=t[m]*this.min[m],d+=t[m]*this.max[m]):(d+=t[m]*this.min[m],r+=t[m]*this.max[m]);return r>=0?2:d<0?0:1}}class ia{distanceToTile2d(t,r,d,m){const y=m.distanceX([t,r]),v=m.distanceY([t,r]);return Math.hypot(y,v)}getWrap(t,r,d){return d}getTileAABB(t,r,d,m){var y,v;let T=d,C=d;if(m.terrain){const L=new a.S(t.z,r,t.z,t.x,t.y),B=m.terrain.getMinMaxElevation(L);T=(y=B.minElevation)!==null&&y!==void 0?y:d,C=(v=B.maxElevation)!==null&&v!==void 0?v:d}const D=1<<t.z;return new Di([r+t.x/D,t.y/D,T],[r+(t.x+1)/D,(t.y+1)/D,C])}allowVariableZoom(t,r){const d=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,m=a.ab(78.5-d/2,0,60);return!!r.terrain||t.pitch>m||t.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class Ln{constructor(t,r,d){this.points=t,this.planes=r,this.aabb=d}static fromInvProjectionMatrix(t,r=1,d=0){const m=Math.pow(2,d),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const L=1/(D=a.al([],D,t))[3]/r*m;return a.aO(D,D,[L,L,1/D[3],L])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const L=a.aP([],y[D[0]],y[D[1]]),B=a.aP([],y[D[2]],y[D[1]]),V=a.aQ([],a.aR([],L,B)),Z=-a.aS(V,y[D[1]]);return V.concat(Z)}),T=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],C=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const D of y)for(let L=0;L<3;L++)T[L]=Math.min(T[L],D[L]),C[L]=Math.max(C[L],D[L]);return new Ln(y,v,new Di(T,C))}}class Un{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,d){return this._helper.interpolatePadding(t,r,d)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,d=!0){this._helper.resize(t,r,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,r){}constructor(t,r,d,m,y){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Dr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(v,T)=>this.getConstrained(v,T)},t,r,d,m,y),this._coveringTilesDetailsProvider=new ia}clone(){const t=new Un;return t.apply(this),t}apply(t,r,d){this._helper.apply(t,r,d)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const r=[new a.aT(0,t)];if(this._helper._renderWorldCopies){const d=this.screenPointToMercatorCoordinate(new a.P(0,0)),m=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),T=Math.floor(Math.min(d.x,m.x,y.x,v.x)),C=Math.floor(Math.max(d.x,m.x,y.x,v.x)),D=1;for(let L=T-D;L<=C+D;L++)L!==0&&r.push(new a.aT(L,t))}return r}getCameraFrustum(){return Ln.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const r=this.screenPointToLocation(this.centerPoint,t),d=t?t.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(d)}setLocationAtPoint(t,r){const d=a.aH(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(r,d),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,d),v=a.Y.fromLngLat(t),T=new a.Y(v.x-(m.x-y.x),v.y-(m.y-y.y));this.setCenter(T==null?void 0:T.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,r){return r?this.coordinatePoint(a.Y.fromLngLat(t),r.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.Y.fromLngLat(t))}screenPointToLocation(t,r){var d;return(d=this.screenPointToMercatorCoordinate(t,r))===null||d===void 0?void 0:d.toLngLat()}screenPointToMercatorCoordinate(t,r){if(r){const d=r.pointCoordinate(t);if(d!=null)return d}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,r){const d=r||0,m=[t.x,t.y,0,1],y=[t.x,t.y,1,1];a.al(m,m,this._pixelMatrixInverse),a.al(y,y,this._pixelMatrixInverse);const v=m[3],T=y[3],C=m[1]/v,D=y[1]/T,L=m[2]/v,B=y[2]/T,V=L===B?0:(d-L)/(B-L);return new a.Y(a.y.number(m[0]/v,y[0]/T,V)/this.worldSize,a.y.number(C,D,V)/this.worldSize,d)}coordinatePoint(t,r=0,d=this._pixelMatrix){const m=[t.x*this.worldSize,t.y*this.worldSize,r,1];return a.al(m,m,d),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const t=Math.max(0,this._helper._height/2-$i(this));return new K().extend(this.screenPointToLocation(new a.P(0,t))).extend(this.screenPointToLocation(new a.P(this._helper._width,t))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(t,r){return r?r.pointCoordinate(t)!=null:t.y>this.height/2-$i(this)}calculatePosMatrix(t,r=!1,d){var m;const y=(m=t.key)!==null&&m!==void 0?m:a.aU(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),v=r?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(y)){const D=v.get(y);return d?D.f32:D.f64}const T=Sc(t,this.worldSize);a.L(T,r?this._alignedProjMatrix:this._viewProjMatrix,T);const C={f64:T,f32:new Float32Array(T)};return v.set(y,C),d?C.f32:C.f64}calculateFogMatrix(t){const r=t.key,d=this._fogMatrixCacheF32;if(d.has(r))return d.get(r);const m=Sc(t,this.worldSize);return a.L(m,this._fogMatrix,m),d.set(r,new Float32Array(m)),d.get(r)}getConstrained(t,r){r=a.ab(+r,this.minZoom,this.maxZoom);const d={center:new a.N(t.lng,t.lat),zoom:r};let m=this._helper._lngRange;this._helper._renderWorldCopies||m!==null||(m=[-179.9999999999,180-1e-10]);const y=this.tileSize*a.aG(d.zoom);let v=0,T=y,C=0,D=y,L=0,B=0;const{x:V,y:Z}=this.size;if(this._helper._latRange){const gt=this._helper._latRange;v=a.Q(gt[1])*y,T=a.Q(gt[0])*y,T-v<Z&&(L=Z/(T-v))}m&&(C=a.aI(a.O(m[0])*y,0,y),D=a.aI(a.O(m[1])*y,0,y),D<C&&(D+=y),D-C<V&&(B=V/(D-C)));const{x:W,y:at}=ts(y,t);let ot,lt;const ut=Math.max(B||0,L||0);if(ut){const gt=new a.P(B?(D+C)/2:W,L?(T+v)/2:at);return d.center=fs(y,gt).wrap(),d.zoom+=a.a8(ut),d}if(this._helper._latRange){const gt=Z/2;at-gt<v&&(lt=v+gt),at+gt>T&&(lt=T-gt)}if(m){const gt=(C+D)/2;let _t=W;this._helper._renderWorldCopies&&(_t=a.aI(W,gt-y/2,gt+y/2));const yt=V/2;_t-yt<C&&(ot=C+yt),_t+yt>D&&(ot=D-yt)}if(ot!==void 0||lt!==void 0){const gt=new a.P(ot??W,lt??at);d.center=fs(y,gt).wrap()}return d}calculateCenterFromCameraLngLatAlt(t,r,d,m){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,d,m)}_calculateNearFarZIfNeeded(t,r,d){if(!this._helper.autoCalculateNearFarZ)return;const m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=t-m*this._helper._pixelPerMeter/Math.cos(r),v=m<0?y:t,T=Math.PI/2+this.pitchInRadians,C=a.aa(this.fov)*(Math.abs(Math.cos(a.aa(this.roll)))*this.height+Math.abs(Math.sin(a.aa(this.roll)))*this.width)/this.height*(.5+d.y/this.height),D=Math.sin(C)*v/Math.sin(a.ab(Math.PI-T-C,.01,Math.PI-.01)),L=$i(this),B=Math.atan(L/this._helper.cameraToCenterDistance),V=a.aa(.75),Z=B>V?2*B*(.5+d.y/(2*L)):V,W=Math.sin(Z)*v/Math.sin(a.ab(Math.PI-T-Z,.01,Math.PI-.01)),at=Math.min(D,W);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*at+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,r=ts(this.worldSize,this.center),d=r.x,m=r.y;this._helper._pixelPerMeter=a.aH(1,this.center.lat)*this.worldSize;const y=a.aa(Math.min(this.pitch,89.25)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let T;this._calculateNearFarZIfNeeded(v,y,t),T=new Float64Array(16),a.aV(T,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.an(this._invProjMatrix,T),T[8]=2*-t.x/this._helper._width,T[9]=2*t.y/this._helper._height,this._projectionMatrix=a.aW(T),a.K(T,T,[1,-1,1]),a.J(T,T,[0,0,-this._helper.cameraToCenterDistance]),a.aX(T,T,-this.rollInRadians),a.aY(T,T,this.pitchInRadians),a.aX(T,T,-this.bearingInRadians),a.J(T,T,[-d,-m,0]),this._mercatorMatrix=a.K([],T,[this.worldSize,this.worldSize,this.worldSize]),a.K(T,T,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,T),a.J(T,T,[0,0,-this.elevation]),this._viewProjMatrix=T,this._invViewProjMatrix=a.an([],T);const C=[0,0,-1,1];a.al(C,C,this._invViewProjMatrix),this._cameraPosition=[C[0]/C[3],C[1]/C[3],C[2]/C[3]],this._fogMatrix=new Float64Array(16),a.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,a.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.J(this._fogMatrix,this._fogMatrix,[-d,-m,0]),a.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,T);const D=this._helper._width%2/2,L=this._helper._height%2/2,B=Math.cos(this.bearingInRadians),V=Math.sin(-this.bearingInRadians),Z=d-Math.round(d)+B*D+V*L,W=m-Math.round(m)+B*L+V*D,at=new Float64Array(T);if(a.J(at,at,[Z>.5?Z-1:Z,W>.5?W-1:W,0]),this._alignedProjMatrix=at,T=a.an(new Float64Array(16),this._pixelMatrix),!T)throw new Error("failed to invert matrix");this._pixelMatrixInverse=T,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new a.P(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.al(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=a.aH(1,this.center.lat)*this.worldSize;return Ds(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,r){const d=a.Y.fromLngLat(t),m=[d.x*this.worldSize,d.y*this.worldSize,r,1];return a.al(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(t){const{overscaledTileID:r,aligned:d,applyTerrainMatrix:m}=t,y=this._helper.getMercatorTileCoordinates(r),v=r?this.calculatePosMatrix(r,d,!0):null;let T;return T=r&&r.terrainRttPosMatrix32f&&m?r.terrainRttPosMatrix32f:v||a.aZ(),{mainMatrix:T,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:T}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,r,d){return 1}transformLightDirection(t){return a.aN(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,r,d,m){const y=this.calculatePosMatrix(d);let v;m?(v=[t,r,m(t,r),1],a.al(v,v,y)):(v=[t,r,0,1],as(v,v,y));const T=v[3];return{point:new a.P(v[0]/T,v[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}populateCache(t){for(const r of t)this.calculatePosMatrix(r)}getMatrixForModel(t,r){const d=a.Y.fromLngLat(t,r),m=d.meterInMercatorCoordinateUnits(),y=a.a_();return a.J(y,y,[d.x,d.y,d.z]),a.aX(y,y,Math.PI),a.aY(y,y,Math.PI/2),a.K(y,y,[-m,m,m]),y}getProjectionDataForCustomLayer(t=!0){const r=new a.S(0,0,0,0,0),d=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:t}),m=Sc(r,this.worldSize);a.L(m,this._viewProjMatrix,m),d.tileMercatorCoords=[0,0,1,1];const y=[a.X,a.X,this.worldSize/this._helper.pixelsPerMeter],v=a.a$();return a.K(v,m,y),d.fallbackMatrix=v,d.mainMatrix=v,d}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function un(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Mc(_){if(_.useSlerp)if(_.k<1){const t=a.b0(_.startEulerAngles.roll,_.startEulerAngles.pitch,_.startEulerAngles.bearing),r=a.b0(_.endEulerAngles.roll,_.endEulerAngles.pitch,_.endEulerAngles.bearing),d=new Float64Array(4);a.b1(d,t,r,_.k);const m=a.b2(d);_.tr.setRoll(m.roll),_.tr.setPitch(m.pitch),_.tr.setBearing(m.bearing)}else _.tr.setRoll(_.endEulerAngles.roll),_.tr.setPitch(_.endEulerAngles.pitch),_.tr.setBearing(_.endEulerAngles.bearing);else _.tr.setRoll(a.y.number(_.startEulerAngles.roll,_.endEulerAngles.roll,_.k)),_.tr.setPitch(a.y.number(_.startEulerAngles.pitch,_.endEulerAngles.pitch,_.k)),_.tr.setBearing(a.y.number(_.startEulerAngles.bearing,_.endEulerAngles.bearing,_.k))}function Hn(_,t,r,d,m){const y=m.padding,v=ts(m.worldSize,r.getNorthWest()),T=ts(m.worldSize,r.getNorthEast()),C=ts(m.worldSize,r.getSouthEast()),D=ts(m.worldSize,r.getSouthWest()),L=a.aa(-d),B=v.rotate(L),V=T.rotate(L),Z=C.rotate(L),W=D.rotate(L),at=new a.P(Math.max(B.x,V.x,W.x,Z.x),Math.max(B.y,V.y,W.y,Z.y)),ot=new a.P(Math.min(B.x,V.x,W.x,Z.x),Math.min(B.y,V.y,W.y,Z.y)),lt=at.sub(ot),ut=(m.width-(y.left+y.right+t.left+t.right))/lt.x,gt=(m.height-(y.top+y.bottom+t.top+t.bottom))/lt.y;if(gt<0||ut<0)return void un();const _t=Math.min(a.a8(m.scale*Math.min(ut,gt)),_.maxZoom),yt=a.P.convert(_.offset),wt=new a.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(a.aa(d)),vt=yt.add(wt).mult(m.scale/a.aG(_t));return{center:fs(m.worldSize,v.add(C).div(2).sub(vt)),zoom:_t,bearing:d}}class el{get useGlobeControls(){return!1}handlePanInertia(t,r){return{easingOffset:t,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(t,r){t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta),t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta)}handleMapControlsPan(t,r,d){t.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(d,t.around)}cameraForBoxAndBearing(t,r,d,m,y){return Hn(t,r,d,m,y)}handleJumpToCenterZoom(t,r){t.zoom!==(r.zoom!==void 0?+r.zoom:t.zoom)&&t.setZoom(+r.zoom),r.center!==void 0&&t.setCenter(a.N.convert(r.center))}handleEaseTo(t,r){const d=t.zoom,m=t.padding,y={roll:t.roll,pitch:t.pitch,bearing:t.bearing},v={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},T=r.zoom!==void 0,C=!t.isPaddingEqual(r.padding);let D=!1;const L=T?+r.zoom:t.zoom;let B=t.centerPoint.add(r.offsetAsPoint);const V=t.screenPointToLocation(B),{center:Z,zoom:W}=t.getConstrained(a.N.convert(r.center||V),L??d);Es(t,Z);const at=ts(t.worldSize,V),ot=ts(t.worldSize,Z).sub(at),lt=a.aG(W-d);return D=W!==d,{easeFunc:ut=>{if(D&&t.setZoom(a.y.number(d,W,ut)),a.b3(y,v)||Mc({startEulerAngles:y,endEulerAngles:v,tr:t,k:ut,useSlerp:y.roll!=v.roll}),C&&(t.interpolatePadding(m,r.padding,ut),B=t.centerPoint.add(r.offsetAsPoint)),r.around)t.setLocationAtPoint(r.around,r.aroundPoint);else{const gt=a.aG(t.zoom-d),_t=W>d?Math.min(2,lt):Math.max(.5,lt),yt=Math.pow(_t,1-ut),wt=fs(t.worldSize,at.add(ot.mult(ut*yt)).mult(gt));t.setLocationAtPoint(t.renderWorldCopies?wt.wrap():wt,B)}},isZooming:D,elevationCenter:Z}}handleFlyTo(t,r){const d=r.zoom!==void 0,m=t.zoom,y=t.getConstrained(a.N.convert(r.center||r.locationAtOffset),d?+r.zoom:m),v=y.center,T=y.zoom;Es(t,v);const C=ts(t.worldSize,r.locationAtOffset),D=ts(t.worldSize,v).sub(C),L=D.mag(),B=a.aG(T-m);let V;if(r.minZoom!==void 0){const Z=Math.min(+r.minZoom,m,T),W=t.getConstrained(v,Z).zoom;V=a.aG(W-m)}return{easeFunc:(Z,W,at,ot)=>{t.setZoom(Z===1?T:m+a.a8(W));const lt=Z===1?v:fs(t.worldSize,C.add(D.mult(at)).mult(W));t.setLocationAtPoint(t.renderWorldCopies?lt.wrap():lt,ot)},scaleOfZoom:B,targetCenter:v,scaleOfMinZoom:V,pixelPathLength:L}}}class Ai{constructor(t,r,d){this.blendFunction=t,this.blendColor=r,this.mask=d}}Ai.Replace=[1,0],Ai.disabled=new Ai(Ai.Replace,a.b4.transparent,[!1,!1,!1,!1]),Ai.unblended=new Ai(Ai.Replace,a.b4.transparent,[!0,!0,!0,!0]),Ai.alphaBlended=new Ai([1,771],a.b4.transparent,[!0,!0,!0,!0]);const fo=2305;class si{constructor(t,r,d){this.enable=t,this.mode=r,this.frontFace=d}}si.disabled=new si(!1,1029,fo),si.backCCW=new si(!0,1029,fo),si.frontCCW=new si(!0,1028,fo);class Ze{constructor(t,r,d){this.func=t,this.mask=r,this.range=d}}Ze.ReadOnly=!1,Ze.ReadWrite=!0,Ze.disabled=new Ze(519,Ze.ReadOnly,[0,1]);const sa=7680;class ri{constructor(t,r,d,m,y,v){this.test=t,this.ref=r,this.mask=d,this.fail=m,this.depthFail=y,this.pass=v}}ri.disabled=new ri({func:519,mask:0},0,0,sa,sa,sa);const po=new WeakMap;function bn(_){var t;if(po.has(_))return po.get(_);{const r=(t=_.getParameter(_.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return po.set(_,r),r}}class na{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const r=t.context,d=r.gl;this._texFormat=d.RGBA,this._texType=d.UNSIGNED_BYTE;const m=new a.aC;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);const y=new a.aE;y.emplaceBack(0,1,2),this._fullscreenTriangle=new Rn(r.createVertexBuffer(m,Ke.members),r.createIndexBuffer(y),a.aD.simpleSegment(0,0,m.length,y.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(d.TEXTURE1);const v=d.createTexture();d.bindTexture(d.TEXTURE_2D,v),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),bn(d)&&(this._pbo=d.createBuffer(),d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.bufferData(d.PIXEL_PACK_BUFFER,4,d.STREAM_READ),d.bindBuffer(d.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,r){const d=this._updateCount;return this._readbackQueue?d>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():d>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,r=t.gl;t.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,r){const d=this._cachedRenderContext.context,m=d.gl;if(this._bindFramebuffer(),d.viewport.set([0,0,this._texWidth,this._texHeight]),d.clear({color:a.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(d,m.TRIANGLES,Ze.disabled,ri.disabled,Ai.unblended,si.disabled,((y,v)=>({u_input:y,u_output_expected:v}))(t,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&bn(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const y=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&bn(t)){const r=t.clientWaitSync(this._readbackQueue.sync,0,0);if(r===t.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=na._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let r=0;return r+=t[0]/256,r+=t[1]/65536,r+=t[2]/16777216,t[3]<127&&(r=-r),r/128}}const ra=a.X/128;function oa(_,t){const r=_.granularity!==void 0?Math.max(_.granularity,1):1,d=r+(_.generateBorders?2:0),m=r+(_.extendToNorthPole||_.generateBorders?1:0)+(_.extendToSouthPole||_.generateBorders?1:0),y=d+1,v=m+1,T=_.generateBorders?-1:0,C=_.generateBorders||_.extendToNorthPole?-1:0,D=r+(_.generateBorders?1:0),L=r+(_.generateBorders||_.extendToSouthPole?1:0),B=y*v,V=d*m*6,Z=y*v>65536;if(Z&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const W=Z||t==="32bit",at=new Int16Array(2*B);let ot=0;for(let gt=C;gt<=L;gt++)for(let _t=T;_t<=D;_t++){let yt=_t/r*a.X;_t===-1&&(yt=-64),_t===r+1&&(yt=a.X+ra);let wt=gt/r*a.X;gt===-1&&(wt=_.extendToNorthPole?a.b6:-64),gt===r+1&&(wt=_.extendToSouthPole?a.b7:a.X+ra),at[ot++]=yt,at[ot++]=wt}const lt=W?new Uint32Array(V):new Uint16Array(V);let ut=0;for(let gt=0;gt<m;gt++)for(let _t=0;_t<d;_t++){const yt=_t+1+gt*y,wt=_t+(gt+1)*y,vt=_t+1+(gt+1)*y;lt[ut++]=_t+gt*y,lt[ut++]=wt,lt[ut++]=yt,lt[ut++]=yt,lt[ut++]=wt,lt[ut++]=vt}return{vertices:at.buffer.slice(0),indices:lt.buffer.slice(0),uses32bitIndices:W}}const Ar=new a.aB({fill:new a.b8(128,2),line:new a.b8(512,0),tile:new a.b8(128,32),stencil:new a.b8(128,1),circle:3});class Uu{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return zn.projectionGlobe}get vertexShaderPreludeCode(){return zn.projectionMercator.vertexSource}get subdivisionGranularity(){return Ar}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new na(t));const r=a.Q(this._errorQueryLatitudeDegrees),d=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(r,d),y=F.now();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=y);const v=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.ba(v))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,r,d,m,y){const v=(y==="stencil"?Ar.stencil:Ar.tile).getGranularityForZoomLevel(r.z);return this._getMesh(t,{granularity:v,generateBorders:d,extendToNorthPole:r.y===0&&m,extendToSouthPole:r.y===(1<<r.z)-1&&m})}_getMesh(t,r){const d=this._getMeshKey(r);if(d in this._tileMeshCache)return this._tileMeshCache[d];const m=function(y,v){const T=oa(v,"16bit"),C=a.aC.deserialize({arrayBuffer:T.vertices,length:T.vertices.byteLength/2/2}),D=a.aE.deserialize({arrayBuffer:T.indices,length:T.indices.byteLength/2/3});return new Rn(y.createVertexBuffer(C,Ke.members),y.createIndexBuffer(D),a.aD.simpleSegment(0,0,C.length,D.length))}(t,r);return this._tileMeshCache[d]=m,m}recalculate(t){}hasTransition(){const t=F.now();let r=!1;return r=r||(t-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Pc=new a.q({type:new a.D(a.v.projection.type)});class Cc extends a.E{constructor(t){super(),this._transitionable=new a.T(Pc),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0)),this._mercatorProjection=new ea,this._verticalPerspectiveProjection=new Uu}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof a.bb){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,r,d,m,y){return this.currentProjection.getMeshFromTileID(t,r,d,m,y)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Hu(_){const t=mo(_.worldSize,_.center.lat);return 2*Math.PI*t}function aa(_,t,r,d,m){const y=1/(1<<m),v=t/a.X*y+d*y,T=a.bd((_/a.X*y+r*y)*Math.PI*2+Math.PI,2*Math.PI),C=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,D=Math.cos(C),L=new Float64Array(3);return L[0]=Math.sin(T)*D,L[1]=Math.sin(C),L[2]=Math.cos(T)*D,L}function wi(_){return function(t,r){const d=Math.cos(r),m=new Float64Array(3);return m[0]=Math.sin(t)*d,m[1]=Math.sin(r),m[2]=Math.cos(t)*d,m}(_.lng*Math.PI/180,_.lat*Math.PI/180)}function mo(_,t){return _/(2*Math.PI)/Math.cos(t*Math.PI/180)}function vn(_){const t=Math.asin(_[1])/Math.PI*180,r=Math.sqrt(_[0]*_[0]+_[2]*_[2]);if(r>1e-6){const d=_[0]/r,m=Math.acos(_[2]/r),y=(d>0?m:-m)/Math.PI*180;return new a.N(a.aI(y,-180,180),t)}return new a.N(0,t)}function Er(_){return Math.cos(_*Math.PI/180)}function ps(_,t){const r=Er(_),d=Er(t);return a.a8(d/r)}function kc(_,t){const r=_.rotate(t.bearingInRadians),d=t.zoom+ps(t.center.lat,0),m=a.b9(1/Er(t.center.lat),1/Er(Math.min(Math.abs(t.center.lat),60)),a.bc(d,7,3,0,1)),y=360/Hu({worldSize:t.worldSize,center:{lat:t.center.lat}});return new a.N(t.center.lng-r.x*y*m,a.ab(t.center.lat+r.y*y,-85.051129,a.aF))}function cr(_){const t=.5*_,r=Math.sin(t),d=Math.cos(t);return Math.log(r+d)-Math.log(d-r)}function Zu(_,t,r,d){const m=_.lat+r*d;if(Math.abs(r)>1){const y=(Math.sign(_.lat+r)!==Math.sign(_.lat)?-Math.abs(_.lat):Math.abs(_.lat))*Math.PI/180,v=Math.abs(_.lat+r)*Math.PI/180,T=cr(y+d*(v-y)),C=cr(y),D=cr(v);return new a.N(_.lng+t*((T-C)/(D-C)),m)}return new a.N(_.lng+t*d,m)}class wp{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=t}recalculateCache(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(t,r,d,m){const y=`${t.z}_${t.x}_${t.y}`,v=this._cache.get(y);if(v)return v;const T=this._cachePrevious.get(y);if(T)return this._cache.set(y,T),T;const C=this._aabbFactory(t,r,d,m);return this._cache.set(y,C),this._hadAnyChanges=!0,C}}function il(_,t,r){const d=_-t;return d<0?-d:Math.max(0,d-r)}function Ic(_,t,r,d,m){const y=_-r;let v;return v=y<0?Math.min(-y,1+y-m):y>1?Math.min(Math.max(y-m,0),1-y):0,Math.max(v,il(t,d,m))}class Sp{constructor(){this._aabbCache=new wp(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(t,r,d,m){const y=1<<d.z,v=1/y,T=d.x/y,C=d.y/y;let D=2;return D=Math.min(D,Ic(t,r,T,C,v)),D=Math.min(D,Ic(t,r,T+.5,-C-v,v)),D=Math.min(D,Ic(t,r,T+.5,2-C-v,v)),D}getWrap(t,r,d){const m=1<<r.z,y=1/m,v=r.x/m,T=il(t.x,v,y),C=il(t.x,v-1,y),D=il(t.x,v+1,y),L=Math.min(T,C,D);return L===D?1:L===C?-1:0}allowVariableZoom(t,r){return Qs(t,r)>4}allowWorldCopies(){return!1}getTileAABB(t,r,d,m){return this._aabbCache.getTileAABB(t,r,d,m)}_computeTileAABB(t,r,d,m){if(t.z<=0)return new Di([-1,-1,-1],[1,1,1]);if(t.z===1)return new Di([t.x===0?-1:0,t.y===0?0:-1,-1],[t.x===0?0:1,t.y===0?1:0,1]);{const y=[aa(0,0,t.x,t.y,t.z),aa(a.X,0,t.x,t.y,t.z),aa(a.X,a.X,t.x,t.y,t.z),aa(0,a.X,t.x,t.y,t.z)],v=[1,1,1],T=[-1,-1,-1];for(const C of y)for(let D=0;D<3;D++)v[D]=Math.min(v[D],C[D]),T[D]=Math.max(T[D],C[D]);if(t.y===0||t.y===(1<<t.z)-1){const C=[0,t.y===0?1:-1,0];for(let D=0;D<3;D++)v[D]=Math.min(v[D],C[D]),T[D]=Math.max(T[D],C[D])}return new Di(v,T)}}}class sl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,d){return this._helper.interpolatePadding(t,r,d)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r){this._helper.resize(t,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=a.be(),this._projectionMatrix=a.a_(),this._globeViewProjMatrix32f=a.aZ(),this._globeViewProjMatrixNoCorrection=a.a_(),this._globeViewProjMatrixNoCorrectionInverted=a.a_(),this._globeProjMatrixInverted=a.a_(),this._cameraPosition=a.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Dr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,r)=>this.getConstrained(t,r)}),this._coveringTilesDetailsProvider=new Sp}clone(){const t=new sl;return t.apply(this),t}apply(t,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=a.bf();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:r,applyGlobeMatrix:d}=t,m=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:d?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const r=this.pitchInRadians,d=this.cameraToCenterDistance/t,m=Math.sin(r)*d,y=Math.cos(r)*d+1,v=1/Math.sqrt(m*m+y*y)*1;let T=-m,C=y;const D=Math.sqrt(T*T+C*C);T/=D,C/=D;const L=[0,T,C];return a.bg(L,L,[0,0,0],-this.bearingInRadians),a.bh(L,L,[0,0,0],-1*this.center.lat*Math.PI/180),a.bi(L,L,[0,0,0],this.center.lng*Math.PI/180),a.aL(L,L,.25),[...L,.25*-v]}isLocationOccluded(t){return!this.isSurfacePointVisible(wi(t))}transformLightDirection(t){const r=this._helper._center.lng*Math.PI/180,d=this._helper._center.lat*Math.PI/180,m=Math.cos(d),y=[Math.sin(r)*m,Math.sin(d),Math.cos(r)*m],v=[y[2],0,-y[0]],T=[0,0,0];a.aR(T,v,y),a.aQ(v,v),a.aQ(T,T);const C=[0,0,0];return a.aQ(C,[v[0]*t[0]+T[0]*t[1]+y[0]*t[2],v[1]*t[0]+T[1]*t[1]+y[1]*t[2],v[2]*t[0]+T[2]*t[1]+y[2]*t[2]]),C}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,r,d){const m=function(T,C,D){const L=1/(1<<D.z);return new a.Y(T/a.X*L+D.x*L,C/a.X*L+D.y*L)}(t,r,d.canonical),y=(v=m.y,[a.bd(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(t,r,d,m){const y=d.canonical,v=aa(t,r,y.x,y.y,y.z),T=1+(m?m(t,r):0)/a.bo,C=[v[0]*T,v[1]*T,v[2]*T,1];a.al(C,C,this._globeViewProjMatrixNoCorrection);const D=this._cachedClippingPlane,L=D[0]*v[0]+D[1]*v[1]+D[2]*v[2]+D[3]<0;return{point:new a.P(C[0]/C[3],C[1]/C[3]),signedDistanceFromCamera:C[3],isOccluded:L}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=mo(this.worldSize,this.center.lat),r=a.a$(),d=a.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),a.aV(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const m=this.centerOffset;r[8]=2*-m.x/this._helper._width,r[9]=2*m.y/this._helper._height,this._projectionMatrix=a.aW(r),this._globeProjMatrixInverted=a.a$(),a.an(this._globeProjMatrixInverted,r),a.J(r,r,[0,0,-this.cameraToCenterDistance]),a.aX(r,r,this.rollInRadians),a.aY(r,r,-this.pitchInRadians),a.aX(r,r,this.bearingInRadians),a.J(r,r,[0,0,-t]);const y=a.bf();y[0]=t,y[1]=t,y[2]=t,a.aY(d,r,this.center.lat*Math.PI/180),a.bj(d,d,-this.center.lng*Math.PI/180),a.K(d,d,y),this._globeViewProjMatrixNoCorrection=d,a.aY(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bj(r,r,-this.center.lng*Math.PI/180),a.K(r,r,y),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=a.a$(),a.an(this._globeViewProjMatrixNoCorrectionInverted,d);const v=a.bf();this._cameraPosition=a.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/t,a.bg(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),a.bh(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),a.bg(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),a.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bh(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),a.bi(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const T=a.aW(this._globeViewProjMatrixNoCorrectionInverted);a.K(T,T,[1,1,-1]),this._cachedFrustum=Ln.fromInvProjectionMatrix(T)}calculateFogMatrix(t){a.w("calculateFogMatrix is not supported on globe projection.");const r=a.a$();return a.aq(r),r}getVisibleUnwrappedCoordinates(t){return[new a.aT(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const d=wi(t);a.aL(d,d,1+r/a.bo);const m=a.be();return a.al(m,[d[0],d[1],d[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(t){}getBounds(){const t=.5*this.width,r=.5*this.height,d=[new a.P(0,0),new a.P(t,0),new a.P(this.width,0),new a.P(this.width,r),new a.P(this.width,this.height),new a.P(t,this.height),new a.P(0,this.height),new a.P(0,r)],m=[];for(const B of d)m.push(this.unprojectScreenPoint(B));let y=0,v=0,T=0,C=0;const D=this.center;for(const B of m){const V=a.bk(D.lng,B.lng),Z=a.bk(D.lat,B.lat);V<v&&(v=V),V>y&&(y=V),Z<C&&(C=Z),Z>T&&(T=Z)}const L=[D.lng+v,D.lat+C,D.lng+y,D.lat+T];return this.isSurfacePointOnScreen([0,1,0])&&(L[3]=90,L[0]=-180,L[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(L[1]=-90,L[0]=-180,L[2]=180),new K(L)}getConstrained(t,r){const d=a.ab(t.lat,-85.051129,a.aF),m=a.ab(+r,this.minZoom+ps(0,d),this.maxZoom);return{center:new a.N(t.lng,d),zoom:m}}calculateCenterFromCameraLngLatAlt(t,r,d,m){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,d,m)}setLocationAtPoint(t,r){const d=wi(this.unprojectScreenPoint(r)),m=wi(t),y=a.bf();a.bl(y);const v=a.bf();a.bi(v,d,y,-this.center.lng*Math.PI/180),a.bh(v,v,y,this.center.lat*Math.PI/180);const T=m[0]*m[0]+m[2]*m[2],C=v[0]*v[0];if(T<C)return;const D=Math.sqrt(T-C),L=-D,B=a.bm(m[0],m[2],v[0],D),V=a.bm(m[0],m[2],v[0],L),Z=a.bf();a.bi(Z,m,y,-B);const W=a.bm(Z[1],Z[2],v[1],v[2]),at=a.bf();a.bi(at,m,y,-V);const ot=a.bm(at[1],at[2],v[1],v[2]),lt=.5*Math.PI,ut=W>=-lt&&W<=lt,gt=ot>=-lt&&ot<=lt;let _t,yt;if(ut&&gt){const Ot=this.center.lng*Math.PI/180,qt=this.center.lat*Math.PI/180;a.bp(B,Ot)+a.bp(W,qt)<a.bp(V,Ot)+a.bp(ot,qt)?(_t=B,yt=W):(_t=V,yt=ot)}else if(ut)_t=B,yt=W;else{if(!gt)return;_t=V,yt=ot}const wt=_t/Math.PI*180,vt=yt/Math.PI*180,zt=this.center.lat;this.setCenter(new a.N(wt,a.ab(vt,-90,90))),this.setZoom(this.zoom+ps(zt,this.center.lat))}locationToScreenPoint(t,r){const d=wi(t);if(r){const m=r.getElevationForLngLatZoom(t,this._helper._tileZoom);a.aL(d,d,1+m/a.bo)}return this._projectSurfacePointToScreen(d)}_projectSurfacePointToScreen(t){const r=a.be();return a.al(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new a.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,r){if(r){const d=r.pointCoordinate(t);if(d)return d}return a.Y.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,r){var d;return(d=this.screenPointToMercatorCoordinate(t,r))===null||d===void 0?void 0:d.toLngLat()}isPointOnMapSurface(t,r){const d=this._cameraPosition,m=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(d,m)}getRayDirectionFromPixel(t){const r=a.be();r[0]=t.x/this.width*2-1,r[1]=-1*(t.y/this.height*2-1),r[2]=1,r[3]=1,a.al(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const d=a.bf();d[0]=r[0]-this._cameraPosition[0],d[1]=r[1]-this._cameraPosition[1],d[2]=r[2]-this._cameraPosition[2];const m=a.bf();return a.aQ(m,d),m}isSurfacePointVisible(t){const r=this._cachedClippingPlane;return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const r=a.be();return a.al(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(t,r){const d=a.aS(t,r),m=a.bf(),y=a.bf();a.aL(y,r,d),a.aP(m,t,y);const v=1-a.aS(m,m);if(v<0)return null;const T=a.aS(t,t)-1,C=-d+(d<0?1:-1)*Math.sqrt(v),D=T/C,L=C;return{tMin:Math.min(D,L),tMax:Math.max(D,L)}}unprojectScreenPoint(t){const r=this._cameraPosition,d=this.getRayDirectionFromPixel(t),m=this.rayPlanetIntersection(r,d);if(m){const D=a.bf();a.aM(D,r,[d[0]*m.tMin,d[1]*m.tMin,d[2]*m.tMin]);const L=a.bf();return a.aQ(L,D),vn(L)}const y=this._cachedClippingPlane[0]*d[0]+this._cachedClippingPlane[1]*d[1]+this._cachedClippingPlane[2]*d[2],v=-a.bn(this._cachedClippingPlane,r)/y,T=a.bf();if(v>0)a.aM(T,r,[d[0]*v,d[1]*v,d[2]*v]);else{const D=a.bf();a.aM(D,r,[2*d[0],2*d[1],2*d[2]]);const L=a.bn(this._cachedClippingPlane,D);a.aP(T,D,[this._cachedClippingPlane[0]*L,this._cachedClippingPlane[1]*L,this._cachedClippingPlane[2]*L])}const C=a.bf();return a.aQ(C,T),vn(C)}getMatrixForModel(t,r){const d=a.N.convert(t),m=1/a.bo,y=a.a_();return a.bj(y,y,d.lng/180*Math.PI),a.aY(y,y,-d.lat/180*Math.PI),a.J(y,y,[0,0,1+r/a.bo]),a.aY(y,y,.5*Math.PI),a.K(y,y,[m,m,m]),y}getProjectionDataForCustomLayer(t=!0){const r=this.getProjectionData({overscaledTileID:new a.S(0,0,0,0,0),applyGlobeMatrix:t});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(t){}}class zr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,d){return this._helper.interpolatePadding(t,r,d)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,d=!0){this._helper.resize(t,r,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,r){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Dr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,r)=>this.getConstrained(t,r)}),this._globeness=1,this._mercatorTransform=new Un,this._verticalPerspectiveTransform=new sl}clone(){const t=new zr;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const r=this._mercatorTransform.getProjectionData(t),d=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?d.mainMatrix:r.mainMatrix,clippingPlane:d.clippingPlane,tileMercatorCoords:d.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return a.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,r,d){const m=this._mercatorTransform.getPitchedTextCorrection(t,r,d),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,r,d);return a.b9(m,y,this._globeness)}projectTileCoordinates(t,r,d,m){return this.currentTransform.projectTileCoordinates(t,r,d,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){return this.currentTransform.lngLatToCameraDepth(t,r)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,r){return this.currentTransform.getConstrained(t,r)}calculateCenterFromCameraLngLatAlt(t,r,d,m){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,d,m)}setLocationAtPoint(t,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,r){return this.currentTransform.locationToScreenPoint(t,r)}screenPointToMercatorCoordinate(t,r){return this.currentTransform.screenPointToMercatorCoordinate(t,r)}screenPointToLocation(t,r){return this.currentTransform.screenPointToLocation(t,r)}isPointOnMapSurface(t,r){return this.currentTransform.isPointOnMapSurface(t,r)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,r){return this.currentTransform.getMatrixForModel(t,r)}getProjectionDataForCustomLayer(t=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return r;const d=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return d.fallbackMatrix=r.mainMatrix,d}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class en{get useGlobeControls(){return!0}handlePanInertia(t,r){const d=kc(t,r);return Math.abs(d.lng-r.center.lng)>180&&(d.lng=r.center.lng+179.5*Math.sign(d.lng-r.center.lng)),{easingCenter:d,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,r){const d=t.around,m=r.screenPointToLocation(d);t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta);const y=r.zoom;t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta);const v=r.zoom-y;if(v===0)return;const T=a.bk(r.center.lng,m.lng),C=T/(Math.abs(T/180)+1),D=a.bk(r.center.lat,m.lat),L=r.getRayDirectionFromPixel(d),B=r.cameraPosition,V=-1*a.aS(B,L),Z=a.bf();a.aM(Z,B,[L[0]*V,L[1]*V,L[2]*V]);const W=a.bq(Z)-1,at=Math.exp(.5*-Math.max(W-.3,0)),ot=mo(r.worldSize,r.center.lat)/Math.min(r.width,r.height),lt=a.bc(ot,.9,.5,1,.25),ut=(1-a.aG(-v))*Math.min(at,lt),gt=r.center.lat,_t=r.zoom,yt=new a.N(r.center.lng+C*ut,a.ab(r.center.lat+D*ut,-85.051129,a.aF));r.setLocationAtPoint(m,d);const wt=r.center,vt=a.bc(Math.abs(T),45,85,0,1),zt=a.bc(ot,.75,.35,0,1),Ot=Math.pow(Math.max(vt,zt),.25),qt=a.bk(wt.lng,yt.lng),Kt=a.bk(wt.lat,yt.lat);r.setCenter(new a.N(wt.lng+qt*Ot,wt.lat+Kt*Ot).wrap()),r.setZoom(_t+ps(gt,r.center.lat))}handleMapControlsPan(t,r,d){if(!t.panDelta)return;const m=r.center.lat,y=r.zoom;r.setCenter(kc(t.panDelta,r).wrap()),r.setZoom(y+ps(m,r.center.lat))}cameraForBoxAndBearing(t,r,d,m,y){const v=Hn(t,r,d,m,y),T=r.left/y.width*2-1,C=(y.width-r.right)/y.width*2-1,D=r.top/y.height*-2+1,L=(y.height-r.bottom)/y.height*-2+1,B=a.bk(d.getWest(),d.getEast())<0,V=B?d.getEast():d.getWest(),Z=B?d.getWest():d.getEast(),W=Math.max(d.getNorth(),d.getSouth()),at=Math.min(d.getNorth(),d.getSouth()),ot=V+.5*a.bk(V,Z),lt=W+.5*a.bk(W,at),ut=y.clone();ut.setCenter(v.center),ut.setBearing(v.bearing),ut.setPitch(0),ut.setRoll(0),ut.setZoom(v.zoom);const gt=ut.modelViewProjectionMatrix,_t=[wi(d.getNorthWest()),wi(d.getNorthEast()),wi(d.getSouthWest()),wi(d.getSouthEast()),wi(new a.N(Z,lt)),wi(new a.N(V,lt)),wi(new a.N(ot,W)),wi(new a.N(ot,at))],yt=wi(v.center);let wt=Number.POSITIVE_INFINITY;for(const vt of _t)T<0&&(wt=en.getLesserNonNegativeNonNull(wt,en.solveVectorScale(vt,yt,gt,"x",T))),C>0&&(wt=en.getLesserNonNegativeNonNull(wt,en.solveVectorScale(vt,yt,gt,"x",C))),D>0&&(wt=en.getLesserNonNegativeNonNull(wt,en.solveVectorScale(vt,yt,gt,"y",D))),L<0&&(wt=en.getLesserNonNegativeNonNull(wt,en.solveVectorScale(vt,yt,gt,"y",L)));if(Number.isFinite(wt)&&wt!==0)return v.zoom=ut.zoom+a.a8(wt),v;un()}handleJumpToCenterZoom(t,r){const d=t.center.lat,m=t.getConstrained(r.center?a.N.convert(r.center):t.center,t.zoom).center;t.setCenter(m.wrap());const y=r.zoom!==void 0?+r.zoom:t.zoom+ps(d,m.lat);t.zoom!==y&&t.setZoom(y)}handleEaseTo(t,r){const d=t.zoom,m=t.center,y=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},T={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},C=r.zoom!==void 0,D=!t.isPaddingEqual(r.padding);let L=!1;const B=r.center?a.N.convert(r.center):m,V=t.getConstrained(B,d).center;Es(t,V);const Z=t.clone();Z.setCenter(V),Z.setZoom(C?+r.zoom:d+ps(m.lat,B.lat)),Z.setBearing(r.bearing);const W=new a.P(a.ab(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),a.ab(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));Z.setLocationAtPoint(V,W);const at=(r.offset&&r.offsetAsPoint.mag())>0?Z.center:V,ot=C?+r.zoom:d+ps(m.lat,at.lat),lt=d+ps(m.lat,0),ut=ot+ps(at.lat,0),gt=a.bk(m.lng,at.lng),_t=a.bk(m.lat,at.lat),yt=a.aG(ut-lt);return L=ot!==d,{easeFunc:wt=>{if(a.b3(v,T)||Mc({startEulerAngles:v,endEulerAngles:T,tr:t,k:wt,useSlerp:v.roll!=T.roll}),D&&t.interpolatePadding(y,r.padding,wt),r.around)a.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(r.around,r.aroundPoint);else{const vt=ut>lt?Math.min(2,yt):Math.max(.5,yt),zt=Math.pow(vt,1-wt),Ot=Zu(m,gt,_t,wt*zt);t.setCenter(Ot.wrap())}if(L){const vt=a.y.number(lt,ut,wt)+ps(0,t.center.lat);t.setZoom(vt)}},isZooming:L,elevationCenter:at}}handleFlyTo(t,r){const d=r.zoom!==void 0,m=t.center,y=t.zoom,v=!t.isPaddingEqual(r.padding),T=t.getConstrained(a.N.convert(r.center||r.locationAtOffset),y).center,C=d?+r.zoom:t.zoom+ps(t.center.lat,T.lat),D=t.clone();D.setCenter(T),v&&D.setPadding(r.padding),D.setZoom(C),D.setBearing(r.bearing);const L=new a.P(a.ab(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),a.ab(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));D.setLocationAtPoint(T,L);const B=D.center;Es(t,B);const V=function(gt,_t,yt){const wt=wi(_t),vt=wi(yt),zt=a.aS(wt,vt),Ot=Math.acos(zt),qt=Hu(gt);return Ot/(2*Math.PI)*qt}(t,m,B),Z=y+ps(m.lat,0),W=C+ps(B.lat,0),at=a.aG(W-Z);let ot;if(typeof r.minZoom=="number"){const gt=+r.minZoom+ps(B.lat,0),_t=Math.min(gt,Z,W)+ps(0,B.lat),yt=t.getConstrained(B,_t).zoom+ps(B.lat,0);ot=a.aG(yt-Z)}const lt=a.bk(m.lng,B.lng),ut=a.bk(m.lat,B.lat);return{easeFunc:(gt,_t,yt,wt)=>{const vt=Zu(m,lt,ut,yt),zt=gt===1?B:vt;t.setCenter(zt.wrap());const Ot=Z+a.a8(_t);t.setZoom(gt===1?C:Ot+ps(0,zt.lat))},scaleOfZoom:at,targetCenter:B,scaleOfMinZoom:ot,pixelPathLength:V}}static solveVectorScale(t,r,d,m,y){const v=m==="x"?[d[0],d[4],d[8],d[12]]:[d[1],d[5],d[9],d[13]],T=[d[3],d[7],d[11],d[15]],C=t[0]*v[0]+t[1]*v[1]+t[2]*v[2],D=t[0]*T[0]+t[1]*T[1]+t[2]*T[2],L=r[0]*v[0]+r[1]*v[1]+r[2]*v[2],B=r[0]*T[0]+r[1]*T[1]+r[2]*T[2];return L+y*D===C+y*B||T[3]*(C-L)+v[3]*(B-D)+C*B==L*D?null:(L+v[3]-y*B-y*T[3])/(L-C-y*B+y*D)}static getLesserNonNegativeNonNull(t,r){return r!==null&&r>=0&&r<t?r:t}}class la{constructor(t){this._globe=t,this._mercatorCameraHelper=new el,this._verticalPerspectiveCameraHelper=new en}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,r){return this.currentHelper.handlePanInertia(t,r)}handleMapControlsRollPitchBearingZoom(t,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,r)}handleMapControlsPan(t,r,d){this.currentHelper.handleMapControlsPan(t,r,d)}cameraForBoxAndBearing(t,r,d,m,y){return this.currentHelper.cameraForBoxAndBearing(t,r,d,m,y)}handleJumpToCenterZoom(t,r){this.currentHelper.handleJumpToCenterZoom(t,r)}handleEaseTo(t,r){return this.currentHelper.handleEaseTo(t,r)}handleFlyTo(t,r){return this.currentHelper.handleFlyTo(t,r)}}const go=(_,t)=>a.t(_,t&&t.filter(r=>r.identifier!=="source.canvas")),Dc=a.br();class dn extends a.E{constructor(t,r={}){super(),this._rtlPluginLoaded=()=>{for(const d in this.sourceCaches){const m=this.sourceCaches[d].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[d].reload()}},this.map=t,this.dispatcher=new Jt(ii(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(d,m)=>this.getGlyphs(d,m)),this.dispatcher.registerMessageHandler("GI",(d,m)=>this.getImages(d,m)),this.imageManager=new ze,this.imageManager.setEventedParent(this),this.glyphManager=new He(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new zi(256,512),this.crossTileSymbolIndex=new Ir,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.bt()),$e().on(Te,this._rtlPluginLoaded),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const m=this.sourceCaches[d.sourceId];if(!m)return;const y=m.getSource();if(y&&y.vectorLayerIds)for(const v in this._layers){const T=this._layers[v];T.source===y.id&&this._validateLayer(T)}})}loadURL(t,r={},d){this.fire(new a.k("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const m=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;a.h(m,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,r,d)}).catch(v=>{this._loadStyleRequest=null,v&&!y.signal.aborted&&this.fire(new a.j(v))})}loadJSON(t,r={},d){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(t,r,d)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Dc,{validate:!1})}_load(t,r,d){var m,y;const v=r.transformStyle?r.transformStyle(d,t):t;if(!r.validate||!go(this,a.u(v))){this._loaded=!0,this.stylesheet=v;for(const T in v.sources)this.addSource(T,v.sources[T],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new De(this.stylesheet.light),this._setProjectionInternal(((m=this.stylesheet.projection)===null||m===void 0?void 0:m.type)||"mercator"),this.sky=new qe(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const t=a.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of t){const d=a.bv(r);d.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=d}}_loadSprite(t,r=!1,d=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,v,T,C){return a._(this,void 0,void 0,function*(){const D=Yt(y),L=T>1?"@2x":"",B={},V={};for(const{id:Z,url:W}of D){const at=v.transformRequest(Gt(W,L,".json"),"SpriteJSON");B[Z]=a.h(at,C);const ot=v.transformRequest(Gt(W,L,".png"),"SpriteImage");V[Z]=At.getImage(ot,C)}return yield Promise.all([...Object.values(B),...Object.values(V)]),function(Z,W){return a._(this,void 0,void 0,function*(){const at={};for(const ot in Z){at[ot]={};const lt=F.getImageCanvasContext((yield W[ot]).data),ut=(yield Z[ot]).data;for(const gt in ut){const{width:_t,height:yt,x:wt,y:vt,sdf:zt,pixelRatio:Ot,stretchX:qt,stretchY:Kt,content:Ut,textFitWidth:ce,textFitHeight:ae}=ut[gt];at[ot][gt]={data:null,pixelRatio:Ot,sdf:zt,stretchX:qt,stretchY:Kt,content:Ut,textFitWidth:ce,textFitHeight:ae,spriteData:{width:_t,height:yt,x:wt,y:vt,context:lt}}}}return at})}(B,V)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const v in y){this._spritesImagesIds[v]=[];const T=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(C=>!(C in y)):[];for(const C of T)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in y[v]){const D=v==="default"?C:`${v}:${C}`;this._spritesImagesIds[v].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,y[v][C],!1):this.imageManager.addImage(D,y[v][C]),r&&(this._changedImages[D]=!0)}}}).catch(y=>{this._spriteRequest=null,m=y,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),d&&d(m)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(t){const r=this.sourceCaches[t.source];if(!r)return;const d=t.sourceLayer;if(!d)return;const m=r.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(d)===-1)&&this.fire(new a.j(new Error(`Source layer "${d}" does not exist on source "${m.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,r=!1){const d=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r?a.bw(d):d);const m=[];for(const y of t)if(d[y]){const v=r?a.bw(d[y]):d[y];m.push(v)}return m}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const d of r){const m=this._layers[d];m.type!=="custom"&&(t[d]=m.serialize())}return t}hasTransitions(){var t,r,d;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((d=this.projection)===null||d===void 0)&&d.hasTransition())return!0;for(const m in this.sourceCaches)if(this.sourceCaches[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(r){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const v in this._updatedSources){const T=this._updatedSources[v];if(T==="reload")this._reloadSource(v);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const d={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];d[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(t,this._availableImages),!y.isHidden(t.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in d){const y=this.sourceCaches[m];!!d[m]!=!!y.used&&y.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,r&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){var d;this._checkLoaded();const m=this.serialize();if(t=r.transformStyle?r.transformStyle(m,t):t,((d=r.validate)===null||d===void 0||d)&&go(this,a.u(t)))return!1;(t=a.bw(t)).layers=a.bu(t.layers);const y=a.bx(m,t),v=this._getOperationsToPerform(y);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const T of v.operations)T();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const r=[],d=[];for(const m of t)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":r.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":r.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setSky":r.push(()=>this.setSky.apply(this,m.args));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setTransition":r.push(()=>{});break;default:d.push(m.command)}return{operations:r,unimplemented:d}}addImage(t,r){if(this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,d={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(a.u.source,`sources.${t}`,r,null,d))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const m=this.sourceCaches[t]=new G(t,r,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:t})),m.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===t)return this.fire(new a.j(new Error(`Source "${t}" cannot be removed while layer "${d}" is using it.`)));const r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const d=this.sourceCaches[t].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(r),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,r,d={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let y;if(t.type==="custom"){if(go(this,a.by(t)))return;y=a.bv(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(m,t.source),t=a.bw(t),t=a.e(t,{source:m})),this._validate(a.u.layer,`layers.${m}`,t,{arrayIndex:-1},d))return;y=a.bv(t),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}const v=r?this._order.indexOf(r):this._order.length;if(r&&v===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${r}".`)));else{if(this._order.splice(v,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const T=this._removedLayers[m];delete this._removedLayers[m],T.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const d=this._order.indexOf(t);this._order.splice(d,1);const m=r?this._order.indexOf(r):this._order.length;r&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,d){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===r&&m.maxzoom===d||(r!=null&&(m.minzoom=r),d!=null&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,d={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!a.bz(m.filter,r))return r==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.u.filter,`layers.${m.id}.filter`,r,null,d)||(m.filter=a.bw(r),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.bw(this.getLayer(t).filter)}setLayoutProperty(t,r,d,m={}){this._checkLoaded();const y=this.getLayer(t);y?a.bz(y.getLayoutProperty(r),d)||(y.setLayoutProperty(r,d,m),this._updateLayer(y)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const d=this.getLayer(t);if(d)return d.getLayoutProperty(r);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,d,m={}){this._checkLoaded();const y=this.getLayer(t);y?a.bz(y.getPaintProperty(r),d)||(y.setPaintProperty(r,d,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const d=t.source,m=t.sourceLayer,y=this.sourceCaches[d];if(y===void 0)return void this.fire(new a.j(new Error(`The source '${d}' does not exist in the map's style.`)));const v=y.getSource().type;v==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||m?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,t.id,r)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const d=t.source,m=this.sourceCaches[d];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${d}' does not exist in the map's style.`)));const y=m.getSource().type,v=y==="vector"?t.sourceLayer:void 0;y!=="vector"||v?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(v,t.id,r):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,d=t.sourceLayer,m=this.sourceCaches[r];if(m!==void 0)return m.getSource().type!=="vector"||d?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(d,t.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=a.bA(this.sourceCaches,y=>y.serialize()),r=this._serializeByIds(this._order,!0),d=this.map.getTerrain()||void 0,m=this.stylesheet;return a.bB({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:t,layers:r,terrain:d},y=>y!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=v=>this._layers[v].type==="fill-extrusion",d={},m=[];for(let v=this._order.length-1;v>=0;v--){const T=this._order[v];if(r(T)){d[T]=v;for(const C of t){const D=C[T];if(D)for(const L of D)m.push(L)}}}m.sort((v,T)=>T.intersectionZ-v.intersectionZ);const y=[];for(let v=this._order.length-1;v>=0;v--){const T=this._order[v];if(r(T))for(let C=m.length-1;C>=0;C--){const D=m[C].feature;if(d[D.layer.id]<v)break;y.push(D),m.pop()}else for(const C of t){const D=C[T];if(D)for(const L of D)y.push(L.feature)}}return y}queryRenderedFeatures(t,r,d){r&&r.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",r.filter,null,r);const m={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new a.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const D of r.layers){const L=this._layers[D];if(!L)return this.fire(new a.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];m[L.source]=!0}}const y=[];r.availableImages=this._availableImages;const v=this._serializedAllLayers(),T=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,C=Object.assign(Object.assign({},r),{layers:T});for(const D in this.sourceCaches)r.layers&&!m[D]||y.push(Pt(this.sourceCaches[D],this._layers,v,t,C,d));return this.placement&&y.push(function(D,L,B,V,Z,W,at){const ot={},lt=W.queryRenderedSymbols(V),ut=[];for(const gt of Object.keys(lt).map(Number))ut.push(at[gt]);ut.sort(X);for(const gt of ut){const _t=gt.featureIndex.lookupSymbolFeatures(lt[gt.bucketInstanceId],L,gt.bucketIndex,gt.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,D);for(const yt in _t){const wt=ot[yt]=ot[yt]||[],vt=_t[yt];vt.sort((zt,Ot)=>{const qt=gt.featureSortOrder;if(qt){const Kt=qt.indexOf(zt.featureIndex);return qt.indexOf(Ot.featureIndex)-Kt}return Ot.featureIndex-zt.featureIndex});for(const zt of vt)wt.push(zt)}}return function(gt,_t,yt){for(const wt in gt)for(const vt of gt[wt])N(vt,yt[_t[wt].source]);return gt}(ot,D,B)}(this._layers,v,this.sourceCaches,t,C,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(t,r){r&&r.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",r.filter,null,r);const d=this.sourceCaches[t];return d?function(m,y){const v=m.getRenderableIds().map(D=>m.getTileByID(D)),T=[],C={};for(let D=0;D<v.length;D++){const L=v[D],B=L.tileID.canonical.key;C[B]||(C[B]=!0,L.querySourceFeatures(T,y))}return T}(d,r):[]}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const v in t)if(!a.bz(t[v],d[v])){m=!0;break}if(!m)return;const y={now:F.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(y)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,r={}){this._checkLoaded();const d=this.getSky();let m=!1;if(!t&&!d)return;if(t&&!d)m=!0;else if(!t&&d)m=!0;else for(const v in t)if(!a.bz(t[v],d[v])){m=!0;break}if(!m)return;const y={now:F.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,r),this.sky.updateTransitions(y)}_setProjectionInternal(t){const r=function(d){if(Array.isArray(d)){const m=new Cc({type:d});return{projection:m,transform:new zr,cameraHelper:new la(m)}}switch(d){case"mercator":return{projection:new ea,transform:new Un,cameraHelper:new el};case"globe":{const m=new Cc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new zr,cameraHelper:new la(m)}}case"vertical-perspective":return{projection:new Uu,transform:new sl,cameraHelper:new en};default:return a.w(`Unknown projection name: ${d}. Falling back to mercator projection.`),{projection:new ea,transform:new Un,cameraHelper:new el}}}(t);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const d in this.sourceCaches)this.sourceCaches[d].reload()}_validate(t,r,d,m,y={}){return(!y||y.validate!==!1)&&go(this,t.call(a.u,a.e({key:r,style:this.serialize(),value:d,styleSpec:a.v},m)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),$e().off(Te,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const d=this.sourceCaches[r];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const r in this.sourceCaches)this.sourceCaches[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,r,d,m,y=!1){let v=!1,T=!1;const C={};for(const D of this._order){const L=this._layers[D];if(L.type!=="symbol")continue;if(!C[L.source]){const V=this.sourceCaches[L.source];C[L.source]=V.getRenderableIds(!0).map(Z=>V.getTileByID(Z)).sort((Z,W)=>W.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(W.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(L,C[L.source],t.center.lng);v=v||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(F.now(),t.zoom))&&(this.pauseablePlacement=new Nu(t,this.map.terrain,this._order,y,r,d,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(F.now()),T=!0),v&&this.pauseablePlacement.placement.setStale()),T||v)for(const D of this._order){const L=this._layers[D];L.type==="symbol"&&this.placement.updateLayerOpacities(L,C[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(F.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,r){return a._(this,void 0,void 0,function*(){const d=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[r.source];return m&&m.setDependencies(r.tileID.key,r.type,r.icons),d})}getGlyphs(t,r){return a._(this,void 0,void 0,function*(){const d=yield this.glyphManager.getGlyphs(r.stacks),m=this.sourceCaches[r.source];return m&&m.setDependencies(r.tileID.key,r.type,[""]),d})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(a.u.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,r,d={},m){this._checkLoaded();const y=[{id:t,url:r}],v=[...Yt(this.stylesheet.sprite),...y];this._validate(a.u.sprite,"sprite",v,null,d)||(this.stylesheet.sprite=v,this._loadSprite(y,!0,m))}removeSprite(t){this._checkLoaded();const r=Yt(this.stylesheet.sprite);if(r.find(d=>d.id===t)){if(this._spritesImagesIds[t])for(const d of this._spritesImagesIds[t])this.imageManager.removeImage(d),this._changedImages[d]=!0;r.splice(r.findIndex(d=>d.id===t),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Yt(this.stylesheet.sprite)}setSprite(t,r={},d){this._checkLoaded(),t&&this._validate(a.u.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,d):(this._unloadSprite(),d&&d(null)))}}var Tp=a.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ac{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,d,m,y,v,T,C,D){this.context=t;let L=this.boundPaintVertexBuffers.length!==m.length;for(let B=0;!L&&B<m.length;B++)this.boundPaintVertexBuffers[B]!==m[B]&&(L=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==d||L||this.boundIndexBuffer!==y||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==D?this.freshBind(r,d,m,y,v,T,C,D):(t.bindVertexArray.set(this.vao),T&&T.bind(),y&&y.dynamicDraw&&y.bind(),C&&C.bind(),D&&D.bind())}freshBind(t,r,d,m,y,v,T,C){const D=t.numAttributes,L=this.context,B=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=C,r.enableAttributes(B,t);for(const V of d)V.enableAttributes(B,t);v&&v.enableAttributes(B,t),T&&T.enableAttributes(B,t),C&&C.enableAttributes(B,t),r.bind(),r.setVertexAttribPointers(B,t,y);for(const V of d)V.bind(),V.setVertexAttribPointers(B,t,y);v&&(v.bind(),v.setVertexAttribPointers(B,t,y)),m&&m.bind(),T&&(T.bind(),T.setVertexAttribPointers(B,t,y)),C&&(C.bind(),C.setVertexAttribPointers(B,t,y)),L.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ca=(_,t,r,d,m)=>({u_texture:0,u_ele_delta:_,u_fog_matrix:t,u_fog_color:r?r.properties.get("fog-color"):a.b4.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:r?r.calculateFogBlendOpacity(d):0,u_horizon_color:r?r.properties.get("horizon-color"):a.b4.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),ha={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function nl(_){const t=[];for(let r=0;r<_.length;r++){if(_[r]===null)continue;const d=_[r].split(" ");t.push(d.pop())}return t}class rl{constructor(t,r,d,m,y,v,T,C){const D=t.gl;this.program=D.createProgram();const L=nl(r.staticAttributes),B=d?d.getBinderAttributes():[],V=L.concat(B),Z=zn.prelude.staticUniforms?nl(zn.prelude.staticUniforms):[],W=T.staticUniforms?nl(T.staticUniforms):[],at=r.staticUniforms?nl(r.staticUniforms):[],ot=d?d.getBinderUniforms():[],lt=Z.concat(W).concat(at).concat(ot),ut=[];for(const Ot of lt)ut.indexOf(Ot)<0&&ut.push(Ot);const gt=d?d.defines():[];bn(D)&&gt.unshift("#version 300 es"),y&&gt.push("#define OVERDRAW_INSPECTOR;"),v&&gt.push("#define TERRAIN3D;"),C&&gt.push(C);let _t=gt.concat(zn.prelude.fragmentSource,T.fragmentSource,r.fragmentSource).join(`
`),yt=gt.concat(zn.prelude.vertexSource,T.vertexSource,r.vertexSource).join(`
`);bn(D)||(_t=function(Ot){return Ot.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(_t),yt=function(Ot){return Ot.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(yt));const wt=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(wt,_t),D.compileShader(wt),!D.getShaderParameter(wt,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(wt)}`);D.attachShader(this.program,wt);const vt=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(vt,yt),D.compileShader(vt),!D.getShaderParameter(vt,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(vt)}`);D.attachShader(this.program,vt),this.attributes={};const zt={};this.numAttributes=V.length;for(let Ot=0;Ot<this.numAttributes;Ot++)V[Ot]&&(D.bindAttribLocation(this.program,Ot,V[Ot]),this.attributes[V[Ot]]=Ot);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(vt),D.deleteShader(wt);for(let Ot=0;Ot<ut.length;Ot++){const qt=ut[Ot];if(qt&&!zt[qt]){const Kt=D.getUniformLocation(this.program,qt);Kt&&(zt[qt]=Kt)}}this.fixedUniforms=m(t,zt),this.terrainUniforms=((Ot,qt)=>({u_depth:new a.bC(Ot,qt.u_depth),u_terrain:new a.bC(Ot,qt.u_terrain),u_terrain_dim:new a.b5(Ot,qt.u_terrain_dim),u_terrain_matrix:new a.bD(Ot,qt.u_terrain_matrix),u_terrain_unpack:new a.bE(Ot,qt.u_terrain_unpack),u_terrain_exaggeration:new a.b5(Ot,qt.u_terrain_exaggeration)}))(t,zt),this.projectionUniforms=((Ot,qt)=>({u_projection_matrix:new a.bD(Ot,qt.u_projection_matrix),u_projection_tile_mercator_coords:new a.bE(Ot,qt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bE(Ot,qt.u_projection_clipping_plane),u_projection_transition:new a.b5(Ot,qt.u_projection_transition),u_projection_fallback_matrix:new a.bD(Ot,qt.u_projection_fallback_matrix)}))(t,zt),this.binderUniforms=d?d.getUniforms(t,zt):[]}draw(t,r,d,m,y,v,T,C,D,L,B,V,Z,W,at,ot,lt,ut,gt){const _t=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(d),t.setStencilMode(m),t.setColorMode(y),t.setCullFace(v),C){t.activeTexture.set(_t.TEXTURE2),_t.bindTexture(_t.TEXTURE_2D,C.depthTexture),t.activeTexture.set(_t.TEXTURE3),_t.bindTexture(_t.TEXTURE_2D,C.texture);for(const wt in this.terrainUniforms)this.terrainUniforms[wt].set(C[wt])}if(D)for(const wt in D)this.projectionUniforms[ha[wt]].set(D[wt]);if(T)for(const wt in this.fixedUniforms)this.fixedUniforms[wt].set(T[wt]);ot&&ot.setUniforms(t,this.binderUniforms,W,{zoom:at});let yt=0;switch(r){case _t.LINES:yt=2;break;case _t.TRIANGLES:yt=3;break;case _t.LINE_STRIP:yt=1}for(const wt of Z.get()){const vt=wt.vaos||(wt.vaos={});(vt[L]||(vt[L]=new Ac)).bind(t,this,B,ot?ot.getPaintVertexBuffers():[],V,wt.vertexOffset,lt,ut,gt),_t.drawElements(r,wt.primitiveLength*yt,_t.UNSIGNED_SHORT,wt.primitiveOffset*yt*2)}}}function Gu(_,t,r){const d=1/a.at(r,1,t.transform.tileZoom),m=Math.pow(2,r.tileID.overscaledZ),y=r.tileSize*Math.pow(2,t.transform.tileZoom)/m,v=y*(r.tileID.canonical.x+r.tileID.wrap*m),T=y*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[d,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[v>>16,T>>16],u_pixel_coord_lower:[65535&v,65535&T]}}const Rr=(_,t,r,d)=>{const m=_.style.light,y=m.properties.get("position"),v=[y.x,y.y,y.z],T=a.bI();m.properties.get("anchor")==="viewport"&&a.bJ(T,_.transform.bearingInRadians),a.bK(v,v,T);const C=_.transform.transformLightDirection(v),D=m.properties.get("color");return{u_lightpos:v,u_lightpos_globe:C,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+t,u_opacity:r,u_fill_translate:d}},Mp=(_,t,r,d,m,y,v)=>a.e(Rr(_,t,r,d),Gu(y,_,v),{u_height_factor:-Math.pow(2,m.overscaledZ)/v.tileSize/8}),Ec=(_,t,r,d)=>a.e(Gu(t,_,r),{u_fill_translate:d}),Pp=(_,t)=>({u_world:_,u_fill_translate:t}),qu=(_,t,r,d,m)=>a.e(Ec(_,t,r,m),{u_world:d}),zc=(_,t,r,d,m)=>{const y=_.transform;let v,T,C=0;if(r.paint.get("circle-pitch-alignment")==="map"){const D=a.at(t,1,y.zoom);v=!0,T=[D,D],C=D/(a.X*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*m}else v=!1,T=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:T,u_globe_extrude_scale:C,u_translate:d}},Wu=_=>({u_pixel_extrude_scale:[1/_.width,1/_.height]}),Xu=_=>({u_viewport_size:[_.width,_.height]}),Rc=(_,t=1)=>({u_color:_,u_overlay:0,u_overlay_scale:t}),Lc=(_,t,r,d)=>{const m=a.at(_,1,t)/(a.X*Math.pow(2,_.tileID.overscaledZ))*2*Math.PI*d;return{u_extrude_scale:a.at(_,1,t),u_intensity:r,u_globe_extrude_scale:m}},hr=(_,t,r,d)=>{const m=a.H();a.bL(m,0,_.width,_.height,0,0,1);const y=_.context.gl;return{u_matrix:m,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:r,u_color_ramp:d,u_opacity:t.paint.get("heatmap-opacity")}},Ku=(_,t,r)=>{const d=r.paint.get("hillshade-shadow-color"),m=r.paint.get("hillshade-highlight-color"),y=r.paint.get("hillshade-accent-color");let v=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);return r.paint.get("hillshade-illumination-anchor")==="viewport"&&(v+=_.transform.bearingInRadians),{u_image:0,u_latrange:ua(0,t.tileID),u_light:[r.paint.get("hillshade-exaggeration"),v],u_shadow:d,u_highlight:m,u_accent:y}},Yu=(_,t)=>{const r=t.stride,d=a.H();return a.bL(d,0,a.X,-8192,0,0,1),a.J(d,d,[0,-8192,0]),{u_matrix:d,u_image:1,u_dimension:[r,r],u_zoom:_.overscaledZ,u_unpack:t.getUnpackVector()}};function ua(_,t){const r=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new a.Y(0,d/r).toLngLat().lat,new a.Y(0,(d+1)/r).toLngLat().lat]}const Fc=(_,t,r,d)=>{const m=_.transform;return{u_translation:Bc(_,t,r),u_ratio:d/a.at(t,1,m.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},ol=(_,t,r,d,m)=>a.e(Fc(_,t,r,d),{u_image:0,u_image_height:m}),Cp=(_,t,r,d,m)=>{const y=_.transform,v=Oc(t,y);return{u_translation:Bc(_,t,r),u_texsize:t.imageAtlasTexture.size,u_ratio:d/a.at(t,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[v,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},kp=(_,t,r,d,m,y)=>{const v=_.lineAtlas,T=Oc(t,_.transform),C=r.layout.get("line-cap")==="round",D=v.getDash(m.from,C),L=v.getDash(m.to,C),B=D.width*y.fromScale,V=L.width*y.toScale;return a.e(Fc(_,t,r,d),{u_patternscale_a:[T/B,-D.height/2],u_patternscale_b:[T/V,-L.height/2],u_sdfgamma:v.width/(256*Math.min(B,V)*_.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:L.y,u_mix:y.t})};function Oc(_,t){return 1/a.at(_,1,t.tileZoom)}function Bc(_,t,r){return a.au(_.transform,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Ju=(_,t,r,d,m)=>{return{u_tl_parent:_,u_scale_parent:t,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(v=d.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(y=d.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:jc(d.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var y,v};function jc(_){_*=Math.PI/180;const t=Math.sin(_),r=Math.cos(_);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Nc=(_,t,r,d,m,y,v,T,C,D,L,B,V)=>{const Z=v.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:Z.width/Z.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:T,u_coord_matrix:C,u_is_text:+L,u_pitch_with_map:+d,u_is_along_line:m,u_is_variable_anchor:y,u_texsize:B,u_texture:0,u_translation:D,u_pitched_scale:V}},da=(_,t,r,d,m,y,v,T,C,D,L,B,V,Z)=>{const W=v.transform;return a.e(Nc(_,t,r,d,m,y,v,T,C,D,L,B,Z),{u_gamma_scale:d?Math.cos(W.pitch*Math.PI/180)*W.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},Zn=(_,t,r,d,m,y,v,T,C,D,L,B,V)=>a.e(da(_,t,r,d,m,y,v,T,C,D,!0,L,0,V),{u_texsize_icon:B,u_texture_icon:1}),Vc=(_,t)=>({u_opacity:_,u_color:t}),$c=(_,t,r,d,m)=>a.e(function(y,v,T,C){const D=T.imageManager.getPattern(y.from.toString()),L=T.imageManager.getPattern(y.to.toString()),{width:B,height:V}=T.imageManager.getPixelSize(),Z=Math.pow(2,C.tileID.overscaledZ),W=C.tileSize*Math.pow(2,T.transform.tileZoom)/Z,at=W*(C.tileID.canonical.x+C.tileID.wrap*Z),ot=W*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[B,V],u_mix:v.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/a.at(C,1,T.transform.tileZoom),u_pixel_coord_upper:[at>>16,ot>>16],u_pixel_coord_lower:[65535&at,65535&ot]}}(r,m,t,d),{u_opacity:_}),al=(_,t)=>{},Qu={fillExtrusion:(_,t)=>({u_lightpos:new a.bG(_,t.u_lightpos),u_lightpos_globe:new a.bG(_,t.u_lightpos_globe),u_lightintensity:new a.b5(_,t.u_lightintensity),u_lightcolor:new a.bG(_,t.u_lightcolor),u_vertical_gradient:new a.b5(_,t.u_vertical_gradient),u_opacity:new a.b5(_,t.u_opacity),u_fill_translate:new a.bH(_,t.u_fill_translate)}),fillExtrusionPattern:(_,t)=>({u_lightpos:new a.bG(_,t.u_lightpos),u_lightpos_globe:new a.bG(_,t.u_lightpos_globe),u_lightintensity:new a.b5(_,t.u_lightintensity),u_lightcolor:new a.bG(_,t.u_lightcolor),u_vertical_gradient:new a.b5(_,t.u_vertical_gradient),u_height_factor:new a.b5(_,t.u_height_factor),u_opacity:new a.b5(_,t.u_opacity),u_fill_translate:new a.bH(_,t.u_fill_translate),u_image:new a.bC(_,t.u_image),u_texsize:new a.bH(_,t.u_texsize),u_pixel_coord_upper:new a.bH(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.bH(_,t.u_pixel_coord_lower),u_scale:new a.bG(_,t.u_scale),u_fade:new a.b5(_,t.u_fade)}),fill:(_,t)=>({u_fill_translate:new a.bH(_,t.u_fill_translate)}),fillPattern:(_,t)=>({u_image:new a.bC(_,t.u_image),u_texsize:new a.bH(_,t.u_texsize),u_pixel_coord_upper:new a.bH(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.bH(_,t.u_pixel_coord_lower),u_scale:new a.bG(_,t.u_scale),u_fade:new a.b5(_,t.u_fade),u_fill_translate:new a.bH(_,t.u_fill_translate)}),fillOutline:(_,t)=>({u_world:new a.bH(_,t.u_world),u_fill_translate:new a.bH(_,t.u_fill_translate)}),fillOutlinePattern:(_,t)=>({u_world:new a.bH(_,t.u_world),u_image:new a.bC(_,t.u_image),u_texsize:new a.bH(_,t.u_texsize),u_pixel_coord_upper:new a.bH(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.bH(_,t.u_pixel_coord_lower),u_scale:new a.bG(_,t.u_scale),u_fade:new a.b5(_,t.u_fade),u_fill_translate:new a.bH(_,t.u_fill_translate)}),circle:(_,t)=>({u_camera_to_center_distance:new a.b5(_,t.u_camera_to_center_distance),u_scale_with_map:new a.bC(_,t.u_scale_with_map),u_pitch_with_map:new a.bC(_,t.u_pitch_with_map),u_extrude_scale:new a.bH(_,t.u_extrude_scale),u_device_pixel_ratio:new a.b5(_,t.u_device_pixel_ratio),u_globe_extrude_scale:new a.b5(_,t.u_globe_extrude_scale),u_translate:new a.bH(_,t.u_translate)}),collisionBox:(_,t)=>({u_pixel_extrude_scale:new a.bH(_,t.u_pixel_extrude_scale)}),collisionCircle:(_,t)=>({u_viewport_size:new a.bH(_,t.u_viewport_size)}),debug:(_,t)=>({u_color:new a.bF(_,t.u_color),u_overlay:new a.bC(_,t.u_overlay),u_overlay_scale:new a.b5(_,t.u_overlay_scale)}),depth:al,clippingMask:al,heatmap:(_,t)=>({u_extrude_scale:new a.b5(_,t.u_extrude_scale),u_intensity:new a.b5(_,t.u_intensity),u_globe_extrude_scale:new a.b5(_,t.u_globe_extrude_scale)}),heatmapTexture:(_,t)=>({u_matrix:new a.bD(_,t.u_matrix),u_world:new a.bH(_,t.u_world),u_image:new a.bC(_,t.u_image),u_color_ramp:new a.bC(_,t.u_color_ramp),u_opacity:new a.b5(_,t.u_opacity)}),hillshade:(_,t)=>({u_image:new a.bC(_,t.u_image),u_latrange:new a.bH(_,t.u_latrange),u_light:new a.bH(_,t.u_light),u_shadow:new a.bF(_,t.u_shadow),u_highlight:new a.bF(_,t.u_highlight),u_accent:new a.bF(_,t.u_accent)}),hillshadePrepare:(_,t)=>({u_matrix:new a.bD(_,t.u_matrix),u_image:new a.bC(_,t.u_image),u_dimension:new a.bH(_,t.u_dimension),u_zoom:new a.b5(_,t.u_zoom),u_unpack:new a.bE(_,t.u_unpack)}),line:(_,t)=>({u_translation:new a.bH(_,t.u_translation),u_ratio:new a.b5(_,t.u_ratio),u_device_pixel_ratio:new a.b5(_,t.u_device_pixel_ratio),u_units_to_pixels:new a.bH(_,t.u_units_to_pixels)}),lineGradient:(_,t)=>({u_translation:new a.bH(_,t.u_translation),u_ratio:new a.b5(_,t.u_ratio),u_device_pixel_ratio:new a.b5(_,t.u_device_pixel_ratio),u_units_to_pixels:new a.bH(_,t.u_units_to_pixels),u_image:new a.bC(_,t.u_image),u_image_height:new a.b5(_,t.u_image_height)}),linePattern:(_,t)=>({u_translation:new a.bH(_,t.u_translation),u_texsize:new a.bH(_,t.u_texsize),u_ratio:new a.b5(_,t.u_ratio),u_device_pixel_ratio:new a.b5(_,t.u_device_pixel_ratio),u_image:new a.bC(_,t.u_image),u_units_to_pixels:new a.bH(_,t.u_units_to_pixels),u_scale:new a.bG(_,t.u_scale),u_fade:new a.b5(_,t.u_fade)}),lineSDF:(_,t)=>({u_translation:new a.bH(_,t.u_translation),u_ratio:new a.b5(_,t.u_ratio),u_device_pixel_ratio:new a.b5(_,t.u_device_pixel_ratio),u_units_to_pixels:new a.bH(_,t.u_units_to_pixels),u_patternscale_a:new a.bH(_,t.u_patternscale_a),u_patternscale_b:new a.bH(_,t.u_patternscale_b),u_sdfgamma:new a.b5(_,t.u_sdfgamma),u_image:new a.bC(_,t.u_image),u_tex_y_a:new a.b5(_,t.u_tex_y_a),u_tex_y_b:new a.b5(_,t.u_tex_y_b),u_mix:new a.b5(_,t.u_mix)}),raster:(_,t)=>({u_tl_parent:new a.bH(_,t.u_tl_parent),u_scale_parent:new a.b5(_,t.u_scale_parent),u_buffer_scale:new a.b5(_,t.u_buffer_scale),u_fade_t:new a.b5(_,t.u_fade_t),u_opacity:new a.b5(_,t.u_opacity),u_image0:new a.bC(_,t.u_image0),u_image1:new a.bC(_,t.u_image1),u_brightness_low:new a.b5(_,t.u_brightness_low),u_brightness_high:new a.b5(_,t.u_brightness_high),u_saturation_factor:new a.b5(_,t.u_saturation_factor),u_contrast_factor:new a.b5(_,t.u_contrast_factor),u_spin_weights:new a.bG(_,t.u_spin_weights),u_coords_top:new a.bE(_,t.u_coords_top),u_coords_bottom:new a.bE(_,t.u_coords_bottom)}),symbolIcon:(_,t)=>({u_is_size_zoom_constant:new a.bC(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bC(_,t.u_is_size_feature_constant),u_size_t:new a.b5(_,t.u_size_t),u_size:new a.b5(_,t.u_size),u_camera_to_center_distance:new a.b5(_,t.u_camera_to_center_distance),u_pitch:new a.b5(_,t.u_pitch),u_rotate_symbol:new a.bC(_,t.u_rotate_symbol),u_aspect_ratio:new a.b5(_,t.u_aspect_ratio),u_fade_change:new a.b5(_,t.u_fade_change),u_label_plane_matrix:new a.bD(_,t.u_label_plane_matrix),u_coord_matrix:new a.bD(_,t.u_coord_matrix),u_is_text:new a.bC(_,t.u_is_text),u_pitch_with_map:new a.bC(_,t.u_pitch_with_map),u_is_along_line:new a.bC(_,t.u_is_along_line),u_is_variable_anchor:new a.bC(_,t.u_is_variable_anchor),u_texsize:new a.bH(_,t.u_texsize),u_texture:new a.bC(_,t.u_texture),u_translation:new a.bH(_,t.u_translation),u_pitched_scale:new a.b5(_,t.u_pitched_scale)}),symbolSDF:(_,t)=>({u_is_size_zoom_constant:new a.bC(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bC(_,t.u_is_size_feature_constant),u_size_t:new a.b5(_,t.u_size_t),u_size:new a.b5(_,t.u_size),u_camera_to_center_distance:new a.b5(_,t.u_camera_to_center_distance),u_pitch:new a.b5(_,t.u_pitch),u_rotate_symbol:new a.bC(_,t.u_rotate_symbol),u_aspect_ratio:new a.b5(_,t.u_aspect_ratio),u_fade_change:new a.b5(_,t.u_fade_change),u_label_plane_matrix:new a.bD(_,t.u_label_plane_matrix),u_coord_matrix:new a.bD(_,t.u_coord_matrix),u_is_text:new a.bC(_,t.u_is_text),u_pitch_with_map:new a.bC(_,t.u_pitch_with_map),u_is_along_line:new a.bC(_,t.u_is_along_line),u_is_variable_anchor:new a.bC(_,t.u_is_variable_anchor),u_texsize:new a.bH(_,t.u_texsize),u_texture:new a.bC(_,t.u_texture),u_gamma_scale:new a.b5(_,t.u_gamma_scale),u_device_pixel_ratio:new a.b5(_,t.u_device_pixel_ratio),u_is_halo:new a.bC(_,t.u_is_halo),u_translation:new a.bH(_,t.u_translation),u_pitched_scale:new a.b5(_,t.u_pitched_scale)}),symbolTextAndIcon:(_,t)=>({u_is_size_zoom_constant:new a.bC(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bC(_,t.u_is_size_feature_constant),u_size_t:new a.b5(_,t.u_size_t),u_size:new a.b5(_,t.u_size),u_camera_to_center_distance:new a.b5(_,t.u_camera_to_center_distance),u_pitch:new a.b5(_,t.u_pitch),u_rotate_symbol:new a.bC(_,t.u_rotate_symbol),u_aspect_ratio:new a.b5(_,t.u_aspect_ratio),u_fade_change:new a.b5(_,t.u_fade_change),u_label_plane_matrix:new a.bD(_,t.u_label_plane_matrix),u_coord_matrix:new a.bD(_,t.u_coord_matrix),u_is_text:new a.bC(_,t.u_is_text),u_pitch_with_map:new a.bC(_,t.u_pitch_with_map),u_is_along_line:new a.bC(_,t.u_is_along_line),u_is_variable_anchor:new a.bC(_,t.u_is_variable_anchor),u_texsize:new a.bH(_,t.u_texsize),u_texsize_icon:new a.bH(_,t.u_texsize_icon),u_texture:new a.bC(_,t.u_texture),u_texture_icon:new a.bC(_,t.u_texture_icon),u_gamma_scale:new a.b5(_,t.u_gamma_scale),u_device_pixel_ratio:new a.b5(_,t.u_device_pixel_ratio),u_is_halo:new a.bC(_,t.u_is_halo),u_translation:new a.bH(_,t.u_translation),u_pitched_scale:new a.b5(_,t.u_pitched_scale)}),background:(_,t)=>({u_opacity:new a.b5(_,t.u_opacity),u_color:new a.bF(_,t.u_color)}),backgroundPattern:(_,t)=>({u_opacity:new a.b5(_,t.u_opacity),u_image:new a.bC(_,t.u_image),u_pattern_tl_a:new a.bH(_,t.u_pattern_tl_a),u_pattern_br_a:new a.bH(_,t.u_pattern_br_a),u_pattern_tl_b:new a.bH(_,t.u_pattern_tl_b),u_pattern_br_b:new a.bH(_,t.u_pattern_br_b),u_texsize:new a.bH(_,t.u_texsize),u_mix:new a.b5(_,t.u_mix),u_pattern_size_a:new a.bH(_,t.u_pattern_size_a),u_pattern_size_b:new a.bH(_,t.u_pattern_size_b),u_scale_a:new a.b5(_,t.u_scale_a),u_scale_b:new a.b5(_,t.u_scale_b),u_pixel_coord_upper:new a.bH(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.bH(_,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.b5(_,t.u_tile_units_to_pixels)}),terrain:(_,t)=>({u_texture:new a.bC(_,t.u_texture),u_ele_delta:new a.b5(_,t.u_ele_delta),u_fog_matrix:new a.bD(_,t.u_fog_matrix),u_fog_color:new a.bF(_,t.u_fog_color),u_fog_ground_blend:new a.b5(_,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.b5(_,t.u_fog_ground_blend_opacity),u_horizon_color:new a.bF(_,t.u_horizon_color),u_horizon_fog_blend:new a.b5(_,t.u_horizon_fog_blend),u_is_globe_mode:new a.b5(_,t.u_is_globe_mode)}),terrainDepth:(_,t)=>({u_ele_delta:new a.b5(_,t.u_ele_delta)}),terrainCoords:(_,t)=>({u_texture:new a.bC(_,t.u_texture),u_terrain_coords_id:new a.b5(_,t.u_terrain_coords_id),u_ele_delta:new a.b5(_,t.u_ele_delta)}),projectionErrorMeasurement:(_,t)=>({u_input:new a.b5(_,t.u_input),u_output_expected:new a.b5(_,t.u_output_expected)}),atmosphere:(_,t)=>({u_sun_pos:new a.bG(_,t.u_sun_pos),u_atmosphere_blend:new a.b5(_,t.u_atmosphere_blend),u_globe_position:new a.bG(_,t.u_globe_position),u_globe_radius:new a.b5(_,t.u_globe_radius),u_inv_proj_matrix:new a.bD(_,t.u_inv_proj_matrix)}),sky:(_,t)=>({u_sky_color:new a.bF(_,t.u_sky_color),u_horizon_color:new a.bF(_,t.u_horizon_color),u_horizon:new a.bH(_,t.u_horizon),u_horizon_normal:new a.bH(_,t.u_horizon_normal),u_sky_horizon_blend:new a.b5(_,t.u_sky_horizon_blend),u_sky_blend:new a.b5(_,t.u_sky_blend)})};class Uc{constructor(t,r,d){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Lr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hc{constructor(t,r,d,m){this.length=r.length,this.attributes=d,this.itemSize=r.bytesPerElement,this.dynamicDraw=m,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),t.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let d=0;d<this.attributes.length;d++){const m=r.attributes[this.attributes[d].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,r,d){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],v=r.attributes[y.name];v!==void 0&&t.vertexAttribPointer(v,y.components,t[Lr[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class di{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ip extends di{getDefault(){return a.b4.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Dp extends di{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ap extends di{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class td extends di{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ep extends di{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ed extends di{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ll extends di{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class cl extends di{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class hl extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Zc extends di{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Fr extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class _o extends di{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class fn extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class id extends di{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class sd extends di{getDefault(){return a.b4.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Gc extends di{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Or extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class ul extends di{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class dl extends di{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class fa extends di{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class fl extends di{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class nd extends di{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class yo extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class xo extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class rd extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class qc extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class li extends di{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class pl extends di{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const d=this.gl;bn(d)?d.bindVertexArray(t):(r=d.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class zp extends di{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class od extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class pa extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Wc extends di{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Rp extends Wc{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ad extends Wc{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Lp extends Wc{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const ml="Framebuffer is not complete";class gl{constructor(t,r,d,m,y){this.context=t,this.width=r,this.height=d;const v=t.gl,T=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Rp(t,T),m)this.depthAttachment=y?new Lp(t,T):new ad(t,T);else if(y)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(ml)}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const d=this.depthAttachment.get();d&&t.deleteRenderbuffer(d)}t.deleteFramebuffer(this.framebuffer)}}class _l{constructor(t){var r,d;if(this.gl=t,this.clearColor=new Ip(this),this.clearDepth=new Dp(this),this.clearStencil=new Ap(this),this.colorMask=new td(this),this.depthMask=new Ep(this),this.stencilMask=new ed(this),this.stencilFunc=new ll(this),this.stencilOp=new cl(this),this.stencilTest=new hl(this),this.depthRange=new Zc(this),this.depthTest=new Fr(this),this.depthFunc=new _o(this),this.blend=new fn(this),this.blendFunc=new id(this),this.blendColor=new sd(this),this.blendEquation=new Gc(this),this.cullFace=new Or(this),this.cullFaceSide=new ul(this),this.frontFace=new dl(this),this.program=new fa(this),this.activeTexture=new fl(this),this.viewport=new nd(this),this.bindFramebuffer=new yo(this),this.bindRenderbuffer=new xo(this),this.bindTexture=new rd(this),this.bindVertexBuffer=new qc(this),this.bindElementBuffer=new li(this),this.bindVertexArray=new pl(this),this.pixelStoreUnpack=new zp(this),this.pixelStoreUnpackPremultiplyAlpha=new od(this),this.pixelStoreUnpackFlipY=new pa(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),bn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const m=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(d=t.RGB16F)!==null&&d!==void 0?d:m==null?void 0:m.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const m=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new Uc(this,t,r)}createVertexBuffer(t,r,d){return new Hc(this,t,r,d)}createRenderbuffer(t,r,d){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,t,r,d),this.bindRenderbuffer.set(null),y}createFramebuffer(t,r,d,m){return new gl(this,t,r,d,m)}clear({color:t,depth:r,stencil:d}){const m=this.gl;let y=0;t&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),d!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.bz(t.blendFunction,Ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return bn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return bn(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let bo;function yl(_,t,r,d,m){const y=_.context,v=_.transform,T=y.gl,C=_.useProgram("collisionBox"),D=[];let L=0,B=0;for(let lt=0;lt<d.length;lt++){const ut=d[lt],gt=t.getTile(ut).getBucket(r);if(!gt)continue;const _t=m?gt.textCollisionBox:gt.iconCollisionBox,yt=gt.collisionCircleArray;yt.length>0&&(D.push({circleArray:yt,circleOffset:B,coord:ut}),L+=yt.length/4,B=L),_t&&C.draw(y,T.LINES,Ze.disabled,ri.disabled,_.colorModeForRenderPass(),si.disabled,Wu(_.transform),_.style.map.terrain&&_.style.map.terrain.getTerrainData(ut),v.getProjectionData({overscaledTileID:ut,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,_.transform.zoom,null,null,_t.collisionVertexBuffer)}if(!m||!D.length)return;const V=_.useProgram("collisionCircle"),Z=new a.bM;Z.resize(4*L),Z._trim();let W=0;for(const lt of D)for(let ut=0;ut<lt.circleArray.length/4;ut++){const gt=4*ut,_t=lt.circleArray[gt+0],yt=lt.circleArray[gt+1],wt=lt.circleArray[gt+2],vt=lt.circleArray[gt+3];Z.emplace(W++,_t,yt,wt,vt,0),Z.emplace(W++,_t,yt,wt,vt,1),Z.emplace(W++,_t,yt,wt,vt,2),Z.emplace(W++,_t,yt,wt,vt,3)}(!bo||bo.length<2*L)&&(bo=function(lt){const ut=2*lt,gt=new a.bO;gt.resize(ut),gt._trim();for(let _t=0;_t<ut;_t++){const yt=6*_t;gt.uint16[yt+0]=4*_t+0,gt.uint16[yt+1]=4*_t+1,gt.uint16[yt+2]=4*_t+2,gt.uint16[yt+3]=4*_t+2,gt.uint16[yt+4]=4*_t+3,gt.uint16[yt+5]=4*_t+0}return gt}(L));const at=y.createIndexBuffer(bo,!0),ot=y.createVertexBuffer(Z,a.bN.members,!0);for(const lt of D){const ut=Xu(_.transform);V.draw(y,T.TRIANGLES,Ze.disabled,ri.disabled,_.colorModeForRenderPass(),si.disabled,ut,_.style.map.terrain&&_.style.map.terrain.getTerrainData(lt.coord),null,r.id,ot,at,a.aD.simpleSegment(0,2*lt.circleOffset,lt.circleArray.length,lt.circleArray.length/2),null,_.transform.zoom,null,null,null)}ot.destroy(),at.destroy()}const ld=a.aq(new Float32Array(16));function xl(_,t,r,d,m,y){const{horizontalAlign:v,verticalAlign:T}=a.ay(_);return new a.P((-(v-.5)*t/m+d[0])*y,(-(T-.5)*r/m+d[1])*y)}function bl(_,t,r,d,m,y){const v=t.tileAnchorPoint.add(new a.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let T=d.mult(y);r||(T=T.rotate(-m));const C=v.add(T);return $t(C.x,C.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(r){const T=Se(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(_),C=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return _.add(d.rotate(C))}return _.add(d)}function Xc(_,t,r,d,m,y,v,T,C,D,L,B){const V=_.text.placedSymbolArray,Z=_.text.dynamicLayoutVertexArray,W=_.icon.dynamicLayoutVertexArray,at={};Z.clear();for(let ot=0;ot<V.length;ot++){const lt=V.get(ot),ut=lt.hidden||!lt.crossTileID||_.allowVerticalPlacement&&!lt.placedOrientation?null:d[lt.crossTileID];if(ut){const gt=new a.P(lt.anchorX,lt.anchorY),_t={getElevation:B,width:m.width,height:m.height,pitchedLabelPlaneMatrix:y,pitchWithMap:r,transform:m,tileAnchorPoint:gt,translation:D,unwrappedTileID:L},yt=r?ni(gt.x,gt.y,_t):Se(gt.x,gt.y,_t),wt=Dt(m.cameraToCenterDistance,yt.signedDistanceFromCamera);let vt=a.aj(_.textSizeData,T,lt)*wt/a.as;r&&(vt*=_.tilePixelRatio/v);const{width:zt,height:Ot,anchor:qt,textOffset:Kt,textBoxScale:Ut}=ut,ce=xl(qt,zt,Ot,Kt,Ut,vt),ae=m.getPitchedTextCorrection(gt.x+D[0],gt.y+D[1],L),te=bl(yt.point,_t,t,ce,-m.bearingInRadians,ae),pe=_.allowVerticalPlacement&&lt.placedOrientation===a.ai.vertical?Math.PI/2:0;for(let Ge=0;Ge<lt.numGlyphs;Ge++)a.ak(Z,te,pe);C&&lt.associatedIconIndex>=0&&(at[lt.associatedIconIndex]={shiftedAnchor:te,angle:pe})}else ds(lt.numGlyphs,Z)}if(C){W.clear();const ot=_.icon.placedSymbolArray;for(let lt=0;lt<ot.length;lt++){const ut=ot.get(lt);if(ut.hidden)ds(ut.numGlyphs,W);else{const gt=at[lt];if(gt)for(let _t=0;_t<ut.numGlyphs;_t++)a.ak(W,gt.shiftedAnchor,gt.angle);else ds(ut.numGlyphs,W)}}_.icon.dynamicLayoutVertexBuffer.updateData(W)}_.text.dynamicLayoutVertexBuffer.updateData(Z)}function Fp(_,t,r){return r.iconsInText&&t?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function vl(_,t,r,d,m,y,v,T,C,D,L,B,V){const Z=_.context,W=Z.gl,at=_.transform,ot=T==="map",lt=C==="map",ut=T!=="viewport"&&r.layout.get("symbol-placement")!=="point",gt=ot&&!lt&&!ut,_t=!r.layout.get("symbol-sort-key").isConstant();let yt=!1;const wt=_.getDepthModeForSublayer(0,Ze.ReadOnly),vt=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),zt=[],Ot=at.getCircleRadiusCorrection();for(const qt of d){const Kt=t.getTile(qt),Ut=Kt.getBucket(r);if(!Ut)continue;const ce=m?Ut.text:Ut.icon;if(!ce||!ce.segments.get().length||!ce.hasVisibleVertices)continue;const ae=ce.programConfigurations.get(r.id),te=m||Ut.sdfIcons,pe=m?Ut.textSizeData:Ut.iconSizeData,Ge=lt||at.pitch!==0,oi=_.useProgram(Fp(te,m,Ut),ae),Bi=a.ah(pe,at.zoom),yi=_.style.map.terrain&&_.style.map.terrain.getTerrainData(qt);let ji,xi,gi,bi,Ts=[0,0],ls=null;if(m)xi=Kt.glyphAtlasTexture,gi=W.LINEAR,ji=Kt.glyphAtlasTexture.size,Ut.iconsInText&&(Ts=Kt.imageAtlasTexture.size,ls=Kt.imageAtlasTexture,bi=Ge||_.options.rotating||_.options.zooming||pe.kind==="composite"||pe.kind==="camera"?W.LINEAR:W.NEAREST);else{const vi=r.layout.get("icon-size").constantOr(0)!==1||Ut.iconsNeedLinear;xi=Kt.imageAtlasTexture,gi=te||_.options.rotating||_.options.zooming||vi||Ge?W.LINEAR:W.NEAREST,ji=Kt.imageAtlasTexture.size}const cs=a.at(Kt,1,_.transform.zoom),Os=Bt(ot,_.transform,cs),Xn=a.H();a.an(Xn,Os);const Bn=kt(lt,ot,_.transform,cs),sn=a.au(at,Kt,y,v),Kn=at.getProjectionData({overscaledTileID:qt,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),Ca=vt&&Ut.hasTextData(),ka=r.layout.get("icon-text-fit")!=="none"&&Ca&&Ut.hasIconData();if(ut){const vi=_.style.map.terrain?(rn,Ui)=>_.style.map.terrain.getElevation(qt,rn,Ui):null,Ni=r.layout.get("text-rotation-alignment")==="map";he(Ut,_,m,Os,Xn,lt,D,Ni,qt.toUnwrapped(),at.width,at.height,sn,vi)}const Ao=m&&vt||ka,Vs=ut||Ao?ld:lt?Os:_.transform.clipSpaceToPixelsMatrix,mn=te&&r.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let gn;gn=te?Ut.iconsInText?Zn(pe.kind,Bi,gt,lt,ut,Ao,_,Vs,Bn,sn,ji,Ts,Ot):da(pe.kind,Bi,gt,lt,ut,Ao,_,Vs,Bn,sn,m,ji,0,Ot):Nc(pe.kind,Bi,gt,lt,ut,Ao,_,Vs,Bn,sn,m,ji,Ot);const nn={program:oi,buffers:ce,uniformValues:gn,projectionData:Kn,atlasTexture:xi,atlasTextureIcon:ls,atlasInterpolation:gi,atlasInterpolationIcon:bi,isSDF:te,hasHalo:mn};if(_t&&Ut.canOverlap){yt=!0;const vi=ce.segments.get();for(const Ni of vi)zt.push({segments:new a.aD([Ni]),sortKey:Ni.sortKey,state:nn,terrainData:yi})}else zt.push({segments:ce.segments,sortKey:0,state:nn,terrainData:yi})}yt&&zt.sort((qt,Kt)=>qt.sortKey-Kt.sortKey);for(const qt of zt){const Kt=qt.state;if(Z.activeTexture.set(W.TEXTURE0),Kt.atlasTexture.bind(Kt.atlasInterpolation,W.CLAMP_TO_EDGE),Kt.atlasTextureIcon&&(Z.activeTexture.set(W.TEXTURE1),Kt.atlasTextureIcon&&Kt.atlasTextureIcon.bind(Kt.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Kt.isSDF){const Ut=Kt.uniformValues;Kt.hasHalo&&(Ut.u_is_halo=1,cd(Kt.buffers,qt.segments,r,_,Kt.program,wt,L,B,Ut,Kt.projectionData,qt.terrainData)),Ut.u_is_halo=0}cd(Kt.buffers,qt.segments,r,_,Kt.program,wt,L,B,Kt.uniformValues,Kt.projectionData,qt.terrainData)}}function cd(_,t,r,d,m,y,v,T,C,D,L){const B=d.context;m.draw(B,B.gl.TRIANGLES,y,v,T,si.backCCW,C,L,D,r.id,_.layoutVertexBuffer,_.indexBuffer,t,r.paint,d.transform.zoom,_.programConfigurations.get(r.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function hd(_,t,r,d,m){const y=_.context,v=y.gl,T=ri.disabled,C=new Ai([v.ONE,v.ONE],a.b4.transparent,[!0,!0,!0,!0]),D=t.getBucket(r);if(!D)return;const L=d.key;let B=r.heatmapFbos.get(L);B||(B=Sl(y,t.tileSize,t.tileSize),r.heatmapFbos.set(L,B)),y.bindFramebuffer.set(B.framebuffer),y.viewport.set([0,0,t.tileSize,t.tileSize]),y.clear({color:a.b4.transparent});const V=D.programConfigurations.get(r.id),Z=_.useProgram("heatmap",V,!m),W=_.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),at=_.style.map.terrain.getTerrainData(d);Z.draw(y,v.TRIANGLES,Ze.disabled,T,C,si.disabled,Lc(t,_.transform.zoom,r.paint.get("heatmap-intensity"),1),at,W,r.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,r.paint,_.transform.zoom,V)}function wl(_,t,r,d,m){const y=_.context,v=y.gl,T=_.transform;y.setColorMode(_.colorModeForRenderPass());const C=Kc(y,t),D=r.key,L=t.heatmapFbos.get(D);if(!L)return;y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,L.colorAttachment.get()),y.activeTexture.set(v.TEXTURE1),C.bind(v.LINEAR,v.CLAMP_TO_EDGE);const B=T.getProjectionData({overscaledTileID:r,applyTerrainMatrix:m,applyGlobeMatrix:!d});_.useProgram("heatmapTexture").draw(y,v.TRIANGLES,Ze.disabled,ri.disabled,_.colorModeForRenderPass(),si.disabled,hr(_,t,0,1),null,B,t.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,t.paint,T.zoom),L.destroy(),t.heatmapFbos.delete(D)}function Sl(_,t,r){var d,m;const y=_.gl,v=y.createTexture();y.bindTexture(y.TEXTURE_2D,v),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const T=(d=_.HALF_FLOAT)!==null&&d!==void 0?d:y.UNSIGNED_BYTE,C=(m=_.RGBA16F)!==null&&m!==void 0?m:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,C,t,r,0,y.RGBA,T,null);const D=_.createFramebuffer(t,r,!1,!1);return D.colorAttachment.set(v),D}function Kc(_,t){return t.colorRampTexture||(t.colorRampTexture=new ie(_,t.colorRamp,_.gl.RGBA)),t.colorRampTexture}function Yc(_,t,r,d,m){if(!r||!d||!d.imageAtlas)return;const y=d.imageAtlas.patternPositions;let v=y[r.to.toString()],T=y[r.from.toString()];if(!v&&T&&(v=T),!T&&v&&(T=v),!v||!T){const C=m.getPaintProperty(t);v=y[C],T=y[C]}v&&T&&_.setConstantPatternPositions(v,T)}function ma(_,t,r,d,m,y,v,T){const C=_.context.gl,D="fill-pattern",L=r.paint.get(D),B=L&&L.constantOr(1),V=r.getCrossfadeParameters();let Z,W,at,ot,lt;const ut=_.transform,gt=r.paint.get("fill-translate"),_t=r.paint.get("fill-translate-anchor");v?(W=B&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=C.LINES):(W=B?"fillPattern":"fill",Z=C.TRIANGLES);const yt=L.constantOr(null);for(const wt of d){const vt=t.getTile(wt);if(B&&!vt.patternsLoaded())continue;const zt=vt.getBucket(r);if(!zt)continue;const Ot=zt.programConfigurations.get(r.id),qt=_.useProgram(W,Ot),Kt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(wt);B&&(_.context.activeTexture.set(C.TEXTURE0),vt.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Ot.updatePaintBuffers(V)),Yc(Ot,D,yt,vt,r);const Ut=ut.getProjectionData({overscaledTileID:wt,applyGlobeMatrix:!T,applyTerrainMatrix:!0}),ce=a.au(ut,vt,gt,_t);if(v){ot=zt.indexBuffer2,lt=zt.segments2;const te=[C.drawingBufferWidth,C.drawingBufferHeight];at=W==="fillOutlinePattern"&&B?qu(_,V,vt,te,ce):Pp(te,ce)}else ot=zt.indexBuffer,lt=zt.segments,at=B?Ec(_,V,vt,ce):{u_fill_translate:ce};let ae;if(_.renderPass==="translucent"&&T){const[te]=_.getStencilConfigForOverlapAndUpdateStencilID(d);ae=te[wt.overscaledZ]}else ae=_.stencilModeForClipping(wt);qt.draw(_.context,Z,m,ae,y,si.backCCW,at,Kt,Ut,r.id,zt.layoutVertexBuffer,ot,lt,r.paint,_.transform.zoom,Ot)}}function ga(_,t,r,d,m,y,v,T){const C=_.context,D=C.gl,L="fill-extrusion-pattern",B=r.paint.get(L),V=B.constantOr(1),Z=r.getCrossfadeParameters(),W=r.paint.get("fill-extrusion-opacity"),at=B.constantOr(null),ot=_.transform;for(const lt of d){const ut=t.getTile(lt),gt=ut.getBucket(r);if(!gt)continue;const _t=_.style.map.terrain&&_.style.map.terrain.getTerrainData(lt),yt=gt.programConfigurations.get(r.id),wt=_.useProgram(V?"fillExtrusionPattern":"fillExtrusion",yt);V&&(_.context.activeTexture.set(D.TEXTURE0),ut.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),yt.updatePaintBuffers(Z));const vt=ot.getProjectionData({overscaledTileID:lt,applyGlobeMatrix:!T,applyTerrainMatrix:!0});Yc(yt,L,at,ut,r);const zt=a.au(ot,ut,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Ot=r.paint.get("fill-extrusion-vertical-gradient"),qt=V?Mp(_,Ot,W,zt,lt,Z,ut):Rr(_,Ot,W,zt);wt.draw(C,C.gl.TRIANGLES,m,y,v,si.backCCW,qt,_t,vt,r.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,r.paint,_.transform.zoom,yt,_.style.map.terrain&&gt.centroidVertexBuffer)}}function Jc(_,t,r,d,m,y,v,T,C){var D;const L=_.style.projection,B=_.context,V=_.transform,Z=B.gl,W=_.useProgram("hillshade"),at=!_.options.moving;for(const ot of d){const lt=t.getTile(ot),ut=lt.fbo;if(!ut)continue;const gt=L.getMeshFromTileID(B,ot.canonical,T,!0,"raster"),_t=(D=_.style.map.terrain)===null||D===void 0?void 0:D.getTerrainData(ot);B.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,ut.colorAttachment.get());const yt=V.getProjectionData({overscaledTileID:ot,aligned:at,applyGlobeMatrix:!C,applyTerrainMatrix:!0});W.draw(B,Z.TRIANGLES,y,m[ot.overscaledZ],v,si.backCCW,Ku(_,lt,r),_t,yt,r.id,gt.vertexBuffer,gt.indexBuffer,gt.segments)}}const Tl=[new a.P(0,0),new a.P(a.X,0),new a.P(a.X,a.X),new a.P(0,a.X)];function Fi(_,t,r,d,m,y,v,T,C=!1,D=!1){const L=d[d.length-1].overscaledZ,B=_.context,V=B.gl,Z=_.useProgram("raster"),W=_.transform,at=_.style.projection,ot=_.colorModeForRenderPass(),lt=!_.options.moving;for(const ut of d){const gt=_.getDepthModeForSublayer(ut.overscaledZ-L,r.paint.get("raster-opacity")===1?Ze.ReadWrite:Ze.ReadOnly,V.LESS),_t=t.getTile(ut);_t.registerFadeDuration(r.paint.get("raster-fade-duration"));const yt=t.findLoadedParent(ut,0),wt=t.findLoadedSibling(ut),vt=Br(_t,yt||wt||null,t,r,_.transform,_.style.map.terrain);let zt,Ot;const qt=r.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;B.activeTexture.set(V.TEXTURE0),_t.texture.bind(qt,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(V.TEXTURE1),yt?(yt.texture.bind(qt,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),zt=Math.pow(2,yt.tileID.overscaledZ-_t.tileID.overscaledZ),Ot=[_t.tileID.canonical.x*zt%1,_t.tileID.canonical.y*zt%1]):_t.texture.bind(qt,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),_t.texture.useMipmap&&B.extTextureFilterAnisotropic&&_.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const Kt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ut),Ut=W.getProjectionData({overscaledTileID:ut,aligned:lt,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),ce=Ju(Ot||[0,0],zt||1,vt,r,T),ae=at.getMeshFromTileID(B,ut.canonical,y,v,"raster");Z.draw(B,V.TRIANGLES,gt,m?m[ut.overscaledZ]:ri.disabled,ot,C?si.frontCCW:si.backCCW,ce,Kt,Ut,r.id,ae.vertexBuffer,ae.indexBuffer,ae.segments)}}function Br(_,t,r,d,m,y){const v=d.paint.get("raster-fade-duration");if(!y&&v>0){const T=F.now(),C=(T-_.timeAdded)/v,D=t?(T-t.timeAdded)/v:-1,L=r.getSource(),B=Qs(m,{tileSize:L.tileSize,roundZoom:L.roundZoom}),V=!t||Math.abs(t.tileID.overscaledZ-B)>Math.abs(_.tileID.overscaledZ-B),Z=V&&_.refreshedUponExpiration?1:a.ab(V?C:1-D,0,1);return _.refreshedUponExpiration&&C>=1&&(_.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const pn=new a.b4(1,0,0,1),Qc=new a.b4(0,1,0,1),th=new a.b4(0,0,1,1),ud=new a.b4(1,0,1,1),vo=new a.b4(0,1,1,1);function wo(_,t,r,d){_a(_,0,t+r/2,_.transform.width,r,d)}function Ml(_,t,r,d){_a(_,t-r/2,0,r,_.transform.height,d)}function _a(_,t,r,d,m,y){const v=_.context,T=v.gl;T.enable(T.SCISSOR_TEST),T.scissor(t*_.pixelRatio,r*_.pixelRatio,d*_.pixelRatio,m*_.pixelRatio),v.clear({color:y}),T.disable(T.SCISSOR_TEST)}function dd(_,t,r){const d=_.context,m=d.gl,y=_.useProgram("debug"),v=Ze.disabled,T=ri.disabled,C=_.colorModeForRenderPass(),D="$debug",L=_.style.map.terrain&&_.style.map.terrain.getTerrainData(r);d.activeTexture.set(m.TEXTURE0);const B=t.getTileByID(r.key).latestRawTileData,V=Math.floor((B&&B.byteLength||0)/1024),Z=t.getTile(r).tileSize,W=512/Math.min(Z,512)*(r.overscaledZ/_.transform.zoom)*.5;let at=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(at+=` => ${r.overscaledZ}`),function(lt,ut){lt.initDebugOverlayCanvas();const gt=lt.debugOverlayCanvas,_t=lt.context.gl,yt=lt.debugOverlayCanvas.getContext("2d");yt.clearRect(0,0,gt.width,gt.height),yt.shadowColor="white",yt.shadowBlur=2,yt.lineWidth=1.5,yt.strokeStyle="white",yt.textBaseline="top",yt.font="bold 36px Open Sans, sans-serif",yt.fillText(ut,5,5),yt.strokeText(ut,5,5),lt.debugOverlayTexture.update(gt),lt.debugOverlayTexture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE)}(_,`${at} ${V}kB`);const ot=_.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(d,m.TRIANGLES,v,T,Ai.alphaBlended,si.disabled,Rc(a.b4.transparent,W),null,ot,D,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),y.draw(d,m.LINE_STRIP,v,T,C,si.disabled,Rc(a.b4.red),L,ot,D,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function eh(_,t,r,d){const{isRenderingGlobe:m}=d,y=_.context,v=y.gl,T=_.transform,C=_.colorModeForRenderPass(),D=_.getDepthModeFor3D(),L=_.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,_.width,_.height]);for(const B of r){const V=t.getTerrainMesh(B.tileID),Z=_.renderToTexture.getTexture(B),W=t.getTerrainData(B.tileID);y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,Z.texture);const at=t.getMeshFrameDelta(T.zoom),ot=T.calculateFogMatrix(B.tileID.toUnwrapped()),lt=ca(at,ot,_.style.sky,T.pitch,m),ut=T.getProjectionData({overscaledTileID:B.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});L.draw(y,v.TRIANGLES,D,ri.disabled,C,si.backCCW,lt,W,ut,"terrain",V.vertexBuffer,V.indexBuffer,V.segments)}}function ih(_,t){if(!t.mesh){const r=new a.aC;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const d=new a.aE;d.emplaceBack(0,1,2),d.emplaceBack(0,2,3),t.mesh=new Rn(_.createVertexBuffer(r,Ke.members),_.createIndexBuffer(d),a.aD.simpleSegment(0,0,r.length,d.length))}return t.mesh}class fd{constructor(t,r){this.context=new _l(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=G.maxUnderzooming+G.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ir}resize(t,r,d){if(this.width=Math.floor(t*d),this.height=Math.floor(r*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const t=this.context,r=new a.aC;r.emplaceBack(0,0),r.emplaceBack(a.X,0),r.emplaceBack(0,a.X),r.emplaceBack(a.X,a.X),this.tileExtentBuffer=t.createVertexBuffer(r,Ke.members),this.tileExtentSegments=a.aD.simpleSegment(0,0,4,2);const d=new a.aC;d.emplaceBack(0,0),d.emplaceBack(a.X,0),d.emplaceBack(0,a.X),d.emplaceBack(a.X,a.X),this.debugBuffer=t.createVertexBuffer(d,Ke.members),this.debugSegments=a.aD.simpleSegment(0,0,4,5);const m=new a.bT;m.emplaceBack(0,0,0,0),m.emplaceBack(a.X,0,a.X,0),m.emplaceBack(0,a.X,0,a.X),m.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=t.createVertexBuffer(m,Tp.members),this.rasterBoundsSegments=a.aD.simpleSegment(0,0,4,2);const y=new a.aC;y.emplaceBack(0,0),y.emplaceBack(a.X,0),y.emplaceBack(0,a.X),y.emplaceBack(a.X,a.X),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(y,Ke.members),this.rasterBoundsSegmentsPosOnly=a.aD.simpleSegment(0,0,4,5);const v=new a.aC;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,Ke.members),this.viewportSegments=a.aD.simpleSegment(0,0,4,2);const T=new a.bU;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(T);const C=new a.aE;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(C);const D=this.context.gl;this.stencilClearMode=new ri({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.tileExtentMesh=new Rn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=a.H();a.bL(d,0,this.width,this.height,0,0,1),a.K(d,d,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const m={mainMatrix:d,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:d};this.useProgram("clippingMask",null,!0).draw(t,r.TRIANGLES,Ze.disabled,this.stencilClearMode,Ai.disabled,si.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r,d){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source,this.nextStencilID+r.length>256&&this.clearStencil();const m=this.context;m.setColorMode(Ai.disabled),m.setDepthMode(Ze.disabled);const y={};for(const v of r)y[v.key]=this.nextStencilID++;this._renderTileMasks(y,r,d,!0),this._renderTileMasks(y,r,d,!1),this._tileClippingMaskIDs=y}_renderTileMasks(t,r,d,m){const y=this.context,v=y.gl,T=this.style.projection,C=this.transform,D=this.useProgram("clippingMask");for(const L of r){const B=t[L.key],V=this.style.map.terrain&&this.style.map.terrain.getTerrainData(L),Z=T.getMeshFromTileID(this.context,L.canonical,m,!0,"stencil"),W=C.getProjectionData({overscaledTileID:L,applyGlobeMatrix:!0,applyTerrainMatrix:!0});D.draw(y,v.TRIANGLES,Ze.disabled,new ri({func:v.ALWAYS,mask:0},B,255,v.KEEP,v.KEEP,v.REPLACE),Ai.disabled,d?si.disabled:si.backCCW,null,V,W,"$clipping",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}_renderTilesDepthBuffer(){const t=this.context,r=t.gl,d=this.style.projection,m=this.transform,y=this.useProgram("depth"),v=this.getDepthModeFor3D(),T=st(m,{tileSize:m.tileSize});for(const C of T){const D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),L=d.getMeshFromTileID(this.context,C.canonical,!0,!0,"raster"),B=m.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(t,r.TRIANGLES,v,ri.disabled,Ai.disabled,si.backCCW,null,D,B,"$clipping",L.vertexBuffer,L.indexBuffer,L.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new ri({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new ri({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const r=this.context.gl,d=t.sort((v,T)=>T.overscaledZ-v.overscaledZ),m=d[d.length-1].overscaledZ,y=d[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const v={};for(let T=0;T<y;T++)v[T+m]=new ri({func:r.GEQUAL,mask:255},T+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=y,[v,d]}return[{[m]:ri.disabled},d]}stencilConfigForOverlapTwoPass(t){const r=this.context.gl,d=t.sort((v,T)=>T.overscaledZ-v.overscaledZ),m=d[d.length-1].overscaledZ,y=d[0].overscaledZ-m+1;if(this.clearStencil(),y>1){const v={},T={};for(let C=0;C<y;C++)v[C+m]=new ri({func:r.GREATER,mask:255},y+1+C,255,r.KEEP,r.KEEP,r.REPLACE),T[C+m]=new ri({func:r.GREATER,mask:255},1+C,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*y+1,[v,T,d]}return this.nextStencilID=3,[{[m]:new ri({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[m]:new ri({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ai([t.CONSTANT_COLOR,t.ONE],new a.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ai.unblended:Ai.alphaBlended}getDepthModeForSublayer(t,r,d){if(!this.opaquePassEnabledForLayer())return Ze.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ze(d||this.context.gl.LEQUAL,r,[m,m])}getDepthModeFor3D(){return new Ze(this.context.gl.LEQUAL,Ze.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){var d,m;this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(F.now()),this.imageManager.beginFrame();const y=this.style._order,v=this.style.sourceCaches,T={},C={},D={},L={isRenderingToTexture:!1,isRenderingGlobe:((d=t.projection)===null||d===void 0?void 0:d.transitionState)>0};for(const V in v){const Z=v[V];Z.used&&Z.prepare(this.context),T[V]=Z.getVisibleCoordinates(!1),C[V]=T[V].slice().reverse(),D[V]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<y.length;V++)if(this.style._layers[y[V]].is3D()){this.opaquePassCutoff=V;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const V of y){const Z=this.style._layers[V];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const W=C[Z.source];(Z.type==="custom"||W.length)&&this.renderLayer(this,v[Z.source],Z,W,L)}if((m=this.style.projection)===null||m===void 0||m.updateGPUdependent({context:this.context,useProgram:V=>this.useProgram(V)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?a.b4.black:a.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(V,Z){const W=V.context,at=W.gl,ot=((wt,vt,zt)=>{const Ot=Math.cos(vt.rollInRadians),qt=Math.sin(vt.rollInRadians),Kt=$i(vt),Ut=vt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:wt.properties.get("sky-color"),u_horizon_color:wt.properties.get("horizon-color"),u_horizon:[(vt.width/2-Kt*qt)*zt,(vt.height/2+Kt*Ot)*zt],u_horizon_normal:[-qt,Ot],u_sky_horizon_blend:wt.properties.get("sky-horizon-blend")*vt.height/2*zt,u_sky_blend:Ut}})(Z,V.style.map.transform,V.pixelRatio),lt=new Ze(at.LEQUAL,Ze.ReadWrite,[0,1]),ut=ri.disabled,gt=V.colorModeForRenderPass(),_t=V.useProgram("sky"),yt=ih(W,Z);_t.draw(W,at.TRIANGLES,lt,ut,gt,si.disabled,ot,null,void 0,"sky",yt.vertexBuffer,yt.indexBuffer,yt.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const V=this.style._layers[y[this.currentLayer]],Z=v[V.source],W=T[V.source];this._renderTileClippingMasks(V,W,!1),this.renderLayer(this,Z,V,W,L)}this.renderPass="translucent";let B=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const V=this.style._layers[y[this.currentLayer]],Z=v[V.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(V,L))continue;this.opaquePassEnabledForLayer()||B||(B=!0,L.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const W=(V.type==="symbol"?D:C)[V.source];this._renderTileClippingMasks(V,T[V.source],!1),this.renderLayer(this,Z,V,W,L)}if(L.isRenderingGlobe&&function(V,Z,W){const at=V.context,ot=at.gl,lt=V.useProgram("atmosphere"),ut=new Ze(ot.LEQUAL,Ze.ReadOnly,[0,1]),gt=V.transform,_t=function(Ut,ce){const ae=Ut.properties.get("position"),te=[-ae.x,-ae.y,-ae.z],pe=a.aq(new Float64Array(16));return Ut.properties.get("anchor")==="map"&&(a.aX(pe,pe,ce.rollInRadians),a.aY(pe,pe,-ce.pitchInRadians),a.aX(pe,pe,ce.bearingInRadians),a.aY(pe,pe,ce.center.lat*Math.PI/180),a.bj(pe,pe,-ce.center.lng*Math.PI/180)),a.bS(te,te,pe),te}(W,V.transform),yt=gt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),wt=Z.properties.get("atmosphere-blend")*yt.projectionTransition;if(wt===0)return;const vt=mo(gt.worldSize,gt.center.lat),zt=gt.inverseProjectionMatrix,Ot=new Float64Array(4);Ot[3]=1,a.al(Ot,Ot,gt.modelViewProjectionMatrix),Ot[0]/=Ot[3],Ot[1]/=Ot[3],Ot[2]/=Ot[3],Ot[3]=1,a.al(Ot,Ot,zt),Ot[0]/=Ot[3],Ot[1]/=Ot[3],Ot[2]/=Ot[3],Ot[3]=1;const qt=((Ut,ce,ae,te,pe)=>({u_sun_pos:Ut,u_atmosphere_blend:ce,u_globe_position:ae,u_globe_radius:te,u_inv_proj_matrix:pe}))(_t,wt,[Ot[0],Ot[1],Ot[2]],vt,zt),Kt=ih(at,Z);lt.draw(at,ot.TRIANGLES,ut,ri.disabled,Ai.alphaBlended,si.disabled,qt,null,null,"atmosphere",Kt.vertexBuffer,Kt.indexBuffer,Kt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const V=function(Z,W){let at=null;const ot=Object.values(Z._layers).flatMap(_t=>_t.source&&!_t.isHidden(W)?[Z.sourceCaches[_t.source]]:[]),lt=ot.filter(_t=>_t.getSource().type==="vector"),ut=ot.filter(_t=>_t.getSource().type!=="vector"),gt=_t=>{(!at||at.getSource().maxzoom<_t.getSource().maxzoom)&&(at=_t)};return lt.forEach(_t=>gt(_t)),at||ut.forEach(_t=>gt(_t)),at}(this.style,this.transform.zoom);V&&function(Z,W,at){for(let ot=0;ot<at.length;ot++)dd(Z,W,at[ot])}(this,V,V.getVisibleCoordinates())}this.options.showPadding&&function(V){const Z=V.transform.padding;wo(V,V.transform.height-(Z.top||0),3,pn),wo(V,Z.bottom||0,3,Qc),Ml(V,Z.left||0,3,th),Ml(V,V.transform.width-(Z.right||0),3,ud);const W=V.transform.centerPoint;(function(at,ot,lt,ut){_a(at,ot-1,lt-10,2,20,ut),_a(at,ot-10,lt-1,20,2,ut)})(V,W.x,V.transform.height-W.y,vo)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,d=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=t?!a.bV(r,d):!a.bW(r,d)),m||(m=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(a.bX(r,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,v){const T=y.context,C=T.gl,D=y.transform,L=Ai.unblended,B=new Ze(C.LEQUAL,Ze.ReadWrite,[0,1]),V=v.sourceCache.getRenderableTiles(),Z=y.useProgram("terrainDepth");T.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),T.clear({color:a.b4.transparent,depth:1});for(const W of V){const at=v.getTerrainMesh(W.tileID),ot=v.getTerrainData(W.tileID),lt=D.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ut={u_ele_delta:v.getMeshFrameDelta(D.zoom)};Z.draw(T,C.TRIANGLES,B,ri.disabled,L,si.backCCW,ut,ot,lt,"terrain",at.vertexBuffer,at.indexBuffer,at.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,v){const T=y.context,C=T.gl,D=y.transform,L=Ai.unblended,B=new Ze(C.LEQUAL,Ze.ReadWrite,[0,1]),V=v.getCoordsTexture(),Z=v.sourceCache.getRenderableTiles(),W=y.useProgram("terrainCoords");T.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),T.clear({color:a.b4.transparent,depth:1}),v.coordsIndex=[];for(const at of Z){const ot=v.getTerrainMesh(at.tileID),lt=v.getTerrainData(at.tileID);T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,V.texture);const ut={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(D.zoom)},gt=D.getProjectionData({overscaledTileID:at.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(T,C.TRIANGLES,B,ri.disabled,L,si.backCCW,ut,lt,gt,"terrain",ot.vertexBuffer,ot.indexBuffer,ot.segments),v.coordsIndex.push(at.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(t,r,d,m,y){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||(m||[]).length)&&(this.id=d.id,a.bY(d)?function(v,T,C,D,L,B){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:V}=B,Z=ri.disabled,W=v.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(at,ot,lt,ut,gt,_t,yt,wt,vt){const zt=ot.transform,Ot=ot.style.map.terrain,qt=gt==="map",Kt=_t==="map";for(const Ut of at){const ce=ut.getTile(Ut),ae=ce.getBucket(lt);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const te=a.ah(ae.textSizeData,zt.zoom),pe=a.at(ce,1,ot.transform.zoom),Ge=Bt(qt,ot.transform,pe),oi=lt.layout.get("icon-text-fit")!=="none"&&ae.hasIconData();{const Bi=Math.pow(2,zt.zoom-ce.tileID.overscaledZ),yi=Ot?(ji,xi)=>Ot.getElevation(Ut,ji,xi):null;Xc(ae,qt,Kt,vt,zt,Ge,Bi,te,oi,a.au(zt,ce,yt,wt),Ut.toUnwrapped(),yi)}}}(D,v,C,T,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),L),C.paint.get("icon-opacity").constantOr(1)!==0&&vl(v,T,C,D,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),Z,W,V),C.paint.get("text-opacity").constantOr(1)!==0&&vl(v,T,C,D,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),Z,W,V),T.map.showCollisionBoxes&&(yl(v,T,C,D,!0),yl(v,T,C,D,!1))}(t,r,d,m,this.style.placement.variableOffsets,y):a.bZ(d)?function(v,T,C,D,L){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:B}=L,V=C.paint.get("circle-opacity"),Z=C.paint.get("circle-stroke-width"),W=C.paint.get("circle-stroke-opacity"),at=!C.layout.get("circle-sort-key").isConstant();if(V.constantOr(1)===0&&(Z.constantOr(1)===0||W.constantOr(1)===0))return;const ot=v.context,lt=ot.gl,ut=v.transform,gt=v.getDepthModeForSublayer(0,Ze.ReadOnly),_t=ri.disabled,yt=v.colorModeForRenderPass(),wt=[],vt=ut.getCircleRadiusCorrection();for(let zt=0;zt<D.length;zt++){const Ot=D[zt],qt=T.getTile(Ot),Kt=qt.getBucket(C);if(!Kt)continue;const Ut=C.paint.get("circle-translate"),ce=C.paint.get("circle-translate-anchor"),ae=a.au(ut,qt,Ut,ce),te=Kt.programConfigurations.get(C.id),pe=v.useProgram("circle",te),Ge=Kt.layoutVertexBuffer,oi=Kt.indexBuffer,Bi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ot),yi={programConfiguration:te,program:pe,layoutVertexBuffer:Ge,indexBuffer:oi,uniformValues:zc(v,qt,C,ae,vt),terrainData:Bi,projectionData:ut.getProjectionData({overscaledTileID:Ot,applyGlobeMatrix:!B,applyTerrainMatrix:!0})};if(at){const ji=Kt.segments.get();for(const xi of ji)wt.push({segments:new a.aD([xi]),sortKey:xi.sortKey,state:yi})}else wt.push({segments:Kt.segments,sortKey:0,state:yi})}at&&wt.sort((zt,Ot)=>zt.sortKey-Ot.sortKey);for(const zt of wt){const{programConfiguration:Ot,program:qt,layoutVertexBuffer:Kt,indexBuffer:Ut,uniformValues:ce,terrainData:ae,projectionData:te}=zt.state;qt.draw(ot,lt.TRIANGLES,gt,_t,yt,si.backCCW,ce,ae,te,C.id,Kt,Ut,zt.segments,C.paint,v.transform.zoom,Ot)}}(t,r,d,m,y):a.b_(d)?function(v,T,C,D,L){if(C.paint.get("heatmap-opacity")===0)return;const B=v.context,{isRenderingToTexture:V,isRenderingGlobe:Z}=L;if(v.style.map.terrain){for(const W of D){const at=T.getTile(W);T.hasRenderableParent(W)||(v.renderPass==="offscreen"?hd(v,at,C,W,Z):v.renderPass==="translucent"&&wl(v,C,W,V,Z))}B.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?function(W,at,ot,lt){const ut=W.context,gt=ut.gl,_t=W.transform,yt=ri.disabled,wt=new Ai([gt.ONE,gt.ONE],a.b4.transparent,[!0,!0,!0,!0]);(function(vt,zt,Ot){const qt=vt.gl;vt.activeTexture.set(qt.TEXTURE1),vt.viewport.set([0,0,zt.width/4,zt.height/4]);let Kt=Ot.heatmapFbos.get(a.bP);Kt?(qt.bindTexture(qt.TEXTURE_2D,Kt.colorAttachment.get()),vt.bindFramebuffer.set(Kt.framebuffer)):(Kt=Sl(vt,zt.width/4,zt.height/4),Ot.heatmapFbos.set(a.bP,Kt))})(ut,W,ot),ut.clear({color:a.b4.transparent});for(let vt=0;vt<lt.length;vt++){const zt=lt[vt];if(at.hasRenderableParent(zt))continue;const Ot=at.getTile(zt),qt=Ot.getBucket(ot);if(!qt)continue;const Kt=qt.programConfigurations.get(ot.id),Ut=W.useProgram("heatmap",Kt),ce=_t.getProjectionData({overscaledTileID:zt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ae=_t.getCircleRadiusCorrection();Ut.draw(ut,gt.TRIANGLES,Ze.disabled,yt,wt,si.backCCW,Lc(Ot,_t.zoom,ot.paint.get("heatmap-intensity"),ae),null,ce,ot.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,ot.paint,_t.zoom,Kt)}ut.viewport.set([0,0,W.width,W.height])}(v,T,C,D):v.renderPass==="translucent"&&function(W,at){const ot=W.context,lt=ot.gl;ot.setColorMode(W.colorModeForRenderPass());const ut=at.heatmapFbos.get(a.bP);ut&&(ot.activeTexture.set(lt.TEXTURE0),lt.bindTexture(lt.TEXTURE_2D,ut.colorAttachment.get()),ot.activeTexture.set(lt.TEXTURE1),Kc(ot,at).bind(lt.LINEAR,lt.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(ot,lt.TRIANGLES,Ze.disabled,ri.disabled,W.colorModeForRenderPass(),si.disabled,hr(W,at,0,1),null,null,at.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,at.paint,W.transform.zoom))}(v,C)}(t,r,d,m,y):a.b$(d)?function(v,T,C,D,L){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:B}=L,V=C.paint.get("line-opacity"),Z=C.paint.get("line-width");if(V.constantOr(1)===0||Z.constantOr(1)===0)return;const W=v.getDepthModeForSublayer(0,Ze.ReadOnly),at=v.colorModeForRenderPass(),ot=C.paint.get("line-dasharray"),lt=C.paint.get("line-pattern"),ut=lt.constantOr(1),gt=C.paint.get("line-gradient"),_t=C.getCrossfadeParameters(),yt=ut?"linePattern":ot?"lineSDF":gt?"lineGradient":"line",wt=v.context,vt=wt.gl,zt=v.transform;let Ot=!0;for(const qt of D){const Kt=T.getTile(qt);if(ut&&!Kt.patternsLoaded())continue;const Ut=Kt.getBucket(C);if(!Ut)continue;const ce=Ut.programConfigurations.get(C.id),ae=v.context.program.get(),te=v.useProgram(yt,ce),pe=Ot||te.program!==ae,Ge=v.style.map.terrain&&v.style.map.terrain.getTerrainData(qt),oi=lt.constantOr(null);if(oi&&Kt.imageAtlas){const gi=Kt.imageAtlas,bi=gi.patternPositions[oi.to.toString()],Ts=gi.patternPositions[oi.from.toString()];bi&&Ts&&ce.setConstantPatternPositions(bi,Ts)}const Bi=zt.getProjectionData({overscaledTileID:qt,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),yi=zt.getPixelScale(),ji=ut?Cp(v,Kt,C,yi,_t):ot?kp(v,Kt,C,yi,ot,_t):gt?ol(v,Kt,C,yi,Ut.lineClipsArray.length):Fc(v,Kt,C,yi);if(ut)wt.activeTexture.set(vt.TEXTURE0),Kt.imageAtlasTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE),ce.updatePaintBuffers(_t);else if(ot&&(pe||v.lineAtlas.dirty))wt.activeTexture.set(vt.TEXTURE0),v.lineAtlas.bind(wt);else if(gt){const gi=Ut.gradients[C.id];let bi=gi.texture;if(C.gradientVersion!==gi.version){let Ts=256;if(C.stepInterpolant){const ls=T.getSource().maxzoom,cs=qt.canonical.z===ls?Math.ceil(1<<v.transform.maxZoom-qt.canonical.z):1;Ts=a.ab(a.bQ(Ut.maxLineLength/a.X*1024*cs),256,wt.maxTextureSize)}gi.gradient=a.bR({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:Ts,image:gi.gradient||void 0,clips:Ut.lineClipsArray}),gi.texture?gi.texture.update(gi.gradient):gi.texture=new ie(wt,gi.gradient,vt.RGBA),gi.version=C.gradientVersion,bi=gi.texture}wt.activeTexture.set(vt.TEXTURE0),bi.bind(C.stepInterpolant?vt.NEAREST:vt.LINEAR,vt.CLAMP_TO_EDGE)}let xi;if(B){const[gi]=v.getStencilConfigForOverlapAndUpdateStencilID(D);xi=gi[qt.overscaledZ]}else xi=v.stencilModeForClipping(qt);te.draw(wt,vt.TRIANGLES,W,xi,at,si.disabled,ji,Ge,Bi,C.id,Ut.layoutVertexBuffer,Ut.indexBuffer,Ut.segments,C.paint,v.transform.zoom,ce,Ut.layoutVertexBuffer2),Ot=!1}}(t,r,d,m,y):a.c0(d)?function(v,T,C,D,L){const B=C.paint.get("fill-color"),V=C.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const{isRenderingToTexture:Z}=L,W=v.colorModeForRenderPass(),at=C.paint.get("fill-pattern"),ot=v.opaquePassEnabledForLayer()&&!at.constantOr(1)&&B.constantOr(a.b4.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===ot){const lt=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Ze.ReadWrite:Ze.ReadOnly);ma(v,T,C,D,lt,W,!1,Z)}if(v.renderPass==="translucent"&&C.paint.get("fill-antialias")){const lt=v.getDepthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,Ze.ReadOnly);ma(v,T,C,D,lt,W,!0,Z)}}(t,r,d,m,y):a.c1(d)?function(v,T,C,D,L){const B=C.paint.get("fill-extrusion-opacity");if(B===0)return;const{isRenderingToTexture:V}=L;if(v.renderPass==="translucent"){const Z=new Ze(v.context.gl.LEQUAL,Ze.ReadWrite,v.depthRangeFor3D);if(B!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))ga(v,T,C,D,Z,ri.disabled,Ai.disabled,V),ga(v,T,C,D,Z,v.stencilModeFor3D(),v.colorModeForRenderPass(),V);else{const W=v.colorModeForRenderPass();ga(v,T,C,D,Z,ri.disabled,W,V)}}}(t,r,d,m,y):a.c2(d)?function(v,T,C,D,L){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:B}=L,V=v.context,Z=v.style.projection.useSubdivision,W=v.getDepthModeForSublayer(0,Ze.ReadOnly),at=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(ot,lt,ut,gt,_t,yt,wt){const vt=ot.context,zt=vt.gl;for(const Ot of ut){const qt=lt.getTile(Ot),Kt=qt.dem;if(!Kt||!Kt.data||!qt.needsHillshadePrepare)continue;const Ut=Kt.dim,ce=Kt.stride,ae=Kt.getPixels();if(vt.activeTexture.set(zt.TEXTURE1),vt.pixelStoreUnpackPremultiplyAlpha.set(!1),qt.demTexture=qt.demTexture||ot.getTileTexture(ce),qt.demTexture){const pe=qt.demTexture;pe.update(ae,{premultiply:!1}),pe.bind(zt.NEAREST,zt.CLAMP_TO_EDGE)}else qt.demTexture=new ie(vt,ae,zt.RGBA,{premultiply:!1}),qt.demTexture.bind(zt.NEAREST,zt.CLAMP_TO_EDGE);vt.activeTexture.set(zt.TEXTURE0);let te=qt.fbo;if(!te){const pe=new ie(vt,{width:Ut,height:Ut,data:null},zt.RGBA);pe.bind(zt.LINEAR,zt.CLAMP_TO_EDGE),te=qt.fbo=vt.createFramebuffer(Ut,Ut,!0,!1),te.colorAttachment.set(pe.texture)}vt.bindFramebuffer.set(te.framebuffer),vt.viewport.set([0,0,Ut,Ut]),ot.useProgram("hillshadePrepare").draw(vt,zt.TRIANGLES,_t,yt,wt,si.disabled,Yu(qt.tileID,Kt),null,null,gt.id,ot.rasterBoundsBuffer,ot.quadTriangleIndexBuffer,ot.rasterBoundsSegments),qt.needsHillshadePrepare=!1}})(v,T,D,C,W,ri.disabled,at),V.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(Z){const[ot,lt,ut]=v.stencilConfigForOverlapTwoPass(D);Jc(v,T,C,ut,ot,W,at,!1,B),Jc(v,T,C,ut,lt,W,at,!0,B)}else{const[ot,lt]=v.getStencilConfigForOverlapAndUpdateStencilID(D);Jc(v,T,C,lt,ot,W,at,!1,B)}}(t,r,d,m,y):a.c3(d)?function(v,T,C,D,L){if(v.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!D.length)return;const{isRenderingToTexture:B}=L,V=T.getSource(),Z=v.style.projection.useSubdivision;if(V instanceof jt)Fi(v,T,C,D,null,!1,!1,V.tileCoords,V.flippedWindingOrder,B);else if(Z){const[W,at,ot]=v.stencilConfigForOverlapTwoPass(D);Fi(v,T,C,ot,W,!1,!0,Tl,!1,B),Fi(v,T,C,ot,at,!0,!0,Tl,!1,B)}else{const[W,at]=v.getStencilConfigForOverlapAndUpdateStencilID(D);Fi(v,T,C,at,W,!1,!0,Tl,!1,B)}}(t,r,d,m,y):a.c4(d)?function(v,T,C,D,L){const B=C.paint.get("background-color"),V=C.paint.get("background-opacity");if(V===0)return;const{isRenderingToTexture:Z}=L,W=v.context,at=W.gl,ot=v.style.projection,lt=v.transform,ut=lt.tileSize,gt=C.paint.get("background-pattern");if(v.isPatternMissing(gt))return;const _t=!gt&&B.a===1&&V===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==_t)return;const yt=ri.disabled,wt=v.getDepthModeForSublayer(0,_t==="opaque"?Ze.ReadWrite:Ze.ReadOnly),vt=v.colorModeForRenderPass(),zt=v.useProgram(gt?"backgroundPattern":"background"),Ot=D||st(lt,{tileSize:ut,terrain:v.style.map.terrain});gt&&(W.activeTexture.set(at.TEXTURE0),v.imageManager.bind(v.context));const qt=C.getCrossfadeParameters();for(const Kt of Ot){const Ut=lt.getProjectionData({overscaledTileID:Kt,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),ce=gt?$c(V,v,gt,{tileID:Kt,tileSize:ut},qt):Vc(V,B),ae=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Kt),te=ot.getMeshFromTileID(W,Kt.canonical,!1,!0,"raster");zt.draw(W,at.TRIANGLES,wt,yt,vt,si.backCCW,ce,ae,Ut,C.id,te.vertexBuffer,te.indexBuffer,te.segments)}}(t,0,d,m,y):a.c5(d)&&function(v,T,C,D){const{isRenderingGlobe:L}=D,B=v.context,V=C.implementation,Z=v.style.projection,W=v.transform,at=W.getProjectionDataForCustomLayer(L),ot={farZ:W.farZ,nearZ:W.nearZ,fov:W.fov*Math.PI/180,modelViewProjectionMatrix:W.modelViewProjectionMatrix,projectionMatrix:W.projectionMatrix,shaderData:{variantName:Z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Z.shaderPreludeCode.vertexSource}`,define:Z.shaderDefine},defaultProjectionData:at},lt=V.renderingMode?V.renderingMode:"2d";if(v.renderPass==="offscreen"){const ut=V.prerender;ut&&(v.setCustomLayerDefaults(),B.setColorMode(v.colorModeForRenderPass()),ut.call(V,B.gl,ot),B.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),B.setColorMode(v.colorModeForRenderPass()),B.setStencilMode(ri.disabled);const ut=lt==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Ze.ReadOnly);B.setDepthMode(ut),V.render(B.gl,ot),B.setDirty(),v.setBaseState(),B.bindFramebuffer.set(null)}}(t,0,d,y))}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),d=this.imageManager.getPattern(t.to.toString());return!r||!d}useProgram(t,r,d=!1){this.cache=this.cache||{};const m=!!this.style.map.terrain,y=this.style.projection,v=t+(r?r.cacheKey:"")+`/${d?$u:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(m?"/terrain":"");return this.cache[v]||(this.cache[v]=new rl(this.context,zn[t],r,Qu[t],this._showOverdrawInspector,m,d?zn.projectionMercator:y.shaderPreludeCode,d?tl:y.shaderDefine)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ie(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}function ur(_,t){let r,d=!1,m=null,y=null;const v=()=>{m=null,d&&(_.apply(y,r),m=setTimeout(v,t),d=!1)};return(...T)=>(d=!0,y=this,r=T,m||v(),m)}class sh{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let d;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(d=m)}),(d&&d[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:d,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const d=r.join("/");let m=d;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${d}`);let y=window.location.hash.replace(m,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let v=window.location.href.replace(/(#.+)?$/,y);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=ur(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const r=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),v=Math.round(r.lng*y)/y,T=Math.round(r.lat*y)/y,C=this._map.getBearing(),D=this._map.getPitch();let L="";if(L+=t?`/${v}/${T}/${d}`:`${d}/${T}/${v}`,(C||D)&&(L+="/"+Math.round(10*C)/10),D&&(L+=`/${Math.round(D)}`),this._hashName){const B=this._hashName;let V=!1;const Z=window.location.hash.slice(1).split("&").map(W=>{const at=W.split("=")[0];return at===B?(V=!0,`${at}=${L}`):W}).filter(W=>W);return V||Z.push(`${B}=${L}`),`#${Z.join("&")}`}return`#${L}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new a.N(+t[2],+t[1])}catch{return!1}const r=+t[0],d=+(t[3]||0),m=+(t[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&d>=0&&d<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}const So={linearity:.3,easing:a.c6(0,0,.3,1)},pd=a.e({deceleration:2500,maxSpeed:1400},So),md=a.e({deceleration:20,maxSpeed:1400},So),gd=a.e({deceleration:1e3,maxSpeed:360},So),_d=a.e({deceleration:1e3,maxSpeed:90},So),yd=a.e({deceleration:1e3,maxSpeed:360},So);class Pl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:F.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=F.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)r.zoom+=y.zoomDelta||0,r.bearing+=y.bearingDelta||0,r.pitch+=y.pitchDelta||0,r.roll+=y.rollDelta||0,y.panDelta&&r.pan._add(y.panDelta),y.around&&(r.around=y.around),y.pinchAround&&(r.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(r.pan.mag()){const y=Fs(r.pan.mag(),d,a.e({},pd,t||{})),v=r.pan.mult(y.amount/r.pan.mag()),T=this._map.cameraHelper.handlePanInertia(v,this._map.transform);m.center=T.easingCenter,m.offset=T.easingOffset,To(m,y)}if(r.zoom){const y=Fs(r.zoom,d,md);m.zoom=this._map.transform.zoom+y.amount,To(m,y)}if(r.bearing){const y=Fs(r.bearing,d,gd);m.bearing=this._map.transform.bearing+a.ab(y.amount,-179,179),To(m,y)}if(r.pitch){const y=Fs(r.pitch,d,_d);m.pitch=this._map.transform.pitch+y.amount,To(m,y)}if(r.roll){const y=Fs(r.roll,d,yd);m.roll=this._map.transform.roll+a.ab(y.amount,-179,179),To(m,y)}if(m.zoom||m.bearing){const y=r.pinchAround===void 0?r.around:r.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function To(_,t){(!_.duration||_.duration<t.duration)&&(_.duration=t.duration,_.easing=t.easing)}function Fs(_,t,r){const{maxSpeed:d,linearity:m,deceleration:y}=r,v=a.ab(_*m/(t/1e3),-d,d),T=Math.abs(v)/(y*m);return{easing:r.easing,duration:1e3*T,amount:v*(T/2)}}class es extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,d,m={}){const y=R.mousePos(r.getCanvas(),d),v=r.unproject(y);super(t,a.e({point:y,lngLat:v,originalEvent:d},m)),this._defaultPrevented=!1,this.target=r}}class Mo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,d){const m=t==="touchend"?d.changedTouches:d.touches,y=R.touchPos(r.getCanvasContainer(),m),v=y.map(C=>r.unproject(C)),T=y.reduce((C,D,L,B)=>C.add(D.div(B.length)),new a.P(0,0));super(t,{points:y,point:T,lngLats:v,lngLat:r.unproject(T),originalEvent:d}),this._defaultPrevented=!1}}class wn extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,d){super(t,{originalEvent:d}),this._defaultPrevented=!1}}class Po{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new wn(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new es(t.type,this._map,t))}mouseup(t){this._map.fire(new es(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new es(t.type,this._map,t))}dblclick(t){return this._firePreventable(new es(t.type,this._map,t))}mouseover(t){this._map.fire(new es(t.type,this._map,t))}mouseout(t){this._map.fire(new es(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Mo(t.type,this._map,t))}touchmove(t){this._map.fire(new Mo(t.type,this._map,t))}touchend(t){this._map.fire(new Mo(t.type,this._map,t))}touchcancel(t){this._map.fire(new Mo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Op{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new es(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new es("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new es(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ya{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(a.P.convert(t),this._map.terrain)}}class xd{constructor(t,r){this._map=t,this._tr=new ya(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(R.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const d=r;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(m.x,d.x),v=Math.max(m.x,d.x),T=Math.min(m.y,d.y),C=Math.max(m.y,d.y);R.setTransform(this._box,`translate(${y}px,${T}px)`),this._box.style.width=v-y+"px",this._box.style.height=C-T+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const d=this._startPos,m=r;if(this.reset(),R.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(d,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new a.k(t,{originalEvent:r}))}}function nh(_,t){if(_.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${t.length}`);const r={};for(let d=0;d<_.length;d++)r[_[d].identifier]=t[d];return r}class bd{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const y=new a.P(0,0);for(const v of m)y._add(v);return y.div(m.length)}(r),this.touches=nh(d,r)))}touchmove(t,r,d){if(this.aborted||!this.centroid)return;const m=nh(d,r);for(const y in this.touches){const v=m[y];(!v||v.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,r,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class jr{constructor(t){this.singleTap=new bd(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,d){this.singleTap.touchstart(t,r,d)}touchmove(t,r,d){this.singleTap.touchmove(t,r,d)}touchend(t,r,d){const m=this.singleTap.touchend(t,r,d);if(m){const y=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(m)<30;if(y&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Gn{constructor(t){this._tr=new ya(t),this._zoomIn=new jr({numTouches:1,numTaps:2}),this._zoomOut=new jr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,d){this._zoomIn.touchstart(t,r,d),this._zoomOut.touchstart(t,r,d)}touchmove(t,r,d){this._zoomIn.touchmove(t,r,d),this._zoomOut.touchmove(t,r,d)}touchend(t,r,d){const m=this._zoomIn.touchend(t,r,d),y=this._zoomOut.touchend(t,r,d),v=this._tr;return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(m)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ge{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const m=Array.isArray(r)?r[0]:r;return!this._moved&&m.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(d,m))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&R.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const vd={0:1,2:2};class Nr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=R.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(r,d){const m=vd[d];return r.buttons===void 0||(r.buttons&m)!==m}(t,this._eventButton)}isValidEndEvent(t){return R.mouseButton(t)===this._eventButton}}class wd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class xa{constructor(t=new Nr({checkCorrectEvent:()=>!0}),r=new wd){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(t,r,d){return t instanceof MouseEvent?r(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?d(t):void 0}startMove(t){this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(t){this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(t){return this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(t){return this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(t){return this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}const dr=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=t=>{t.preventDefault()}};class Sd{constructor(t,r){this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,r,d){return this._calculateTransform(t,r,d)}touchmove(t,r,d){if(this._active){if(!this._shouldBePrevented(d.length))return t.preventDefault(),this._calculateTransform(t,r,d);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,r,d){this._calculateTransform(t,r,d),this._active&&this._shouldBePrevented(d.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,d){d.length>0&&(this._active=!0);const m=nh(d,r),y=new a.P(0,0),v=new a.P(0,0);let T=0;for(const D in m){const L=m[D],B=this._touches[D];B&&(y._add(L),v._add(L.sub(B)),T++,m[D]=L)}if(this._touches=m,this._shouldBePrevented(T)||!v.mag())return;const C=v.div(T);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(T),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qe{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,d){if(!this._firstTwoTouches)return;t.preventDefault();const[m,y]=this._firstTwoTouches,v=Co(d,r,m),T=Co(d,r,y);if(!v||!T)return;const C=this._aroundCenter?null:v.add(T).div(2);return this._move([v,T],C,t)}touchend(t,r,d){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,v=Co(d,r,m),T=Co(d,r,y);v&&T||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Co(_,t,r){for(let d=0;d<_.length;d++)if(_[d].identifier===r)return t[d]}function Td(_,t){return Math.log(_/t)/Math.LN2}class Cl extends Qe{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Td(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Td(this._distance,d),pinchAround:r}}}function Md(_,t){return 180*_.angleWith(t)/Math.PI}class Pd extends Qe{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r,d){const m=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Md(this._vector,m),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,d=Md(t,this._startVector);return Math.abs(d)<r}}function kl(_){return Math.abs(_.y)>Math.abs(_.x)}class Il extends Qe{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,d){super.touchstart(t,r,d),this._currentTouchCount=d.length}_start(t){this._lastPoints=t,kl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=t[0].sub(this._lastPoints[0]),y=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,d.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,d){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,y=r.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const v=t.y>0==r.y>0;return kl(t)&&kl(r)&&v}}const Cd={panStep:100,bearingStep:15,pitchStep:10};class kd{constructor(t){this._tr=new ya(t);const r=Cd;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,d=0,m=0,y=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:T=>{const C=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:Id,zoom:r?Math.round(C.zoom)+r*(t.shiftKey?2:1):C.zoom,bearing:C.bearing+d*this._bearingStep,pitch:C.pitch+m*this._pitchStep,offset:[-y*this._panStep,-v*this._panStep],center:C.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Id(_){return _*(2-_)}const Dd=4.000244140625;class Ad{constructor(t,r){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=t,this._tr=new ya(t),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=F.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,r!==0&&r%Dd==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=R.mousePos(this._map.getCanvas(),t),d=this._tr;this._aroundPoint=this._aroundCenter?d.transform.locationToScreenPoint(a.N.convert(d.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const T=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=T),typeof this._targetZoom=="number"&&(this._targetZoom+=T)}if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>Dd?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&C!==0&&(C=1/C);const D=typeof this._targetZoom!="number"?t.scale:a.aG(this._targetZoom);this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,a.a8(D*C))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,d=this._startZoom,m=this._easing;let y,v=!1;if(this._type==="wheel"&&d&&m){const T=F.now()-this._lastWheelEventTime,C=Math.min((T+5)/200,1),D=m(C);y=a.y.number(d,r,D),C<1?this._frameId||(this._frameId=!0):v=!0}else y=r,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!v,zoomDelta:y-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=a.c8;if(this._prevEase){const d=this._prevEase,m=(F.now()-d.start)/d.duration,y=d.easing(m+.01)-d.easing(m),v=.27/Math.sqrt(y*y+1e-4)*.01,T=Math.sqrt(.0729-v*v);r=a.c6(v,T,.25,1)}return this._prevEase={start:F.now(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class qn{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Oi{constructor(t){this._tr=new ya(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dl{constructor(){this._tap=new jr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,d){if(!this._swipePoint)if(this._tapTime){const m=r[0],y=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(m)<30;y&&v?d.length>0&&(this._swipePoint=m,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(t,r,d)}touchmove(t,r,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=r[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,r,d)}touchend(t,r,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const m=this._tap.touchend(t,r,d);m&&(this._tapTime=t.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Al{constructor(t,r,d){this._el=t,this._mousePan=r,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rh{constructor(t,r,d,m){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=r,this._mousePitch=d,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class oh{constructor(t,r,d,m){this._el=t,this._touchZoom=r,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ah{constructor(t,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=R.create("div","maplibregl-cooperative-gesture-screen",t);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=r,this._container.appendChild(m);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=d,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(R.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,r){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:t,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const El=_=>_.zoom||_.drag||_.roll||_.pitch||_.rotate;class Fn extends a.k{}function ko(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta||_.rollDelta}class ke{constructor(t,r){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,y)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=m.type==="renderFrame"?void 0:m,T={needsRenderFrame:!1},C={},D={},L=m.touches,B=L?this._getMapTouches(L):void 0,V=B?R.touchPos(this._map.getCanvas(),B):R.mousePos(this._map.getCanvas(),m);for(const{handlerName:at,handler:ot,allowed:lt}of this._handlers){if(!ot.isEnabled())continue;let ut;this._blockedByActive(D,lt,at)?ot.reset():ot[y||m.type]&&(ut=ot[y||m.type](m,V,B),this.mergeHandlerResult(T,C,ut,at,v),ut&&ut.needsRenderFrame&&this._triggerRenderFrame()),(ut||ot.isActive())&&(D[at]=ot)}const Z={};for(const at in this._previousActiveHandlers)D[at]||(Z[at]=v);this._previousActiveHandlers=D,(Object.keys(Z).length||ko(T))&&(this._changes.push([T,C,Z]),this._triggerRenderFrame()),(Object.keys(D).length||ko(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=T;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pl(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,v]of this._listeners)R.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,r,d]of this._listeners)R.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(t){const r=this._map,d=r.getCanvasContainer();this._add("mapEvent",new Po(r,t));const m=r.boxZoom=new xd(r,t);this._add("boxZoom",m),t.interactive&&t.boxZoom&&m.enable();const y=r.cooperativeGestures=new ah(r,t.cooperativeGestures);this._add("cooperativeGestures",y),t.cooperativeGestures&&y.enable();const v=new Gn(r),T=new Oi(r);r.doubleClickZoom=new qn(T,v),this._add("tapZoom",v),this._add("clickZoom",T),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const C=new Dl;this._add("tapDragZoom",C);const D=r.touchPitch=new Il(r);this._add("touchPitch",D),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const L=()=>r.project(r.getCenter()),B=function({enable:_t,clickTolerance:yt,aroundCenter:wt=!0,minPixelCenterThreshold:vt=100,rotateDegreesPerPixelMoved:zt=.8},Ot){const qt=new Nr({checkCorrectEvent:Kt=>R.mouseButton(Kt)===0&&Kt.ctrlKey||R.mouseButton(Kt)===2&&!Kt.ctrlKey});return new ge({clickTolerance:yt,move:(Kt,Ut)=>{const ce=Ot();if(wt&&Math.abs(ce.y-Kt.y)>vt)return{bearingDelta:a.c7(new a.P(Kt.x,Ut.y),Ut,ce)};let ae=(Ut.x-Kt.x)*zt;return wt&&Ut.y<ce.y&&(ae=-ae),{bearingDelta:ae}},moveStateManager:qt,enable:_t,assignEvents:dr})}(t,L),V=function({enable:_t,clickTolerance:yt,pitchDegreesPerPixelMoved:wt=-.5}){const vt=new Nr({checkCorrectEvent:zt=>R.mouseButton(zt)===0&&zt.ctrlKey||R.mouseButton(zt)===2});return new ge({clickTolerance:yt,move:(zt,Ot)=>({pitchDelta:(Ot.y-zt.y)*wt}),moveStateManager:vt,enable:_t,assignEvents:dr})}(t),Z=function({enable:_t,clickTolerance:yt,rollDegreesPerPixelMoved:wt=.3},vt){const zt=new Nr({checkCorrectEvent:Ot=>R.mouseButton(Ot)===2&&Ot.ctrlKey});return new ge({clickTolerance:yt,move:(Ot,qt)=>{const Kt=vt();let Ut=(qt.x-Ot.x)*wt;return qt.y<Kt.y&&(Ut=-Ut),{rollDelta:Ut}},moveStateManager:zt,enable:_t,assignEvents:dr})}(t,L);r.dragRotate=new rh(t,B,V,Z),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",V,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Z,["mousePitch"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const W=function({enable:_t,clickTolerance:yt}){const wt=new Nr({checkCorrectEvent:vt=>R.mouseButton(vt)===0&&!vt.ctrlKey});return new ge({clickTolerance:yt,move:(vt,zt)=>({around:zt,panDelta:zt.sub(vt)}),activateOnStart:!0,moveStateManager:wt,enable:_t,assignEvents:dr})}(t),at=new Sd(t,r);r.dragPan=new Al(d,W,at),this._add("mousePan",W),this._add("touchPan",at,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const ot=new Pd,lt=new Cl;r.touchZoomRotate=new oh(d,lt,ot,C),this._add("touchRotate",ot,["touchPan","touchZoom"]),this._add("touchZoom",lt,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate);const ut=r.scrollZoom=new Ad(r,()=>this._triggerRenderFrame());this._add("scrollZoom",ut,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const gt=r.keyboard=new kd(r);this._add("keyboard",gt),t.interactive&&t.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Op(r))}_add(t,r,d){this._handlers.push({handlerName:t,handler:r,allowed:d}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!El(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,d){for(const m in t)if(m!==d&&(!r||r.indexOf(m)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const d of t)this._el.contains(d.target)&&r.push(d);return r}mergeHandlerResult(t,r,d,m,y){if(!d)return;a.e(t,d);const v={handlerName:m,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(r.zoom=v),d.panDelta!==void 0&&(r.drag=v),d.rollDelta!==void 0&&(r.roll=v),d.pitchDelta!==void 0&&(r.pitch=v),d.bearingDelta!==void 0&&(r.rotate=v)}_applyChanges(){const t={},r={},d={};for(const[m,y,v]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(t.rollDelta=(t.rollDelta||0)+m.rollDelta),m.around!==void 0&&(t.around=m.around),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),a.e(r,y),a.e(d,v);this._updateMapTransform(t,r,d),this._changes=[]}_updateMapTransform(t,r,d){const m=this._map,y=m._getTransformForUpdate(),v=m.terrain;if(!(ko(t)||v&&this._terrainMovement))return this._fireEvents(r,d,!0);m._stop(!0);let{panDelta:T,zoomDelta:C,bearingDelta:D,pitchDelta:L,rollDelta:B,around:V,pinchAround:Z}=t;Z!==void 0&&(V=Z),V=V||m.transform.centerPoint,v&&!y.isPointOnMapSurface(V)&&(V=y.centerPoint);const W={panDelta:T,zoomDelta:C,rollDelta:B,pitchDelta:L,bearingDelta:D,around:V};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(V)&&(V=y.centerPoint);const at=V.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(T?V.sub(T):V);v?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,y),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(T))):this._map.cameraHelper.handleMapControlsPan(W,y,at):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(W,y,at))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,y),this._map.cameraHelper.handleMapControlsPan(W,y,at)),m._applyUpdatedTransform(y),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,d,!0)}_fireEvents(t,r,d){const m=El(this._eventsInProgress),y=El(t),v={};for(const B in t){const{originalEvent:V}=t[B];this._eventsInProgress[B]||(v[`${B}start`]=V),this._eventsInProgress[B]=t[B]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const B in v)this._fireEvent(B,v[B]);y&&this._fireEvent("move",y.originalEvent);for(const B in t){const{originalEvent:V}=t[B];this._fireEvent(B,V)}const T={};let C;for(const B in this._eventsInProgress){const{handlerName:V,originalEvent:Z}=this._eventsInProgress[B];this._handlersById[V].isActive()||(delete this._eventsInProgress[B],C=r[V]||Z,T[`${B}end`]=C)}for(const B in T)this._fireEvent(B,T[B]);const D=El(this._eventsInProgress),L=(m||y)&&!D;if(L&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const B=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&B.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(B)}if(d&&L){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!B||!B.essential&&F.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:C})),V(this._map.getBearing())&&this._map.resetNorth()):(V(B.bearing||this._map.getBearing())&&(B.bearing=0),B.freezeElevation=!0,this._map.easeTo(B,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new a.k(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Fn("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Re extends a.E{constructor(t,r,d){super(),this._renderFrameCallback=()=>{const m=Math.min((F.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=d.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,r){t.apply(this.transform),this.transform=t,this.cameraHelper=r}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,r){return this.jumpTo({elevation:t},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,r,d){return t=a.P.convert(t).mult(-1),this.panTo(this.transform.center,a.e({offset:t},r),d)}panTo(t,r,d){return this.easeTo(a.e({center:t},r),d)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,d){return this.easeTo(a.e({zoom:t},r),d)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,r){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new a.k("movestart",r)).fire(new a.k("move",r)).fire(new a.k("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,d){return this.easeTo(a.e({bearing:t},r),d)}resetNorth(t,r){return this.rotateTo(0,a.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}getRoll(){return this.transform.roll}setRoll(t,r){return this.jumpTo({roll:t},r),this}cameraForBounds(t,r){t=K.convert(t).adjustAntiMeridian();const d=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),d,r)}_cameraForBoxAndBearing(t,r,d,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const D=m.padding;m.padding={top:D,bottom:D,right:D,left:D}}const v=a.e(y,m.padding);m.padding=v;const T=this.transform,C=new K(t,r);return this.cameraHelper.cameraForBoxAndBearing(m,v,C,d,T)}fitBounds(t,r,d){return this._fitInternal(this.cameraForBounds(t,r),r,d)}fitScreenCoordinates(t,r,d,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(t)),this.transform.screenPointToLocation(a.P.convert(r)),d,m),m,y)}_fitInternal(t,r,d){return t?(delete(r=a.e(t,r)).padding,r.linear?this.easeTo(r,d):this.flyTo(r,d)):this}jumpTo(t,r){this.stop();const d=this._getTransformForUpdate();let m=!1,y=!1,v=!1;const T=d.zoom;this.cameraHelper.handleJumpToCenterZoom(d,t);const C=d.zoom!==T;return"elevation"in t&&d.elevation!==+t.elevation&&d.setElevation(+t.elevation),"bearing"in t&&d.bearing!==+t.bearing&&(m=!0,d.setBearing(+t.bearing)),"pitch"in t&&d.pitch!==+t.pitch&&(y=!0,d.setPitch(+t.pitch)),"roll"in t&&d.roll!==+t.roll&&(v=!0,d.setRoll(+t.roll)),t.padding==null||d.isPaddingEqual(t.padding)||d.setPadding(t.padding),this._applyUpdatedTransform(d),this.fire(new a.k("movestart",r)).fire(new a.k("move",r)),C&&this.fire(new a.k("zoomstart",r)).fire(new a.k("zoom",r)).fire(new a.k("zoomend",r)),m&&this.fire(new a.k("rotatestart",r)).fire(new a.k("rotate",r)).fire(new a.k("rotateend",r)),y&&this.fire(new a.k("pitchstart",r)).fire(new a.k("pitch",r)).fire(new a.k("pitchend",r)),v&&this.fire(new a.k("rollstart",r)).fire(new a.k("roll",r)).fire(new a.k("rollend",r)),this.fire(new a.k("moveend",r))}calculateCameraOptionsFromTo(t,r,d,m=0){const y=a.Y.fromLngLat(t,r),v=a.Y.fromLngLat(d,m),T=v.x-y.x,C=v.y-y.y,D=v.z-y.z,L=Math.hypot(T,C,D);if(L===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(T,C),V=a.a8(this.transform.cameraToCenterDistance/L/this.transform.tileSize),Z=180*Math.atan2(T,-C)/Math.PI;let W=180*Math.acos(B/L)/Math.PI;return W=D<0?90-W:90+W,{center:v.toLngLat(),elevation:m,zoom:V,pitch:W,bearing:Z}}calculateCameraOptionsFromCameraLngLatAltRotation(t,r,d,m,y){const v=this.transform.calculateCenterFromCameraLngLatAlt(t,r,d,m);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:d,pitch:m,roll:y}}easeTo(t,r){this._stop(!1,t.easeId),((t=a.e({offset:[0,0],duration:500,easing:a.c8},t)).animate===!1||!t.essential&&F.prefersReducedMotion)&&(t.duration=0);const d=this._getTransformForUpdate(),m=this.getBearing(),y=d.pitch,v=d.roll,T="bearing"in t?this._normalizeBearing(t.bearing,m):m,C="pitch"in t?+t.pitch:y,D="roll"in t?this._normalizeBearing(t.roll,v):v,L="padding"in t?t.padding:d.padding,B=a.P.convert(t.offset);let V,Z;t.around&&(V=a.N.convert(t.around),Z=d.locationToScreenPoint(V));const W={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},at=this.cameraHelper.handleEaseTo(d,{bearing:T,pitch:C,roll:D,padding:L,around:V,aroundPoint:Z,offsetAsPoint:B,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||m!==T,this._pitching=this._pitching||C!==y,this._rolling=this._rolling||D!==v,this._padding=!d.isPaddingEqual(L),this._zooming=this._zooming||at.isZooming,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,W),this.terrain&&this._prepareElevation(at.elevationCenter),this._ease(ot=>{at.easeFunc(ot),this.terrain&&!t.freezeElevation&&this._updateElevation(ot),this._applyUpdatedTransform(d),this._fireMoveEvents(r)},ot=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r,ot)},t),this}_prepareEase(t,r,d={}){this._moving=!0,r||d.moving||this.fire(new a.k("movestart",t)),this._zooming&&!d.zooming&&this.fire(new a.k("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new a.k("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new a.k("pitchstart",t)),this._rolling&&!d.rolling&&this.fire(new a.k("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(d-(r-(d*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.setElevation(a.y.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const r=t.getCameraLngLat(),d=t.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(r,t.zoom):0;if(d<m){const y=this.calculateCameraOptionsFromTo(r,m,t.center,t.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(t){const r=[];if(r.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&r.push(m=>this.transformCameraUpdate(m)),!r.length)return;const d=t.clone();for(const m of r){const y=d.clone(),{center:v,zoom:T,roll:C,pitch:D,bearing:L,elevation:B}=m(y);v&&y.setCenter(v),B!==void 0&&y.setElevation(B),T!==void 0&&y.setZoom(T),C!==void 0&&y.setRoll(C),D!==void 0&&y.setPitch(D),L!==void 0&&y.setBearing(L),d.apply(y)}this.transform.apply(d)}_fireMoveEvents(t){this.fire(new a.k("move",t)),this._zooming&&this.fire(new a.k("zoom",t)),this._rotating&&this.fire(new a.k("rotate",t)),this._pitching&&this.fire(new a.k("pitch",t)),this._rolling&&this.fire(new a.k("roll",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const d=this._zooming,m=this._rotating,y=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,d&&this.fire(new a.k("zoomend",t)),m&&this.fire(new a.k("rotateend",t)),y&&this.fire(new a.k("pitchend",t)),v&&this.fire(new a.k("rollend",t)),this.fire(new a.k("moveend",t))}flyTo(t,r){if(!t.essential&&F.prefersReducedMotion){const Ut=a.M(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ut,r)}this.stop(),t=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.c8},t);const d=this._getTransformForUpdate(),m=d.bearing,y=d.pitch,v=d.roll,T=d.padding,C="bearing"in t?this._normalizeBearing(t.bearing,m):m,D="pitch"in t?+t.pitch:y,L="roll"in t?this._normalizeBearing(t.roll,v):v,B="padding"in t?t.padding:d.padding,V=a.P.convert(t.offset);let Z=d.centerPoint.add(V);const W=d.screenPointToLocation(Z),at=this.cameraHelper.handleFlyTo(d,{bearing:C,pitch:D,roll:L,padding:B,locationAtOffset:W,offsetAsPoint:V,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ot=t.curve;const lt=Math.max(d.width,d.height),ut=lt/at.scaleOfZoom,gt=at.pixelPathLength;typeof at.scaleOfMinZoom=="number"&&(ot=Math.sqrt(lt/at.scaleOfMinZoom/gt*2));const _t=ot*ot;function yt(Ut){const ce=(ut*ut-lt*lt+(Ut?-1:1)*_t*_t*gt*gt)/(2*(Ut?ut:lt)*_t*gt);return Math.log(Math.sqrt(ce*ce+1)-ce)}function wt(Ut){return(Math.exp(Ut)-Math.exp(-Ut))/2}function vt(Ut){return(Math.exp(Ut)+Math.exp(-Ut))/2}const zt=yt(!1);let Ot=function(Ut){return vt(zt)/vt(zt+ot*Ut)},qt=function(Ut){return lt*((vt(zt)*(wt(ce=zt+ot*Ut)/vt(ce))-wt(zt))/_t)/gt;var ce},Kt=(yt(!0)-zt)/ot;if(Math.abs(gt)<2e-6||!isFinite(Kt)){if(Math.abs(lt-ut)<1e-6)return this.easeTo(t,r);const Ut=ut<lt?-1:1;Kt=Math.abs(Math.log(ut/lt))/ot,qt=()=>0,Ot=ce=>Math.exp(Ut*ot*ce)}return t.duration="duration"in t?+t.duration:1e3*Kt/("screenSpeed"in t?+t.screenSpeed/ot:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=m!==C,this._pitching=D!==y,this._rolling=L!==v,this._padding=!d.isPaddingEqual(B),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(at.targetCenter),this._ease(Ut=>{const ce=Ut*Kt,ae=1/Ot(ce),te=qt(ce);this._rotating&&d.setBearing(a.y.number(m,C,Ut)),this._pitching&&d.setPitch(a.y.number(y,D,Ut)),this._rolling&&d.setRoll(a.y.number(v,L,Ut)),this._padding&&(d.interpolatePadding(T,B,Ut),Z=d.centerPoint.add(V)),at.easeFunc(Ut,ae,te,Z),this.terrain&&!t.freezeElevation&&this._updateElevation(Ut),this._applyUpdatedTransform(d),this._fireMoveEvents(r)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){var d;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,r)}return t||(d=this.handlers)===null||d===void 0||d.stop(!1),this}_ease(t,r,d){d.animate===!1||d.duration===0?(t(1),r()):(this._easeStart=F.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=a.aI(t,-180,180);const d=Math.abs(t-r);return Math.abs(t-360-r)<d&&(t-=360),Math.abs(t+360-r)<d&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(t),this.transform.tileZoom):null}}const ba={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class zl{constructor(t=ba){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(t,r){const d=this._map._getUIString(`AttributionControl.${r}`);t.title=d,t.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const r=this._map.style.sourceCaches;for(const m in r){const y=r[m];if(y.used||y.usedForTerrain){const v=y.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(m=>String(m).trim()),t.sort((m,y)=>m.length-y.length),t=t.filter((m,y)=>{for(let v=y+1;v<t.length;v++)if(t[v].indexOf(m)>=0)return!1;return!0});const d=t.join(" | ");d!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=R.sanitize(d),t.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Rl{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const d=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const r=R.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ns{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,d=r?this._queue.concat(r):this._queue;for(const m of d)if(m.id===t)return void(m.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const d of r)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ed=a.aA([{name:"a_pos3d",type:"Int16",components:3}]);class On extends a.E{constructor(t){super(),this._lastTilesetChange=F.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,r){this.sourceCache.update(t,r),this._renderableTilesKeys=[];const d={};for(const m of st(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))d[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),a.bL(m.terrainRttPosMatrix32f,0,a.X,a.X,0,0,1),this._tiles[m.key]=new _i(m,this.tileSize),this._lastTilesetChange=F.now());for(const m in this._tiles)d[m]||delete this._tiles[m]}freeRtt(t){for(const r in this._tiles){const d=this._tiles[r];(!t||d.tileID.equals(t)||d.tileID.isChildOf(t)||t.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const r={};for(const d of this._renderableTilesKeys){const m=this._tiles[d].tileID,y=t.clone(),v=a.a$();if(m.canonical.equals(t.canonical))a.bL(v,0,a.X,a.X,0,0,1);else if(m.canonical.isChildOf(t.canonical)){const T=m.canonical.z-t.canonical.z,C=m.canonical.x-(m.canonical.x>>T<<T),D=m.canonical.y-(m.canonical.y>>T<<T),L=a.X>>T;a.bL(v,0,L,L,0,0,1),a.J(v,v,[-C*L,-D*L,0])}else{if(!t.canonical.isChildOf(m.canonical))continue;{const T=t.canonical.z-m.canonical.z,C=t.canonical.x-(t.canonical.x>>T<<T),D=t.canonical.y-(t.canonical.y>>T<<T),L=a.X>>T;a.bL(v,0,a.X,a.X,0,0,1),a.J(v,v,[C*L,D*L,0]),a.K(v,v,[1/2**T,1/2**T,0])}}y.terrainRttPosMatrix32f=new Float32Array(v),r[d]=y}return r}getSourceTile(t,r){const d=this.sourceCache._source;let m=t.overscaledZ-this.deltaZoom;if(m>d.maxzoom&&(m=d.maxzoom),m<d.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!y||!y.dem)&&r)for(;m>=d.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(t.scaledTo(m--).key);return y}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}}class Bp{constructor(t,r,d){this._meshCache={},this.painter=t,this.sourceCache=new On(r),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,d,m=a.X){var y;if(!(r>=0&&r<m&&d>=0&&d<m))return 0;const v=this.getTerrainData(t),T=(y=v.tile)===null||y===void 0?void 0:y.dem;if(!T)return 0;const C=a.c9([],[r/m*a.X,d/m*a.X],v.u_terrain_matrix),D=[C[0]*T.dim,C[1]*T.dim],L=Math.floor(D[0]),B=Math.floor(D[1]),V=D[0]-L,Z=D[1]-B;return T.get(L,B)*(1-V)*(1-Z)+T.get(L+1,B)*V*(1-Z)+T.get(L,B+1)*(1-V)*Z+T.get(L+1,B+1)*V*Z}getElevationForLngLatZoom(t,r){if(!a.ca(r,t.wrap()))return 0;const{tileID:d,mercatorX:m,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(d,m%a.X,y%a.X,a.X)}getElevation(t,r,d,m=a.X){return this.getDEMElevation(t,r,d,m)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const m=this.painter.context,y=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ie(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ie(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.aq([])}const r=this.sourceCache.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const m=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new ie(m,r.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),r.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const d=r&&r+r.tileID.key+t.key;if(d&&!this._demMatrixCache[d]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=m?y=t.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>y<<y),T=t.canonical.y-(t.canonical.y>>y<<y),C=a.cb(new Float64Array(16),[1/(a.X<<y),1/(a.X<<y),0]);a.J(C,C,[v*a.X,T*a.X,0]),this._demMatrixCache[t.key]={matrix:C,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,d=r.width/devicePixelRatio,m=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ie(r.context,{width:d,height:m,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ie(r.context,{width:d,height:m,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(d,m,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,d,m))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,v=0;y<this._coordsTextureSize;y++)for(let T=0;T<this._coordsTextureSize;T++,v+=4)r[v+0]=255&T,r[v+1]=255&y,r[v+2]=T>>8<<4|y>>8,r[v+3]=0;const d=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),m=new ie(t,d,t.gl.RGBA,{premultiply:!1});return m.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),d=this.painter.context,m=d.gl,y=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(y,T-v-1,1,1,m.RGBA,m.UNSIGNED_BYTE,r),d.bindFramebuffer.set(null);const C=r[0]+(r[2]>>4<<8),D=r[1]+((15&r[2])<<8),L=this.coordsIndex[255-r[3]],B=L&&this.sourceCache.getTileByID(L);if(!B)return null;const V=this._coordsTextureSize,Z=(1<<B.tileID.canonical.z)*V;return new a.Y((B.tileID.canonical.x*V+C)/Z+B.tileID.wrap,(B.tileID.canonical.y*V+D)/Z,this.getElevation(B.tileID,C,D,V))}depthAtPoint(t){const r=new Uint8Array(4),d=this.painter.context,m=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,r),d.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(t){var r;const d=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,m=d&&t.canonical.y===0,y=d&&t.canonical.y===(1<<t.canonical.z)-1,v=`m_${m?"n":""}_${y?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const T=this.painter.context,C=new a.cc,D=new a.aE,L=this.meshSize,B=a.X/L,V=L*L;for(let vt=0;vt<=L;vt++)for(let zt=0;zt<=L;zt++)C.emplaceBack(zt*B,vt*B,0);for(let vt=0;vt<V;vt+=L+1)for(let zt=0;zt<L;zt++)D.emplaceBack(zt+vt,L+zt+vt+1,L+zt+vt+2),D.emplaceBack(zt+vt,L+zt+vt+2,zt+vt+1);const Z=C.length,W=Z+(L+1),at=(L+1)*L,ot=m?a.b6:0,lt=m?0:1,ut=y?a.b7:a.X,gt=y?0:1;for(let vt=0;vt<=L;vt++)C.emplaceBack(vt*B,ot,lt);for(let vt=0;vt<=L;vt++)C.emplaceBack(vt*B,ut,gt);for(let vt=0;vt<L;vt++)D.emplaceBack(at+vt,W+vt,W+vt+1),D.emplaceBack(at+vt,W+vt+1,at+vt+1),D.emplaceBack(0+vt,Z+vt+1,Z+vt),D.emplaceBack(0+vt,0+vt+1,Z+vt+1);const _t=C.length,yt=_t+2*(L+1);for(const vt of[0,1])for(let zt=0;zt<=L;zt++)for(const Ot of[0,1])C.emplaceBack(vt*a.X,zt*B,Ot);for(let vt=0;vt<2*L;vt+=2)D.emplaceBack(_t+vt,_t+vt+1,_t+vt+3),D.emplaceBack(_t+vt,_t+vt+3,_t+vt+2),D.emplaceBack(yt+vt,yt+vt+3,yt+vt+1),D.emplaceBack(yt+vt,yt+vt+2,yt+vt+3);const wt=new Rn(T.createVertexBuffer(C,Ed.members),T.createIndexBuffer(D),a.aD.simpleSegment(0,0,C.length,D.length));return this._meshCache[v]=wt,wt}getMeshFrameDelta(t){return 2*Math.PI*a.bo/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,r){var d;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(d=this.getMinMaxElevation(m).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,d={minElevation:null,maxElevation:null};return r&&r.dem&&(d.minElevation=r.dem.min*this.exaggeration,d.maxElevation=r.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(t,r){const d=a.Y.fromLngLat(t.wrap()),m=(1<<r)*a.X,y=d.x*m,v=d.y*m,T=Math.floor(y/a.X),C=Math.floor(v/a.X);return{tileID:new a.S(r,0,r,T,C),mercatorX:y,mercatorY:v}}}class va{constructor(t,r,d){this._context=t,this._size=r,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new ie(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(d.texture),{id:t,fbo:r,texture:d,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>t.id!==r),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Si={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class rs{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new va(t.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(d=>!t._layers[d].isHidden(r)),this._coordsAscending={};for(const d in t.sourceCaches){this._coordsAscending[d]={};const m=t.sourceCaches[d].getVisibleCoordinates();for(const y of m){const v=this.terrain.sourceCache.getTerrainCoords(y);for(const T in v)this._coordsAscending[d][T]||(this._coordsAscending[d][T]=[]),this._coordsAscending[d][T].push(v[T])}}this._coordsAscendingStr={};for(const d of t._order){const m=t._layers[d],y=m.source;if(Si[m.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const v in this._coordsAscending[y])this._coordsAscendingStr[y][v]=this._coordsAscending[y][v].map(T=>T.key).sort().join()}}for(const d of this._renderableTiles)for(const m in this._coordsAscendingStr){const y=this._coordsAscendingStr[m][d.tileID.key];y&&y!==d.rttCoords[m]&&(d.rtt=[])}}renderLayer(t,r){if(t.isHidden(this.painter.transform.zoom))return!1;const d=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),m=t.type,y=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Si[m]&&(this._prevType&&Si[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(t.id),!v))return!0;if(Si[this._prevType]||Si[m]&&v){this._prevType=m;const T=this._stacks.length-1,C=this._stacks[T]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(eh(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[T]){const B=this.pool.getObjectForId(D.rtt[T].id);if(B.stamp===D.rtt[T].stamp){this.pool.useObject(B);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),D.rtt[T]={id:L.id,stamp:L.stamp},y.context.bindFramebuffer.set(L.fbo.framebuffer),y.context.clear({color:a.b4.transparent,stencil:0}),y.currentStencilSource=void 0;for(let B=0;B<C.length;B++){const V=y.style._layers[C[B]],Z=V.source?this._coordsAscending[V.source][D.tileID.key]:[D.tileID];y.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),y._renderTileClippingMasks(V,Z,!0),y.renderLayer(y,y.style.sourceCaches[V.source],V,Z,d),V.source&&(D.rttCoords[V.source]=this._coordsAscendingStr[V.source][D.tileID.key])}}return eh(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects(),Si[m]}return!1}}const zd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},wa=w,Sa={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ba,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},lh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ch{constructor(t,r,d=!1){this.mousedown=y=>{this.startMove(y,R.mousePos(this.element,y)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,R.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHanlder.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const m=new xa;this._rotatePitchHanlder=new ge({clickTolerance:3,move:(y,v)=>{const T=r.getBoundingClientRect(),C=new a.P((T.bottom-T.top)/2,(T.right-T.left)/2);return{bearingDelta:a.c7(new a.P(y.x,v.y),v,C),pitchDelta:d?-.5*(v.y-y.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=t,R.addEventListener(r,"mousedown",this.mousedown),R.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(r,"touchcancel",this.reset)}startMove(t,r){this._rotatePitchHanlder.dragStart(t,r),R.disableDrag()}move(t,r){const d=this.map,{bearingDelta:m,pitchDelta:y}=this._rotatePitchHanlder.dragMove(t,r)||{};m&&d.setBearing(d.getBearing()+m),y&&d.setPitch(d.getPitch()+y)}off(){const t=this.element;R.removeEventListener(t,"mousedown",this.mousedown),R.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let Wn;function Io(_,t,r){const d=new a.N(_.lng,_.lat);if(_=new a.N(_.lng,_.lat),t){const m=new a.N(_.lng-360,_.lat),y=new a.N(_.lng+360,_.lat),v=r.locationToScreenPoint(_).distSqr(t);r.locationToScreenPoint(m).distSqr(t)<v?_=m:r.locationToScreenPoint(y).distSqr(t)<v&&(_=y)}for(;Math.abs(_.lng-r.center.lng)>180;){const m=r.locationToScreenPoint(_);if(m.x>=0&&m.y>=0&&m.x<=r.width&&m.y<=r.height)break;_.lng>r.center.lng?_.lng-=360:_.lng+=360}return _.lng!==d.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(_))?_:d}const Ta={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ll(_,t,r){const d=_.classList;for(const m in Ta)d.remove(`maplibregl-${r}-anchor-${m}`);d.add(`maplibregl-${r}-anchor-${t}`)}class Ma extends a.E{constructor(t){if(super(),this._onKeyPress=r=>{const d=r.code,m=r.charCode||r.keyCode;d!=="Space"&&d!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=r=>{const d=r.originalEvent.target,m=this._element;this._popup&&(d===m||m.contains(d))&&this.togglePopup()},this._update=r=>{var d;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Io(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${Ta[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${y}`),F.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=a.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div");const r=R.createNS("http://www.w3.org/2000/svg","svg"),d=41,m=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${d}px`),r.setAttributeNS(null,"width",`${m}px`),r.setAttributeNS(null,"viewBox",`0 0 ${m} ${d}`);const y=R.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const v=R.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const T=R.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const lt of C){const ut=R.createNS("http://www.w3.org/2000/svg","ellipse");ut.setAttributeNS(null,"opacity","0.04"),ut.setAttributeNS(null,"cx","10.5"),ut.setAttributeNS(null,"cy","5.80029008"),ut.setAttributeNS(null,"rx",lt.rx),ut.setAttributeNS(null,"ry",lt.ry),T.appendChild(ut)}const D=R.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const L=R.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(L);const B=R.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const V=R.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(V);const Z=R.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const W=R.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const at=R.createNS("http://www.w3.org/2000/svg","circle");at.setAttributeNS(null,"fill","#000000"),at.setAttributeNS(null,"opacity","0.25"),at.setAttributeNS(null,"cx","5.5"),at.setAttributeNS(null,"cy","5.5"),at.setAttributeNS(null,"r","5.4999962");const ot=R.createNS("http://www.w3.org/2000/svg","circle");ot.setAttributeNS(null,"fill","#FFFFFF"),ot.setAttributeNS(null,"cx","5.5"),ot.setAttributeNS(null,"cy","5.5"),ot.setAttributeNS(null,"r","5.4999962"),W.appendChild(at),W.appendChild(ot),v.appendChild(T),v.appendChild(D),v.appendChild(B),v.appendChild(Z),v.appendChild(W),r.appendChild(v),r.setAttributeNS(null,"height",d*this._scale+"px"),r.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(r),this._offset=a.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),Ll(this._element,this._anchor,"marker"),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var r,d;if(!(!((r=this._map)===null||r===void 0)&&r.terrain)){const B=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==B&&(this._element.style.opacity=B))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,y=m.terrain.depthAtPoint(this._pos),v=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,v)-y<.006)return void(this._element.style.opacity=this._opacity);const T=-this._offset.y/m.transform.pixelsPerMeter,C=Math.sin(m.getPitch()*Math.PI/180)*T,D=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),L=m.transform.lngLatToCameraDepth(this._lngLat,v+C)-D>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=a.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,r){return t===void 0&&r===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const hh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Do=0,Vr=!1;const uh={maxWidth:100,unit:"metric"};function Fl(_,t,r){const d=r&&r.maxWidth||100,m=_._container.clientHeight/2,y=_._container.clientWidth/2,v=_.unproject([y-d/2,m]),T=_.unproject([y+d/2,m]),C=Math.round(_.project(T).x-_.project(v).x),D=Math.min(d,C,_._container.clientWidth),L=v.distanceTo(T);if(r&&r.unit==="imperial"){const B=3.2808*L;B>5280?fr(t,D,B/5280,_._getUIString("ScaleControl.Miles")):fr(t,D,B,_._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?fr(t,D,L/1852,_._getUIString("ScaleControl.NauticalMiles")):L>=1e3?fr(t,D,L/1e3,_._getUIString("ScaleControl.Kilometers")):fr(t,D,L,_._getUIString("ScaleControl.Meters"))}function fr(_,t,r,d){const m=function(y){const v=Math.pow(10,`${Math.floor(y)}`.length-1);let T=y/v;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(C){const D=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*D)/D}(T),v*T}(r);_.style.width=t*(m/r)+"px",_.innerHTML=`${m}&nbsp;${d}`}const dh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},fh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pa(_){if(_){if(typeof _=="number"){const t=Math.round(Math.abs(_)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,_),"top-left":new a.P(t,t),"top-right":new a.P(-t,t),bottom:new a.P(0,-_),"bottom-left":new a.P(t,-t),"bottom-right":new a.P(-t,-t),left:new a.P(_,0),right:new a.P(-_,0)}}if(_ instanceof a.P||Array.isArray(_)){const t=a.P.convert(_);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.P.convert(_.center||[0,0]),top:a.P.convert(_.top||[0,0]),"top-left":a.P.convert(_["top-left"]||[0,0]),"top-right":a.P.convert(_["top-right"]||[0,0]),bottom:a.P.convert(_.bottom||[0,0]),"bottom-left":a.P.convert(_["bottom-left"]||[0,0]),"bottom-right":a.P.convert(_["bottom-right"]||[0,0]),left:a.P.convert(_.left||[0,0]),right:a.P.convert(_.right||[0,0])}}return Pa(new a.P(0,0))}const ph=w;f.AJAXError=a.cg,f.Event=a.k,f.Evented=a.E,f.LngLat=a.N,f.MercatorCoordinate=a.Y,f.Point=a.P,f.addProtocol=a.ch,f.config=a.a,f.removeProtocol=a.ci,f.AttributionControl=zl,f.BoxZoomHandler=xd,f.CanvasSource=se,f.CooperativeGesturesHandler=ah,f.DoubleClickZoomHandler=qn,f.DragPanHandler=Al,f.DragRotateHandler=rh,f.EdgeInsets=As,f.FullscreenControl=class extends a.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var t;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=r==null?void 0:r.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=Et,f.GeolocateControl=class extends a.E{constructor(_){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new a.N(t.coords.longitude,t.coords.latitude),d=t.coords.accuracy,m=this._map.getBearing(),y=a.e({bearing:m},this.options.fitBoundsOptions),v=K.fromLngLat(r,d);this._map.fitBounds(v,y,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new a.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Vr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ma({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ma({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},hh,_)}onAdd(_){return this._map=_,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(t=!1){if(Wn!==void 0&&!t)return Wn;if(window.navigator.permissions===void 0)return Wn=!!window.navigator.geolocation,Wn;try{Wn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Wn=!!window.navigator.geolocation}return Wn})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Do=0,Vr=!1}_isOutOfMapMaxBounds(_){const t=this._map.getMaxBounds(),r=_.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),t=_.getSouthEast(),r=_.getNorthEast(),d=t.distanceTo(r),m=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Do--,Vr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Do++,Do>1?(_={maximumAge:6e5,timeout:0},Vr=!0):(_=this.options.positionOptions,Vr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.GlobeControl=class{constructor(){this._toggleProjection=()=>{var _;const t=(_=this._map.getProjection())===null||_===void 0?void 0:_.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var _;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((_=this._map.getProjection())===null||_===void 0?void 0:_.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(_){return this._map=_,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=R.create("button","maplibregl-ctrl-globe",this._container),R.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},f.Hash=sh,f.ImageSource=jt,f.KeyboardHandler=kd,f.LngLatBounds=K,f.LogoControl=Rl,f.Map=class extends Re{constructor(_){var t,r;a.cd.mark(a.ce.create);const d=Object.assign(Object.assign(Object.assign({},Sa),_),{canvasContextAttributes:Object.assign(Object.assign({},Sa.canvasContextAttributes),_.canvasContextAttributes)});if(d.minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const m=new Un,y=new el;if(d.minZoom!==void 0&&m.setMinZoom(d.minZoom),d.maxZoom!==void 0&&m.setMaxZoom(d.maxZoom),d.minPitch!==void 0&&m.setMinPitch(d.minPitch),d.maxPitch!==void 0&&m.setMaxPitch(d.maxPitch),d.renderWorldCopies!==void 0&&m.setRenderWorldCopies(d.renderWorldCopies),super(m,y,{bearingSnap:d.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ns,this._controls=[],this._mapId=a.a1(),this._contextLost=T=>{T.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:T}))},this._contextRestored=T=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:T}))},this._onMapScroll=T=>{if(T.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},d.canvasContextAttributes),this._trackResize=d.trackResize===!0,this._bearingSnap=d.bearingSnap,this._centerClampedToGround=d.centerClampedToGround,this._refreshExpiredTiles=d.refreshExpiredTiles===!0,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions===!0,this._collectResourceTiming=d.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},zd),d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this.transformCameraUpdate=d.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=d.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=At.addThrottleControl(()=>this.isMoving()),this._requestManager=new Vt(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let T=!1;const C=ur(D=>{this._trackResize&&!this._removed&&(this.resize(D),this.redraw())},50);this._resizeObserver=new ResizeObserver(D=>{T?C(D):T=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ke(this,d),this._hash=d.hash&&new sh(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,elevation:d.elevation,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,roll:d.roll}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,a.e({},d.fitBoundsOptions,{duration:0}))));const v=typeof d.style=="string"||((r=(t=d.style)===null||t===void 0?void 0:t.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new zl(typeof d.attributionControl=="boolean"?void 0:d.attributionControl)),d.maplibreLogo&&this.addControl(new Rl,d.logoPosition),this.on("style.load",()=>{if(v||this._resizeTransform(),this.transform.unmodified){const T=a.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(T)}}),this.on("data",T=>{this._update(T.dataType==="style"),this.fire(new a.k(`${T.dataType}data`,T))}),this.on("dataloading",T=>{this.fire(new a.k(`${T.dataType}dataloading`,T))}),this.on("dataabort",T=>{this.fire(new a.k("sourcedataabort",T))})}_getMapId(){return this._mapId}addControl(_,t){if(t===void 0&&(t=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=_.onAdd(this);this._controls.push(_);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(r,d.firstChild):d.appendChild(r),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(_);return t>-1&&this._controls.splice(t,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,t,r,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,t,r,d)}resize(_,t=!0){const[r,d]=this._containerDimensions(),m=this._getClampedPixelRatio(r,d);if(this._resizeCanvas(r,d,m),this.painter.resize(r,d,m),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const T=this._getClampedPixelRatio(r,d);this._resizeCanvas(r,d,T),this.painter.resize(r,d,T)}this._resizeTransform(t);const y=!this._moving;return y&&(this.stop(),this.fire(new a.k("movestart",_)).fire(new a.k("move",_))),this.fire(new a.k("resize",_)),y&&this.fire(new a.k("moveend",_)),this}_resizeTransform(_=!0){var t;const[r,d]=this._containerDimensions();this.transform.resize(r,d,_),(t=this._requestedCameraState)===null||t===void 0||t.resize(r,d,_)}_getClampedPixelRatio(_,t){const{0:r,1:d}=this._maxCanvasSize,m=this.getPixelRatio(),y=_*m,v=t*m;return Math.min(y>r?r/y:1,v>d?d/v:1)*m}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(K.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.setMinZoom(_),this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.setMaxZoom(_),this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.setMinPitch(_),this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(_>=this.transform.minPitch)return this.transform.setMaxPitch(_),this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.setRenderWorldCopies(_),this._update()}project(_){return this.transform.locationToScreenPoint(a.N.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.screenPointToLocation(a.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,t,r){if(_==="mouseenter"||_==="mouseover"){let d=!1;return{layers:t,listener:r,delegates:{mousemove:y=>{const v=t.filter(C=>this.getLayer(C)),T=v.length!==0?this.queryRenderedFeatures(y.point,{layers:v}):[];T.length?d||(d=!0,r.call(this,new es(_,this,y.originalEvent,{features:T}))):d=!1},mouseout:()=>{d=!1}}}}if(_==="mouseleave"||_==="mouseout"){let d=!1;return{layers:t,listener:r,delegates:{mousemove:v=>{const T=t.filter(C=>this.getLayer(C));(T.length!==0?this.queryRenderedFeatures(v.point,{layers:T}):[]).length?d=!0:d&&(d=!1,r.call(this,new es(_,this,v.originalEvent)))},mouseout:v=>{d&&(d=!1,r.call(this,new es(_,this,v.originalEvent)))}}}}{const d=m=>{const y=t.filter(T=>this.getLayer(T)),v=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];v.length&&(m.features=v,r.call(this,m),delete m.features)};return{layers:t,listener:r,delegates:{[_]:d}}}}_saveDelegatedListener(_,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(t)}_removeDelegatedListener(_,t,r){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const d=this._delegatedListeners[_];for(let m=0;m<d.length;m++){const y=d[m];if(y.listener===r&&y.layers.length===t.length&&y.layers.every(v=>t.includes(v))){for(const v in y.delegates)this.off(v,y.delegates[v]);return void d.splice(m,1)}}}on(_,t,r){if(r===void 0)return super.on(_,t);const d=typeof t=="string"?[t]:t,m=this._createDelegatedListener(_,d,r);this._saveDelegatedListener(_,m);for(const y in m.delegates)this.on(y,m.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(_,d,r)}}}once(_,t,r){if(r===void 0)return super.once(_,t);const d=typeof t=="string"?[t]:t,m=this._createDelegatedListener(_,d,r);for(const y in m.delegates){const v=m.delegates[y];m.delegates[y]=(...T)=>{this._removeDelegatedListener(_,d,r),v(...T)}}this._saveDelegatedListener(_,m);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(_,t,r){return r===void 0?super.off(_,t):(this._removeDelegatedListener(_,typeof t=="string"?[t]:t,r),this)}queryRenderedFeatures(_,t){if(!this.style)return[];let r;const d=_ instanceof a.P||Array.isArray(_),m=d?_:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(d?{}:_)||{},m instanceof a.P||typeof m[0]=="number")r=[a.P.convert(m)];else{const y=a.P.convert(m[0]),v=a.P.convert(m[1]);r=[y,new a.P(v.x,y.y),v,new a.P(y.x,v.y),y]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(_,t){return this.style.querySourceFeatures(_,t)}setStyle(_,t){return(t=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(_,t))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const t=this._locale[_];if(t==null)throw new Error(`Missing UI string '${_}'`);return t}_updateStyle(_,t){var r,d;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,t));const m=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new dn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,t,m):this.style.loadJSON(_,t,m),this):((d=(r=this.style)===null||r===void 0?void 0:r.projection)===null||d===void 0||d.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new dn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,t){if(typeof _=="string"){const r=this._requestManager.transformRequest(_,"Style");a.h(r,new AbortController).then(d=>{this._updateDiff(d.data,t)}).catch(d=>{d&&this.fire(new a.j(d))})}else typeof _=="object"&&this._updateDiff(_,t)}_updateDiff(_,t){try{this.style.setState(_,t)&&this._update(!0)}catch(r){a.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(_,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(_,t){return this._lazyInitEmptyStyle(),this.style.addSource(_,t),this._update(!0)}isSourceLoaded(_){const t=this.style&&this.style.sourceCaches[_];if(t!==void 0)return t.loaded();this.fire(new a.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const t=this.style.sourceCaches[_.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&t.reload();for(const r in this.style._layers){const d=this.style._layers[r];d.type==="hillshade"&&d.source===_.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Bp(this.painter,t,_),this.painter.renderToTexture=new rs(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==_.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.k("terrain",{terrain:_})),this}getTerrain(){var _,t;return(t=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const t in _){const r=_[t]._tiles;for(const d in r){const m=r[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,t,r={}){const{pixelRatio:d=1,sdf:m=!1,stretchX:y,stretchY:v,content:T,textFitWidth:C,textFitHeight:D}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||a.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:B,data:V}=t,Z=t;return this.style.addImage(_,{data:new a.R({width:L,height:B},new Uint8Array(V)),pixelRatio:d,stretchX:y,stretchY:v,content:T,textFitWidth:C,textFitHeight:D,sdf:m,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,_),this}}{const{width:L,height:B,data:V}=F.getImageData(t);this.style.addImage(_,{data:new a.R({width:L,height:B},V),pixelRatio:d,stretchX:y,stretchY:v,content:T,textFitWidth:C,textFitHeight:D,sdf:m,version:0})}}updateImage(_,t){const r=this.style.getImage(_);if(!r)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof HTMLImageElement||a.b(t)?F.getImageData(t):t,{width:m,height:y,data:v}=d;if(m===void 0||y===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==r.data.width||y!==r.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(t instanceof HTMLImageElement||a.b(t));return r.data.replace(v,T),this.style.updateImage(_,r),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return At.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,t){return this._lazyInitEmptyStyle(),this.style.addLayer(_,t),this._update(!0)}moveLayer(_,t){return this.style.moveLayer(_,t),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,t,r){return this.style.setLayerZoomRange(_,t,r),this._update(!0)}setFilter(_,t,r={}){return this.style.setFilter(_,t,r),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,t,r,d={}){return this.style.setPaintProperty(_,t,r,d),this._update(!0)}getPaintProperty(_,t){return this.style.getPaintProperty(_,t)}setLayoutProperty(_,t,r,d={}){return this.style.setLayoutProperty(_,t,r,d),this._update(!0)}getLayoutProperty(_,t){return this.style.getLayoutProperty(_,t)}setGlyphs(_,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,t,r,d=>{d||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,t,r=>{r||this._update(!0)}),this}setLight(_,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(_,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(_,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,t){return this.style.setFeatureState(_,t),this._update()}removeFeatureState(_,t){return this.style.removeFeatureState(_,t),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,t=0;return this._container&&(_=this._container.clientWidth||400,t=this._container.clientHeight||300),[_,t]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const t=this._canvasContainer=R.create("div","maplibregl-canvas-container",_);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),d=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],d);const m=this._controlContainer=R.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{y[v]=R.create("div",`maplibregl-ctrl-${v} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,t,r){this._canvas.width=Math.floor(r*_),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const _=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{t={requestedAttributes:_},d&&(t.statusMessage=d.statusMessage,t.type=d.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,_):this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_),!r){const d="Failed to initialize WebGL";throw t?(t.message=d,new Error(JSON.stringify(t))):new Error(d)}this.painter=new fd(r,this.transform),J.testSupport(r)}migrateProjection(_,t){super.migrateProjection(_,t),this.painter.transform=_,this.fire(new a.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){var t,r,d,m,y;const v=this._idleTriggered?this._fadeDuration:0,T=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let C=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,V=F.now();this.style.zoomHistory.update(B,V);const Z=new a.z(B,{now:V,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),W=Z.crossFadingFactor();W===1&&W===this._crossFadingFactor||(C=!0,this._crossFadingFactor=W),this.style.update(Z)}const D=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==T;(d=this.style.projection)===null||d===void 0||d.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((m=this.style.projection)===null||m===void 0?void 0:m.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||D)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,D),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cd.mark(a.ce.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||C)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const L=this._sourcesDirty||this._styleDirty||this._placementDirty;return L||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,a.cd.mark(a.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),At.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cd.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,F.frame(this._frameRequest,_=>{a.cd.frame(_),this._frameRequest=null;try{this._render(_)}catch(t){if(!a.cf(t)&&!function(r){return r.message===ml}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return wa}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),this.style.setProjection(_),this._update(!0)}},f.MapMouseEvent=es,f.MapTouchEvent=Mo,f.MapWheelEvent=wn,f.Marker=Ma,f.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),d=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,r)=>{const d=this._map._getUIString(`NavigationControl.${r}`);t.title=d,t.setAttribute("aria-label",d)},this.options=a.e({},lh,_),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ch(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,t){const r=R.create("button",_,this._container);return r.type="button",r.addEventListener("click",t),r}},f.Popup=class extends a.E{constructor(_){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var r;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Io(this._lngLat,this._flatPos,this._map.transform):(r=this._lngLat)===null||r===void 0?void 0:r.wrap(),this._trackPointer&&!t)return;const d=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let m=this.options.anchor;const y=Pa(this.options.offset);if(!m){const T=this._container.offsetWidth,C=this._container.offsetHeight;let D;D=d.y+y.bottom.y<C?["top"]:d.y>this._map.transform.height-C?["bottom"]:[],d.x<T/2?D.push("left"):d.x>this._map.transform.width-T/2&&D.push("right"),m=D.length===0?"bottom":D.join("-")}let v=d.add(y[m]);this.options.subpixelPositioning||(v=v.round()),R.setTransform(this._container,`${Ta[m]} translate(${v.x}px,${v.y}px)`),Ll(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(dh),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=a.N.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const t=document.createDocumentFragment(),r=document.createElement("body");let d;for(r.innerHTML=_;d=r.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(fh);_&&_.focus()}},f.RasterDEMTileSource=Tt,f.RasterTileSource=ht,f.ScaleControl=class{constructor(_){this._onMove=()=>{Fl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Fl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},uh),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=Ad,f.Style=dn,f.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=Il,f.TwoFingersTouchRotateHandler=Pd,f.TwoFingersTouchZoomHandler=Cl,f.TwoFingersTouchZoomRotateHandler=oh,f.VectorTileSource=et,f.VideoSource=Ft,f.addSourceType=(_,t)=>a._(void 0,void 0,void 0,function*(){if(ve(_))throw new Error(`A source type called "${_}" already exists.`);((r,d)=>{re[r]=d})(_,t)}),f.clearPrewarmedResources=function(){const _=Ce;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(mi),Ce=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.createTileMesh=oa,f.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return $e().getRTLTextPluginStatus()},f.getVersion=function(){return ph},f.getWorkerCount=function(){return ci.workerCount},f.getWorkerUrl=function(){return a.a.WORKER_URL},f.importScriptInWorkers=function(_){return me().broadcast("IS",_)},f.prewarm=function(){ii().acquire(mi)},f.setMaxParallelImageRequests=function(_){a.a.MAX_PARALLEL_IMAGE_REQUESTS=_},f.setRTLTextPlugin=function(_,t){return $e().setRTLTextPlugin(_,t)},f.setWorkerCount=function(_){ci.workerCount=_},f.setWorkerUrl=function(_){a.a.WORKER_URL=_}});var p=n;return p})}(Cf)),Cf.exports}var pP=fP();const cu=Kg(pP),mP={props:{location:{type:Object,required:!0}},data(){return{map:null,marker:null}},mounted(){this.initializeMap()},watch:{location(){this.location.lon+this.location.lat===0?(this.initializeMap(),this.marker=null):this.marker||(this.marker=new cu.Marker().setLngLat([this.location.lon,this.location.lat]).addTo(this.map),this.map.flyTo({center:[this.location.lon,this.location.lat],zoom:10,essential:!0}))}},methods:{initializeMap(){this.map=new cu.Map({container:"map",style:"https://api.maptiler.com/maps/streets-v2/style.json?key=AJPmdudX9yJ2dZbT3iuM",center:[2,48],zoom:4,minZoom:2})}}},gP={class:"m-2 d-flex justify-content-center"},_P={class:"badge text-bg-primary ms-3"},yP={class:"badge text-bg-primary ms-1"};function xP(s,e,n,c,h,p){return hi(),Yi(Gs,null,[e[1]||(e[1]=fe("div",{id:"map"},null,-1)),fe("p",gP,[e[0]||(e[0]=io(" Station Location : ")),fe("span",_P,"lon : "+Nn(n.location.lon),1),fe("span",yP,"lat : "+Nn(n.location.lat),1)])],64)}const V0=xn(mP,[["render",xP],["__scopeId","data-v-b63dbd63"]]),bP={},vP={class:"SensorItem"},wP={class:"col d-flex align-items-start border-dark-subtle"},SP={class:"icon-square bg-body-secondary d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3"},TP={class:"fs-3 text-body-emphasis"},MP={class:"text-center"};function PP(s,e){return hi(),Yi("div",vP,[fe("div",wP,[fe("div",SP,[nu(s.$slots,"icon",{},void 0)]),fe("div",null,[fe("h3",TP,[nu(s.$slots,"title",{},void 0)])])]),fe("div",null,[fe("h4",MP,[nu(s.$slots,"val",{},void 0)])])])}const CP=xn(bP,[["render",PP],["__scopeId","data-v-88aa7672"]]),kP={components:{MapBox:V0,SensorItem:CP},props:{sensorData:{type:Array,required:!0},location:{type:Object,required:!0}}},IP={class:"box"},DP={class:"sensorBox"},AP=["src"],EP={class:"mapBox"};function zP(s,e,n,c,h,p){const f=ks("SensorItem"),a=ks("MapBox");return hi(),Yi("div",IP,[fe("div",DP,[(hi(!0),Yi(Gs,null,Ug(n.sensorData,w=>(hi(),Yi("div",{key:w},[ki(f,null,{icon:oo(()=>[fe("img",{alt:"icon",class:"icon-square",src:w.url},null,8,AP)]),title:oo(()=>[io(Nn(w.name),1)]),val:oo(()=>[io(Nn(w.val),1)]),_:2},1024)]))),128))]),fe("div",EP,[ki(a,{location:n.location},null,8,["location"])])])}const RP=xn(kP,[["render",zP],["__scopeId","data-v-59da5a10"]]),LP={props:{stationName:{type:String,required:!0},timestamp:{type:String,required:!0}},data(){return{infos:{"Pi 28":"Vanessa et Zijian","Pi 27":"Romain et Jiongru","Pi 29":"iamvdo et cedricici","Pi 30":"Loïs et Jean-Baptiste","Pi 31":"Vincent et Ibrahim","Pi 32":"Thomas et Antonin"}}},methods:{readableTimestamp(){const s={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"};return new Date(this.timestamp).toLocaleDateString("fr-FR",s).replace(/./,n=>n.toUpperCase()).replace(/,? /,", ")}}},FP={class:"card"},OP={class:"card-header"},BP={key:0,type:"button",class:"btn btn-outline-danger btn-sm me-2","data-bs-toggle":"button"},jP={key:1,type:"button",class:"btn btn-outline-success btn-sm me-2","data-bs-toggle":"button"},NP={class:"ms-2"},VP={class:"card-body d-flex flex-row justify-content-between"};function $P(s,e,n,c,h,p){const f=ks("router-link");return hi(),Yi("div",FP,[fe("div",OP,[s.$route.name==="home"?(hi(),Yi("button",BP," Data Live ")):Vo("",!0),s.$route.name==="history"?(hi(),Yi("button",jP," Data History ")):Vo("",!0),io(" Station "+Nn(n.stationName)+" | ",1),fe("b",NP,Nn(h.infos[n.stationName]),1)]),fe("div",VP,[fe("h5",null,Nn(p.readableTimestamp()),1),fe("div",null,[s.$route.name==="history"||s.$route.name==="map"?(hi(),nr(f,{key:0,to:"/",class:"btn btn-outline-danger btn-sm me-2","data-bs-toggle":"button"},{default:oo(()=>e[0]||(e[0]=[io("Go Data Live")])),_:1})):Vo("",!0),s.$route.name==="home"||s.$route.name==="map"?(hi(),nr(f,{key:1,to:"/history",class:"btn btn-outline-success btn-sm me-2","data-bs-toggle":"button"},{default:oo(()=>e[1]||(e[1]=[io("Go Data History")])),_:1})):Vo("",!0),s.$route.name!=="map"?(hi(),nr(f,{key:2,to:"/map",class:"btn btn-outline-primary btn-sm me-2","data-bs-toggle":"button"},{default:oo(()=>e[2]||(e[2]=[io("Go Map stations")])),_:1})):Vo("",!0)])])])}const Yg=xn(LP,[["render",$P]]),UP={},HP={class:"alert alert-danger",role:"alert"};function ZP(s,e){return hi(),Yi("div",HP,e[0]||(e[0]=[fe("h4",{class:"alert-heading"},"Oh mince !",-1),fe("p",null," Cette station semble avoir des problèmes techniques. Nous ne pouvons pas recevoir les informations de ses capteurs. ",-1),fe("hr",null,null,-1),fe("p",{class:"mb-0"},"Veuillez retourner sur la station Pi 28, c'est plus safe :D",-1)]))}const $0=xn(UP,[["render",ZP]]),GP="/assets/temperature-DLYwAvqg.png",qP="/assets/luminosity-DTq5WRNs.png",WP="/assets/humidity-DXEJ10dZ.png",XP="/assets/precipitation-guEkBHi1.png",KP="/assets/wind_head-CrWqZk-K.png",YP="/assets/wind_speed-aFxxQyYr.png",JP="/assets/pressure-m2dHtsb9.png";function U0(s){return{rain:XP,temperature:GP,humidity:WP,pressure:JP,wind_speed_avg:YP,wind_heading:KP,luminosity:qP}[s]}function Zf(){return{rain:"Precipitation",temperature:"Temperature",humidity:"Humidity",pressure:"Pressure",wind_speed_avg:"Wind Speed",wind_heading:"Wind Heading",luminosity:"Luminosity"}}const QP={components:{HeaderApp:Xg,InfoStation:Yg,MenuApp:j0,DataLiveBoard:RP,ErrorStation:$0},data(){return{sensorList:[],sensorData:[],dataLive:{},timestamp:"",location:{lon:0,lat:0},stationName:"Pi 28",error:!1}},mounted(){this.get_date()},watch:{timestamp(s){new Date(s).getMinutes()%10===0&&console.log("time to fetch")},dataLive(){this.sensorList.includes("lat-lon")&&(this.location={lon:this.dataLive.data.lon,lat:this.dataLive.data.lat});const s=Zf();this.sensorData=this.sensorList.filter(e=>e!=="lat-lon").map(e=>({name:s[e],val:`${this.dataLive.data[e]} ${this.dataLive.unit[e]}`,url:U0(e)}))}},methods:{maj_sensor(s){s.includes("all")?(this.sensorList=Object.keys(Zf()),this.sensorList.push("lat-lon")):(this.sensorList=s.filter(e=>e!=="location"&&e!=="all"),this.location={lon:0,lat:0}),s.includes("location")&&this.sensorList.push("lat-lon"),this.fetchDataLive()},maj_station(s){this.stationName=s,this.fetchDataLive()},get_date(){setInterval(()=>{this.timestamp=new Date().toISOString()},1e3)},async fetchDataLive(){try{const s=await fetch(`http://piensg0${this.stationName.split(" ")[1]}.ensg.eu:3000/live/${this.sensorList.join("-")}`);if(s.ok)this.error=!1,this.dataLive=await s.json();else throw new Error("Failed to fetch data")}catch(s){this.error=!0,console.error("Error:",s)}}}},tC={class:"container"},eC={class:"row mb-4"},iC={class:"col"},sC={class:"row"},nC={class:"col-2"},rC={class:"col-10"};function oC(s,e,n,c,h,p){const f=ks("HeaderApp"),a=ks("InfoStation"),w=ks("MenuApp"),P=ks("ErrorStation"),k=ks("DataLiveBoard");return hi(),Yi("div",tC,[fe("div",eC,[fe("div",iC,[ki(f,{onUpdateStationName:p.maj_station},null,8,["onUpdateStationName"]),ki(a,{stationName:h.stationName,timestamp:h.timestamp},null,8,["stationName","timestamp"])])]),fe("div",sC,[fe("div",nC,[ki(w,{onUpdateSensor:p.maj_sensor},null,8,["onUpdateSensor"])]),fe("div",rC,[h.error?(hi(),nr(P,{key:0})):(hi(),nr(k,{key:1,sensorData:h.sensorData,location:h.location},null,8,["sensorData","location"]))])])])}const aC=xn(QP,[["render",oC]]);var kf={exports:{}},lC=kf.exports,Hx;function cC(){return Hx||(Hx=1,function(s,e){(function(n,c){s.exports=c()})(lC,function(){return function(){var n={d:function(Pt,X){for(var N in X)n.o(X,N)&&!n.o(Pt,N)&&Object.defineProperty(Pt,N,{enumerable:!0,get:X[N]})},o:function(Pt,X){return Object.prototype.hasOwnProperty.call(Pt,X)}},c={};n.d(c,{default:function(){return me}});var h={days:"days",months:"months",years:"years",day:"day",month:"month",year:"year",eventChangeViewDate:"changeViewDate",eventChangeCurrentView:"changeCurrentView",eventChangeFocusDate:"changeFocusDate",eventChangeSelectedDate:"changeSelectedDate",eventChangeTime:"changeTime",eventChangeLastSelectedDate:"changeLastSelectedDate",actionSelectDate:"selectDate",actionUnselectDate:"unselectDate",cssClassWeekend:"-weekend-"},p={classes:"",inline:!1,locale:{days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],daysShort:["Вос","Пон","Вто","Сре","Чет","Пят","Суб"],daysMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthsShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],today:"Сегодня",clear:"Очистить",dateFormat:"dd.MM.yyyy",timeFormat:"HH:mm",firstDay:1},startDate:new Date,firstDay:"",weekends:[6,0],dateFormat:"",altField:"",altFieldDateFormat:"T",toggleSelected:!0,keyboardNav:!0,selectedDates:!1,container:"",isMobile:!1,visible:!1,position:"bottom left",offset:12,view:h.days,minView:h.days,showOtherMonths:!0,selectOtherMonths:!0,moveToOtherMonthsOnSelect:!0,showOtherYears:!0,selectOtherYears:!0,moveToOtherYearsOnSelect:!0,minDate:"",maxDate:"",disableNavWhenOutOfRange:!0,multipleDates:!1,multipleDatesSeparator:", ",range:!1,dynamicRange:!0,buttons:!1,monthsField:"monthsShort",showEvent:"focus",autoClose:!1,fixedHeight:!1,prevHtml:'<svg><path d="M 17,12 l -5,5 l 5,5"></path></svg>',nextHtml:'<svg><path d="M 14,12 l 5,5 l -5,5"></path></svg>',navTitles:{days:"MMMM, <i>yyyy</i>",months:"yyyy",years:"yyyy1 - yyyy2"},timepicker:!1,onlyTimepicker:!1,dateTimeSeparator:" ",timeFormat:"",minHours:0,maxHours:24,minMinutes:0,maxMinutes:59,hoursStep:1,minutesStep:1,onSelect:!1,onChangeViewDate:!1,onChangeView:!1,onRenderCell:!1,onShow:!1,onHide:!1,onClickDayName:!1};function f(Pt){let X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document;return typeof Pt=="string"?X.querySelector(Pt):Pt}function a(){let{tagName:Pt="div",className:X="",innerHtml:N="",id:O="",attrs:K={}}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},nt=document.createElement(Pt);return X&&nt.classList.add(...X.split(" ")),O&&(nt.id=O),N&&(nt.innerHTML=N),K&&w(nt,K),nt}function w(Pt,X){for(let[N,O]of Object.entries(X))O!==void 0&&Pt.setAttribute(N,O);return Pt}function P(Pt){return new Date(Pt.getFullYear(),Pt.getMonth()+1,0).getDate()}function k(Pt){let X=Pt.getHours(),{hours:N,dayPeriod:O}=E(X);return{year:Pt.getFullYear(),month:Pt.getMonth(),fullMonth:Pt.getMonth()+1<10?"0"+(Pt.getMonth()+1):Pt.getMonth()+1,date:Pt.getDate(),fullDate:Pt.getDate()<10?"0"+Pt.getDate():Pt.getDate(),day:Pt.getDay(),hours:X,fullHours:F(X),hours12:N,dayPeriod:O,fullHours12:F(N),minutes:Pt.getMinutes(),fullMinutes:Pt.getMinutes()<10?"0"+Pt.getMinutes():Pt.getMinutes()}}function E(Pt){return{dayPeriod:Pt>11?"pm":"am",hours:Pt%12==0?12:Pt%12}}function F(Pt){return Pt<10?"0"+Pt:Pt}function R(Pt){let X=10*Math.floor(Pt.getFullYear()/10);return[X,X+9]}function J(){let Pt=[];for(var X=arguments.length,N=new Array(X),O=0;O<X;O++)N[O]=arguments[O];return N.forEach(K=>{if(typeof K=="object")for(let nt in K)K[nt]&&Pt.push(nt);else K&&Pt.push(K)}),Pt.join(" ")}function rt(Pt,X){let N=arguments.length>2&&arguments[2]!==void 0?arguments[2]:h.days;if(!Pt||!X)return!1;let O=k(Pt),K=k(X);return{[h.days]:O.date===K.date&&O.month===K.month&&O.year===K.year,[h.months]:O.month===K.month&&O.year===K.year,[h.years]:O.year===K.year}[N]}function mt(Pt,X,N){let O=Ct(Pt,!1).getTime(),K=Ct(X,!1).getTime();return N?O>=K:O>K}function xt(Pt,X){return!mt(Pt,X,!0)}function Ct(Pt){let X=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],N=new Date(Pt.getTime());return typeof X!="boolean"||X||function(O){O.setHours(0,0,0,0)}(N),N}function Lt(Pt,X,N){Pt.length?Pt.forEach(O=>{O.addEventListener(X,N)}):Pt.addEventListener(X,N)}function At(Pt,X){return!(!Pt||Pt===document||Pt instanceof DocumentFragment)&&(Pt.matches(X)?Pt:At(Pt.parentNode,X))}function Vt(Pt,X,N){return Pt>N?N:Pt<X?X:Pt}function Yt(Pt){for(var X=arguments.length,N=new Array(X>1?X-1:0),O=1;O<X;O++)N[O-1]=arguments[O];return N.filter(K=>K).forEach(K=>{for(let[nt,et]of Object.entries(K))if(et!==void 0&&et.toString()==="[object Object]"){let ht=Pt[nt]!==void 0?Pt[nt].toString():void 0,Tt=et.toString(),Et=Array.isArray(et)?[]:{};Pt[nt]=Pt[nt]?ht!==Tt?Et:Pt[nt]:Et,Yt(Pt[nt],et)}else Pt[nt]=et}),Pt}function Gt(Pt){let X=Pt;return Pt instanceof Date||(typeof Pt=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(Pt)&&(Pt+="T00:00:00"),X=new Date(Pt)),isNaN(X.getTime())&&(console.log(`Unable to convert value "${Pt}" to Date object`),X=!1),X}function ie(Pt){let X="\\s|\\.|-|/|\\\\|,|\\$|\\!|\\?|:|;";return new RegExp("(^|>|"+X+")("+Pt+")($|<|"+X+")","g")}function be(Pt,X,N){return(X=function(O){var K=function(nt,et){if(typeof nt!="object"||nt===null)return nt;var ht=nt[Symbol.toPrimitive];if(ht!==void 0){var Tt=ht.call(nt,"string");if(typeof Tt!="object")return Tt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(nt)}(O);return typeof K=="symbol"?K:String(K)}(X))in Pt?Object.defineProperty(Pt,X,{value:N,enumerable:!0,configurable:!0,writable:!0}):Pt[X]=N,Pt}class ze{constructor(){let{type:X,date:N,dp:O,opts:K,body:nt}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};be(this,"focus",()=>{this.$cell.classList.add("-focus-"),this.focused=!0}),be(this,"removeFocus",()=>{this.$cell.classList.remove("-focus-"),this.focused=!1}),be(this,"select",()=>{this.$cell.classList.add("-selected-"),this.selected=!0}),be(this,"removeSelect",()=>{this.$cell.classList.remove("-selected-","-range-from-","-range-to-"),this.selected=!1}),be(this,"onChangeSelectedDate",()=>{this.isDisabled||(this._handleSelectedStatus(),this.opts.range&&this._handleRangeStatus())}),be(this,"onChangeFocusDate",et=>{if(!et)return void(this.focused&&this.removeFocus());let ht=rt(et,this.date,this.type);ht?this.focus():!ht&&this.focused&&this.removeFocus(),this.opts.range&&this._handleRangeStatus()}),be(this,"render",()=>(this.$cell.innerHTML=this._getHtml(),this._handleClasses(),this.$cell)),this.type=X,this.singleType=this.type.slice(0,-1),this.date=N,this.dp=O,this.opts=K,this.body=nt,this.customData=!1,this.init()}init(){var X;let{onRenderCell:N}=this.opts;N&&(this.customData=N({date:this.date,cellType:this.singleType,datepicker:this.dp})),this._createElement(),this._bindDatepickerEvents(),(X=this.customData)!==null&&X!==void 0&&X.disabled&&this.dp.disableDate(this.date)}_bindDatepickerEvents(){this.dp.on(h.eventChangeSelectedDate,this.onChangeSelectedDate),this.dp.on(h.eventChangeFocusDate,this.onChangeFocusDate)}unbindDatepickerEvents(){this.dp.off(h.eventChangeSelectedDate,this.onChangeSelectedDate),this.dp.off(h.eventChangeFocusDate,this.onChangeFocusDate)}_createElement(){var X;let{year:N,month:O,date:K}=k(this.date),nt=((X=this.customData)===null||X===void 0?void 0:X.attrs)||{};this.$cell=a({attrs:{"data-year":N,"data-month":O,"data-date":K,...nt}}),this.$cell.adpCell=this}_getClassName(){var X;let N=new Date,{selectOtherMonths:O,selectOtherYears:K}=this.opts,{minDate:nt,maxDate:et,isDateDisabled:ht}=this.dp,{day:Tt}=k(this.date),Et=this._isOutOfMinMaxRange(),jt=ht(this.date),Ft=J("air-datepicker-cell",`-${this.singleType}-`,{"-current-":rt(N,this.date,this.type),"-min-date-":nt&&rt(nt,this.date,this.type),"-max-date-":et&&rt(et,this.date,this.type)}),se="";switch(this.type){case h.days:se=J({"-weekend-":this.dp.isWeekend(Tt),"-other-month-":this.isOtherMonth,"-disabled-":this.isOtherMonth&&!O||Et||jt});break;case h.months:se=J({"-disabled-":Et});break;case h.years:se=J({"-other-decade-":this.isOtherDecade,"-disabled-":Et||this.isOtherDecade&&!K})}return J(Ft,se,(X=this.customData)===null||X===void 0?void 0:X.classes).split(" ")}_getHtml(){var X;let{year:N,month:O,date:K}=k(this.date),{showOtherMonths:nt,showOtherYears:et}=this.opts;if((X=this.customData)!==null&&X!==void 0&&X.html)return this.customData.html;switch(this.type){case h.days:return!nt&&this.isOtherMonth?"":K;case h.months:return this.dp.locale[this.opts.monthsField][O];case h.years:return!et&&this.isOtherDecade?"":N}}_isOutOfMinMaxRange(){let{minDate:X,maxDate:N}=this.dp,{type:O,date:K}=this,{month:nt,year:et,date:ht}=k(K),Tt=O===h.days,Et=O===h.years,jt=!!X&&new Date(et,Et?X.getMonth():nt,Tt?ht:X.getDate()),Ft=!!N&&new Date(et,Et?N.getMonth():nt,Tt?ht:N.getDate());return X&&N?xt(jt,X)||mt(Ft,N):X?xt(jt,X):N?mt(Ft,N):void 0}destroy(){this.unbindDatepickerEvents()}_handleRangeStatus(){const{selectedDates:X,focusDate:N,rangeDateTo:O,rangeDateFrom:K}=this.dp,nt=X.length;if(!nt)return;let et=K,ht=O;if(nt===1&&N){const se=mt(N,X[0]);et=se?X[0]:N,ht=se?N:X[0]}let Tt=J({"-in-range-":et&&ht&&(Et=this.date,jt=et,Ft=ht,mt(Et,jt)&&xt(Et,Ft)),"-range-from-":et&&rt(this.date,et,this.type),"-range-to-":ht&&rt(this.date,ht,this.type)});var Et,jt,Ft;this.$cell.classList.remove("-range-from-","-range-to-","-in-range-"),Tt&&this.$cell.classList.add(...Tt.split(" "))}_handleSelectedStatus(){let X=this.dp._checkIfDateIsSelected(this.date,this.type);X?this.select():!X&&this.selected&&this.removeSelect()}_handleInitialFocusStatus(){rt(this.dp.focusDate,this.date,this.type)&&this.focus()}_handleClasses(){this.$cell.setAttribute("class",""),this._handleInitialFocusStatus(),this.dp.hasSelectedDates&&(this._handleSelectedStatus(),this.dp.opts.range&&this._handleRangeStatus()),this.$cell.classList.add(...this._getClassName())}get isDisabled(){return this.$cell.matches(".-disabled-")}get isOtherMonth(){return this.dp.isOtherMonth(this.date)}get isOtherDecade(){return this.dp.isOtherDecade(this.date)}}function Me(Pt,X,N){return(X=function(O){var K=function(nt,et){if(typeof nt!="object"||nt===null)return nt;var ht=nt[Symbol.toPrimitive];if(ht!==void 0){var Tt=ht.call(nt,"string");if(typeof Tt!="object")return Tt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(nt)}(O);return typeof K=="symbol"?K:String(K)}(X))in Pt?Object.defineProperty(Pt,X,{value:N,enumerable:!0,configurable:!0,writable:!0}):Pt[X]=N,Pt}let Fe={[h.days]:`<div class="air-datepicker-body--day-names"></div><div class="air-datepicker-body--cells -${h.days}-"></div>`,[h.months]:`<div class="air-datepicker-body--cells -${h.months}-"></div>`,[h.years]:`<div class="air-datepicker-body--cells -${h.years}-"></div>`};const Ve=".air-datepicker-cell";class He{constructor(X){let{dp:N,type:O,opts:K}=X;Me(this,"handleClick",nt=>{let et=nt.target.closest(Ve).adpCell;if(et.isDisabled)return;if(!this.dp.isMinViewReached)return void this.dp.down();let ht=this.dp._checkIfDateIsSelected(et.date,et.type);ht?this.dp._handleAlreadySelectedDates(ht,et.date):this.dp.selectDate(et.date)}),Me(this,"handleDayNameClick",nt=>{let et=nt.target.getAttribute("data-day-index");this.opts.onClickDayName({dayIndex:Number(et),datepicker:this.dp})}),Me(this,"onChangeCurrentView",nt=>{nt!==this.type?this.hide():(this.show(),this.render())}),Me(this,"onMouseOverCell",nt=>{let et=At(nt.target,Ve);this.dp.setFocusDate(!!et&&et.adpCell.date)}),Me(this,"onMouseOutCell",()=>{this.dp.setFocusDate(!1)}),Me(this,"onClickBody",nt=>{let{onClickDayName:et}=this.opts,ht=nt.target;ht.closest(Ve)&&this.handleClick(nt),et&&ht.closest(".air-datepicker-body--day-name")&&this.handleDayNameClick(nt)}),Me(this,"onMouseDown",nt=>{this.pressed=!0;let et=At(nt.target,Ve),ht=et&&et.adpCell;rt(ht.date,this.dp.rangeDateFrom)&&(this.rangeFromFocused=!0),rt(ht.date,this.dp.rangeDateTo)&&(this.rangeToFocused=!0)}),Me(this,"onMouseMove",nt=>{if(!this.pressed||!this.dp.isMinViewReached)return;nt.preventDefault();let et=At(nt.target,Ve),ht=et&&et.adpCell,{selectedDates:Tt,rangeDateTo:Et,rangeDateFrom:jt}=this.dp;if(!ht||ht.isDisabled)return;let{date:Ft}=ht;if(Tt.length===2){if(this.rangeFromFocused&&!mt(Ft,Et)){let{hours:se,minutes:re}=k(jt);Ft.setHours(se),Ft.setMinutes(re),this.dp.rangeDateFrom=Ft,this.dp.replaceDate(jt,Ft)}if(this.rangeToFocused&&!xt(Ft,jt)){let{hours:se,minutes:re}=k(Et);Ft.setHours(se),Ft.setMinutes(re),this.dp.rangeDateTo=Ft,this.dp.replaceDate(Et,Ft)}}}),Me(this,"onMouseUp",()=>{this.pressed=!1,this.rangeFromFocused=!1,this.rangeToFocused=!1}),Me(this,"onChangeViewDate",(nt,et)=>{if(!this.isVisible)return;let ht=R(nt),Tt=R(et);switch(this.dp.currentView){case h.days:if(rt(nt,et,h.months))return;break;case h.months:if(rt(nt,et,h.years))return;break;case h.years:if(ht[0]===Tt[0]&&ht[1]===Tt[1])return}this.render()}),Me(this,"render",()=>{this.destroyCells(),this._generateCells(),this.cells.forEach(nt=>{this.$cells.appendChild(nt.render())})}),this.dp=N,this.type=O,this.opts=K,this.cells=[],this.$el="",this.pressed=!1,this.isVisible=!0,this.init()}init(){this._buildBaseHtml(),this.type===h.days&&this.renderDayNames(),this.render(),this._bindEvents(),this._bindDatepickerEvents()}_bindEvents(){let{range:X,dynamicRange:N}=this.opts;Lt(this.$el,"mouseover",this.onMouseOverCell),Lt(this.$el,"mouseout",this.onMouseOutCell),Lt(this.$el,"click",this.onClickBody),X&&N&&(Lt(this.$el,"mousedown",this.onMouseDown),Lt(this.$el,"mousemove",this.onMouseMove),Lt(window.document,"mouseup",this.onMouseUp))}_bindDatepickerEvents(){this.dp.on(h.eventChangeViewDate,this.onChangeViewDate),this.dp.on(h.eventChangeCurrentView,this.onChangeCurrentView)}_buildBaseHtml(){this.$el=a({className:`air-datepicker-body -${this.type}-`,innerHtml:Fe[this.type]}),this.$names=f(".air-datepicker-body--day-names",this.$el),this.$cells=f(".air-datepicker-body--cells",this.$el)}_getDayNamesHtml(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.dp.locale.firstDay,N="",O=this.dp.isWeekend,{onClickDayName:K}=this.opts,nt=X,et=0;for(;et<7;){let ht=nt%7;N+=`<div class="${J("air-datepicker-body--day-name",{[h.cssClassWeekend]:O(ht),"-clickable-":!!K})}" data-day-index='${ht}'>${this.dp.locale.daysMin[ht]}</div>`,et++,nt++}return N}renderDayNames(){this.$names.innerHTML=this._getDayNamesHtml()}_generateCell(X){let{type:N,dp:O,opts:K}=this;return new ze({type:N,dp:O,opts:K,date:X,body:this})}_generateCells(){He.getDatesFunction(this.type)(this.dp,X=>{this.cells.push(this._generateCell(X))})}show(){this.isVisible=!0,this.$el.classList.remove("-hidden-")}hide(){this.isVisible=!1,this.$el.classList.add("-hidden-")}destroyCells(){this.cells.forEach(X=>X.destroy()),this.cells=[],this.$cells.innerHTML=""}destroy(){this.destroyCells(),this.dp.off(h.eventChangeViewDate,this.onChangeViewDate),this.dp.off(h.eventChangeCurrentView,this.onChangeCurrentView)}static getDaysDates(X,N){let{viewDate:O,opts:{fixedHeight:K},locale:{firstDay:nt}}=X,et=P(O),{year:ht,month:Tt}=k(O),Et=new Date(ht,Tt,1),jt=new Date(ht,Tt,et),Ft=Et.getDay()-nt,se=6-jt.getDay()+nt;Ft=Ft<0?Ft+7:Ft,se=se>6?se-7:se;let re=function(fi,ns){let{year:Qi,month:Js,date:Qs}=k(fi);return new Date(Qi,Js,Qs-ns)}(Et,Ft),ve=et+Ft+se,Te=re.getDate(),{year:Ne,month:Je}=k(re),$e=0;K&&(ve=42);const _i=[];for(;$e<ve;){let fi=new Date(Ne,Je,Te+$e);N&&N(fi),_i.push(fi),$e++}return _i}static getMonthsDates(X,N){let{year:O}=X.parsedViewDate,K=0,nt=[];for(;K<12;){const et=new Date(O,K);nt.push(et),N&&N(et),K++}return nt}static getYearsDates(X,N){let O=R(X.viewDate),K=O[0]-1,nt=O[1]+1,et=K,ht=[];for(;et<=nt;){const Tt=new Date(et,0);ht.push(Tt),N&&N(Tt),et++}return ht}static getDatesFunction(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:h.days;return{[h.days]:He.getDaysDates,[h.months]:He.getMonthsDates,[h.years]:He.getYearsDates}[X]}}function je(Pt,X,N){return(X=function(O){var K=function(nt,et){if(typeof nt!="object"||nt===null)return nt;var ht=nt[Symbol.toPrimitive];if(ht!==void 0){var Tt=ht.call(nt,"string");if(typeof Tt!="object")return Tt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(nt)}(O);return typeof K=="symbol"?K:String(K)}(X))in Pt?Object.defineProperty(Pt,X,{value:N,enumerable:!0,configurable:!0,writable:!0}):Pt[X]=N,Pt}class xe{constructor(X){let{dp:N,opts:O}=X;je(this,"onClickNav",K=>{let nt=At(K.target,".air-datepicker-nav--action");if(!nt)return;let et=nt.dataset.action;this.dp[et]()}),je(this,"onChangeViewDate",()=>{this.render(),this._resetNavStatus(),this.handleNavStatus()}),je(this,"onChangeCurrentView",()=>{this.render(),this._resetNavStatus(),this.handleNavStatus()}),je(this,"onClickNavTitle",()=>{this.dp.isFinalView||this.dp.up()}),je(this,"update",()=>{let{prevHtml:K,nextHtml:nt}=this.opts;this.$prev.innerHTML=K,this.$next.innerHTML=nt,this._resetNavStatus(),this.render(),this.handleNavStatus()}),je(this,"renderDelay",()=>{setTimeout(this.render)}),je(this,"render",()=>{this.$title.innerHTML=this._getTitle(),function(K,nt){for(let et in nt)nt[et]?K.classList.add(et):K.classList.remove(et)}(this.$title,{"-disabled-":this.dp.isFinalView})}),this.dp=N,this.opts=O,this.init()}init(){this._createElement(),this._buildBaseHtml(),this._defineDOM(),this.render(),this.handleNavStatus(),this._bindEvents(),this._bindDatepickerEvents()}_defineDOM(){this.$title=f(".air-datepicker-nav--title",this.$el),this.$prev=f('[data-action="prev"]',this.$el),this.$next=f('[data-action="next"]',this.$el)}_bindEvents(){this.$el.addEventListener("click",this.onClickNav),this.$title.addEventListener("click",this.onClickNavTitle)}_bindDatepickerEvents(){this.dp.on(h.eventChangeViewDate,this.onChangeViewDate),this.dp.on(h.eventChangeCurrentView,this.onChangeCurrentView),this.isNavIsFunction&&(this.dp.on(h.eventChangeSelectedDate,this.renderDelay),this.dp.opts.timepicker&&this.dp.on(h.eventChangeTime,this.render))}destroy(){this.dp.off(h.eventChangeViewDate,this.onChangeViewDate),this.dp.off(h.eventChangeCurrentView,this.onChangeCurrentView),this.isNavIsFunction&&(this.dp.off(h.eventChangeSelectedDate,this.renderDelay),this.dp.opts.timepicker&&this.dp.off(h.eventChangeTime,this.render))}_createElement(){this.$el=a({tagName:"nav",className:"air-datepicker-nav"})}_getTitle(){let{dp:X,opts:N}=this,O=N.navTitles[X.currentView];return typeof O=="function"?O(X):X.formatDate(X.viewDate,O)}handleNavStatus(){let{disableNavWhenOutOfRange:X}=this.opts,{minDate:N,maxDate:O}=this.dp;if(!N&&!O||!X)return;let{year:K,month:nt}=this.dp.parsedViewDate,et=!!N&&k(N),ht=!!O&&k(O);switch(this.dp.currentView){case h.days:N&&et.month>=nt&&et.year>=K&&this._disableNav("prev"),O&&ht.month<=nt&&ht.year<=K&&this._disableNav("next");break;case h.months:N&&et.year>=K&&this._disableNav("prev"),O&&ht.year<=K&&this._disableNav("next");break;case h.years:{let Tt=R(this.dp.viewDate);N&&et.year>=Tt[0]&&this._disableNav("prev"),O&&ht.year<=Tt[1]&&this._disableNav("next");break}}}_disableNav(X){f('[data-action="'+X+'"]',this.$el).classList.add("-disabled-")}_resetNavStatus(){(function(X){for(var N=arguments.length,O=new Array(N>1?N-1:0),K=1;K<N;K++)O[K-1]=arguments[K];X.length?X.forEach(nt=>{nt.classList.remove(...O)}):X.classList.remove(...O)})(this.$el.querySelectorAll(".air-datepicker-nav--action"),"-disabled-")}_buildBaseHtml(){let{prevHtml:X,nextHtml:N}=this.opts;this.$el.innerHTML=`<div class="air-datepicker-nav--action" data-action="prev">${X}</div><div class="air-datepicker-nav--title"></div><div class="air-datepicker-nav--action" data-action="next">${N}</div>`}get isNavIsFunction(){let{navTitles:X}=this.opts;return Object.keys(X).find(N=>typeof X[N]=="function")}}var De={today:{content:Pt=>Pt.locale.today,onClick:Pt=>Pt.setViewDate(new Date)},clear:{content:Pt=>Pt.locale.clear,onClick:Pt=>Pt.clear()}};class Oe{constructor(X){let{dp:N,opts:O}=X;this.dp=N,this.opts=O,this.init()}init(){this.createElement(),this.render()}createElement(){this.$el=a({className:"air-datepicker-buttons"})}destroy(){this.$el.parentNode.removeChild(this.$el)}clearHtml(){return this.$el.innerHTML="",this}generateButtons(){let{buttons:X}=this.opts;Array.isArray(X)||(X=[X]),X.forEach(N=>{let O=N;typeof N=="string"&&De[N]&&(O=De[N]);let K=this.createButton(O);O.onClick&&this.attachEventToButton(K,O.onClick),this.$el.appendChild(K)})}attachEventToButton(X,N){X.addEventListener("click",()=>{N(this.dp)})}createButton(X){let{content:N,className:O,tagName:K="button",attrs:nt={}}=X;return a({tagName:K,innerHtml:`<span tabindex='-1'>${typeof N=="function"?N(this.dp):N}</span>`,className:J("air-datepicker-button",O),attrs:nt})}render(){this.generateButtons()}}function qe(Pt,X,N){return(X=function(O){var K=function(nt,et){if(typeof nt!="object"||nt===null)return nt;var ht=nt[Symbol.toPrimitive];if(ht!==void 0){var Tt=ht.call(nt,"string");if(typeof Tt!="object")return Tt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(nt)}(O);return typeof K=="symbol"?K:String(K)}(X))in Pt?Object.defineProperty(Pt,X,{value:N,enumerable:!0,configurable:!0,writable:!0}):Pt[X]=N,Pt}class zi{constructor(){let{opts:X,dp:N}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};qe(this,"toggleTimepickerIsActive",K=>{this.dp.timepickerIsActive=K}),qe(this,"onChangeSelectedDate",K=>{let{date:nt,updateTime:et=!1}=K;nt&&(this.setMinMaxTime(nt),this.setCurrentTime(!!et&&nt),this.addTimeToDate(nt))}),qe(this,"onChangeLastSelectedDate",K=>{K&&(this.setTime(K),this.render())}),qe(this,"onChangeInputRange",K=>{let nt=K.target;this[nt.getAttribute("name")]=nt.value,this.updateText(),this.dp.trigger(h.eventChangeTime,{hours:this.hours,minutes:this.minutes})}),qe(this,"onMouseEnterLeave",K=>{let nt=K.target.getAttribute("name"),et=this.$minutesText;nt==="hours"&&(et=this.$hoursText),et.classList.toggle("-focus-")}),qe(this,"onFocus",()=>{this.toggleTimepickerIsActive(!0)}),qe(this,"onBlur",()=>{this.toggleTimepickerIsActive(!1)}),this.opts=X,this.dp=N;let{timeFormat:O}=this.dp.locale;O&&(O.match(ie("h"))||O.match(ie("hh")))&&(this.ampm=!0),this.init()}init(){this.setTime(this.dp.lastSelectedDate||this.dp.viewDate),this.createElement(),this.buildHtml(),this.defineDOM(),this.render(),this.bindDatepickerEvents(),this.bindDOMEvents()}bindDatepickerEvents(){this.dp.on(h.eventChangeSelectedDate,this.onChangeSelectedDate),this.dp.on(h.eventChangeLastSelectedDate,this.onChangeLastSelectedDate)}bindDOMEvents(){let X="input";navigator.userAgent.match(/trident/gi)&&(X="change"),Lt(this.$ranges,X,this.onChangeInputRange),Lt(this.$ranges,"mouseenter",this.onMouseEnterLeave),Lt(this.$ranges,"mouseleave",this.onMouseEnterLeave),Lt(this.$ranges,"focus",this.onFocus),Lt(this.$ranges,"mousedown",this.onFocus),Lt(this.$ranges,"blur",this.onBlur)}createElement(){this.$el=a({className:J("air-datepicker-time",{"-am-pm-":this.dp.ampm})})}destroy(){this.dp.off(h.eventChangeSelectedDate,this.onChangeSelectedDate),this.dp.off(h.eventChangeLastSelectedDate,this.onChangeLastSelectedDate),this.$el.parentNode.removeChild(this.$el)}buildHtml(){let{ampm:X,hours:N,displayHours:O,minutes:K,minHours:nt,minMinutes:et,maxHours:ht,maxMinutes:Tt,dayPeriod:Et,opts:{hoursStep:jt,minutesStep:Ft}}=this;this.$el.innerHTML=`<div class="air-datepicker-time--current">   <span class="air-datepicker-time--current-hours">${F(O)}</span>   <span class="air-datepicker-time--current-colon">:</span>   <span class="air-datepicker-time--current-minutes">${F(K)}</span>   `+(X?`<span class='air-datepicker-time--current-ampm'>${Et}</span>`:"")+`</div><div class="air-datepicker-time--sliders">   <div class="air-datepicker-time--row">      <input type="range" name="hours" value="${N}" min="${nt}" max="${ht}" step="${jt}"/>   </div>   <div class="air-datepicker-time--row">      <input type="range" name="minutes" value="${K}" min="${et}" max="${Tt}" step="${Ft}"/>   </div></div>`}defineDOM(){let X=N=>f(N,this.$el);this.$ranges=this.$el.querySelectorAll('[type="range"]'),this.$hours=X('[name="hours"]'),this.$minutes=X('[name="minutes"]'),this.$hoursText=X(".air-datepicker-time--current-hours"),this.$minutesText=X(".air-datepicker-time--current-minutes"),this.$ampm=X(".air-datepicker-time--current-ampm")}setTime(X){this.setMinMaxTime(X),this.setCurrentTime(X)}addTimeToDate(X){X&&(X.setHours(this.hours),X.setMinutes(this.minutes))}setMinMaxTime(X){if(this.setMinMaxTimeFromOptions(),X){let{minDate:N,maxDate:O}=this.dp;N&&rt(X,N)&&this.setMinTimeFromMinDate(N),O&&rt(X,O)&&this.setMaxTimeFromMaxDate(O)}}setCurrentTime(X){let{hours:N,minutes:O}=X?k(X):this;this.hours=Vt(N,this.minHours,this.maxHours),this.minutes=Vt(O,this.minMinutes,this.maxMinutes)}setMinMaxTimeFromOptions(){let{minHours:X,minMinutes:N,maxHours:O,maxMinutes:K}=this.opts;this.minHours=Vt(X,0,23),this.minMinutes=Vt(N,0,59),this.maxHours=Vt(O,0,23),this.maxMinutes=Vt(K,0,59)}setMinTimeFromMinDate(X){let{lastSelectedDate:N}=this.dp;this.minHours=X.getHours(),N&&N.getHours()>X.getHours()?this.minMinutes=this.opts.minMinutes:this.minMinutes=X.getMinutes()}setMaxTimeFromMaxDate(X){let{lastSelectedDate:N}=this.dp;this.maxHours=X.getHours(),N&&N.getHours()<X.getHours()?this.maxMinutes=this.opts.maxMinutes:this.maxMinutes=X.getMinutes()}updateSliders(){w(this.$hours,{min:this.minHours,max:this.maxHours}).value=this.hours,w(this.$minutes,{min:this.minMinutes,max:this.maxMinutes}).value=this.minutes}updateText(){this.$hoursText.innerHTML=F(this.displayHours),this.$minutesText.innerHTML=F(this.minutes),this.ampm&&(this.$ampm.innerHTML=this.dayPeriod)}set hours(X){this._hours=X;let{hours:N,dayPeriod:O}=E(X);this.displayHours=this.ampm?N:X,this.dayPeriod=O}get hours(){return this._hours}render(){this.updateSliders(),this.updateText()}}function mi(Pt,X,N){return(X=function(O){var K=function(nt,et){if(typeof nt!="object"||nt===null)return nt;var ht=nt[Symbol.toPrimitive];if(ht!==void 0){var Tt=ht.call(nt,"string");if(typeof Tt!="object")return Tt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(nt)}(O);return typeof K=="symbol"?K:String(K)}(X))in Pt?Object.defineProperty(Pt,X,{value:N,enumerable:!0,configurable:!0,writable:!0}):Pt[X]=N,Pt}class ci{constructor(X){let{dp:N,opts:O}=X;mi(this,"pressedKeys",new Set),mi(this,"hotKeys",new Map([[[["Control","ArrowRight"],["Control","ArrowUp"]],K=>K.month++],[[["Control","ArrowLeft"],["Control","ArrowDown"]],K=>K.month--],[[["Shift","ArrowRight"],["Shift","ArrowUp"]],K=>K.year++],[[["Shift","ArrowLeft"],["Shift","ArrowDown"]],K=>K.year--],[[["Alt","ArrowRight"],["Alt","ArrowUp"]],K=>K.year+=10],[[["Alt","ArrowLeft"],["Alt","ArrowDown"]],K=>K.year-=10],[["Control","Shift","ArrowUp"],(K,nt)=>nt.up()]])),mi(this,"handleHotKey",K=>{let nt=this.hotKeys.get(K),et=k(this.getInitialFocusDate());nt(et,this.dp);let{year:ht,month:Tt,date:Et}=et,jt=P(new Date(ht,Tt));jt<Et&&(Et=jt);let Ft=this.dp.getClampedDate(new Date(ht,Tt,Et));this.dp.setFocusDate(Ft,{viewDateTransition:!0})}),mi(this,"isHotKeyPressed",()=>{let K=!1,nt=this.pressedKeys.size,et=ht=>this.pressedKeys.has(ht);for(let[ht]of this.hotKeys){if(K)break;if(Array.isArray(ht[0]))ht.forEach(Tt=>{K||nt!==Tt.length||(K=Tt.every(et)&&ht)});else{if(nt!==ht.length)continue;K=ht.every(et)&&ht}}return K}),mi(this,"isArrow",K=>K>=37&&K<=40),mi(this,"onKeyDown",K=>{let{key:nt,which:et}=K,{dp:ht,dp:{focusDate:Tt},opts:Et}=this;this.registerKey(nt);let jt=this.isHotKeyPressed();if(jt)return K.preventDefault(),void this.handleHotKey(jt);if(this.isArrow(et))return K.preventDefault(),void this.focusNextCell(nt);if(nt==="Enter"){if(ht.currentView!==Et.minView)return void ht.down();if(Tt){let Ft=ht._checkIfDateIsSelected(Tt);return void(Ft?ht._handleAlreadySelectedDates(Ft,Tt):ht.selectDate(Tt))}}nt==="Escape"&&this.dp.hide()}),mi(this,"onKeyUp",K=>{this.removeKey(K.key)}),this.dp=N,this.opts=O,this.init()}init(){this.bindKeyboardEvents()}bindKeyboardEvents(){let{$el:X}=this.dp;X.addEventListener("keydown",this.onKeyDown),X.addEventListener("keyup",this.onKeyUp)}destroy(){let{$el:X}=this.dp;X.removeEventListener("keydown",this.onKeyDown),X.removeEventListener("keyup",this.onKeyUp),this.hotKeys=null,this.pressedKeys=null}getInitialFocusDate(){let{focusDate:X,currentView:N,selectedDates:O,parsedViewDate:{year:K,month:nt}}=this.dp,et=X||O[O.length-1];if(!et)switch(N){case h.days:et=new Date(K,nt,new Date().getDate());break;case h.months:et=new Date(K,nt,1);break;case h.years:et=new Date(K,0,1)}return et}focusNextCell(X){let N=this.getInitialFocusDate(),{currentView:O}=this.dp,{days:K,months:nt,years:et}=h,ht=k(N),Tt=ht.year,Et=ht.month,jt=ht.date;switch(X){case"ArrowLeft":O===K&&(jt-=1),O===nt&&(Et-=1),O===et&&(Tt-=1);break;case"ArrowUp":O===K&&(jt-=7),O===nt&&(Et-=3),O===et&&(Tt-=4);break;case"ArrowRight":O===K&&(jt+=1),O===nt&&(Et+=1),O===et&&(Tt+=1);break;case"ArrowDown":O===K&&(jt+=7),O===nt&&(Et+=3),O===et&&(Tt+=4)}let Ft=this.dp.getClampedDate(new Date(Tt,Et,jt));this.dp.setFocusDate(Ft,{viewDateTransition:!0})}registerKey(X){this.pressedKeys.add(X)}removeKey(X){this.pressedKeys.delete(X)}}let Ii={on(Pt,X){this.__events||(this.__events={}),this.__events[Pt]?this.__events[Pt].push(X):this.__events[Pt]=[X]},off(Pt,X){this.__events&&this.__events[Pt]&&(this.__events[Pt]=this.__events[Pt].filter(N=>N!==X))},removeAllEvents(){this.__events={}},trigger(Pt){for(var X=arguments.length,N=new Array(X>1?X-1:0),O=1;O<X;O++)N[O-1]=arguments[O];this.__events&&this.__events[Pt]&&this.__events[Pt].forEach(K=>{K(...N)})}};function Ce(Pt,X,N){return(X=function(O){var K=function(nt,et){if(typeof nt!="object"||nt===null)return nt;var ht=nt[Symbol.toPrimitive];if(ht!==void 0){var Tt=ht.call(nt,"string");if(typeof Tt!="object")return Tt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(nt)}(O);return typeof K=="symbol"?K:String(K)}(X))in Pt?Object.defineProperty(Pt,X,{value:N,enumerable:!0,configurable:!0,writable:!0}):Pt[X]=N,Pt}let ai="",ii="",Jt=!1;class me{static buildGlobalContainer(X){Jt=!0,ai=a({className:X,id:X}),f("body").appendChild(ai)}constructor(X,N){var O=this;if(Ce(this,"viewIndexes",[h.days,h.months,h.years]),Ce(this,"next",()=>{let{year:et,month:ht}=this.parsedViewDate;switch(this.currentView){case h.days:this.setViewDate(new Date(et,ht+1,1));break;case h.months:this.setViewDate(new Date(et+1,ht,1));break;case h.years:this.setViewDate(new Date(et+10,0,1))}}),Ce(this,"prev",()=>{let{year:et,month:ht}=this.parsedViewDate;switch(this.currentView){case h.days:this.setViewDate(new Date(et,ht-1,1));break;case h.months:this.setViewDate(new Date(et-1,ht,1));break;case h.years:this.setViewDate(new Date(et-10,0,1))}}),Ce(this,"_finishHide",()=>{this.hideAnimation=!1,this._destroyComponents(),this.$container.removeChild(this.$datepicker)}),Ce(this,"setPosition",function(et){let ht=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(typeof(et=et||O.opts.position)=="function")return void(O.customHide=et({$datepicker:O.$datepicker,$target:O.$el,$pointer:O.$pointer,isViewChange:ht,done:O._finishHide}));let Tt,Et,{isMobile:jt}=O.opts,Ft=O.$el.getBoundingClientRect(),se=O.$el.getBoundingClientRect(),re=O.$datepicker.offsetParent,ve=O.$el.offsetParent,Te=O.$datepicker.getBoundingClientRect(),Ne=et.split(" "),Je=window.scrollY,$e=window.scrollX,_i=O.opts.offset,fi=Ne[0],ns=Ne[1];if(jt)O.$datepicker.style.cssText="left: 50%; top: 50%";else{if(re===ve&&re!==document.body&&(se={top:O.$el.offsetTop,left:O.$el.offsetLeft,width:Ft.width,height:O.$el.offsetHeight},Je=0,$e=0),re!==ve&&re!==document.body){let Qi=re.getBoundingClientRect();se={top:Ft.top-Qi.top,left:Ft.left-Qi.left,width:Ft.width,height:Ft.height},Je=0,$e=0}switch(fi){case"top":Tt=se.top-Te.height-_i;break;case"right":Et=se.left+se.width+_i;break;case"bottom":Tt=se.top+se.height+_i;break;case"left":Et=se.left-Te.width-_i}switch(ns){case"top":Tt=se.top;break;case"right":Et=se.left+se.width-Te.width;break;case"bottom":Tt=se.top+se.height-Te.height;break;case"left":Et=se.left;break;case"center":/left|right/.test(fi)?Tt=se.top+se.height/2-Te.height/2:Et=se.left+se.width/2-Te.width/2}O.$datepicker.style.cssText=`left: ${Et+$e}px; top: ${Tt+Je}px`}}),Ce(this,"_setInputValue",()=>{let{opts:et,$altField:ht,locale:{dateFormat:Tt}}=this,{altFieldDateFormat:Et,altField:jt}=et;jt&&ht&&(ht.value=this._getInputValue(Et)),this.$el.value=this._getInputValue(Tt)}),Ce(this,"_getInputValue",et=>{let{selectedDates:ht,opts:Tt}=this,{multipleDates:Et,multipleDatesSeparator:jt}=Tt;if(!ht.length)return"";let Ft=typeof et=="function",se=Ft?et(Et?ht:ht[0]):ht.map(re=>this.formatDate(re,et));return se=Ft?se:se.join(jt),se}),Ce(this,"_checkIfDateIsSelected",function(et){let ht=arguments.length>1&&arguments[1]!==void 0?arguments[1]:h.days,Tt=!1;return O.selectedDates.some(Et=>{let jt=rt(et,Et,ht);return Tt=jt&&Et,jt}),Tt}),Ce(this,"_scheduleCallAfterTransition",et=>{this._cancelScheduledCall(),et&&et(!1),this._onTransitionEnd=()=>{et&&et(!0)},this.$datepicker.addEventListener("transitionend",this._onTransitionEnd,{once:!0})}),Ce(this,"_cancelScheduledCall",()=>{this.$datepicker.removeEventListener("transitionend",this._onTransitionEnd)}),Ce(this,"setViewDate",et=>{if(!((et=Gt(et))instanceof Date)||rt(et,this.viewDate))return;let ht=this.viewDate;this.viewDate=et;let{onChangeViewDate:Tt}=this.opts;if(Tt){let{month:Et,year:jt}=this.parsedViewDate;Tt({month:Et,year:jt,decade:this.curDecade})}this.trigger(h.eventChangeViewDate,et,ht)}),Ce(this,"setFocusDate",function(et){let ht=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(!et||(et=Gt(et))instanceof Date)&&(O.focusDate=et,O.trigger(h.eventChangeFocusDate,et,ht))}),Ce(this,"setCurrentView",function(et){let ht=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(O.viewIndexes.includes(et)){if(O.currentView=et,O.elIsInput&&O.visible&&O.setPosition(void 0,!0),O.trigger(h.eventChangeCurrentView,et),!O.views[et]){let Tt=O.views[et]=new He({dp:O,opts:O.opts,type:et});O.shouldUpdateDOM&&O.$content.appendChild(Tt.$el)}O.opts.onChangeView&&!ht.silent&&O.opts.onChangeView(et)}}),Ce(this,"_updateLastSelectedDate",et=>{this.lastSelectedDate=et,this.trigger(h.eventChangeLastSelectedDate,et)}),Ce(this,"destroy",()=>{if(this.isDestroyed)return;let{showEvent:et,isMobile:ht}=this.opts,Tt=this.$datepicker.parentNode;Tt&&Tt.removeChild(this.$datepicker),this.$el.removeEventListener(et,this._onFocus),this.$el.removeEventListener("blur",this._onBlur),window.removeEventListener("resize",this._onResize),ht&&this._removeMobileAttributes(),this.keyboardNav&&this.keyboardNav.destroy(),this.views=null,this.nav=null,this.$datepicker=null,this.opts={},this.$customContainer=null,this.viewDate=null,this.focusDate=null,this.selectedDates=[],this.rangeDateFrom=null,this.rangeDateTo=null,this.isDestroyed=!0}),Ce(this,"update",function(){let et=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ht=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Tt=Yt({},O.opts),{silent:Et}=ht;Yt(O.opts,et);let{timepicker:jt,buttons:Ft,range:se,selectedDates:re,isMobile:ve}=O.opts,Te=O.visible||O.treatAsInline;O._createMinMaxDates(),O._limitViewDateByMaxMinDates(),O._handleLocale(),re&&(O.selectedDates=[],O.selectDate(re,{silent:Et})),et.view&&O.setCurrentView(et.view,{silent:Et}),O._setInputValue(),Tt.range&&!se?(O.rangeDateTo=!1,O.rangeDateFrom=!1):!Tt.range&&se&&O.selectedDates.length&&(O.rangeDateFrom=O.selectedDates[0],O.rangeDateTo=O.selectedDates[1]),Tt.timepicker&&!jt?(Te&&O.timepicker.destroy(),O.timepicker=!1,O.$timepicker.parentNode.removeChild(O.$timepicker)):!Tt.timepicker&&jt&&O._addTimepicker(),!Tt.buttons&&Ft?O._addButtons():Tt.buttons&&!Ft?(O.buttons.destroy(),O.$buttons.parentNode.removeChild(O.$buttons)):Te&&Tt.buttons&&Ft&&O.buttons.clearHtml().render(),!Tt.isMobile&&ve?(O.treatAsInline||ii||O._createMobileOverlay(),O._addMobileAttributes(),O.visible&&O._showMobileOverlay()):Tt.isMobile&&!ve&&(O._removeMobileAttributes(),O.visible&&(ii.classList.remove("-active-"),typeof O.opts.position!="function"&&O.setPosition())),Te&&(O.nav.update(),O.views[O.currentView].render(),O.currentView===h.days&&O.views[O.currentView].renderDayNames())}),Ce(this,"disableDate",(et,ht)=>{(Array.isArray(et)?et:[et]).forEach(Tt=>{let Et=Gt(Tt);if(!Et)return;let jt=ht?"delete":"add";this.disabledDates[jt](this.formatDate(Et,"yyyy-MM-dd"));let Ft=this.getCell(Et,this.currentViewSingular);Ft&&Ft.adpCell.render()},[])}),Ce(this,"enableDate",et=>{this.disableDate(et,!0)}),Ce(this,"isDateDisabled",et=>{let ht=Gt(et);return this.disabledDates.has(this.formatDate(ht,"yyyy-MM-dd"))}),Ce(this,"isOtherMonth",et=>{let{month:ht}=k(et);return ht!==this.parsedViewDate.month}),Ce(this,"isOtherYear",et=>{let{year:ht}=k(et);return ht!==this.parsedViewDate.year}),Ce(this,"isOtherDecade",et=>{let{year:ht}=k(et),[Tt,Et]=R(this.viewDate);return ht<Tt||ht>Et}),Ce(this,"_onChangeSelectedDate",et=>{let{silent:ht}=et;setTimeout(()=>{this._setInputValue(),this.opts.onSelect&&!ht&&this._triggerOnSelect()})}),Ce(this,"_onChangeFocusedDate",function(et){let{viewDateTransition:ht}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!et)return;let Tt=!1;ht&&(Tt=O.isOtherMonth(et)||O.isOtherYear(et)||O.isOtherDecade(et)),Tt&&O.setViewDate(et),O.opts.onFocus&&O.opts.onFocus({datepicker:O,date:et})}),Ce(this,"_onChangeTime",et=>{let{hours:ht,minutes:Tt}=et,Et=new Date,{lastSelectedDate:jt,opts:{onSelect:Ft}}=this,se=jt;jt||(se=Et);let re=this.getCell(se,this.currentViewSingular),ve=re&&re.adpCell;ve&&ve.isDisabled||(se.setHours(ht),se.setMinutes(Tt),jt?(this._setInputValue(),Ft&&this._triggerOnSelect()):this.selectDate(se))}),Ce(this,"_onFocus",et=>{this.visible||this.show()}),Ce(this,"_onBlur",et=>{this.inFocus||!this.visible||this.opts.isMobile||this.hide()}),Ce(this,"_onMouseDown",et=>{this.inFocus=!0}),Ce(this,"_onMouseUp",et=>{this.inFocus=!1,this.$el.focus()}),Ce(this,"_onResize",()=>{this.visible&&typeof this.opts.position!="function"&&this.setPosition()}),Ce(this,"_onClickOverlay",()=>{this.visible&&this.hide()}),Ce(this,"getViewDates",function(){let et=arguments.length>0&&arguments[0]!==void 0?arguments[0]:h.days;return He.getDatesFunction(et)(O)}),Ce(this,"isWeekend",et=>this.opts.weekends.includes(et)),Ce(this,"getClampedDate",et=>{let{minDate:ht,maxDate:Tt}=this,Et=et;return Tt&&mt(et,Tt)?Et=Tt:ht&&xt(et,ht)&&(Et=ht),Et}),this.$el=f(X),!this.$el)return;this.$datepicker=a({className:"air-datepicker"}),this.opts=Yt({},p,N),this.$customContainer=!!this.opts.container&&f(this.opts.container),this.$altField=f(this.opts.altField||!1);let{view:K,startDate:nt}=this.opts;nt||(this.opts.startDate=new Date),this.$el.nodeName==="INPUT"&&(this.elIsInput=!0),this.inited=!1,this.visible=!1,this.viewDate=Gt(this.opts.startDate),this.focusDate=!1,this.initialReadonly=this.$el.getAttribute("readonly"),this.customHide=!1,this.currentView=K,this.selectedDates=[],this.disabledDates=new Set,this.isDestroyed=!1,this.views={},this.keys=[],this.rangeDateFrom="",this.rangeDateTo="",this.timepickerIsActive=!1,this.treatAsInline=this.opts.inline||!this.elIsInput,this.init()}init(){let{opts:X,treatAsInline:N,opts:{inline:O,isMobile:K,selectedDates:nt,keyboardNav:et,onlyTimepicker:ht}}=this,Tt=f("body");(!Jt||Jt&&ai&&!Tt.contains(ai))&&!O&&this.elIsInput&&!this.$customContainer&&me.buildGlobalContainer(me.defaultGlobalContainerId),!K||ii||N||this._createMobileOverlay(),this._handleLocale(),this._bindSubEvents(),this._createMinMaxDates(),this._limitViewDateByMaxMinDates(),this.elIsInput&&(O||this._bindEvents(),et&&!ht&&(this.keyboardNav=new ci({dp:this,opts:X}))),nt&&this.selectDate(nt,{silent:!0}),this.opts.visible&&!N&&this.show(),K&&!N&&this.$el.setAttribute("readonly",!0),N&&this._createComponents()}_createMobileOverlay(){ii=a({className:"air-datepicker-overlay"}),ai.appendChild(ii)}_createComponents(){let{opts:X,treatAsInline:N,opts:{inline:O,buttons:K,timepicker:nt,position:et,classes:ht,onlyTimepicker:Tt,isMobile:Et}}=this;this._buildBaseHtml(),this.elIsInput&&(O||this._setPositionClasses(et)),!O&&this.elIsInput||this.$datepicker.classList.add("-inline-"),ht&&this.$datepicker.classList.add(...ht.split(" ")),Tt&&this.$datepicker.classList.add("-only-timepicker-"),Et&&!N&&this._addMobileAttributes(),this.views[this.currentView]=new He({dp:this,type:this.currentView,opts:X}),this.nav=new xe({dp:this,opts:X}),nt&&this._addTimepicker(),K&&this._addButtons(),this.$content.appendChild(this.views[this.currentView].$el),this.$nav.appendChild(this.nav.$el)}_destroyComponents(){for(let X in this.views)this.views[X].destroy();this.views={},this.nav.destroy(),this.timepicker&&this.timepicker.destroy()}_addMobileAttributes(){ii.addEventListener("click",this._onClickOverlay),this.$datepicker.classList.add("-is-mobile-"),this.$el.setAttribute("readonly",!0)}_removeMobileAttributes(){ii.removeEventListener("click",this._onClickOverlay),this.$datepicker.classList.remove("-is-mobile-"),this.initialReadonly||this.initialReadonly===""||this.$el.removeAttribute("readonly")}_createMinMaxDates(){let{minDate:X,maxDate:N}=this.opts;this.minDate=!!X&&Gt(X),this.maxDate=!!N&&Gt(N)}_addTimepicker(){this.$timepicker=a({className:"air-datepicker--time"}),this.$datepicker.appendChild(this.$timepicker),this.timepicker=new zi({dp:this,opts:this.opts}),this.$timepicker.appendChild(this.timepicker.$el)}_addButtons(){this.$buttons=a({className:"air-datepicker--buttons"}),this.$datepicker.appendChild(this.$buttons),this.buttons=new Oe({dp:this,opts:this.opts}),this.$buttons.appendChild(this.buttons.$el)}_bindSubEvents(){this.on(h.eventChangeSelectedDate,this._onChangeSelectedDate),this.on(h.eventChangeFocusDate,this._onChangeFocusedDate),this.on(h.eventChangeTime,this._onChangeTime)}_buildBaseHtml(){let{inline:X}=this.opts;var N,O;this.elIsInput?X?(N=this.$datepicker,(O=this.$el).parentNode.insertBefore(N,O.nextSibling)):this.$container.appendChild(this.$datepicker):this.$el.appendChild(this.$datepicker),this.$datepicker.innerHTML='<i class="air-datepicker--pointer"></i><div class="air-datepicker--navigation"></div><div class="air-datepicker--content"></div>',this.$content=f(".air-datepicker--content",this.$datepicker),this.$pointer=f(".air-datepicker--pointer",this.$datepicker),this.$nav=f(".air-datepicker--navigation",this.$datepicker)}_handleLocale(){let{locale:X,dateFormat:N,firstDay:O,timepicker:K,onlyTimepicker:nt,timeFormat:et,dateTimeSeparator:ht}=this.opts;var Tt;this.locale=(Tt=X,JSON.parse(JSON.stringify(Tt))),N&&(this.locale.dateFormat=N),et!==void 0&&et!==""&&(this.locale.timeFormat=et);let{timeFormat:Et}=this.locale;if(O!==""&&(this.locale.firstDay=O),K&&typeof N!="function"){let jt=Et?ht:"";this.locale.dateFormat=[this.locale.dateFormat,Et||""].join(jt)}nt&&typeof N!="function"&&(this.locale.dateFormat=this.locale.timeFormat)}_setPositionClasses(X){if(typeof X=="function")return void this.$datepicker.classList.add("-custom-position-");let N=(X=X.split(" "))[0],O=`air-datepicker -${N}-${X[1]}- -from-${N}-`;this.$datepicker.classList.add(...O.split(" "))}_bindEvents(){this.$el.addEventListener(this.opts.showEvent,this._onFocus),this.$el.addEventListener("blur",this._onBlur),this.$datepicker.addEventListener("mousedown",this._onMouseDown),this.$datepicker.addEventListener("mouseup",this._onMouseUp),window.addEventListener("resize",this._onResize)}_limitViewDateByMaxMinDates(){let{viewDate:X,minDate:N,maxDate:O}=this;O&&mt(X,O)&&this.setViewDate(O),N&&xt(X,N)&&this.setViewDate(N)}formatDate(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.viewDate,N=arguments.length>1?arguments[1]:void 0;if(X=Gt(X),!(X instanceof Date))return;let O=N,K=this.locale,nt=k(X),et=nt.dayPeriod,ht=R(X),Tt=me.replacer,Et={T:X.getTime(),m:nt.minutes,mm:nt.fullMinutes,h:nt.hours12,hh:nt.fullHours12,H:nt.hours,HH:nt.fullHours,aa:et,AA:et.toUpperCase(),E:K.daysShort[nt.day],EEEE:K.days[nt.day],d:nt.date,dd:nt.fullDate,M:nt.month+1,MM:nt.fullMonth,MMM:K.monthsShort[nt.month],MMMM:K.months[nt.month],yy:nt.year.toString().slice(-2),yyyy:nt.year,yyyy1:ht[0],yyyy2:ht[1]};for(let[jt,Ft]of Object.entries(Et))O=Tt(O,ie(jt),Ft);return O}down(X){this._handleUpDownActions(X,"down")}up(X){this._handleUpDownActions(X,"up")}selectDate(X){let N,O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{currentView:K,parsedViewDate:nt,selectedDates:et}=this,{updateTime:ht}=O,{moveToOtherMonthsOnSelect:Tt,moveToOtherYearsOnSelect:Et,multipleDates:jt,range:Ft,autoClose:se,onBeforeSelect:re}=this.opts,ve=et.length;if(Array.isArray(X))return X.forEach(Te=>{this.selectDate(Te,O)}),new Promise(Te=>{setTimeout(Te)});if((X=Gt(X))instanceof Date){if(re&&!re({date:X,datepicker:this}))return Promise.resolve();if(K===h.days&&X.getMonth()!==nt.month&&Tt&&(N=new Date(X.getFullYear(),X.getMonth(),1)),K===h.years&&X.getFullYear()!==nt.year&&Et&&(N=new Date(X.getFullYear(),0,1)),N&&this.setViewDate(N),jt&&!Ft){if(ve===jt)return;this._checkIfDateIsSelected(X)||et.push(X)}else if(Ft)switch(ve){case 1:et.push(X),this.rangeDateTo||(this.rangeDateTo=X),mt(this.rangeDateFrom,this.rangeDateTo)&&(this.rangeDateTo=this.rangeDateFrom,this.rangeDateFrom=X),this.selectedDates=[this.rangeDateFrom,this.rangeDateTo];break;case 2:this.selectedDates=[X],this.rangeDateFrom=X,this.rangeDateTo="";break;default:this.selectedDates=[X],this.rangeDateFrom=X}else this.selectedDates=[X];return this.trigger(h.eventChangeSelectedDate,{action:h.actionSelectDate,silent:O==null?void 0:O.silent,date:X,updateTime:ht}),this._updateLastSelectedDate(X),se&&!this.timepickerIsActive&&this.visible&&(jt||Ft?Ft&&ve===1&&this.hide():this.hide()),new Promise(Te=>{setTimeout(Te)})}}unselectDate(X){let N=this.selectedDates,O=this;if((X=Gt(X))instanceof Date)return N.some((K,nt)=>{if(rt(K,X))return N.splice(nt,1),O.selectedDates.length?(O.rangeDateTo="",O.rangeDateFrom=N[0],O._updateLastSelectedDate(O.selectedDates[O.selectedDates.length-1])):(O.rangeDateFrom="",O.rangeDateTo="",O._updateLastSelectedDate(!1)),this.trigger(h.eventChangeSelectedDate,{action:h.actionUnselectDate,date:X}),!0})}replaceDate(X,N){let O=this.selectedDates.find(nt=>rt(nt,X,this.currentView)),K=this.selectedDates.indexOf(O);K<0||rt(this.selectedDates[K],N,this.currentView)||(this.selectedDates[K]=N,this.trigger(h.eventChangeSelectedDate,{action:h.actionSelectDate,date:N,updateTime:!0}),this._updateLastSelectedDate(N))}clear(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.selectedDates=[],this.rangeDateFrom=!1,this.rangeDateTo=!1,this.lastSelectedDate=!1,this.trigger(h.eventChangeSelectedDate,{action:h.actionUnselectDate,silent:X.silent}),new Promise(N=>{setTimeout(N)})}show(){let{onShow:X,isMobile:N}=this.opts;this._cancelScheduledCall(),this.visible||this.hideAnimation||this._createComponents(),this.setPosition(this.opts.position),this.$datepicker.classList.add("-active-"),this.visible=!0,X&&this._scheduleCallAfterTransition(X),N&&this._showMobileOverlay()}hide(){let{onHide:X,isMobile:N}=this.opts,O=this._hasTransition();this.visible=!1,this.hideAnimation=!0,this.$datepicker.classList.remove("-active-"),this.customHide&&this.customHide(),this.elIsInput&&this.$el.blur(),this._scheduleCallAfterTransition(K=>{!this.customHide&&(K&&O||!K&&!O)&&this._finishHide(),X&&X(K)}),N&&ii.classList.remove("-active-")}_triggerOnSelect(){let X=[],N=[],{selectedDates:O,locale:K,opts:{onSelect:nt,multipleDates:et,range:ht}}=this,Tt=et||ht,Et=typeof K.dateFormat=="function";O.length&&(X=O.map(Ct),N=Et?et?K.dateFormat(X):X.map(jt=>K.dateFormat(jt)):X.map(jt=>this.formatDate(jt,K.dateFormat))),nt({date:Tt?X:X[0],formattedDate:Tt?N:N[0],datepicker:this})}_handleAlreadySelectedDates(X,N){let{selectedDates:O,rangeDateFrom:K,rangeDateTo:nt}=this,{range:et,toggleSelected:ht}=this.opts,Tt=O.length,Et=typeof ht=="function"?ht({datepicker:this,date:N}):ht,jt=!!(et&&Tt===1&&X),Ft=jt?Ct(N):N;et&&!Et&&(Tt!==2&&this.selectDate(Ft),Tt===2&&rt(K,nt))||(Et?this.unselectDate(Ft):this._updateLastSelectedDate(jt?Ft:X))}_handleUpDownActions(X,N){if(!((X=Gt(X||this.focusDate||this.viewDate))instanceof Date))return;let O=N==="up"?this.viewIndex+1:this.viewIndex-1;O>2&&(O=2),O<0&&(O=0),this.setViewDate(new Date(X.getFullYear(),X.getMonth(),1)),this.setCurrentView(this.viewIndexes[O])}getCell(X){let N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:h.day;if(!((X=Gt(X))instanceof Date))return;let{year:O,month:K,date:nt}=k(X),et=`[data-year="${O}"]`,ht=`[data-month="${K}"]`,Tt={[h.day]:`${et}${ht}[data-date="${nt}"]`,[h.month]:`${et}${ht}`,[h.year]:`${et}`};return this.views[this.currentView]?this.views[this.currentView].$el.querySelector(Tt[N]):void 0}_showMobileOverlay(){ii.classList.add("-active-")}_hasTransition(){return window.getComputedStyle(this.$datepicker).getPropertyValue("transition-duration").split(", ").reduce((X,N)=>parseFloat(N)+X,0)>0}get shouldUpdateDOM(){return this.visible||this.treatAsInline}get parsedViewDate(){return k(this.viewDate)}get currentViewSingular(){return this.currentView.slice(0,-1)}get curDecade(){return R(this.viewDate)}get viewIndex(){return this.viewIndexes.indexOf(this.currentView)}get isFinalView(){return this.currentView===h.years}get hasSelectedDates(){return this.selectedDates.length>0}get isMinViewReached(){return this.currentView===this.opts.minView||this.currentView===h.days}get $container(){return this.$customContainer||ai}static replacer(X,N,O){return X.replace(N,function(K,nt,et,ht){return nt+O+ht})}}var ue;return Ce(me,"defaults",p),Ce(me,"version","3.5.3"),Ce(me,"defaultGlobalContainerId","air-datepicker-global-container"),ue=me.prototype,Object.assign(ue,Ii),c.default}()})}(kf)),kf.exports}var hC=cC();const uC=Kg(hC);var Vh={},Zx;function dC(){if(Zx)return Vh;Zx=1,Object.defineProperty(Vh,"__esModule",{value:!0}),Vh.default=void 0;var s={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",dateFormat:"MM/dd/yyyy",timeFormat:"hh:mm aa",firstDay:0};return Vh.default=s,Vh}var fC=dC();const pC=Kg(fC);function Gx(s){const e={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"};return new Date(s).toLocaleDateString("fr-FR",e).replace(/./,c=>c.toUpperCase()).replace(/,? /,", ")}const mC={data(){return{buttonTimerange:!1,timeRangePicked:"",timeRange:{start:null,stop:null}}},computed:{readableStartDate(){return Gx(this.timeRange.start)},readableStopDate(){return Gx(this.timeRange.stop)}},methods:{helloTimeRange(){this.$emit("updateTimeRange",this.timeRange)},dateToLocalISO(s){return new Date(s.getTime()-s.getTimezoneOffset()*60*1e3).toISOString()}},watch:{timeRangePicked(s){if(s==="range")this.$nextTick(()=>{new uC("#cal",{range:!0,position:"top center",timepicker:!0,locale:pC,maxDate:new Date,minDate:new Date("2025-02-14"),timeFormat:"HH:mm",onSelect:({date:e})=>{var n;this.timeRange.start=(n=e[0])==null?void 0:n.toISOString(),this.timeRange.stop=e[1]?e[1].toISOString():"now",this.helloTimeRange()}})});else{const h=new Date;this.timeRange.stop="now",s==="hour"&&(this.timeRange.start=new Date(h.getTime()-2*36e5)),s==="day"&&(this.timeRange.start=new Date(h.getTime()-864e5)),s==="week"&&(this.timeRange.start=new Date(h.getTime()-6048e5)),this.timeRange.start=this.dateToLocalISO(this.timeRange.start),this.helloTimeRange()}}}},gC={class:"container mt-3"},_C={class:"d-flex flex-column ms-2"},yC={class:"form-check"},xC={class:"form-check"},bC={class:"form-check"},vC={class:"form-check mb-3"},wC={key:0},SC={key:1,class:"alert alert-primary mb-5 d-flex flex-column",role:"alert"};function TC(s,e,n,c,h,p){return hi(),Yi("div",gC,[e[11]||(e[11]=fe("h2",null,"History",-1)),fe("div",_C,[fe("div",yC,[qh(fe("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":e[0]||(e[0]=f=>h.timeRangePicked=f),id:"hour",value:"hour"},null,512),[[rf,h.timeRangePicked]]),e[4]||(e[4]=fe("label",{class:"form-check-label",for:"hour"}," Last Hour ",-1))]),fe("div",xC,[qh(fe("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":e[1]||(e[1]=f=>h.timeRangePicked=f),id:"day",value:"day"},null,512),[[rf,h.timeRangePicked]]),e[5]||(e[5]=fe("label",{class:"form-check-label",for:"day"}," Last Day ",-1))]),fe("div",bC,[qh(fe("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":e[2]||(e[2]=f=>h.timeRangePicked=f),id:"week",value:"week"},null,512),[[rf,h.timeRangePicked]]),e[6]||(e[6]=fe("label",{class:"form-check-label",for:"week"}," Last week ",-1))]),fe("div",vC,[qh(fe("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":e[3]||(e[3]=f=>h.timeRangePicked=f),name:"exampleRadios",id:"range",value:"range"},null,512),[[rf,h.timeRangePicked]]),e[7]||(e[7]=fe("label",{class:"form-check-label",for:"range"}," Choose timerange ",-1))])]),h.timeRangePicked==="range"?(hi(),Yi("div",wC,e[8]||(e[8]=[fe("span",{class:"badge text-bg-primary my-2"},"Date selection",-1),fe("div",{class:"input-group input-group-sm mb-5"},[fe("input",{type:"text",class:"form-control",id:"cal"})],-1)]))):Vo("",!0),h.timeRangePicked.length!==0?(hi(),Yi("div",SC,[e[9]||(e[9]=fe("span",{class:"badge rounded-pill text-bg-secondary mb-2"},"Start date",-1)),fe("span",null,Nn(p.readableStartDate),1),e[10]||(e[10]=fe("span",{class:"badge rounded-pill text-bg-secondary my-2"},"Stop date",-1)),fe("span",null,Nn(h.timeRange.stop==="now"?"Maintenant":p.readableStopDate),1)])):Vo("",!0)])}const MC=xn(mC,[["render",TC]]),PC={},CC={class:"pl",viewBox:"0 0 160 160",width:"160px",height:"160px",xmlns:"http://www.w3.org/2000/svg"};function kC(s,e){return hi(),Yi("svg",CC,e[0]||(e[0]=[lT('<defs data-v-dfcbb9c9><linearGradient id="grad" x1="0" y1="0" x2="0" y2="1" data-v-dfcbb9c9><stop offset="0%" stop-color="#000" data-v-dfcbb9c9></stop><stop offset="100%" stop-color="#fff" data-v-dfcbb9c9></stop></linearGradient><mask id="mask1" data-v-dfcbb9c9><rect x="0" y="0" width="160" height="160" fill="url(#grad)" data-v-dfcbb9c9></rect></mask><mask id="mask2" data-v-dfcbb9c9><rect x="28" y="28" width="104" height="104" fill="url(#grad)" data-v-dfcbb9c9></rect></mask></defs><g data-v-dfcbb9c9><g class="pl__ring-rotate" data-v-dfcbb9c9><circle class="pl__ring-stroke" cx="80" cy="80" r="72" fill="none" stroke="hsl(223,90%,55%)" stroke-width="16" stroke-dasharray="452.39 452.39" stroke-dashoffset="452" stroke-linecap="round" transform="rotate(-45,80,80)" data-v-dfcbb9c9></circle></g></g><g mask="url(#mask1)" data-v-dfcbb9c9><g class="pl__ring-rotate" data-v-dfcbb9c9><circle class="pl__ring-stroke" cx="80" cy="80" r="72" fill="none" stroke="hsl(193,90%,55%)" stroke-width="16" stroke-dasharray="452.39 452.39" stroke-dashoffset="452" stroke-linecap="round" transform="rotate(-45,80,80)" data-v-dfcbb9c9></circle></g></g><g data-v-dfcbb9c9><g stroke-width="4" stroke-dasharray="12 12" stroke-dashoffset="12" stroke-linecap="round" transform="translate(80,80)" data-v-dfcbb9c9><polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(-135,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(-90,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(-45,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(0,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(45,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(90,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(135,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,10%,90%)" points="0,2 0,14" transform="rotate(180,0,0) translate(0,40)" data-v-dfcbb9c9></polyline></g></g><g mask="url(#mask1)" data-v-dfcbb9c9><g stroke-width="4" stroke-dasharray="12 12" stroke-dashoffset="12" stroke-linecap="round" transform="translate(80,80)" data-v-dfcbb9c9><polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(-135,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(-90,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(-45,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(0,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(45,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(90,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(135,0,0) translate(0,40)" data-v-dfcbb9c9></polyline><polyline class="pl__tick" stroke="hsl(223,90%,80%)" points="0,2 0,14" transform="rotate(180,0,0) translate(0,40)" data-v-dfcbb9c9></polyline></g></g><g data-v-dfcbb9c9><g transform="translate(64,28)" data-v-dfcbb9c9><g class="pl__arrows" transform="rotate(45,16,52)" data-v-dfcbb9c9><path fill="hsl(3,90%,55%)" d="M17.998,1.506l13.892,43.594c.455,1.426-.56,2.899-1.998,2.899H2.108c-1.437,0-2.452-1.473-1.998-2.899L14.002,1.506c.64-2.008,3.356-2.008,3.996,0Z" data-v-dfcbb9c9></path><path fill="hsl(223,10%,90%)" d="M14.009,102.499L.109,58.889c-.453-1.421,.559-2.889,1.991-2.889H29.899c1.433,0,2.444,1.468,1.991,2.889l-13.899,43.61c-.638,2.001-3.345,2.001-3.983,0Z" data-v-dfcbb9c9></path></g></g></g><g mask="url(#mask2)" data-v-dfcbb9c9><g transform="translate(64,28)" data-v-dfcbb9c9><g class="pl__arrows" transform="rotate(45,16,52)" data-v-dfcbb9c9><path fill="hsl(333,90%,55%)" d="M17.998,1.506l13.892,43.594c.455,1.426-.56,2.899-1.998,2.899H2.108c-1.437,0-2.452-1.473-1.998-2.899L14.002,1.506c.64-2.008,3.356-2.008,3.996,0Z" data-v-dfcbb9c9></path><path fill="hsl(223,90%,80%)" d="M14.009,102.499L.109,58.889c-.453-1.421,.559-2.889,1.991-2.889H29.899c1.433,0,2.444,1.468,1.991,2.889l-13.899,43.61c-.638,2.001-3.345,2.001-3.983,0Z" data-v-dfcbb9c9></path></g></g></g>',7)]))}const IC=xn(PC,[["render",kC],["__scopeId","data-v-dfcbb9c9"]]);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Ru(s){return s+.5|0}const $o=(s,e,n)=>Math.max(Math.min(s,n),e);function Xh(s){return $o(Ru(s*2.55),0,255)}function qo(s){return $o(Ru(s*255),0,255)}function Jr(s){return $o(Ru(s/2.55)/100,0,1)}function qx(s){return $o(Ru(s*100),0,100)}const jn={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},fg=[..."0123456789ABCDEF"],DC=s=>fg[s&15],AC=s=>fg[(s&240)>>4]+fg[s&15],of=s=>(s&240)>>4===(s&15),EC=s=>of(s.r)&&of(s.g)&&of(s.b)&&of(s.a);function zC(s){var e=s.length,n;return s[0]==="#"&&(e===4||e===5?n={r:255&jn[s[1]]*17,g:255&jn[s[2]]*17,b:255&jn[s[3]]*17,a:e===5?jn[s[4]]*17:255}:(e===7||e===9)&&(n={r:jn[s[1]]<<4|jn[s[2]],g:jn[s[3]]<<4|jn[s[4]],b:jn[s[5]]<<4|jn[s[6]],a:e===9?jn[s[7]]<<4|jn[s[8]]:255})),n}const RC=(s,e)=>s<255?e(s):"";function LC(s){var e=EC(s)?DC:AC;return s?"#"+e(s.r)+e(s.g)+e(s.b)+RC(s.a,e):void 0}const FC=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function H0(s,e,n){const c=e*Math.min(n,1-n),h=(p,f=(p+s/30)%12)=>n-c*Math.max(Math.min(f-3,9-f,1),-1);return[h(0),h(8),h(4)]}function OC(s,e,n){const c=(h,p=(h+s/60)%6)=>n-n*e*Math.max(Math.min(p,4-p,1),0);return[c(5),c(3),c(1)]}function BC(s,e,n){const c=H0(s,1,.5);let h;for(e+n>1&&(h=1/(e+n),e*=h,n*=h),h=0;h<3;h++)c[h]*=1-e-n,c[h]+=e;return c}function jC(s,e,n,c,h){return s===h?(e-n)/c+(e<n?6:0):e===h?(n-s)/c+2:(s-e)/c+4}function Jg(s){const n=s.r/255,c=s.g/255,h=s.b/255,p=Math.max(n,c,h),f=Math.min(n,c,h),a=(p+f)/2;let w,P,k;return p!==f&&(k=p-f,P=a>.5?k/(2-p-f):k/(p+f),w=jC(n,c,h,k,p),w=w*60+.5),[w|0,P||0,a]}function Qg(s,e,n,c){return(Array.isArray(e)?s(e[0],e[1],e[2]):s(e,n,c)).map(qo)}function t_(s,e,n){return Qg(H0,s,e,n)}function NC(s,e,n){return Qg(BC,s,e,n)}function VC(s,e,n){return Qg(OC,s,e,n)}function Z0(s){return(s%360+360)%360}function $C(s){const e=FC.exec(s);let n=255,c;if(!e)return;e[5]!==c&&(n=e[6]?Xh(+e[5]):qo(+e[5]));const h=Z0(+e[2]),p=+e[3]/100,f=+e[4]/100;return e[1]==="hwb"?c=NC(h,p,f):e[1]==="hsv"?c=VC(h,p,f):c=t_(h,p,f),{r:c[0],g:c[1],b:c[2],a:n}}function UC(s,e){var n=Jg(s);n[0]=Z0(n[0]+e),n=t_(n),s.r=n[0],s.g=n[1],s.b=n[2]}function HC(s){if(!s)return;const e=Jg(s),n=e[0],c=qx(e[1]),h=qx(e[2]);return s.a<255?`hsla(${n}, ${c}%, ${h}%, ${Jr(s.a)})`:`hsl(${n}, ${c}%, ${h}%)`}const Wx={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Xx={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function ZC(){const s={},e=Object.keys(Xx),n=Object.keys(Wx);let c,h,p,f,a;for(c=0;c<e.length;c++){for(f=a=e[c],h=0;h<n.length;h++)p=n[h],a=a.replace(p,Wx[p]);p=parseInt(Xx[f],16),s[a]=[p>>16&255,p>>8&255,p&255]}return s}let af;function GC(s){af||(af=ZC(),af.transparent=[0,0,0,0]);const e=af[s.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const qC=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function WC(s){const e=qC.exec(s);let n=255,c,h,p;if(e){if(e[7]!==c){const f=+e[7];n=e[8]?Xh(f):$o(f*255,0,255)}return c=+e[1],h=+e[3],p=+e[5],c=255&(e[2]?Xh(c):$o(c,0,255)),h=255&(e[4]?Xh(h):$o(h,0,255)),p=255&(e[6]?Xh(p):$o(p,0,255)),{r:c,g:h,b:p,a:n}}}function XC(s){return s&&(s.a<255?`rgba(${s.r}, ${s.g}, ${s.b}, ${Jr(s.a)})`:`rgb(${s.r}, ${s.g}, ${s.b})`)}const Nm=s=>s<=.0031308?s*12.92:Math.pow(s,1/2.4)*1.055-.055,Jl=s=>s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4);function KC(s,e,n){const c=Jl(Jr(s.r)),h=Jl(Jr(s.g)),p=Jl(Jr(s.b));return{r:qo(Nm(c+n*(Jl(Jr(e.r))-c))),g:qo(Nm(h+n*(Jl(Jr(e.g))-h))),b:qo(Nm(p+n*(Jl(Jr(e.b))-p))),a:s.a+n*(e.a-s.a)}}function lf(s,e,n){if(s){let c=Jg(s);c[e]=Math.max(0,Math.min(c[e]+c[e]*n,e===0?360:1)),c=t_(c),s.r=c[0],s.g=c[1],s.b=c[2]}}function G0(s,e){return s&&Object.assign(e||{},s)}function Kx(s){var e={r:0,g:0,b:0,a:255};return Array.isArray(s)?s.length>=3&&(e={r:s[0],g:s[1],b:s[2],a:255},s.length>3&&(e.a=qo(s[3]))):(e=G0(s,{r:0,g:0,b:0,a:1}),e.a=qo(e.a)),e}function YC(s){return s.charAt(0)==="r"?WC(s):$C(s)}class Su{constructor(e){if(e instanceof Su)return e;const n=typeof e;let c;n==="object"?c=Kx(e):n==="string"&&(c=zC(e)||GC(e)||YC(e)),this._rgb=c,this._valid=!!c}get valid(){return this._valid}get rgb(){var e=G0(this._rgb);return e&&(e.a=Jr(e.a)),e}set rgb(e){this._rgb=Kx(e)}rgbString(){return this._valid?XC(this._rgb):void 0}hexString(){return this._valid?LC(this._rgb):void 0}hslString(){return this._valid?HC(this._rgb):void 0}mix(e,n){if(e){const c=this.rgb,h=e.rgb;let p;const f=n===p?.5:n,a=2*f-1,w=c.a-h.a,P=((a*w===-1?a:(a+w)/(1+a*w))+1)/2;p=1-P,c.r=255&P*c.r+p*h.r+.5,c.g=255&P*c.g+p*h.g+.5,c.b=255&P*c.b+p*h.b+.5,c.a=f*c.a+(1-f)*h.a,this.rgb=c}return this}interpolate(e,n){return e&&(this._rgb=KC(this._rgb,e._rgb,n)),this}clone(){return new Su(this.rgb)}alpha(e){return this._rgb.a=qo(e),this}clearer(e){const n=this._rgb;return n.a*=1-e,this}greyscale(){const e=this._rgb,n=Ru(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=n,this}opaquer(e){const n=this._rgb;return n.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return lf(this._rgb,2,e),this}darken(e){return lf(this._rgb,2,-e),this}saturate(e){return lf(this._rgb,1,e),this}desaturate(e){return lf(this._rgb,1,-e),this}rotate(e){return UC(this._rgb,e),this}}/*!
 * Chart.js v4.4.7
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function qr(){}const JC=(()=>{let s=0;return()=>s++})();function pi(s){return s==null}function is(s){if(Array.isArray&&Array.isArray(s))return!0;const e=Object.prototype.toString.call(s);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function ui(s){return s!==null&&Object.prototype.toString.call(s)==="[object Object]"}function us(s){return(typeof s=="number"||s instanceof Number)&&isFinite(+s)}function In(s,e){return us(s)?s:e}function ti(s,e){return typeof s>"u"?e:s}const QC=(s,e)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100:+s/e,q0=(s,e)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100*e:+s;function Gi(s,e,n){if(s&&typeof s.call=="function")return s.apply(n,e)}function Ci(s,e,n,c){let h,p,f;if(is(s))for(p=s.length,h=0;h<p;h++)e.call(n,s[h],h);else if(ui(s))for(f=Object.keys(s),p=f.length,h=0;h<p;h++)e.call(n,s[f[h]],f[h])}function Gf(s,e){let n,c,h,p;if(!s||!e||s.length!==e.length)return!1;for(n=0,c=s.length;n<c;++n)if(h=s[n],p=e[n],h.datasetIndex!==p.datasetIndex||h.index!==p.index)return!1;return!0}function qf(s){if(is(s))return s.map(qf);if(ui(s)){const e=Object.create(null),n=Object.keys(s),c=n.length;let h=0;for(;h<c;++h)e[n[h]]=qf(s[n[h]]);return e}return s}function W0(s){return["__proto__","prototype","constructor"].indexOf(s)===-1}function tk(s,e,n,c){if(!W0(s))return;const h=e[s],p=n[s];ui(h)&&ui(p)?Tu(h,p,c):e[s]=qf(p)}function Tu(s,e,n){const c=is(e)?e:[e],h=c.length;if(!ui(s))return s;n=n||{};const p=n.merger||tk;let f;for(let a=0;a<h;++a){if(f=c[a],!ui(f))continue;const w=Object.keys(f);for(let P=0,k=w.length;P<k;++P)p(w[P],s,f,n)}return s}function hu(s,e){return Tu(s,e,{merger:ek})}function ek(s,e,n){if(!W0(s))return;const c=e[s],h=n[s];ui(c)&&ui(h)?hu(c,h):Object.prototype.hasOwnProperty.call(e,s)||(e[s]=qf(h))}const Yx={"":s=>s,x:s=>s.x,y:s=>s.y};function ik(s){const e=s.split("."),n=[];let c="";for(const h of e)c+=h,c.endsWith("\\")?c=c.slice(0,-1)+".":(n.push(c),c="");return n}function sk(s){const e=ik(s);return n=>{for(const c of e){if(c==="")break;n=n&&n[c]}return n}}function Xo(s,e){return(Yx[e]||(Yx[e]=sk(e)))(s)}function e_(s){return s.charAt(0).toUpperCase()+s.slice(1)}const Mu=s=>typeof s<"u",Ko=s=>typeof s=="function",Jx=(s,e)=>{if(s.size!==e.size)return!1;for(const n of s)if(!e.has(n))return!1;return!0};function nk(s){return s.type==="mouseup"||s.type==="click"||s.type==="contextmenu"}const Ji=Math.PI,Ki=2*Ji,rk=Ki+Ji,Wf=Number.POSITIVE_INFINITY,ok=Ji/180,ys=Ji/2,Fa=Ji/4,Qx=Ji*2/3,Uo=Math.log10,Sr=Math.sign;function uu(s,e,n){return Math.abs(s-e)<n}function tb(s){const e=Math.round(s);s=uu(s,e,s/1e3)?e:s;const n=Math.pow(10,Math.floor(Uo(s))),c=s/n;return(c<=1?1:c<=2?2:c<=5?5:10)*n}function ak(s){const e=[],n=Math.sqrt(s);let c;for(c=1;c<n;c++)s%c===0&&(e.push(c),e.push(s/c));return n===(n|0)&&e.push(n),e.sort((h,p)=>h-p).pop(),e}function pc(s){return!isNaN(parseFloat(s))&&isFinite(s)}function lk(s,e){const n=Math.round(s);return n-e<=s&&n+e>=s}function X0(s,e,n){let c,h,p;for(c=0,h=s.length;c<h;c++)p=s[c][n],isNaN(p)||(e.min=Math.min(e.min,p),e.max=Math.max(e.max,p))}function ir(s){return s*(Ji/180)}function i_(s){return s*(180/Ji)}function eb(s){if(!us(s))return;let e=1,n=0;for(;Math.round(s*e)/e!==s;)e*=10,n++;return n}function K0(s,e){const n=e.x-s.x,c=e.y-s.y,h=Math.sqrt(n*n+c*c);let p=Math.atan2(c,n);return p<-.5*Ji&&(p+=Ki),{angle:p,distance:h}}function pg(s,e){return Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2))}function ck(s,e){return(s-e+rk)%Ki-Ji}function An(s){return(s%Ki+Ki)%Ki}function Pu(s,e,n,c){const h=An(s),p=An(e),f=An(n),a=An(p-h),w=An(f-h),P=An(h-p),k=An(h-f);return h===p||h===f||c&&p===f||a>w&&P<k}function Ls(s,e,n){return Math.max(e,Math.min(n,s))}function hk(s){return Ls(s,-32768,32767)}function so(s,e,n,c=1e-6){return s>=Math.min(e,n)-c&&s<=Math.max(e,n)+c}function s_(s,e,n){n=n||(f=>s[f]<e);let c=s.length-1,h=0,p;for(;c-h>1;)p=h+c>>1,n(p)?h=p:c=p;return{lo:h,hi:c}}const no=(s,e,n,c)=>s_(s,n,c?h=>{const p=s[h][e];return p<n||p===n&&s[h+1][e]===n}:h=>s[h][e]<n),uk=(s,e,n)=>s_(s,n,c=>s[c][e]>=n);function dk(s,e,n){let c=0,h=s.length;for(;c<h&&s[c]<e;)c++;for(;h>c&&s[h-1]>n;)h--;return c>0||h<s.length?s.slice(c,h):s}const Y0=["push","pop","shift","splice","unshift"];function fk(s,e){if(s._chartjs){s._chartjs.listeners.push(e);return}Object.defineProperty(s,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),Y0.forEach(n=>{const c="_onData"+e_(n),h=s[n];Object.defineProperty(s,n,{configurable:!0,enumerable:!1,value(...p){const f=h.apply(this,p);return s._chartjs.listeners.forEach(a=>{typeof a[c]=="function"&&a[c](...p)}),f}})})}function ib(s,e){const n=s._chartjs;if(!n)return;const c=n.listeners,h=c.indexOf(e);h!==-1&&c.splice(h,1),!(c.length>0)&&(Y0.forEach(p=>{delete s[p]}),delete s._chartjs)}function J0(s){const e=new Set(s);return e.size===s.length?s:Array.from(e)}const Q0=function(){return typeof window>"u"?function(s){return s()}:window.requestAnimationFrame}();function t1(s,e){let n=[],c=!1;return function(...h){n=h,c||(c=!0,Q0.call(window,()=>{c=!1,s.apply(e,n)}))}}function pk(s,e){let n;return function(...c){return e?(clearTimeout(n),n=setTimeout(s,e,c)):s.apply(this,c),e}}const n_=s=>s==="start"?"left":s==="end"?"right":"center",Us=(s,e,n)=>s==="start"?e:s==="end"?n:(e+n)/2,mk=(s,e,n,c)=>s===(c?"left":"right")?n:s==="center"?(e+n)/2:e;function e1(s,e,n){const c=e.length;let h=0,p=c;if(s._sorted){const{iScale:f,_parsed:a}=s,w=f.axis,{min:P,max:k,minDefined:E,maxDefined:F}=f.getUserBounds();E&&(h=Ls(Math.min(no(a,w,P).lo,n?c:no(e,w,f.getPixelForValue(P)).lo),0,c-1)),F?p=Ls(Math.max(no(a,f.axis,k,!0).hi+1,n?0:no(e,w,f.getPixelForValue(k),!0).hi+1),h,c)-h:p=c-h}return{start:h,count:p}}function i1(s){const{xScale:e,yScale:n,_scaleRanges:c}=s,h={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!c)return s._scaleRanges=h,!0;const p=c.xmin!==e.min||c.xmax!==e.max||c.ymin!==n.min||c.ymax!==n.max;return Object.assign(c,h),p}const cf=s=>s===0||s===1,sb=(s,e,n)=>-(Math.pow(2,10*(s-=1))*Math.sin((s-e)*Ki/n)),nb=(s,e,n)=>Math.pow(2,-10*s)*Math.sin((s-e)*Ki/n)+1,du={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>-s*(s-2),easeInOutQuad:s=>(s/=.5)<1?.5*s*s:-.5*(--s*(s-2)-1),easeInCubic:s=>s*s*s,easeOutCubic:s=>(s-=1)*s*s+1,easeInOutCubic:s=>(s/=.5)<1?.5*s*s*s:.5*((s-=2)*s*s+2),easeInQuart:s=>s*s*s*s,easeOutQuart:s=>-((s-=1)*s*s*s-1),easeInOutQuart:s=>(s/=.5)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2),easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>(s-=1)*s*s*s*s+1,easeInOutQuint:s=>(s/=.5)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2),easeInSine:s=>-Math.cos(s*ys)+1,easeOutSine:s=>Math.sin(s*ys),easeInOutSine:s=>-.5*(Math.cos(Ji*s)-1),easeInExpo:s=>s===0?0:Math.pow(2,10*(s-1)),easeOutExpo:s=>s===1?1:-Math.pow(2,-10*s)+1,easeInOutExpo:s=>cf(s)?s:s<.5?.5*Math.pow(2,10*(s*2-1)):.5*(-Math.pow(2,-10*(s*2-1))+2),easeInCirc:s=>s>=1?s:-(Math.sqrt(1-s*s)-1),easeOutCirc:s=>Math.sqrt(1-(s-=1)*s),easeInOutCirc:s=>(s/=.5)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1),easeInElastic:s=>cf(s)?s:sb(s,.075,.3),easeOutElastic:s=>cf(s)?s:nb(s,.075,.3),easeInOutElastic(s){return cf(s)?s:s<.5?.5*sb(s*2,.1125,.45):.5+.5*nb(s*2-1,.1125,.45)},easeInBack(s){return s*s*((1.70158+1)*s-1.70158)},easeOutBack(s){return(s-=1)*s*((1.70158+1)*s+1.70158)+1},easeInOutBack(s){let e=1.70158;return(s/=.5)<1?.5*(s*s*(((e*=1.525)+1)*s-e)):.5*((s-=2)*s*(((e*=1.525)+1)*s+e)+2)},easeInBounce:s=>1-du.easeOutBounce(1-s),easeOutBounce(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},easeInOutBounce:s=>s<.5?du.easeInBounce(s*2)*.5:du.easeOutBounce(s*2-1)*.5+.5};function r_(s){if(s&&typeof s=="object"){const e=s.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function rb(s){return r_(s)?s:new Su(s)}function Vm(s){return r_(s)?s:new Su(s).saturate(.5).darken(.1).hexString()}const gk=["x","y","borderWidth","radius","tension"],_k=["color","borderColor","backgroundColor"];function yk(s){s.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),s.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),s.set("animations",{colors:{type:"color",properties:_k},numbers:{type:"number",properties:gk}}),s.describe("animations",{_fallback:"animation"}),s.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function xk(s){s.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const ob=new Map;function bk(s,e){e=e||{};const n=s+JSON.stringify(e);let c=ob.get(n);return c||(c=new Intl.NumberFormat(s,e),ob.set(n,c)),c}function Lu(s,e,n){return bk(e,n).format(s)}const s1={values(s){return is(s)?s:""+s},numeric(s,e,n){if(s===0)return"0";const c=this.chart.options.locale;let h,p=s;if(n.length>1){const P=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(P<1e-4||P>1e15)&&(h="scientific"),p=vk(s,n)}const f=Uo(Math.abs(p)),a=isNaN(f)?1:Math.max(Math.min(-1*Math.floor(f),20),0),w={notation:h,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(w,this.options.ticks.format),Lu(s,c,w)},logarithmic(s,e,n){if(s===0)return"0";const c=n[e].significand||s/Math.pow(10,Math.floor(Uo(s)));return[1,2,3,5,10,15].includes(c)||e>.8*n.length?s1.numeric.call(this,s,e,n):""}};function vk(s,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(n)>=1&&s!==Math.floor(s)&&(n=s-Math.floor(s)),n}var fp={formatters:s1};function wk(s){s.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,n)=>n.lineWidth,tickColor:(e,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:fp.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),s.route("scale.ticks","color","","color"),s.route("scale.grid","color","","borderColor"),s.route("scale.border","color","","borderColor"),s.route("scale.title","color","","color"),s.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),s.describe("scales",{_fallback:"scale"}),s.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Xa=Object.create(null),mg=Object.create(null);function fu(s,e){if(!e)return s;const n=e.split(".");for(let c=0,h=n.length;c<h;++c){const p=n[c];s=s[p]||(s[p]=Object.create(null))}return s}function $m(s,e,n){return typeof e=="string"?Tu(fu(s,e),n):Tu(fu(s,""),e)}class Sk{constructor(e,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=c=>c.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(c,h)=>Vm(h.backgroundColor),this.hoverBorderColor=(c,h)=>Vm(h.borderColor),this.hoverColor=(c,h)=>Vm(h.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(n)}set(e,n){return $m(this,e,n)}get(e){return fu(this,e)}describe(e,n){return $m(mg,e,n)}override(e,n){return $m(Xa,e,n)}route(e,n,c,h){const p=fu(this,e),f=fu(this,c),a="_"+n;Object.defineProperties(p,{[a]:{value:p[n],writable:!0},[n]:{enumerable:!0,get(){const w=this[a],P=f[h];return ui(w)?Object.assign({},P,w):ti(w,P)},set(w){this[a]=w}}})}apply(e){e.forEach(n=>n(this))}}var ss=new Sk({_scriptable:s=>!s.startsWith("on"),_indexable:s=>s!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[yk,xk,wk]);function Tk(s){return!s||pi(s.size)||pi(s.family)?null:(s.style?s.style+" ":"")+(s.weight?s.weight+" ":"")+s.size+"px "+s.family}function Xf(s,e,n,c,h){let p=e[h];return p||(p=e[h]=s.measureText(h).width,n.push(h)),p>c&&(c=p),c}function Mk(s,e,n,c){c=c||{};let h=c.data=c.data||{},p=c.garbageCollect=c.garbageCollect||[];c.font!==e&&(h=c.data={},p=c.garbageCollect=[],c.font=e),s.save(),s.font=e;let f=0;const a=n.length;let w,P,k,E,F;for(w=0;w<a;w++)if(E=n[w],E!=null&&!is(E))f=Xf(s,h,p,f,E);else if(is(E))for(P=0,k=E.length;P<k;P++)F=E[P],F!=null&&!is(F)&&(f=Xf(s,h,p,f,F));s.restore();const R=p.length/2;if(R>n.length){for(w=0;w<R;w++)delete h[p[w]];p.splice(0,R)}return f}function Oa(s,e,n){const c=s.currentDevicePixelRatio,h=n!==0?Math.max(n/2,.5):0;return Math.round((e-h)*c)/c+h}function ab(s,e){!e&&!s||(e=e||s.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,s.width,s.height),e.restore())}function gg(s,e,n,c){n1(s,e,n,c,null)}function n1(s,e,n,c,h){let p,f,a,w,P,k,E,F;const R=e.pointStyle,J=e.rotation,rt=e.radius;let mt=(J||0)*ok;if(R&&typeof R=="object"&&(p=R.toString(),p==="[object HTMLImageElement]"||p==="[object HTMLCanvasElement]")){s.save(),s.translate(n,c),s.rotate(mt),s.drawImage(R,-R.width/2,-R.height/2,R.width,R.height),s.restore();return}if(!(isNaN(rt)||rt<=0)){switch(s.beginPath(),R){default:h?s.ellipse(n,c,h/2,rt,0,0,Ki):s.arc(n,c,rt,0,Ki),s.closePath();break;case"triangle":k=h?h/2:rt,s.moveTo(n+Math.sin(mt)*k,c-Math.cos(mt)*rt),mt+=Qx,s.lineTo(n+Math.sin(mt)*k,c-Math.cos(mt)*rt),mt+=Qx,s.lineTo(n+Math.sin(mt)*k,c-Math.cos(mt)*rt),s.closePath();break;case"rectRounded":P=rt*.516,w=rt-P,f=Math.cos(mt+Fa)*w,E=Math.cos(mt+Fa)*(h?h/2-P:w),a=Math.sin(mt+Fa)*w,F=Math.sin(mt+Fa)*(h?h/2-P:w),s.arc(n-E,c-a,P,mt-Ji,mt-ys),s.arc(n+F,c-f,P,mt-ys,mt),s.arc(n+E,c+a,P,mt,mt+ys),s.arc(n-F,c+f,P,mt+ys,mt+Ji),s.closePath();break;case"rect":if(!J){w=Math.SQRT1_2*rt,k=h?h/2:w,s.rect(n-k,c-w,2*k,2*w);break}mt+=Fa;case"rectRot":E=Math.cos(mt)*(h?h/2:rt),f=Math.cos(mt)*rt,a=Math.sin(mt)*rt,F=Math.sin(mt)*(h?h/2:rt),s.moveTo(n-E,c-a),s.lineTo(n+F,c-f),s.lineTo(n+E,c+a),s.lineTo(n-F,c+f),s.closePath();break;case"crossRot":mt+=Fa;case"cross":E=Math.cos(mt)*(h?h/2:rt),f=Math.cos(mt)*rt,a=Math.sin(mt)*rt,F=Math.sin(mt)*(h?h/2:rt),s.moveTo(n-E,c-a),s.lineTo(n+E,c+a),s.moveTo(n+F,c-f),s.lineTo(n-F,c+f);break;case"star":E=Math.cos(mt)*(h?h/2:rt),f=Math.cos(mt)*rt,a=Math.sin(mt)*rt,F=Math.sin(mt)*(h?h/2:rt),s.moveTo(n-E,c-a),s.lineTo(n+E,c+a),s.moveTo(n+F,c-f),s.lineTo(n-F,c+f),mt+=Fa,E=Math.cos(mt)*(h?h/2:rt),f=Math.cos(mt)*rt,a=Math.sin(mt)*rt,F=Math.sin(mt)*(h?h/2:rt),s.moveTo(n-E,c-a),s.lineTo(n+E,c+a),s.moveTo(n+F,c-f),s.lineTo(n-F,c+f);break;case"line":f=h?h/2:Math.cos(mt)*rt,a=Math.sin(mt)*rt,s.moveTo(n-f,c-a),s.lineTo(n+f,c+a);break;case"dash":s.moveTo(n,c),s.lineTo(n+Math.cos(mt)*(h?h/2:rt),c+Math.sin(mt)*rt);break;case!1:s.closePath();break}s.fill(),e.borderWidth>0&&s.stroke()}}function ro(s,e,n){return n=n||.5,!e||s&&s.x>e.left-n&&s.x<e.right+n&&s.y>e.top-n&&s.y<e.bottom+n}function pp(s,e){s.save(),s.beginPath(),s.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),s.clip()}function mp(s){s.restore()}function Pk(s,e,n,c,h){if(!e)return s.lineTo(n.x,n.y);if(h==="middle"){const p=(e.x+n.x)/2;s.lineTo(p,e.y),s.lineTo(p,n.y)}else h==="after"!=!!c?s.lineTo(e.x,n.y):s.lineTo(n.x,e.y);s.lineTo(n.x,n.y)}function Ck(s,e,n,c){if(!e)return s.lineTo(n.x,n.y);s.bezierCurveTo(c?e.cp1x:e.cp2x,c?e.cp1y:e.cp2y,c?n.cp2x:n.cp1x,c?n.cp2y:n.cp1y,n.x,n.y)}function kk(s,e){e.translation&&s.translate(e.translation[0],e.translation[1]),pi(e.rotation)||s.rotate(e.rotation),e.color&&(s.fillStyle=e.color),e.textAlign&&(s.textAlign=e.textAlign),e.textBaseline&&(s.textBaseline=e.textBaseline)}function Ik(s,e,n,c,h){if(h.strikethrough||h.underline){const p=s.measureText(c),f=e-p.actualBoundingBoxLeft,a=e+p.actualBoundingBoxRight,w=n-p.actualBoundingBoxAscent,P=n+p.actualBoundingBoxDescent,k=h.strikethrough?(w+P)/2:P;s.strokeStyle=s.fillStyle,s.beginPath(),s.lineWidth=h.decorationWidth||2,s.moveTo(f,k),s.lineTo(a,k),s.stroke()}}function Dk(s,e){const n=s.fillStyle;s.fillStyle=e.color,s.fillRect(e.left,e.top,e.width,e.height),s.fillStyle=n}function Ka(s,e,n,c,h,p={}){const f=is(e)?e:[e],a=p.strokeWidth>0&&p.strokeColor!=="";let w,P;for(s.save(),s.font=h.string,kk(s,p),w=0;w<f.length;++w)P=f[w],p.backdrop&&Dk(s,p.backdrop),a&&(p.strokeColor&&(s.strokeStyle=p.strokeColor),pi(p.strokeWidth)||(s.lineWidth=p.strokeWidth),s.strokeText(P,n,c,p.maxWidth)),s.fillText(P,n,c,p.maxWidth),Ik(s,n,c,P,p),c+=Number(h.lineHeight);s.restore()}function Cu(s,e){const{x:n,y:c,w:h,h:p,radius:f}=e;s.arc(n+f.topLeft,c+f.topLeft,f.topLeft,1.5*Ji,Ji,!0),s.lineTo(n,c+p-f.bottomLeft),s.arc(n+f.bottomLeft,c+p-f.bottomLeft,f.bottomLeft,Ji,ys,!0),s.lineTo(n+h-f.bottomRight,c+p),s.arc(n+h-f.bottomRight,c+p-f.bottomRight,f.bottomRight,ys,0,!0),s.lineTo(n+h,c+f.topRight),s.arc(n+h-f.topRight,c+f.topRight,f.topRight,0,-ys,!0),s.lineTo(n+f.topLeft,c)}const Ak=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Ek=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function zk(s,e){const n=(""+s).match(Ak);if(!n||n[1]==="normal")return e*1.2;switch(s=+n[2],n[3]){case"px":return s;case"%":s/=100;break}return e*s}const Rk=s=>+s||0;function o_(s,e){const n={},c=ui(e),h=c?Object.keys(e):e,p=ui(s)?c?f=>ti(s[f],s[e[f]]):f=>s[f]:()=>s;for(const f of h)n[f]=Rk(p(f));return n}function r1(s){return o_(s,{top:"y",right:"x",bottom:"y",left:"x"})}function Ga(s){return o_(s,["topLeft","topRight","bottomLeft","bottomRight"])}function Ys(s){const e=r1(s);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Is(s,e){s=s||{},e=e||ss.font;let n=ti(s.size,e.size);typeof n=="string"&&(n=parseInt(n,10));let c=ti(s.style,e.style);c&&!(""+c).match(Ek)&&(console.warn('Invalid font style specified: "'+c+'"'),c=void 0);const h={family:ti(s.family,e.family),lineHeight:zk(ti(s.lineHeight,e.lineHeight),n),size:n,style:c,weight:ti(s.weight,e.weight),string:""};return h.string=Tk(h),h}function Kh(s,e,n,c){let h,p,f;for(h=0,p=s.length;h<p;++h)if(f=s[h],f!==void 0&&f!==void 0)return f}function Lk(s,e,n){const{min:c,max:h}=s,p=q0(e,(h-c)/2),f=(a,w)=>n&&a===0?0:a+w;return{min:f(c,-Math.abs(p)),max:f(h,p)}}function Qo(s,e){return Object.assign(Object.create(s),e)}function a_(s,e=[""],n,c,h=()=>s[0]){const p=n||s;typeof c>"u"&&(c=c1("_fallback",s));const f={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:s,_rootScopes:p,_fallback:c,_getTarget:h,override:a=>a_([a,...s],e,p,c)};return new Proxy(f,{deleteProperty(a,w){return delete a[w],delete a._keys,delete s[0][w],!0},get(a,w){return a1(a,w,()=>Uk(w,e,s,a))},getOwnPropertyDescriptor(a,w){return Reflect.getOwnPropertyDescriptor(a._scopes[0],w)},getPrototypeOf(){return Reflect.getPrototypeOf(s[0])},has(a,w){return cb(a).includes(w)},ownKeys(a){return cb(a)},set(a,w,P){const k=a._storage||(a._storage=h());return a[w]=k[w]=P,delete a._keys,!0}})}function mc(s,e,n,c){const h={_cacheable:!1,_proxy:s,_context:e,_subProxy:n,_stack:new Set,_descriptors:o1(s,c),setContext:p=>mc(s,p,n,c),override:p=>mc(s.override(p),e,n,c)};return new Proxy(h,{deleteProperty(p,f){return delete p[f],delete s[f],!0},get(p,f,a){return a1(p,f,()=>Ok(p,f,a))},getOwnPropertyDescriptor(p,f){return p._descriptors.allKeys?Reflect.has(s,f)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(s,f)},getPrototypeOf(){return Reflect.getPrototypeOf(s)},has(p,f){return Reflect.has(s,f)},ownKeys(){return Reflect.ownKeys(s)},set(p,f,a){return s[f]=a,delete p[f],!0}})}function o1(s,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:c=e.indexable,_allKeys:h=e.allKeys}=s;return{allKeys:h,scriptable:n,indexable:c,isScriptable:Ko(n)?n:()=>n,isIndexable:Ko(c)?c:()=>c}}const Fk=(s,e)=>s?s+e_(e):e,l_=(s,e)=>ui(e)&&s!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function a1(s,e,n){if(Object.prototype.hasOwnProperty.call(s,e)||e==="constructor")return s[e];const c=n();return s[e]=c,c}function Ok(s,e,n){const{_proxy:c,_context:h,_subProxy:p,_descriptors:f}=s;let a=c[e];return Ko(a)&&f.isScriptable(e)&&(a=Bk(e,a,s,n)),is(a)&&a.length&&(a=jk(e,a,s,f.isIndexable)),l_(e,a)&&(a=mc(a,h,p&&p[e],f)),a}function Bk(s,e,n,c){const{_proxy:h,_context:p,_subProxy:f,_stack:a}=n;if(a.has(s))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+s);a.add(s);let w=e(p,f||c);return a.delete(s),l_(s,w)&&(w=c_(h._scopes,h,s,w)),w}function jk(s,e,n,c){const{_proxy:h,_context:p,_subProxy:f,_descriptors:a}=n;if(typeof p.index<"u"&&c(s))return e[p.index%e.length];if(ui(e[0])){const w=e,P=h._scopes.filter(k=>k!==w);e=[];for(const k of w){const E=c_(P,h,s,k);e.push(mc(E,p,f&&f[s],a))}}return e}function l1(s,e,n){return Ko(s)?s(e,n):s}const Nk=(s,e)=>s===!0?e:typeof s=="string"?Xo(e,s):void 0;function Vk(s,e,n,c,h){for(const p of e){const f=Nk(n,p);if(f){s.add(f);const a=l1(f._fallback,n,h);if(typeof a<"u"&&a!==n&&a!==c)return a}else if(f===!1&&typeof c<"u"&&n!==c)return null}return!1}function c_(s,e,n,c){const h=e._rootScopes,p=l1(e._fallback,n,c),f=[...s,...h],a=new Set;a.add(c);let w=lb(a,f,n,p||n,c);return w===null||typeof p<"u"&&p!==n&&(w=lb(a,f,p,w,c),w===null)?!1:a_(Array.from(a),[""],h,p,()=>$k(e,n,c))}function lb(s,e,n,c,h){for(;n;)n=Vk(s,e,n,c,h);return n}function $k(s,e,n){const c=s._getTarget();e in c||(c[e]={});const h=c[e];return is(h)&&ui(n)?n:h||{}}function Uk(s,e,n,c){let h;for(const p of e)if(h=c1(Fk(p,s),n),typeof h<"u")return l_(s,h)?c_(n,c,s,h):h}function c1(s,e){for(const n of e){if(!n)continue;const c=n[s];if(typeof c<"u")return c}}function cb(s){let e=s._keys;return e||(e=s._keys=Hk(s._scopes)),e}function Hk(s){const e=new Set;for(const n of s)for(const c of Object.keys(n).filter(h=>!h.startsWith("_")))e.add(c);return Array.from(e)}function h1(s,e,n,c){const{iScale:h}=s,{key:p="r"}=this._parsing,f=new Array(c);let a,w,P,k;for(a=0,w=c;a<w;++a)P=a+n,k=e[P],f[a]={r:h.parse(Xo(k,p),P)};return f}const Zk=Number.EPSILON||1e-14,gc=(s,e)=>e<s.length&&!s[e].skip&&s[e],u1=s=>s==="x"?"y":"x";function Gk(s,e,n,c){const h=s.skip?e:s,p=e,f=n.skip?e:n,a=pg(p,h),w=pg(f,p);let P=a/(a+w),k=w/(a+w);P=isNaN(P)?0:P,k=isNaN(k)?0:k;const E=c*P,F=c*k;return{previous:{x:p.x-E*(f.x-h.x),y:p.y-E*(f.y-h.y)},next:{x:p.x+F*(f.x-h.x),y:p.y+F*(f.y-h.y)}}}function qk(s,e,n){const c=s.length;let h,p,f,a,w,P=gc(s,0);for(let k=0;k<c-1;++k)if(w=P,P=gc(s,k+1),!(!w||!P)){if(uu(e[k],0,Zk)){n[k]=n[k+1]=0;continue}h=n[k]/e[k],p=n[k+1]/e[k],a=Math.pow(h,2)+Math.pow(p,2),!(a<=9)&&(f=3/Math.sqrt(a),n[k]=h*f*e[k],n[k+1]=p*f*e[k])}}function Wk(s,e,n="x"){const c=u1(n),h=s.length;let p,f,a,w=gc(s,0);for(let P=0;P<h;++P){if(f=a,a=w,w=gc(s,P+1),!a)continue;const k=a[n],E=a[c];f&&(p=(k-f[n])/3,a[`cp1${n}`]=k-p,a[`cp1${c}`]=E-p*e[P]),w&&(p=(w[n]-k)/3,a[`cp2${n}`]=k+p,a[`cp2${c}`]=E+p*e[P])}}function Xk(s,e="x"){const n=u1(e),c=s.length,h=Array(c).fill(0),p=Array(c);let f,a,w,P=gc(s,0);for(f=0;f<c;++f)if(a=w,w=P,P=gc(s,f+1),!!w){if(P){const k=P[e]-w[e];h[f]=k!==0?(P[n]-w[n])/k:0}p[f]=a?P?Sr(h[f-1])!==Sr(h[f])?0:(h[f-1]+h[f])/2:h[f-1]:h[f]}qk(s,h,p),Wk(s,p,e)}function hf(s,e,n){return Math.max(Math.min(s,n),e)}function Kk(s,e){let n,c,h,p,f,a=ro(s[0],e);for(n=0,c=s.length;n<c;++n)f=p,p=a,a=n<c-1&&ro(s[n+1],e),p&&(h=s[n],f&&(h.cp1x=hf(h.cp1x,e.left,e.right),h.cp1y=hf(h.cp1y,e.top,e.bottom)),a&&(h.cp2x=hf(h.cp2x,e.left,e.right),h.cp2y=hf(h.cp2y,e.top,e.bottom)))}function Yk(s,e,n,c,h){let p,f,a,w;if(e.spanGaps&&(s=s.filter(P=>!P.skip)),e.cubicInterpolationMode==="monotone")Xk(s,h);else{let P=c?s[s.length-1]:s[0];for(p=0,f=s.length;p<f;++p)a=s[p],w=Gk(P,a,s[Math.min(p+1,f-(c?0:1))%f],e.tension),a.cp1x=w.previous.x,a.cp1y=w.previous.y,a.cp2x=w.next.x,a.cp2y=w.next.y,P=a}e.capBezierPoints&&Kk(s,n)}function h_(){return typeof window<"u"&&typeof document<"u"}function u_(s){let e=s.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function Kf(s,e,n){let c;return typeof s=="string"?(c=parseInt(s,10),s.indexOf("%")!==-1&&(c=c/100*e.parentNode[n])):c=s,c}const gp=s=>s.ownerDocument.defaultView.getComputedStyle(s,null);function Jk(s,e){return gp(s).getPropertyValue(e)}const Qk=["top","right","bottom","left"];function qa(s,e,n){const c={};n=n?"-"+n:"";for(let h=0;h<4;h++){const p=Qk[h];c[p]=parseFloat(s[e+"-"+p+n])||0}return c.width=c.left+c.right,c.height=c.top+c.bottom,c}const tI=(s,e,n)=>(s>0||e>0)&&(!n||!n.shadowRoot);function eI(s,e){const n=s.touches,c=n&&n.length?n[0]:s,{offsetX:h,offsetY:p}=c;let f=!1,a,w;if(tI(h,p,s.target))a=h,w=p;else{const P=e.getBoundingClientRect();a=c.clientX-P.left,w=c.clientY-P.top,f=!0}return{x:a,y:w,box:f}}function Va(s,e){if("native"in s)return s;const{canvas:n,currentDevicePixelRatio:c}=e,h=gp(n),p=h.boxSizing==="border-box",f=qa(h,"padding"),a=qa(h,"border","width"),{x:w,y:P,box:k}=eI(s,n),E=f.left+(k&&a.left),F=f.top+(k&&a.top);let{width:R,height:J}=e;return p&&(R-=f.width+a.width,J-=f.height+a.height),{x:Math.round((w-E)/R*n.width/c),y:Math.round((P-F)/J*n.height/c)}}function iI(s,e,n){let c,h;if(e===void 0||n===void 0){const p=s&&u_(s);if(!p)e=s.clientWidth,n=s.clientHeight;else{const f=p.getBoundingClientRect(),a=gp(p),w=qa(a,"border","width"),P=qa(a,"padding");e=f.width-P.width-w.width,n=f.height-P.height-w.height,c=Kf(a.maxWidth,p,"clientWidth"),h=Kf(a.maxHeight,p,"clientHeight")}}return{width:e,height:n,maxWidth:c||Wf,maxHeight:h||Wf}}const uf=s=>Math.round(s*10)/10;function sI(s,e,n,c){const h=gp(s),p=qa(h,"margin"),f=Kf(h.maxWidth,s,"clientWidth")||Wf,a=Kf(h.maxHeight,s,"clientHeight")||Wf,w=iI(s,e,n);let{width:P,height:k}=w;if(h.boxSizing==="content-box"){const F=qa(h,"border","width"),R=qa(h,"padding");P-=R.width+F.width,k-=R.height+F.height}return P=Math.max(0,P-p.width),k=Math.max(0,c?P/c:k-p.height),P=uf(Math.min(P,f,w.maxWidth)),k=uf(Math.min(k,a,w.maxHeight)),P&&!k&&(k=uf(P/2)),(e!==void 0||n!==void 0)&&c&&w.height&&k>w.height&&(k=w.height,P=uf(Math.floor(k*c))),{width:P,height:k}}function hb(s,e,n){const c=e||1,h=Math.floor(s.height*c),p=Math.floor(s.width*c);s.height=Math.floor(s.height),s.width=Math.floor(s.width);const f=s.canvas;return f.style&&(n||!f.style.height&&!f.style.width)&&(f.style.height=`${s.height}px`,f.style.width=`${s.width}px`),s.currentDevicePixelRatio!==c||f.height!==h||f.width!==p?(s.currentDevicePixelRatio=c,f.height=h,f.width=p,s.ctx.setTransform(c,0,0,c,0,0),!0):!1}const nI=function(){let s=!1;try{const e={get passive(){return s=!0,!1}};h_()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return s}();function ub(s,e){const n=Jk(s,e),c=n&&n.match(/^(\d+)(\.\d+)?px$/);return c?+c[1]:void 0}function $a(s,e,n,c){return{x:s.x+n*(e.x-s.x),y:s.y+n*(e.y-s.y)}}function rI(s,e,n,c){return{x:s.x+n*(e.x-s.x),y:c==="middle"?n<.5?s.y:e.y:c==="after"?n<1?s.y:e.y:n>0?e.y:s.y}}function oI(s,e,n,c){const h={x:s.cp2x,y:s.cp2y},p={x:e.cp1x,y:e.cp1y},f=$a(s,h,n),a=$a(h,p,n),w=$a(p,e,n),P=$a(f,a,n),k=$a(a,w,n);return $a(P,k,n)}const aI=function(s,e){return{x(n){return s+s+e-n},setWidth(n){e=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,c){return n-c},leftForLtr(n,c){return n-c}}},lI=function(){return{x(s){return s},setWidth(s){},textAlign(s){return s},xPlus(s,e){return s+e},leftForLtr(s,e){return s}}};function cc(s,e,n){return s?aI(e,n):lI()}function d1(s,e){let n,c;(e==="ltr"||e==="rtl")&&(n=s.canvas.style,c=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),s.prevTextDirection=c)}function f1(s,e){e!==void 0&&(delete s.prevTextDirection,s.canvas.style.setProperty("direction",e[0],e[1]))}function p1(s){return s==="angle"?{between:Pu,compare:ck,normalize:An}:{between:so,compare:(e,n)=>e-n,normalize:e=>e}}function db({start:s,end:e,count:n,loop:c,style:h}){return{start:s%n,end:e%n,loop:c&&(e-s+1)%n===0,style:h}}function cI(s,e,n){const{property:c,start:h,end:p}=n,{between:f,normalize:a}=p1(c),w=e.length;let{start:P,end:k,loop:E}=s,F,R;if(E){for(P+=w,k+=w,F=0,R=w;F<R&&f(a(e[P%w][c]),h,p);++F)P--,k--;P%=w,k%=w}return k<P&&(k+=w),{start:P,end:k,loop:E,style:s.style}}function m1(s,e,n){if(!n)return[s];const{property:c,start:h,end:p}=n,f=e.length,{compare:a,between:w,normalize:P}=p1(c),{start:k,end:E,loop:F,style:R}=cI(s,e,n),J=[];let rt=!1,mt=null,xt,Ct,Lt;const At=()=>w(h,Lt,xt)&&a(h,Lt)!==0,Vt=()=>a(p,xt)===0||w(p,Lt,xt),Yt=()=>rt||At(),Gt=()=>!rt||Vt();for(let ie=k,be=k;ie<=E;++ie)Ct=e[ie%f],!Ct.skip&&(xt=P(Ct[c]),xt!==Lt&&(rt=w(xt,h,p),mt===null&&Yt()&&(mt=a(xt,h)===0?ie:be),mt!==null&&Gt()&&(J.push(db({start:mt,end:ie,loop:F,count:f,style:R})),mt=null),be=ie,Lt=xt));return mt!==null&&J.push(db({start:mt,end:E,loop:F,count:f,style:R})),J}function g1(s,e){const n=[],c=s.segments;for(let h=0;h<c.length;h++){const p=m1(c[h],s.points,e);p.length&&n.push(...p)}return n}function hI(s,e,n,c){let h=0,p=e-1;if(n&&!c)for(;h<e&&!s[h].skip;)h++;for(;h<e&&s[h].skip;)h++;for(h%=e,n&&(p+=h);p>h&&s[p%e].skip;)p--;return p%=e,{start:h,end:p}}function uI(s,e,n,c){const h=s.length,p=[];let f=e,a=s[e],w;for(w=e+1;w<=n;++w){const P=s[w%h];P.skip||P.stop?a.skip||(c=!1,p.push({start:e%h,end:(w-1)%h,loop:c}),e=f=P.stop?w:null):(f=w,a.skip&&(e=w)),a=P}return f!==null&&p.push({start:e%h,end:f%h,loop:c}),p}function dI(s,e){const n=s.points,c=s.options.spanGaps,h=n.length;if(!h)return[];const p=!!s._loop,{start:f,end:a}=hI(n,h,p,c);if(c===!0)return fb(s,[{start:f,end:a,loop:p}],n,e);const w=a<f?a+h:a,P=!!s._fullLoop&&f===0&&a===h-1;return fb(s,uI(n,f,w,P),n,e)}function fb(s,e,n,c){return!c||!c.setContext||!n?e:fI(s,e,n,c)}function fI(s,e,n,c){const h=s._chart.getContext(),p=pb(s.options),{_datasetIndex:f,options:{spanGaps:a}}=s,w=n.length,P=[];let k=p,E=e[0].start,F=E;function R(J,rt,mt,xt){const Ct=a?-1:1;if(J!==rt){for(J+=w;n[J%w].skip;)J-=Ct;for(;n[rt%w].skip;)rt+=Ct;J%w!==rt%w&&(P.push({start:J%w,end:rt%w,loop:mt,style:xt}),k=xt,E=rt%w)}}for(const J of e){E=a?E:J.start;let rt=n[E%w],mt;for(F=E+1;F<=J.end;F++){const xt=n[F%w];mt=pb(c.setContext(Qo(h,{type:"segment",p0:rt,p1:xt,p0DataIndex:(F-1)%w,p1DataIndex:F%w,datasetIndex:f}))),pI(mt,k)&&R(E,F-1,J.loop,k),rt=xt,k=mt}E<F-1&&R(E,F-1,J.loop,k)}return P}function pb(s){return{backgroundColor:s.backgroundColor,borderCapStyle:s.borderCapStyle,borderDash:s.borderDash,borderDashOffset:s.borderDashOffset,borderJoinStyle:s.borderJoinStyle,borderWidth:s.borderWidth,borderColor:s.borderColor}}function pI(s,e){if(!e)return!1;const n=[],c=function(h,p){return r_(p)?(n.includes(p)||n.push(p),n.indexOf(p)):p};return JSON.stringify(s,c)!==JSON.stringify(e,c)}/*!
 * Chart.js v4.4.7
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class mI{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,n,c,h){const p=n.listeners[h],f=n.duration;p.forEach(a=>a({chart:e,initial:n.initial,numSteps:f,currentStep:Math.min(c-n.start,f)}))}_refresh(){this._request||(this._running=!0,this._request=Q0.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let n=0;this._charts.forEach((c,h)=>{if(!c.running||!c.items.length)return;const p=c.items;let f=p.length-1,a=!1,w;for(;f>=0;--f)w=p[f],w._active?(w._total>c.duration&&(c.duration=w._total),w.tick(e),a=!0):(p[f]=p[p.length-1],p.pop());a&&(h.draw(),this._notify(h,c,e,"progress")),p.length||(c.running=!1,this._notify(h,c,e,"complete"),c.initial=!1),n+=p.length}),this._lastDate=e,n===0&&(this._running=!1)}_getAnims(e){const n=this._charts;let c=n.get(e);return c||(c={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(e,c)),c}listen(e,n,c){this._getAnims(e).listeners[n].push(c)}add(e,n){!n||!n.length||this._getAnims(e).items.push(...n)}has(e){return this._getAnims(e).items.length>0}start(e){const n=this._charts.get(e);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((c,h)=>Math.max(c,h._duration),0),this._refresh())}running(e){if(!this._running)return!1;const n=this._charts.get(e);return!(!n||!n.running||!n.items.length)}stop(e){const n=this._charts.get(e);if(!n||!n.items.length)return;const c=n.items;let h=c.length-1;for(;h>=0;--h)c[h].cancel();n.items=[],this._notify(e,n,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Wr=new mI;const mb="transparent",gI={boolean(s,e,n){return n>.5?e:s},color(s,e,n){const c=rb(s||mb),h=c.valid&&rb(e||mb);return h&&h.valid?h.mix(c,n).hexString():e},number(s,e,n){return s+(e-s)*n}};class _I{constructor(e,n,c,h){const p=n[c];h=Kh([e.to,h,p,e.from]);const f=Kh([e.from,p,h]);this._active=!0,this._fn=e.fn||gI[e.type||typeof f],this._easing=du[e.easing]||du.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=n,this._prop=c,this._from=f,this._to=h,this._promises=void 0}active(){return this._active}update(e,n,c){if(this._active){this._notify(!1);const h=this._target[this._prop],p=c-this._start,f=this._duration-p;this._start=c,this._duration=Math.floor(Math.max(f,e.duration)),this._total+=p,this._loop=!!e.loop,this._to=Kh([e.to,n,h,e.from]),this._from=Kh([e.from,h,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const n=e-this._start,c=this._duration,h=this._prop,p=this._from,f=this._loop,a=this._to;let w;if(this._active=p!==a&&(f||n<c),!this._active){this._target[h]=a,this._notify(!0);return}if(n<0){this._target[h]=p;return}w=n/c%2,w=f&&w>1?2-w:w,w=this._easing(Math.min(1,Math.max(0,w))),this._target[h]=this._fn(p,a,w)}wait(){const e=this._promises||(this._promises=[]);return new Promise((n,c)=>{e.push({res:n,rej:c})})}_notify(e){const n=e?"res":"rej",c=this._promises||[];for(let h=0;h<c.length;h++)c[h][n]()}}class _1{constructor(e,n){this._chart=e,this._properties=new Map,this.configure(n)}configure(e){if(!ui(e))return;const n=Object.keys(ss.animation),c=this._properties;Object.getOwnPropertyNames(e).forEach(h=>{const p=e[h];if(!ui(p))return;const f={};for(const a of n)f[a]=p[a];(is(p.properties)&&p.properties||[h]).forEach(a=>{(a===h||!c.has(a))&&c.set(a,f)})})}_animateOptions(e,n){const c=n.options,h=xI(e,c);if(!h)return[];const p=this._createAnimations(h,c);return c.$shared&&yI(e.options.$animations,c).then(()=>{e.options=c},()=>{}),p}_createAnimations(e,n){const c=this._properties,h=[],p=e.$animations||(e.$animations={}),f=Object.keys(n),a=Date.now();let w;for(w=f.length-1;w>=0;--w){const P=f[w];if(P.charAt(0)==="$")continue;if(P==="options"){h.push(...this._animateOptions(e,n));continue}const k=n[P];let E=p[P];const F=c.get(P);if(E)if(F&&E.active()){E.update(F,k,a);continue}else E.cancel();if(!F||!F.duration){e[P]=k;continue}p[P]=E=new _I(F,e,P,k),h.push(E)}return h}update(e,n){if(this._properties.size===0){Object.assign(e,n);return}const c=this._createAnimations(e,n);if(c.length)return Wr.add(this._chart,c),!0}}function yI(s,e){const n=[],c=Object.keys(e);for(let h=0;h<c.length;h++){const p=s[c[h]];p&&p.active()&&n.push(p.wait())}return Promise.all(n)}function xI(s,e){if(!e)return;let n=s.options;if(!n){s.options=e;return}return n.$shared&&(s.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function gb(s,e){const n=s&&s.options||{},c=n.reverse,h=n.min===void 0?e:0,p=n.max===void 0?e:0;return{start:c?p:h,end:c?h:p}}function bI(s,e,n){if(n===!1)return!1;const c=gb(s,n),h=gb(e,n);return{top:h.end,right:c.end,bottom:h.start,left:c.start}}function vI(s){let e,n,c,h;return ui(s)?(e=s.top,n=s.right,c=s.bottom,h=s.left):e=n=c=h=s,{top:e,right:n,bottom:c,left:h,disabled:s===!1}}function y1(s,e){const n=[],c=s._getSortedDatasetMetas(e);let h,p;for(h=0,p=c.length;h<p;++h)n.push(c[h].index);return n}function _b(s,e,n,c={}){const h=s.keys,p=c.mode==="single";let f,a,w,P;if(e===null)return;let k=!1;for(f=0,a=h.length;f<a;++f){if(w=+h[f],w===n){if(k=!0,c.all)continue;break}P=s.values[w],us(P)&&(p||e===0||Sr(e)===Sr(P))&&(e+=P)}return!k&&!c.all?0:e}function wI(s,e){const{iScale:n,vScale:c}=e,h=n.axis==="x"?"x":"y",p=c.axis==="x"?"x":"y",f=Object.keys(s),a=new Array(f.length);let w,P,k;for(w=0,P=f.length;w<P;++w)k=f[w],a[w]={[h]:k,[p]:s[k]};return a}function Um(s,e){const n=s&&s.options.stacked;return n||n===void 0&&e.stack!==void 0}function SI(s,e,n){return`${s.id}.${e.id}.${n.stack||n.type}`}function TI(s){const{min:e,max:n,minDefined:c,maxDefined:h}=s.getUserBounds();return{min:c?e:Number.NEGATIVE_INFINITY,max:h?n:Number.POSITIVE_INFINITY}}function MI(s,e,n){const c=s[e]||(s[e]={});return c[n]||(c[n]={})}function yb(s,e,n,c){for(const h of e.getMatchingVisibleMetas(c).reverse()){const p=s[h.index];if(n&&p>0||!n&&p<0)return h.index}return null}function xb(s,e){const{chart:n,_cachedMeta:c}=s,h=n._stacks||(n._stacks={}),{iScale:p,vScale:f,index:a}=c,w=p.axis,P=f.axis,k=SI(p,f,c),E=e.length;let F;for(let R=0;R<E;++R){const J=e[R],{[w]:rt,[P]:mt}=J,xt=J._stacks||(J._stacks={});F=xt[P]=MI(h,k,rt),F[a]=mt,F._top=yb(F,f,!0,c.type),F._bottom=yb(F,f,!1,c.type);const Ct=F._visualValues||(F._visualValues={});Ct[a]=mt}}function Hm(s,e){const n=s.scales;return Object.keys(n).filter(c=>n[c].axis===e).shift()}function PI(s,e){return Qo(s,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function CI(s,e,n){return Qo(s,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}function $h(s,e){const n=s.controller.index,c=s.vScale&&s.vScale.axis;if(c){e=e||s._parsed;for(const h of e){const p=h._stacks;if(!p||p[c]===void 0||p[c][n]===void 0)return;delete p[c][n],p[c]._visualValues!==void 0&&p[c]._visualValues[n]!==void 0&&delete p[c]._visualValues[n]}}}const Zm=s=>s==="reset"||s==="none",bb=(s,e)=>e?s:Object.assign({},s),kI=(s,e,n)=>s&&!e.hidden&&e._stacked&&{keys:y1(n,!0),values:null};class rr{constructor(e,n){this.chart=e,this._ctx=e.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Um(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&$h(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,n=this._cachedMeta,c=this.getDataset(),h=(E,F,R,J)=>E==="x"?F:E==="r"?J:R,p=n.xAxisID=ti(c.xAxisID,Hm(e,"x")),f=n.yAxisID=ti(c.yAxisID,Hm(e,"y")),a=n.rAxisID=ti(c.rAxisID,Hm(e,"r")),w=n.indexAxis,P=n.iAxisID=h(w,p,f,a),k=n.vAxisID=h(w,f,p,a);n.xScale=this.getScaleForId(p),n.yScale=this.getScaleForId(f),n.rScale=this.getScaleForId(a),n.iScale=this.getScaleForId(P),n.vScale=this.getScaleForId(k)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const n=this._cachedMeta;return e===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&ib(this._data,this),e._stacked&&$h(e)}_dataCheck(){const e=this.getDataset(),n=e.data||(e.data=[]),c=this._data;if(ui(n)){const h=this._cachedMeta;this._data=wI(n,h)}else if(c!==n){if(c){ib(c,this);const h=this._cachedMeta;$h(h),h._parsed=[]}n&&Object.isExtensible(n)&&fk(n,this),this._syncList=[],this._data=n}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const n=this._cachedMeta,c=this.getDataset();let h=!1;this._dataCheck();const p=n._stacked;n._stacked=Um(n.vScale,n),n.stack!==c.stack&&(h=!0,$h(n),n.stack=c.stack),this._resyncElements(e),(h||p!==n._stacked)&&(xb(this,n._parsed),n._stacked=Um(n.vScale,n))}configure(){const e=this.chart.config,n=e.datasetScopeKeys(this._type),c=e.getOptionScopes(this.getDataset(),n,!0);this.options=e.createResolver(c,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,n){const{_cachedMeta:c,_data:h}=this,{iScale:p,_stacked:f}=c,a=p.axis;let w=e===0&&n===h.length?!0:c._sorted,P=e>0&&c._parsed[e-1],k,E,F;if(this._parsing===!1)c._parsed=h,c._sorted=!0,F=h;else{is(h[e])?F=this.parseArrayData(c,h,e,n):ui(h[e])?F=this.parseObjectData(c,h,e,n):F=this.parsePrimitiveData(c,h,e,n);const R=()=>E[a]===null||P&&E[a]<P[a];for(k=0;k<n;++k)c._parsed[k+e]=E=F[k],w&&(R()&&(w=!1),P=E);c._sorted=w}f&&xb(this,F)}parsePrimitiveData(e,n,c,h){const{iScale:p,vScale:f}=e,a=p.axis,w=f.axis,P=p.getLabels(),k=p===f,E=new Array(h);let F,R,J;for(F=0,R=h;F<R;++F)J=F+c,E[F]={[a]:k||p.parse(P[J],J),[w]:f.parse(n[J],J)};return E}parseArrayData(e,n,c,h){const{xScale:p,yScale:f}=e,a=new Array(h);let w,P,k,E;for(w=0,P=h;w<P;++w)k=w+c,E=n[k],a[w]={x:p.parse(E[0],k),y:f.parse(E[1],k)};return a}parseObjectData(e,n,c,h){const{xScale:p,yScale:f}=e,{xAxisKey:a="x",yAxisKey:w="y"}=this._parsing,P=new Array(h);let k,E,F,R;for(k=0,E=h;k<E;++k)F=k+c,R=n[F],P[k]={x:p.parse(Xo(R,a),F),y:f.parse(Xo(R,w),F)};return P}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,n,c){const h=this.chart,p=this._cachedMeta,f=n[e.axis],a={keys:y1(h,!0),values:n._stacks[e.axis]._visualValues};return _b(a,f,p.index,{mode:c})}updateRangeFromParsed(e,n,c,h){const p=c[n.axis];let f=p===null?NaN:p;const a=h&&c._stacks[n.axis];h&&a&&(h.values=a,f=_b(h,p,this._cachedMeta.index)),e.min=Math.min(e.min,f),e.max=Math.max(e.max,f)}getMinMax(e,n){const c=this._cachedMeta,h=c._parsed,p=c._sorted&&e===c.iScale,f=h.length,a=this._getOtherScale(e),w=kI(n,c,this.chart),P={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:k,max:E}=TI(a);let F,R;function J(){R=h[F];const rt=R[a.axis];return!us(R[e.axis])||k>rt||E<rt}for(F=0;F<f&&!(!J()&&(this.updateRangeFromParsed(P,e,R,w),p));++F);if(p){for(F=f-1;F>=0;--F)if(!J()){this.updateRangeFromParsed(P,e,R,w);break}}return P}getAllParsedValues(e){const n=this._cachedMeta._parsed,c=[];let h,p,f;for(h=0,p=n.length;h<p;++h)f=n[h][e.axis],us(f)&&c.push(f);return c}getMaxOverflow(){return!1}getLabelAndValue(e){const n=this._cachedMeta,c=n.iScale,h=n.vScale,p=this.getParsed(e);return{label:c?""+c.getLabelForValue(p[c.axis]):"",value:h?""+h.getLabelForValue(p[h.axis]):""}}_update(e){const n=this._cachedMeta;this.update(e||"default"),n._clip=vI(ti(this.options.clip,bI(n.xScale,n.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,n=this.chart,c=this._cachedMeta,h=c.data||[],p=n.chartArea,f=[],a=this._drawStart||0,w=this._drawCount||h.length-a,P=this.options.drawActiveElementsOnTop;let k;for(c.dataset&&c.dataset.draw(e,p,a,w),k=a;k<a+w;++k){const E=h[k];E.hidden||(E.active&&P?f.push(E):E.draw(e,p))}for(k=0;k<f.length;++k)f[k].draw(e,p)}getStyle(e,n){const c=n?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(c):this.resolveDataElementOptions(e||0,c)}getContext(e,n,c){const h=this.getDataset();let p;if(e>=0&&e<this._cachedMeta.data.length){const f=this._cachedMeta.data[e];p=f.$context||(f.$context=CI(this.getContext(),e,f)),p.parsed=this.getParsed(e),p.raw=h.data[e],p.index=p.dataIndex=e}else p=this.$context||(this.$context=PI(this.chart.getContext(),this.index)),p.dataset=h,p.index=p.datasetIndex=this.index;return p.active=!!n,p.mode=c,p}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,n){return this._resolveElementOptions(this.dataElementType.id,n,e)}_resolveElementOptions(e,n="default",c){const h=n==="active",p=this._cachedDataOpts,f=e+"-"+n,a=p[f],w=this.enableOptionSharing&&Mu(c);if(a)return bb(a,w);const P=this.chart.config,k=P.datasetElementScopeKeys(this._type,e),E=h?[`${e}Hover`,"hover",e,""]:[e,""],F=P.getOptionScopes(this.getDataset(),k),R=Object.keys(ss.elements[e]),J=()=>this.getContext(c,h,n),rt=P.resolveNamedOptions(F,R,J,E);return rt.$shared&&(rt.$shared=w,p[f]=Object.freeze(bb(rt,w))),rt}_resolveAnimations(e,n,c){const h=this.chart,p=this._cachedDataOpts,f=`animation-${n}`,a=p[f];if(a)return a;let w;if(h.options.animation!==!1){const k=this.chart.config,E=k.datasetAnimationScopeKeys(this._type,n),F=k.getOptionScopes(this.getDataset(),E);w=k.createResolver(F,this.getContext(e,c,n))}const P=new _1(h,w&&w.animations);return w&&w._cacheable&&(p[f]=Object.freeze(P)),P}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,n){return!n||Zm(e)||this.chart._animationsDisabled}_getSharedOptions(e,n){const c=this.resolveDataElementOptions(e,n),h=this._sharedOptions,p=this.getSharedOptions(c),f=this.includeOptions(n,p)||p!==h;return this.updateSharedOptions(p,n,c),{sharedOptions:p,includeOptions:f}}updateElement(e,n,c,h){Zm(h)?Object.assign(e,c):this._resolveAnimations(n,h).update(e,c)}updateSharedOptions(e,n,c){e&&!Zm(n)&&this._resolveAnimations(void 0,n).update(e,c)}_setStyle(e,n,c,h){e.active=h;const p=this.getStyle(n,h);this._resolveAnimations(n,c,h).update(e,{options:!h&&this.getSharedOptions(p)||p})}removeHoverStyle(e,n,c){this._setStyle(e,c,"active",!1)}setHoverStyle(e,n,c){this._setStyle(e,c,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const n=this._data,c=this._cachedMeta.data;for(const[a,w,P]of this._syncList)this[a](w,P);this._syncList=[];const h=c.length,p=n.length,f=Math.min(p,h);f&&this.parse(0,f),p>h?this._insertElements(h,p-h,e):p<h&&this._removeElements(p,h-p)}_insertElements(e,n,c=!0){const h=this._cachedMeta,p=h.data,f=e+n;let a;const w=P=>{for(P.length+=n,a=P.length-1;a>=f;a--)P[a]=P[a-n]};for(w(p),a=e;a<f;++a)p[a]=new this.dataElementType;this._parsing&&w(h._parsed),this.parse(e,n),c&&this.updateElements(p,e,n,"reset")}updateElements(e,n,c,h){}_removeElements(e,n){const c=this._cachedMeta;if(this._parsing){const h=c._parsed.splice(e,n);c._stacked&&$h(c,h)}c.data.splice(e,n)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[n,c,h]=e;this[n](c,h)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,n){n&&this._sync(["_removeElements",e,n]);const c=arguments.length-2;c&&this._sync(["_insertElements",e,c])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}_e(rr,"defaults",{}),_e(rr,"datasetElementType",null),_e(rr,"dataElementType",null);function II(s,e){if(!s._cache.$bar){const n=s.getMatchingVisibleMetas(e);let c=[];for(let h=0,p=n.length;h<p;h++)c=c.concat(n[h].controller.getAllParsedValues(s));s._cache.$bar=J0(c.sort((h,p)=>h-p))}return s._cache.$bar}function DI(s){const e=s.iScale,n=II(e,s.type);let c=e._length,h,p,f,a;const w=()=>{f===32767||f===-32768||(Mu(a)&&(c=Math.min(c,Math.abs(f-a)||c)),a=f)};for(h=0,p=n.length;h<p;++h)f=e.getPixelForValue(n[h]),w();for(a=void 0,h=0,p=e.ticks.length;h<p;++h)f=e.getPixelForTick(h),w();return c}function AI(s,e,n,c){const h=n.barThickness;let p,f;return pi(h)?(p=e.min*n.categoryPercentage,f=n.barPercentage):(p=h*c,f=1),{chunk:p/c,ratio:f,start:e.pixels[s]-p/2}}function EI(s,e,n,c){const h=e.pixels,p=h[s];let f=s>0?h[s-1]:null,a=s<h.length-1?h[s+1]:null;const w=n.categoryPercentage;f===null&&(f=p-(a===null?e.end-e.start:a-p)),a===null&&(a=p+p-f);const P=p-(p-Math.min(f,a))/2*w;return{chunk:Math.abs(a-f)/2*w/c,ratio:n.barPercentage,start:P}}function zI(s,e,n,c){const h=n.parse(s[0],c),p=n.parse(s[1],c),f=Math.min(h,p),a=Math.max(h,p);let w=f,P=a;Math.abs(f)>Math.abs(a)&&(w=a,P=f),e[n.axis]=P,e._custom={barStart:w,barEnd:P,start:h,end:p,min:f,max:a}}function x1(s,e,n,c){return is(s)?zI(s,e,n,c):e[n.axis]=n.parse(s,c),e}function vb(s,e,n,c){const h=s.iScale,p=s.vScale,f=h.getLabels(),a=h===p,w=[];let P,k,E,F;for(P=n,k=n+c;P<k;++P)F=e[P],E={},E[h.axis]=a||h.parse(f[P],P),w.push(x1(F,E,p,P));return w}function Gm(s){return s&&s.barStart!==void 0&&s.barEnd!==void 0}function RI(s,e,n){return s!==0?Sr(s):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}function LI(s){let e,n,c,h,p;return s.horizontal?(e=s.base>s.x,n="left",c="right"):(e=s.base<s.y,n="bottom",c="top"),e?(h="end",p="start"):(h="start",p="end"),{start:n,end:c,reverse:e,top:h,bottom:p}}function FI(s,e,n,c){let h=e.borderSkipped;const p={};if(!h){s.borderSkipped=p;return}if(h===!0){s.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:f,end:a,reverse:w,top:P,bottom:k}=LI(s);h==="middle"&&n&&(s.enableBorderRadius=!0,(n._top||0)===c?h=P:(n._bottom||0)===c?h=k:(p[wb(k,f,a,w)]=!0,h=P)),p[wb(h,f,a,w)]=!0,s.borderSkipped=p}function wb(s,e,n,c){return c?(s=OI(s,e,n),s=Sb(s,n,e)):s=Sb(s,e,n),s}function OI(s,e,n){return s===e?n:s===n?e:s}function Sb(s,e,n){return s==="start"?e:s==="end"?n:s}function BI(s,{inflateAmount:e},n){s.inflateAmount=e==="auto"?n===1?.33:0:e}class If extends rr{parsePrimitiveData(e,n,c,h){return vb(e,n,c,h)}parseArrayData(e,n,c,h){return vb(e,n,c,h)}parseObjectData(e,n,c,h){const{iScale:p,vScale:f}=e,{xAxisKey:a="x",yAxisKey:w="y"}=this._parsing,P=p.axis==="x"?a:w,k=f.axis==="x"?a:w,E=[];let F,R,J,rt;for(F=c,R=c+h;F<R;++F)rt=n[F],J={},J[p.axis]=p.parse(Xo(rt,P),F),E.push(x1(Xo(rt,k),J,f,F));return E}updateRangeFromParsed(e,n,c,h){super.updateRangeFromParsed(e,n,c,h);const p=c._custom;p&&n===this._cachedMeta.vScale&&(e.min=Math.min(e.min,p.min),e.max=Math.max(e.max,p.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const n=this._cachedMeta,{iScale:c,vScale:h}=n,p=this.getParsed(e),f=p._custom,a=Gm(f)?"["+f.start+", "+f.end+"]":""+h.getLabelForValue(p[h.axis]);return{label:""+c.getLabelForValue(p[c.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,e)}updateElements(e,n,c,h){const p=h==="reset",{index:f,_cachedMeta:{vScale:a}}=this,w=a.getBasePixel(),P=a.isHorizontal(),k=this._getRuler(),{sharedOptions:E,includeOptions:F}=this._getSharedOptions(n,h);for(let R=n;R<n+c;R++){const J=this.getParsed(R),rt=p||pi(J[a.axis])?{base:w,head:w}:this._calculateBarValuePixels(R),mt=this._calculateBarIndexPixels(R,k),xt=(J._stacks||{})[a.axis],Ct={horizontal:P,base:rt.base,enableBorderRadius:!xt||Gm(J._custom)||f===xt._top||f===xt._bottom,x:P?rt.head:mt.center,y:P?mt.center:rt.head,height:P?mt.size:Math.abs(rt.size),width:P?Math.abs(rt.size):mt.size};F&&(Ct.options=E||this.resolveDataElementOptions(R,e[R].active?"active":h));const Lt=Ct.options||e[R].options;FI(Ct,Lt,xt,f),BI(Ct,Lt,k.ratio),this.updateElement(e[R],R,Ct,h)}}_getStacks(e,n){const{iScale:c}=this._cachedMeta,h=c.getMatchingVisibleMetas(this._type).filter(k=>k.controller.options.grouped),p=c.options.stacked,f=[],a=this._cachedMeta.controller.getParsed(n),w=a&&a[c.axis],P=k=>{const E=k._parsed.find(R=>R[c.axis]===w),F=E&&E[k.vScale.axis];if(pi(F)||isNaN(F))return!0};for(const k of h)if(!(n!==void 0&&P(k))&&((p===!1||f.indexOf(k.stack)===-1||p===void 0&&k.stack===void 0)&&f.push(k.stack),k.index===e))break;return f.length||f.push(void 0),f}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,n,c){const h=this._getStacks(e,c),p=n!==void 0?h.indexOf(n):-1;return p===-1?h.length-1:p}_getRuler(){const e=this.options,n=this._cachedMeta,c=n.iScale,h=[];let p,f;for(p=0,f=n.data.length;p<f;++p)h.push(c.getPixelForValue(this.getParsed(p)[c.axis],p));const a=e.barThickness;return{min:a||DI(n),pixels:h,start:c._startPixel,end:c._endPixel,stackCount:this._getStackCount(),scale:c,grouped:e.grouped,ratio:a?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:n,_stacked:c,index:h},options:{base:p,minBarLength:f}}=this,a=p||0,w=this.getParsed(e),P=w._custom,k=Gm(P);let E=w[n.axis],F=0,R=c?this.applyStack(n,w,c):E,J,rt;R!==E&&(F=R-E,R=E),k&&(E=P.barStart,R=P.barEnd-P.barStart,E!==0&&Sr(E)!==Sr(P.barEnd)&&(F=0),F+=E);const mt=!pi(p)&&!k?p:F;let xt=n.getPixelForValue(mt);if(this.chart.getDataVisibility(e)?J=n.getPixelForValue(F+R):J=xt,rt=J-xt,Math.abs(rt)<f){rt=RI(rt,n,a)*f,E===a&&(xt-=rt/2);const Ct=n.getPixelForDecimal(0),Lt=n.getPixelForDecimal(1),At=Math.min(Ct,Lt),Vt=Math.max(Ct,Lt);xt=Math.max(Math.min(xt,Vt),At),J=xt+rt,c&&!k&&(w._stacks[n.axis]._visualValues[h]=n.getValueForPixel(J)-n.getValueForPixel(xt))}if(xt===n.getPixelForValue(a)){const Ct=Sr(rt)*n.getLineWidthForValue(a)/2;xt+=Ct,rt-=Ct}return{size:rt,base:xt,head:J,center:J+rt/2}}_calculateBarIndexPixels(e,n){const c=n.scale,h=this.options,p=h.skipNull,f=ti(h.maxBarThickness,1/0);let a,w;if(n.grouped){const P=p?this._getStackCount(e):n.stackCount,k=h.barThickness==="flex"?EI(e,n,h,P):AI(e,n,h,P),E=this._getStackIndex(this.index,this._cachedMeta.stack,p?e:void 0);a=k.start+k.chunk*E+k.chunk/2,w=Math.min(f,k.chunk*k.ratio)}else a=c.getPixelForValue(this.getParsed(e)[c.axis],e),w=Math.min(f,n.min*n.ratio);return{base:a-w/2,head:a+w/2,center:a,size:w}}draw(){const e=this._cachedMeta,n=e.vScale,c=e.data,h=c.length;let p=0;for(;p<h;++p)this.getParsed(p)[n.axis]!==null&&!c[p].hidden&&c[p].draw(this._ctx)}}_e(If,"id","bar"),_e(If,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),_e(If,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Df extends rr{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,n,c,h){const p=super.parsePrimitiveData(e,n,c,h);for(let f=0;f<p.length;f++)p[f]._custom=this.resolveDataElementOptions(f+c).radius;return p}parseArrayData(e,n,c,h){const p=super.parseArrayData(e,n,c,h);for(let f=0;f<p.length;f++){const a=n[c+f];p[f]._custom=ti(a[2],this.resolveDataElementOptions(f+c).radius)}return p}parseObjectData(e,n,c,h){const p=super.parseObjectData(e,n,c,h);for(let f=0;f<p.length;f++){const a=n[c+f];p[f]._custom=ti(a&&a.r&&+a.r,this.resolveDataElementOptions(f+c).radius)}return p}getMaxOverflow(){const e=this._cachedMeta.data;let n=0;for(let c=e.length-1;c>=0;--c)n=Math.max(n,e[c].size(this.resolveDataElementOptions(c))/2);return n>0&&n}getLabelAndValue(e){const n=this._cachedMeta,c=this.chart.data.labels||[],{xScale:h,yScale:p}=n,f=this.getParsed(e),a=h.getLabelForValue(f.x),w=p.getLabelForValue(f.y),P=f._custom;return{label:c[e]||"",value:"("+a+", "+w+(P?", "+P:"")+")"}}update(e){const n=this._cachedMeta.data;this.updateElements(n,0,n.length,e)}updateElements(e,n,c,h){const p=h==="reset",{iScale:f,vScale:a}=this._cachedMeta,{sharedOptions:w,includeOptions:P}=this._getSharedOptions(n,h),k=f.axis,E=a.axis;for(let F=n;F<n+c;F++){const R=e[F],J=!p&&this.getParsed(F),rt={},mt=rt[k]=p?f.getPixelForDecimal(.5):f.getPixelForValue(J[k]),xt=rt[E]=p?a.getBasePixel():a.getPixelForValue(J[E]);rt.skip=isNaN(mt)||isNaN(xt),P&&(rt.options=w||this.resolveDataElementOptions(F,R.active?"active":h),p&&(rt.options.radius=0)),this.updateElement(R,F,rt,h)}}resolveDataElementOptions(e,n){const c=this.getParsed(e);let h=super.resolveDataElementOptions(e,n);h.$shared&&(h=Object.assign({},h,{$shared:!1}));const p=h.radius;return n!=="active"&&(h.radius=0),h.radius+=ti(c&&c._custom,p),h}}_e(Df,"id","bubble"),_e(Df,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),_e(Df,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function jI(s,e,n){let c=1,h=1,p=0,f=0;if(e<Ki){const a=s,w=a+e,P=Math.cos(a),k=Math.sin(a),E=Math.cos(w),F=Math.sin(w),R=(Lt,At,Vt)=>Pu(Lt,a,w,!0)?1:Math.max(At,At*n,Vt,Vt*n),J=(Lt,At,Vt)=>Pu(Lt,a,w,!0)?-1:Math.min(At,At*n,Vt,Vt*n),rt=R(0,P,E),mt=R(ys,k,F),xt=J(Ji,P,E),Ct=J(Ji+ys,k,F);c=(rt-xt)/2,h=(mt-Ct)/2,p=-(rt+xt)/2,f=-(mt+Ct)/2}return{ratioX:c,ratioY:h,offsetX:p,offsetY:f}}class Ua extends rr{constructor(e,n){super(e,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,n){const c=this.getDataset().data,h=this._cachedMeta;if(this._parsing===!1)h._parsed=c;else{let p=w=>+c[w];if(ui(c[e])){const{key:w="value"}=this._parsing;p=P=>+Xo(c[P],w)}let f,a;for(f=e,a=e+n;f<a;++f)h._parsed[f]=p(f)}}_getRotation(){return ir(this.options.rotation-90)}_getCircumference(){return ir(this.options.circumference)}_getRotationExtents(){let e=Ki,n=-Ki;for(let c=0;c<this.chart.data.datasets.length;++c)if(this.chart.isDatasetVisible(c)&&this.chart.getDatasetMeta(c).type===this._type){const h=this.chart.getDatasetMeta(c).controller,p=h._getRotation(),f=h._getCircumference();e=Math.min(e,p),n=Math.max(n,p+f)}return{rotation:e,circumference:n-e}}update(e){const n=this.chart,{chartArea:c}=n,h=this._cachedMeta,p=h.data,f=this.getMaxBorderWidth()+this.getMaxOffset(p)+this.options.spacing,a=Math.max((Math.min(c.width,c.height)-f)/2,0),w=Math.min(QC(this.options.cutout,a),1),P=this._getRingWeight(this.index),{circumference:k,rotation:E}=this._getRotationExtents(),{ratioX:F,ratioY:R,offsetX:J,offsetY:rt}=jI(E,k,w),mt=(c.width-f)/F,xt=(c.height-f)/R,Ct=Math.max(Math.min(mt,xt)/2,0),Lt=q0(this.options.radius,Ct),At=Math.max(Lt*w,0),Vt=(Lt-At)/this._getVisibleDatasetWeightTotal();this.offsetX=J*Lt,this.offsetY=rt*Lt,h.total=this.calculateTotal(),this.outerRadius=Lt-Vt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Vt*P,0),this.updateElements(p,0,p.length,e)}_circumference(e,n){const c=this.options,h=this._cachedMeta,p=this._getCircumference();return n&&c.animation.animateRotate||!this.chart.getDataVisibility(e)||h._parsed[e]===null||h.data[e].hidden?0:this.calculateCircumference(h._parsed[e]*p/Ki)}updateElements(e,n,c,h){const p=h==="reset",f=this.chart,a=f.chartArea,P=f.options.animation,k=(a.left+a.right)/2,E=(a.top+a.bottom)/2,F=p&&P.animateScale,R=F?0:this.innerRadius,J=F?0:this.outerRadius,{sharedOptions:rt,includeOptions:mt}=this._getSharedOptions(n,h);let xt=this._getRotation(),Ct;for(Ct=0;Ct<n;++Ct)xt+=this._circumference(Ct,p);for(Ct=n;Ct<n+c;++Ct){const Lt=this._circumference(Ct,p),At=e[Ct],Vt={x:k+this.offsetX,y:E+this.offsetY,startAngle:xt,endAngle:xt+Lt,circumference:Lt,outerRadius:J,innerRadius:R};mt&&(Vt.options=rt||this.resolveDataElementOptions(Ct,At.active?"active":h)),xt+=Lt,this.updateElement(At,Ct,Vt,h)}}calculateTotal(){const e=this._cachedMeta,n=e.data;let c=0,h;for(h=0;h<n.length;h++){const p=e._parsed[h];p!==null&&!isNaN(p)&&this.chart.getDataVisibility(h)&&!n[h].hidden&&(c+=Math.abs(p))}return c}calculateCircumference(e){const n=this._cachedMeta.total;return n>0&&!isNaN(e)?Ki*(Math.abs(e)/n):0}getLabelAndValue(e){const n=this._cachedMeta,c=this.chart,h=c.data.labels||[],p=Lu(n._parsed[e],c.options.locale);return{label:h[e]||"",value:p}}getMaxBorderWidth(e){let n=0;const c=this.chart;let h,p,f,a,w;if(!e){for(h=0,p=c.data.datasets.length;h<p;++h)if(c.isDatasetVisible(h)){f=c.getDatasetMeta(h),e=f.data,a=f.controller;break}}if(!e)return 0;for(h=0,p=e.length;h<p;++h)w=a.resolveDataElementOptions(h),w.borderAlign!=="inner"&&(n=Math.max(n,w.borderWidth||0,w.hoverBorderWidth||0));return n}getMaxOffset(e){let n=0;for(let c=0,h=e.length;c<h;++c){const p=this.resolveDataElementOptions(c);n=Math.max(n,p.offset||0,p.hoverOffset||0)}return n}_getRingWeightOffset(e){let n=0;for(let c=0;c<e;++c)this.chart.isDatasetVisible(c)&&(n+=this._getRingWeight(c));return n}_getRingWeight(e){return Math.max(ti(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}_e(Ua,"id","doughnut"),_e(Ua,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),_e(Ua,"descriptors",{_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")}),_e(Ua,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const n=e.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:c,color:h}}=e.legend.options;return n.labels.map((p,f)=>{const w=e.getDatasetMeta(0).controller.getStyle(f);return{text:p,fillStyle:w.backgroundColor,strokeStyle:w.borderColor,fontColor:h,lineWidth:w.borderWidth,pointStyle:c,hidden:!e.getDataVisibility(f),index:f}})}return[]}},onClick(e,n,c){c.chart.toggleDataVisibility(n.index),c.chart.update()}}}});class Af extends rr{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const n=this._cachedMeta,{dataset:c,data:h=[],_dataset:p}=n,f=this.chart._animationsDisabled;let{start:a,count:w}=e1(n,h,f);this._drawStart=a,this._drawCount=w,i1(n)&&(a=0,w=h.length),c._chart=this.chart,c._datasetIndex=this.index,c._decimated=!!p._decimated,c.points=h;const P=this.resolveDatasetElementOptions(e);this.options.showLine||(P.borderWidth=0),P.segment=this.options.segment,this.updateElement(c,void 0,{animated:!f,options:P},e),this.updateElements(h,a,w,e)}updateElements(e,n,c,h){const p=h==="reset",{iScale:f,vScale:a,_stacked:w,_dataset:P}=this._cachedMeta,{sharedOptions:k,includeOptions:E}=this._getSharedOptions(n,h),F=f.axis,R=a.axis,{spanGaps:J,segment:rt}=this.options,mt=pc(J)?J:Number.POSITIVE_INFINITY,xt=this.chart._animationsDisabled||p||h==="none",Ct=n+c,Lt=e.length;let At=n>0&&this.getParsed(n-1);for(let Vt=0;Vt<Lt;++Vt){const Yt=e[Vt],Gt=xt?Yt:{};if(Vt<n||Vt>=Ct){Gt.skip=!0;continue}const ie=this.getParsed(Vt),be=pi(ie[R]),ze=Gt[F]=f.getPixelForValue(ie[F],Vt),Me=Gt[R]=p||be?a.getBasePixel():a.getPixelForValue(w?this.applyStack(a,ie,w):ie[R],Vt);Gt.skip=isNaN(ze)||isNaN(Me)||be,Gt.stop=Vt>0&&Math.abs(ie[F]-At[F])>mt,rt&&(Gt.parsed=ie,Gt.raw=P.data[Vt]),E&&(Gt.options=k||this.resolveDataElementOptions(Vt,Yt.active?"active":h)),xt||this.updateElement(Yt,Vt,Gt,h),At=ie}}getMaxOverflow(){const e=this._cachedMeta,n=e.dataset,c=n.options&&n.options.borderWidth||0,h=e.data||[];if(!h.length)return c;const p=h[0].size(this.resolveDataElementOptions(0)),f=h[h.length-1].size(this.resolveDataElementOptions(h.length-1));return Math.max(c,p,f)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}_e(Af,"id","line"),_e(Af,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),_e(Af,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class pu extends rr{constructor(e,n){super(e,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const n=this._cachedMeta,c=this.chart,h=c.data.labels||[],p=Lu(n._parsed[e].r,c.options.locale);return{label:h[e]||"",value:p}}parseObjectData(e,n,c,h){return h1.bind(this)(e,n,c,h)}update(e){const n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,e)}getMinMax(){const e=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((c,h)=>{const p=this.getParsed(h).r;!isNaN(p)&&this.chart.getDataVisibility(h)&&(p<n.min&&(n.min=p),p>n.max&&(n.max=p))}),n}_updateRadius(){const e=this.chart,n=e.chartArea,c=e.options,h=Math.min(n.right-n.left,n.bottom-n.top),p=Math.max(h/2,0),f=Math.max(c.cutoutPercentage?p/100*c.cutoutPercentage:1,0),a=(p-f)/e.getVisibleDatasetCount();this.outerRadius=p-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(e,n,c,h){const p=h==="reset",f=this.chart,w=f.options.animation,P=this._cachedMeta.rScale,k=P.xCenter,E=P.yCenter,F=P.getIndexAngle(0)-.5*Ji;let R=F,J;const rt=360/this.countVisibleElements();for(J=0;J<n;++J)R+=this._computeAngle(J,h,rt);for(J=n;J<n+c;J++){const mt=e[J];let xt=R,Ct=R+this._computeAngle(J,h,rt),Lt=f.getDataVisibility(J)?P.getDistanceFromCenterForValue(this.getParsed(J).r):0;R=Ct,p&&(w.animateScale&&(Lt=0),w.animateRotate&&(xt=Ct=F));const At={x:k,y:E,innerRadius:0,outerRadius:Lt,startAngle:xt,endAngle:Ct,options:this.resolveDataElementOptions(J,mt.active?"active":h)};this.updateElement(mt,J,At,h)}}countVisibleElements(){const e=this._cachedMeta;let n=0;return e.data.forEach((c,h)=>{!isNaN(this.getParsed(h).r)&&this.chart.getDataVisibility(h)&&n++}),n}_computeAngle(e,n,c){return this.chart.getDataVisibility(e)?ir(this.resolveDataElementOptions(e,n).angle||c):0}}_e(pu,"id","polarArea"),_e(pu,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),_e(pu,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const n=e.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:c,color:h}}=e.legend.options;return n.labels.map((p,f)=>{const w=e.getDatasetMeta(0).controller.getStyle(f);return{text:p,fillStyle:w.backgroundColor,strokeStyle:w.borderColor,fontColor:h,lineWidth:w.borderWidth,pointStyle:c,hidden:!e.getDataVisibility(f),index:f}})}return[]}},onClick(e,n,c){c.chart.toggleDataVisibility(n.index),c.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class _g extends Ua{}_e(_g,"id","pie"),_e(_g,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Ef extends rr{getLabelAndValue(e){const n=this._cachedMeta.vScale,c=this.getParsed(e);return{label:n.getLabels()[e],value:""+n.getLabelForValue(c[n.axis])}}parseObjectData(e,n,c,h){return h1.bind(this)(e,n,c,h)}update(e){const n=this._cachedMeta,c=n.dataset,h=n.data||[],p=n.iScale.getLabels();if(c.points=h,e!=="resize"){const f=this.resolveDatasetElementOptions(e);this.options.showLine||(f.borderWidth=0);const a={_loop:!0,_fullLoop:p.length===h.length,options:f};this.updateElement(c,void 0,a,e)}this.updateElements(h,0,h.length,e)}updateElements(e,n,c,h){const p=this._cachedMeta.rScale,f=h==="reset";for(let a=n;a<n+c;a++){const w=e[a],P=this.resolveDataElementOptions(a,w.active?"active":h),k=p.getPointPositionForValue(a,this.getParsed(a).r),E=f?p.xCenter:k.x,F=f?p.yCenter:k.y,R={x:E,y:F,angle:k.angle,skip:isNaN(E)||isNaN(F),options:P};this.updateElement(w,a,R,h)}}}_e(Ef,"id","radar"),_e(Ef,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),_e(Ef,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class zf extends rr{getLabelAndValue(e){const n=this._cachedMeta,c=this.chart.data.labels||[],{xScale:h,yScale:p}=n,f=this.getParsed(e),a=h.getLabelForValue(f.x),w=p.getLabelForValue(f.y);return{label:c[e]||"",value:"("+a+", "+w+")"}}update(e){const n=this._cachedMeta,{data:c=[]}=n,h=this.chart._animationsDisabled;let{start:p,count:f}=e1(n,c,h);if(this._drawStart=p,this._drawCount=f,i1(n)&&(p=0,f=c.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:w}=n;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!w._decimated,a.points=c;const P=this.resolveDatasetElementOptions(e);P.segment=this.options.segment,this.updateElement(a,void 0,{animated:!h,options:P},e)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(c,p,f,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,n,c,h){const p=h==="reset",{iScale:f,vScale:a,_stacked:w,_dataset:P}=this._cachedMeta,k=this.resolveDataElementOptions(n,h),E=this.getSharedOptions(k),F=this.includeOptions(h,E),R=f.axis,J=a.axis,{spanGaps:rt,segment:mt}=this.options,xt=pc(rt)?rt:Number.POSITIVE_INFINITY,Ct=this.chart._animationsDisabled||p||h==="none";let Lt=n>0&&this.getParsed(n-1);for(let At=n;At<n+c;++At){const Vt=e[At],Yt=this.getParsed(At),Gt=Ct?Vt:{},ie=pi(Yt[J]),be=Gt[R]=f.getPixelForValue(Yt[R],At),ze=Gt[J]=p||ie?a.getBasePixel():a.getPixelForValue(w?this.applyStack(a,Yt,w):Yt[J],At);Gt.skip=isNaN(be)||isNaN(ze)||ie,Gt.stop=At>0&&Math.abs(Yt[R]-Lt[R])>xt,mt&&(Gt.parsed=Yt,Gt.raw=P.data[At]),F&&(Gt.options=E||this.resolveDataElementOptions(At,Vt.active?"active":h)),Ct||this.updateElement(Vt,At,Gt,h),Lt=Yt}this.updateSharedOptions(E,h,k)}getMaxOverflow(){const e=this._cachedMeta,n=e.data||[];if(!this.options.showLine){let a=0;for(let w=n.length-1;w>=0;--w)a=Math.max(a,n[w].size(this.resolveDataElementOptions(w))/2);return a>0&&a}const c=e.dataset,h=c.options&&c.options.borderWidth||0;if(!n.length)return h;const p=n[0].size(this.resolveDataElementOptions(0)),f=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(h,p,f)/2}}_e(zf,"id","scatter"),_e(zf,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),_e(zf,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var NI=Object.freeze({__proto__:null,BarController:If,BubbleController:Df,DoughnutController:Ua,LineController:Af,PieController:_g,PolarAreaController:pu,RadarController:Ef,ScatterController:zf});function Ba(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class d_{constructor(e){_e(this,"options");this.options=e||{}}static override(e){Object.assign(d_.prototype,e)}init(){}formats(){return Ba()}parse(){return Ba()}format(){return Ba()}add(){return Ba()}diff(){return Ba()}startOf(){return Ba()}endOf(){return Ba()}}var VI={_date:d_};function $I(s,e,n,c){const{controller:h,data:p,_sorted:f}=s,a=h._cachedMeta.iScale;if(a&&e===a.axis&&e!=="r"&&f&&p.length){const w=a._reversePixels?uk:no;if(c){if(h._sharedOptions){const P=p[0],k=typeof P.getRange=="function"&&P.getRange(e);if(k){const E=w(p,e,n-k),F=w(p,e,n+k);return{lo:E.lo,hi:F.hi}}}}else return w(p,e,n)}return{lo:0,hi:p.length-1}}function _p(s,e,n,c,h){const p=s.getSortedVisibleDatasetMetas(),f=n[e];for(let a=0,w=p.length;a<w;++a){const{index:P,data:k}=p[a],{lo:E,hi:F}=$I(p[a],e,f,h);for(let R=E;R<=F;++R){const J=k[R];J.skip||c(J,P,R)}}}function UI(s){const e=s.indexOf("x")!==-1,n=s.indexOf("y")!==-1;return function(c,h){const p=e?Math.abs(c.x-h.x):0,f=n?Math.abs(c.y-h.y):0;return Math.sqrt(Math.pow(p,2)+Math.pow(f,2))}}function qm(s,e,n,c,h){const p=[];return!h&&!s.isPointInArea(e)||_p(s,n,e,function(a,w,P){!h&&!ro(a,s.chartArea,0)||a.inRange(e.x,e.y,c)&&p.push({element:a,datasetIndex:w,index:P})},!0),p}function HI(s,e,n,c){let h=[];function p(f,a,w){const{startAngle:P,endAngle:k}=f.getProps(["startAngle","endAngle"],c),{angle:E}=K0(f,{x:e.x,y:e.y});Pu(E,P,k)&&h.push({element:f,datasetIndex:a,index:w})}return _p(s,n,e,p),h}function ZI(s,e,n,c,h,p){let f=[];const a=UI(n);let w=Number.POSITIVE_INFINITY;function P(k,E,F){const R=k.inRange(e.x,e.y,h);if(c&&!R)return;const J=k.getCenterPoint(h);if(!(!!p||s.isPointInArea(J))&&!R)return;const mt=a(e,J);mt<w?(f=[{element:k,datasetIndex:E,index:F}],w=mt):mt===w&&f.push({element:k,datasetIndex:E,index:F})}return _p(s,n,e,P),f}function Wm(s,e,n,c,h,p){return!p&&!s.isPointInArea(e)?[]:n==="r"&&!c?HI(s,e,n,h):ZI(s,e,n,c,h,p)}function Tb(s,e,n,c,h){const p=[],f=n==="x"?"inXRange":"inYRange";let a=!1;return _p(s,n,e,(w,P,k)=>{w[f]&&w[f](e[n],h)&&(p.push({element:w,datasetIndex:P,index:k}),a=a||w.inRange(e.x,e.y,h))}),c&&!a?[]:p}var GI={modes:{index(s,e,n,c){const h=Va(e,s),p=n.axis||"x",f=n.includeInvisible||!1,a=n.intersect?qm(s,h,p,c,f):Wm(s,h,p,!1,c,f),w=[];return a.length?(s.getSortedVisibleDatasetMetas().forEach(P=>{const k=a[0].index,E=P.data[k];E&&!E.skip&&w.push({element:E,datasetIndex:P.index,index:k})}),w):[]},dataset(s,e,n,c){const h=Va(e,s),p=n.axis||"xy",f=n.includeInvisible||!1;let a=n.intersect?qm(s,h,p,c,f):Wm(s,h,p,!1,c,f);if(a.length>0){const w=a[0].datasetIndex,P=s.getDatasetMeta(w).data;a=[];for(let k=0;k<P.length;++k)a.push({element:P[k],datasetIndex:w,index:k})}return a},point(s,e,n,c){const h=Va(e,s),p=n.axis||"xy",f=n.includeInvisible||!1;return qm(s,h,p,c,f)},nearest(s,e,n,c){const h=Va(e,s),p=n.axis||"xy",f=n.includeInvisible||!1;return Wm(s,h,p,n.intersect,c,f)},x(s,e,n,c){const h=Va(e,s);return Tb(s,h,"x",n.intersect,c)},y(s,e,n,c){const h=Va(e,s);return Tb(s,h,"y",n.intersect,c)}}};const b1=["left","top","right","bottom"];function Uh(s,e){return s.filter(n=>n.pos===e)}function Mb(s,e){return s.filter(n=>b1.indexOf(n.pos)===-1&&n.box.axis===e)}function Hh(s,e){return s.sort((n,c)=>{const h=e?c:n,p=e?n:c;return h.weight===p.weight?h.index-p.index:h.weight-p.weight})}function qI(s){const e=[];let n,c,h,p,f,a;for(n=0,c=(s||[]).length;n<c;++n)h=s[n],{position:p,options:{stack:f,stackWeight:a=1}}=h,e.push({index:n,box:h,pos:p,horizontal:h.isHorizontal(),weight:h.weight,stack:f&&p+f,stackWeight:a});return e}function WI(s){const e={};for(const n of s){const{stack:c,pos:h,stackWeight:p}=n;if(!c||!b1.includes(h))continue;const f=e[c]||(e[c]={count:0,placed:0,weight:0,size:0});f.count++,f.weight+=p}return e}function XI(s,e){const n=WI(s),{vBoxMaxWidth:c,hBoxMaxHeight:h}=e;let p,f,a;for(p=0,f=s.length;p<f;++p){a=s[p];const{fullSize:w}=a.box,P=n[a.stack],k=P&&a.stackWeight/P.weight;a.horizontal?(a.width=k?k*c:w&&e.availableWidth,a.height=h):(a.width=c,a.height=k?k*h:w&&e.availableHeight)}return n}function KI(s){const e=qI(s),n=Hh(e.filter(P=>P.box.fullSize),!0),c=Hh(Uh(e,"left"),!0),h=Hh(Uh(e,"right")),p=Hh(Uh(e,"top"),!0),f=Hh(Uh(e,"bottom")),a=Mb(e,"x"),w=Mb(e,"y");return{fullSize:n,leftAndTop:c.concat(p),rightAndBottom:h.concat(w).concat(f).concat(a),chartArea:Uh(e,"chartArea"),vertical:c.concat(h).concat(w),horizontal:p.concat(f).concat(a)}}function Pb(s,e,n,c){return Math.max(s[n],e[n])+Math.max(s[c],e[c])}function v1(s,e){s.top=Math.max(s.top,e.top),s.left=Math.max(s.left,e.left),s.bottom=Math.max(s.bottom,e.bottom),s.right=Math.max(s.right,e.right)}function YI(s,e,n,c){const{pos:h,box:p}=n,f=s.maxPadding;if(!ui(h)){n.size&&(s[h]-=n.size);const E=c[n.stack]||{size:0,count:1};E.size=Math.max(E.size,n.horizontal?p.height:p.width),n.size=E.size/E.count,s[h]+=n.size}p.getPadding&&v1(f,p.getPadding());const a=Math.max(0,e.outerWidth-Pb(f,s,"left","right")),w=Math.max(0,e.outerHeight-Pb(f,s,"top","bottom")),P=a!==s.w,k=w!==s.h;return s.w=a,s.h=w,n.horizontal?{same:P,other:k}:{same:k,other:P}}function JI(s){const e=s.maxPadding;function n(c){const h=Math.max(e[c]-s[c],0);return s[c]+=h,h}s.y+=n("top"),s.x+=n("left"),n("right"),n("bottom")}function QI(s,e){const n=e.maxPadding;function c(h){const p={left:0,top:0,right:0,bottom:0};return h.forEach(f=>{p[f]=Math.max(e[f],n[f])}),p}return c(s?["left","right"]:["top","bottom"])}function Yh(s,e,n,c){const h=[];let p,f,a,w,P,k;for(p=0,f=s.length,P=0;p<f;++p){a=s[p],w=a.box,w.update(a.width||e.w,a.height||e.h,QI(a.horizontal,e));const{same:E,other:F}=YI(e,n,a,c);P|=E&&h.length,k=k||F,w.fullSize||h.push(a)}return P&&Yh(h,e,n,c)||k}function df(s,e,n,c,h){s.top=n,s.left=e,s.right=e+c,s.bottom=n+h,s.width=c,s.height=h}function Cb(s,e,n,c){const h=n.padding;let{x:p,y:f}=e;for(const a of s){const w=a.box,P=c[a.stack]||{placed:0,weight:1},k=a.stackWeight/P.weight||1;if(a.horizontal){const E=e.w*k,F=P.size||w.height;Mu(P.start)&&(f=P.start),w.fullSize?df(w,h.left,f,n.outerWidth-h.right-h.left,F):df(w,e.left+P.placed,f,E,F),P.start=f,P.placed+=E,f=w.bottom}else{const E=e.h*k,F=P.size||w.width;Mu(P.start)&&(p=P.start),w.fullSize?df(w,p,h.top,F,n.outerHeight-h.bottom-h.top):df(w,p,e.top+P.placed,F,E),P.start=p,P.placed+=E,p=w.right}}e.x=p,e.y=f}var Ws={addBox(s,e){s.boxes||(s.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(n){e.draw(n)}}]},s.boxes.push(e)},removeBox(s,e){const n=s.boxes?s.boxes.indexOf(e):-1;n!==-1&&s.boxes.splice(n,1)},configure(s,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(s,e,n,c){if(!s)return;const h=Ys(s.options.layout.padding),p=Math.max(e-h.width,0),f=Math.max(n-h.height,0),a=KI(s.boxes),w=a.vertical,P=a.horizontal;Ci(s.boxes,rt=>{typeof rt.beforeLayout=="function"&&rt.beforeLayout()});const k=w.reduce((rt,mt)=>mt.box.options&&mt.box.options.display===!1?rt:rt+1,0)||1,E=Object.freeze({outerWidth:e,outerHeight:n,padding:h,availableWidth:p,availableHeight:f,vBoxMaxWidth:p/2/k,hBoxMaxHeight:f/2}),F=Object.assign({},h);v1(F,Ys(c));const R=Object.assign({maxPadding:F,w:p,h:f,x:h.left,y:h.top},h),J=XI(w.concat(P),E);Yh(a.fullSize,R,E,J),Yh(w,R,E,J),Yh(P,R,E,J)&&Yh(w,R,E,J),JI(R),Cb(a.leftAndTop,R,E,J),R.x+=R.w,R.y+=R.h,Cb(a.rightAndBottom,R,E,J),s.chartArea={left:R.left,top:R.top,right:R.left+R.w,bottom:R.top+R.h,height:R.h,width:R.w},Ci(a.chartArea,rt=>{const mt=rt.box;Object.assign(mt,s.chartArea),mt.update(R.w,R.h,{left:0,top:0,right:0,bottom:0})})}};class w1{acquireContext(e,n){}releaseContext(e){return!1}addEventListener(e,n,c){}removeEventListener(e,n,c){}getDevicePixelRatio(){return 1}getMaximumSize(e,n,c,h){return n=Math.max(0,n||e.width),c=c||e.height,{width:n,height:Math.max(0,h?Math.floor(n/h):c)}}isAttached(e){return!0}updateConfig(e){}}class tD extends w1{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Rf="$chartjs",eD={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},kb=s=>s===null||s==="";function iD(s,e){const n=s.style,c=s.getAttribute("height"),h=s.getAttribute("width");if(s[Rf]={initial:{height:c,width:h,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",kb(h)){const p=ub(s,"width");p!==void 0&&(s.width=p)}if(kb(c))if(s.style.height==="")s.height=s.width/(e||2);else{const p=ub(s,"height");p!==void 0&&(s.height=p)}return s}const S1=nI?{passive:!0}:!1;function sD(s,e,n){s&&s.addEventListener(e,n,S1)}function nD(s,e,n){s&&s.canvas&&s.canvas.removeEventListener(e,n,S1)}function rD(s,e){const n=eD[s.type]||s.type,{x:c,y:h}=Va(s,e);return{type:n,chart:e,native:s,x:c!==void 0?c:null,y:h!==void 0?h:null}}function Yf(s,e){for(const n of s)if(n===e||n.contains(e))return!0}function oD(s,e,n){const c=s.canvas,h=new MutationObserver(p=>{let f=!1;for(const a of p)f=f||Yf(a.addedNodes,c),f=f&&!Yf(a.removedNodes,c);f&&n()});return h.observe(document,{childList:!0,subtree:!0}),h}function aD(s,e,n){const c=s.canvas,h=new MutationObserver(p=>{let f=!1;for(const a of p)f=f||Yf(a.removedNodes,c),f=f&&!Yf(a.addedNodes,c);f&&n()});return h.observe(document,{childList:!0,subtree:!0}),h}const ku=new Map;let Ib=0;function T1(){const s=window.devicePixelRatio;s!==Ib&&(Ib=s,ku.forEach((e,n)=>{n.currentDevicePixelRatio!==s&&e()}))}function lD(s,e){ku.size||window.addEventListener("resize",T1),ku.set(s,e)}function cD(s){ku.delete(s),ku.size||window.removeEventListener("resize",T1)}function hD(s,e,n){const c=s.canvas,h=c&&u_(c);if(!h)return;const p=t1((a,w)=>{const P=h.clientWidth;n(a,w),P<h.clientWidth&&n()},window),f=new ResizeObserver(a=>{const w=a[0],P=w.contentRect.width,k=w.contentRect.height;P===0&&k===0||p(P,k)});return f.observe(h),lD(s,p),f}function Xm(s,e,n){n&&n.disconnect(),e==="resize"&&cD(s)}function uD(s,e,n){const c=s.canvas,h=t1(p=>{s.ctx!==null&&n(rD(p,s))},s);return sD(c,e,h),h}class dD extends w1{acquireContext(e,n){const c=e&&e.getContext&&e.getContext("2d");return c&&c.canvas===e?(iD(e,n),c):null}releaseContext(e){const n=e.canvas;if(!n[Rf])return!1;const c=n[Rf].initial;["height","width"].forEach(p=>{const f=c[p];pi(f)?n.removeAttribute(p):n.setAttribute(p,f)});const h=c.style||{};return Object.keys(h).forEach(p=>{n.style[p]=h[p]}),n.width=n.width,delete n[Rf],!0}addEventListener(e,n,c){this.removeEventListener(e,n);const h=e.$proxies||(e.$proxies={}),f={attach:oD,detach:aD,resize:hD}[n]||uD;h[n]=f(e,n,c)}removeEventListener(e,n){const c=e.$proxies||(e.$proxies={}),h=c[n];if(!h)return;({attach:Xm,detach:Xm,resize:Xm}[n]||nD)(e,n,h),c[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,n,c,h){return sI(e,n,c,h)}isAttached(e){const n=e&&u_(e);return!!(n&&n.isConnected)}}function fD(s){return!h_()||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?tD:dD}var bf;let co=(bf=class{constructor(){_e(this,"x");_e(this,"y");_e(this,"active",!1);_e(this,"options");_e(this,"$animations")}tooltipPosition(e){const{x:n,y:c}=this.getProps(["x","y"],e);return{x:n,y:c}}hasValue(){return pc(this.x)&&pc(this.y)}getProps(e,n){const c=this.$animations;if(!n||!c)return this;const h={};return e.forEach(p=>{h[p]=c[p]&&c[p].active()?c[p]._to:this[p]}),h}},_e(bf,"defaults",{}),_e(bf,"defaultRoutes"),bf);function pD(s,e){const n=s.options.ticks,c=mD(s),h=Math.min(n.maxTicksLimit||c,c),p=n.major.enabled?_D(e):[],f=p.length,a=p[0],w=p[f-1],P=[];if(f>h)return yD(e,P,p,f/h),P;const k=gD(p,e,h);if(f>0){let E,F;const R=f>1?Math.round((w-a)/(f-1)):null;for(ff(e,P,k,pi(R)?0:a-R,a),E=0,F=f-1;E<F;E++)ff(e,P,k,p[E],p[E+1]);return ff(e,P,k,w,pi(R)?e.length:w+R),P}return ff(e,P,k),P}function mD(s){const e=s.options.offset,n=s._tickSize(),c=s._length/n+(e?0:1),h=s._maxLength/n;return Math.floor(Math.min(c,h))}function gD(s,e,n){const c=xD(s),h=e.length/n;if(!c)return Math.max(h,1);const p=ak(c);for(let f=0,a=p.length-1;f<a;f++){const w=p[f];if(w>h)return w}return Math.max(h,1)}function _D(s){const e=[];let n,c;for(n=0,c=s.length;n<c;n++)s[n].major&&e.push(n);return e}function yD(s,e,n,c){let h=0,p=n[0],f;for(c=Math.ceil(c),f=0;f<s.length;f++)f===p&&(e.push(s[f]),h++,p=n[h*c])}function ff(s,e,n,c,h){const p=ti(c,0),f=Math.min(ti(h,s.length),s.length);let a=0,w,P,k;for(n=Math.ceil(n),h&&(w=h-c,n=w/Math.floor(w/n)),k=p;k<0;)a++,k=Math.round(p+a*n);for(P=Math.max(p,0);P<f;P++)P===k&&(e.push(s[P]),a++,k=Math.round(p+a*n))}function xD(s){const e=s.length;let n,c;if(e<2)return!1;for(c=s[0],n=1;n<e;++n)if(s[n]-s[n-1]!==c)return!1;return c}const bD=s=>s==="left"?"right":s==="right"?"left":s,Db=(s,e,n)=>e==="top"||e==="left"?s[e]+n:s[e]-n,Ab=(s,e)=>Math.min(e||s,s);function Eb(s,e){const n=[],c=s.length/e,h=s.length;let p=0;for(;p<h;p+=c)n.push(s[Math.floor(p)]);return n}function vD(s,e,n){const c=s.ticks.length,h=Math.min(e,c-1),p=s._startPixel,f=s._endPixel,a=1e-6;let w=s.getPixelForTick(h),P;if(!(n&&(c===1?P=Math.max(w-p,f-w):e===0?P=(s.getPixelForTick(1)-w)/2:P=(w-s.getPixelForTick(h-1))/2,w+=h<e?P:-P,w<p-a||w>f+a)))return w}function wD(s,e){Ci(s,n=>{const c=n.gc,h=c.length/2;let p;if(h>e){for(p=0;p<h;++p)delete n.data[c[p]];c.splice(0,h)}})}function Zh(s){return s.drawTicks?s.tickLength:0}function zb(s,e){if(!s.display)return 0;const n=Is(s.font,e),c=Ys(s.padding);return(is(s.text)?s.text.length:1)*n.lineHeight+c.height}function SD(s,e){return Qo(s,{scale:e,type:"scale"})}function TD(s,e,n){return Qo(s,{tick:n,index:e,type:"tick"})}function MD(s,e,n){let c=n_(s);return(n&&e!=="right"||!n&&e==="right")&&(c=bD(c)),c}function PD(s,e,n,c){const{top:h,left:p,bottom:f,right:a,chart:w}=s,{chartArea:P,scales:k}=w;let E=0,F,R,J;const rt=f-h,mt=a-p;if(s.isHorizontal()){if(R=Us(c,p,a),ui(n)){const xt=Object.keys(n)[0],Ct=n[xt];J=k[xt].getPixelForValue(Ct)+rt-e}else n==="center"?J=(P.bottom+P.top)/2+rt-e:J=Db(s,n,e);F=a-p}else{if(ui(n)){const xt=Object.keys(n)[0],Ct=n[xt];R=k[xt].getPixelForValue(Ct)-mt+e}else n==="center"?R=(P.left+P.right)/2-mt+e:R=Db(s,n,e);J=Us(c,f,h),E=n==="left"?-ys:ys}return{titleX:R,titleY:J,maxWidth:F,rotation:E}}class Ja extends co{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,n){return e}getUserBounds(){let{_userMin:e,_userMax:n,_suggestedMin:c,_suggestedMax:h}=this;return e=In(e,Number.POSITIVE_INFINITY),n=In(n,Number.NEGATIVE_INFINITY),c=In(c,Number.POSITIVE_INFINITY),h=In(h,Number.NEGATIVE_INFINITY),{min:In(e,c),max:In(n,h),minDefined:us(e),maxDefined:us(n)}}getMinMax(e){let{min:n,max:c,minDefined:h,maxDefined:p}=this.getUserBounds(),f;if(h&&p)return{min:n,max:c};const a=this.getMatchingVisibleMetas();for(let w=0,P=a.length;w<P;++w)f=a[w].controller.getMinMax(this,e),h||(n=Math.min(n,f.min)),p||(c=Math.max(c,f.max));return n=p&&n>c?c:n,c=h&&n>c?n:c,{min:In(n,In(c,n)),max:In(c,In(n,c))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Gi(this.options.beforeUpdate,[this])}update(e,n,c){const{beginAtZero:h,grace:p,ticks:f}=this.options,a=f.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=n,this._margins=c=Object.assign({left:0,right:0,top:0,bottom:0},c),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+c.left+c.right:this.height+c.top+c.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Lk(this,p,h),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const w=a<this.ticks.length;this._convertTicksToLabels(w?Eb(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),f.display&&(f.autoSkip||f.source==="auto")&&(this.ticks=pD(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),w&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,n,c;this.isHorizontal()?(n=this.left,c=this.right):(n=this.top,c=this.bottom,e=!e),this._startPixel=n,this._endPixel=c,this._reversePixels=e,this._length=c-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Gi(this.options.afterUpdate,[this])}beforeSetDimensions(){Gi(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Gi(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Gi(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Gi(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const n=this.options.ticks;let c,h,p;for(c=0,h=e.length;c<h;c++)p=e[c],p.label=Gi(n.callback,[p.value,c,e],this)}afterTickToLabelConversion(){Gi(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Gi(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,n=e.ticks,c=Ab(this.ticks.length,e.ticks.maxTicksLimit),h=n.minRotation||0,p=n.maxRotation;let f=h,a,w,P;if(!this._isVisible()||!n.display||h>=p||c<=1||!this.isHorizontal()){this.labelRotation=h;return}const k=this._getLabelSizes(),E=k.widest.width,F=k.highest.height,R=Ls(this.chart.width-E,0,this.maxWidth);a=e.offset?this.maxWidth/c:R/(c-1),E+6>a&&(a=R/(c-(e.offset?.5:1)),w=this.maxHeight-Zh(e.grid)-n.padding-zb(e.title,this.chart.options.font),P=Math.sqrt(E*E+F*F),f=i_(Math.min(Math.asin(Ls((k.highest.height+6)/a,-1,1)),Math.asin(Ls(w/P,-1,1))-Math.asin(Ls(F/P,-1,1)))),f=Math.max(h,Math.min(p,f))),this.labelRotation=f}afterCalculateLabelRotation(){Gi(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Gi(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:n,options:{ticks:c,title:h,grid:p}}=this,f=this._isVisible(),a=this.isHorizontal();if(f){const w=zb(h,n.options.font);if(a?(e.width=this.maxWidth,e.height=Zh(p)+w):(e.height=this.maxHeight,e.width=Zh(p)+w),c.display&&this.ticks.length){const{first:P,last:k,widest:E,highest:F}=this._getLabelSizes(),R=c.padding*2,J=ir(this.labelRotation),rt=Math.cos(J),mt=Math.sin(J);if(a){const xt=c.mirror?0:mt*E.width+rt*F.height;e.height=Math.min(this.maxHeight,e.height+xt+R)}else{const xt=c.mirror?0:rt*E.width+mt*F.height;e.width=Math.min(this.maxWidth,e.width+xt+R)}this._calculatePadding(P,k,mt,rt)}}this._handleMargins(),a?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,n,c,h){const{ticks:{align:p,padding:f},position:a}=this.options,w=this.labelRotation!==0,P=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const k=this.getPixelForTick(0)-this.left,E=this.right-this.getPixelForTick(this.ticks.length-1);let F=0,R=0;w?P?(F=h*e.width,R=c*n.height):(F=c*e.height,R=h*n.width):p==="start"?R=n.width:p==="end"?F=e.width:p!=="inner"&&(F=e.width/2,R=n.width/2),this.paddingLeft=Math.max((F-k+f)*this.width/(this.width-k),0),this.paddingRight=Math.max((R-E+f)*this.width/(this.width-E),0)}else{let k=n.height/2,E=e.height/2;p==="start"?(k=0,E=e.height):p==="end"&&(k=n.height,E=0),this.paddingTop=k+f,this.paddingBottom=E+f}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Gi(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:n}=this.options;return n==="top"||n==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let n,c;for(n=0,c=e.length;n<c;n++)pi(e[n].label)&&(e.splice(n,1),c--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const n=this.options.ticks.sampleSize;let c=this.ticks;n<c.length&&(c=Eb(c,n)),this._labelSizes=e=this._computeLabelSizes(c,c.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,n,c){const{ctx:h,_longestTextCache:p}=this,f=[],a=[],w=Math.floor(n/Ab(n,c));let P=0,k=0,E,F,R,J,rt,mt,xt,Ct,Lt,At,Vt;for(E=0;E<n;E+=w){if(J=e[E].label,rt=this._resolveTickFontOptions(E),h.font=mt=rt.string,xt=p[mt]=p[mt]||{data:{},gc:[]},Ct=rt.lineHeight,Lt=At=0,!pi(J)&&!is(J))Lt=Xf(h,xt.data,xt.gc,Lt,J),At=Ct;else if(is(J))for(F=0,R=J.length;F<R;++F)Vt=J[F],!pi(Vt)&&!is(Vt)&&(Lt=Xf(h,xt.data,xt.gc,Lt,Vt),At+=Ct);f.push(Lt),a.push(At),P=Math.max(Lt,P),k=Math.max(At,k)}wD(p,n);const Yt=f.indexOf(P),Gt=a.indexOf(k),ie=be=>({width:f[be]||0,height:a[be]||0});return{first:ie(0),last:ie(n-1),widest:ie(Yt),highest:ie(Gt),widths:f,heights:a}}getLabelForValue(e){return e}getPixelForValue(e,n){return NaN}getValueForPixel(e){}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const n=this._startPixel+e*this._length;return hk(this._alignToPixels?Oa(this.chart,n,0):n)}getDecimalForPixel(e){const n=(e-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:n}=this;return e<0&&n<0?n:e>0&&n>0?e:0}getContext(e){const n=this.ticks||[];if(e>=0&&e<n.length){const c=n[e];return c.$context||(c.$context=TD(this.getContext(),e,c))}return this.$context||(this.$context=SD(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,n=ir(this.labelRotation),c=Math.abs(Math.cos(n)),h=Math.abs(Math.sin(n)),p=this._getLabelSizes(),f=e.autoSkipPadding||0,a=p?p.widest.width+f:0,w=p?p.highest.height+f:0;return this.isHorizontal()?w*c>a*h?a/c:w/h:w*h<a*c?w/c:a/h}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const n=this.axis,c=this.chart,h=this.options,{grid:p,position:f,border:a}=h,w=p.offset,P=this.isHorizontal(),E=this.ticks.length+(w?1:0),F=Zh(p),R=[],J=a.setContext(this.getContext()),rt=J.display?J.width:0,mt=rt/2,xt=function(xe){return Oa(c,xe,rt)};let Ct,Lt,At,Vt,Yt,Gt,ie,be,ze,Me,Fe,Ve;if(f==="top")Ct=xt(this.bottom),Gt=this.bottom-F,be=Ct-mt,Me=xt(e.top)+mt,Ve=e.bottom;else if(f==="bottom")Ct=xt(this.top),Me=e.top,Ve=xt(e.bottom)-mt,Gt=Ct+mt,be=this.top+F;else if(f==="left")Ct=xt(this.right),Yt=this.right-F,ie=Ct-mt,ze=xt(e.left)+mt,Fe=e.right;else if(f==="right")Ct=xt(this.left),ze=e.left,Fe=xt(e.right)-mt,Yt=Ct+mt,ie=this.left+F;else if(n==="x"){if(f==="center")Ct=xt((e.top+e.bottom)/2+.5);else if(ui(f)){const xe=Object.keys(f)[0],De=f[xe];Ct=xt(this.chart.scales[xe].getPixelForValue(De))}Me=e.top,Ve=e.bottom,Gt=Ct+mt,be=Gt+F}else if(n==="y"){if(f==="center")Ct=xt((e.left+e.right)/2);else if(ui(f)){const xe=Object.keys(f)[0],De=f[xe];Ct=xt(this.chart.scales[xe].getPixelForValue(De))}Yt=Ct-mt,ie=Yt-F,ze=e.left,Fe=e.right}const He=ti(h.ticks.maxTicksLimit,E),je=Math.max(1,Math.ceil(E/He));for(Lt=0;Lt<E;Lt+=je){const xe=this.getContext(Lt),De=p.setContext(xe),Oe=a.setContext(xe),qe=De.lineWidth,zi=De.color,mi=Oe.dash||[],ci=Oe.dashOffset,Ii=De.tickWidth,Ce=De.tickColor,ai=De.tickBorderDash||[],ii=De.tickBorderDashOffset;At=vD(this,Lt,w),At!==void 0&&(Vt=Oa(c,At,qe),P?Yt=ie=ze=Fe=Vt:Gt=be=Me=Ve=Vt,R.push({tx1:Yt,ty1:Gt,tx2:ie,ty2:be,x1:ze,y1:Me,x2:Fe,y2:Ve,width:qe,color:zi,borderDash:mi,borderDashOffset:ci,tickWidth:Ii,tickColor:Ce,tickBorderDash:ai,tickBorderDashOffset:ii}))}return this._ticksLength=E,this._borderValue=Ct,R}_computeLabelItems(e){const n=this.axis,c=this.options,{position:h,ticks:p}=c,f=this.isHorizontal(),a=this.ticks,{align:w,crossAlign:P,padding:k,mirror:E}=p,F=Zh(c.grid),R=F+k,J=E?-k:R,rt=-ir(this.labelRotation),mt=[];let xt,Ct,Lt,At,Vt,Yt,Gt,ie,be,ze,Me,Fe,Ve="middle";if(h==="top")Yt=this.bottom-J,Gt=this._getXAxisLabelAlignment();else if(h==="bottom")Yt=this.top+J,Gt=this._getXAxisLabelAlignment();else if(h==="left"){const je=this._getYAxisLabelAlignment(F);Gt=je.textAlign,Vt=je.x}else if(h==="right"){const je=this._getYAxisLabelAlignment(F);Gt=je.textAlign,Vt=je.x}else if(n==="x"){if(h==="center")Yt=(e.top+e.bottom)/2+R;else if(ui(h)){const je=Object.keys(h)[0],xe=h[je];Yt=this.chart.scales[je].getPixelForValue(xe)+R}Gt=this._getXAxisLabelAlignment()}else if(n==="y"){if(h==="center")Vt=(e.left+e.right)/2-R;else if(ui(h)){const je=Object.keys(h)[0],xe=h[je];Vt=this.chart.scales[je].getPixelForValue(xe)}Gt=this._getYAxisLabelAlignment(F).textAlign}n==="y"&&(w==="start"?Ve="top":w==="end"&&(Ve="bottom"));const He=this._getLabelSizes();for(xt=0,Ct=a.length;xt<Ct;++xt){Lt=a[xt],At=Lt.label;const je=p.setContext(this.getContext(xt));ie=this.getPixelForTick(xt)+p.labelOffset,be=this._resolveTickFontOptions(xt),ze=be.lineHeight,Me=is(At)?At.length:1;const xe=Me/2,De=je.color,Oe=je.textStrokeColor,qe=je.textStrokeWidth;let zi=Gt;f?(Vt=ie,Gt==="inner"&&(xt===Ct-1?zi=this.options.reverse?"left":"right":xt===0?zi=this.options.reverse?"right":"left":zi="center"),h==="top"?P==="near"||rt!==0?Fe=-Me*ze+ze/2:P==="center"?Fe=-He.highest.height/2-xe*ze+ze:Fe=-He.highest.height+ze/2:P==="near"||rt!==0?Fe=ze/2:P==="center"?Fe=He.highest.height/2-xe*ze:Fe=He.highest.height-Me*ze,E&&(Fe*=-1),rt!==0&&!je.showLabelBackdrop&&(Vt+=ze/2*Math.sin(rt))):(Yt=ie,Fe=(1-Me)*ze/2);let mi;if(je.showLabelBackdrop){const ci=Ys(je.backdropPadding),Ii=He.heights[xt],Ce=He.widths[xt];let ai=Fe-ci.top,ii=0-ci.left;switch(Ve){case"middle":ai-=Ii/2;break;case"bottom":ai-=Ii;break}switch(Gt){case"center":ii-=Ce/2;break;case"right":ii-=Ce;break;case"inner":xt===Ct-1?ii-=Ce:xt>0&&(ii-=Ce/2);break}mi={left:ii,top:ai,width:Ce+ci.width,height:Ii+ci.height,color:je.backdropColor}}mt.push({label:At,font:be,textOffset:Fe,options:{rotation:rt,color:De,strokeColor:Oe,strokeWidth:qe,textAlign:zi,textBaseline:Ve,translation:[Vt,Yt],backdrop:mi}})}return mt}_getXAxisLabelAlignment(){const{position:e,ticks:n}=this.options;if(-ir(this.labelRotation))return e==="top"?"left":"right";let h="center";return n.align==="start"?h="left":n.align==="end"?h="right":n.align==="inner"&&(h="inner"),h}_getYAxisLabelAlignment(e){const{position:n,ticks:{crossAlign:c,mirror:h,padding:p}}=this.options,f=this._getLabelSizes(),a=e+p,w=f.widest.width;let P,k;return n==="left"?h?(k=this.right+p,c==="near"?P="left":c==="center"?(P="center",k+=w/2):(P="right",k+=w)):(k=this.right-a,c==="near"?P="right":c==="center"?(P="center",k-=w/2):(P="left",k=this.left)):n==="right"?h?(k=this.left+p,c==="near"?P="right":c==="center"?(P="center",k-=w/2):(P="left",k-=w)):(k=this.left+a,c==="near"?P="left":c==="center"?(P="center",k+=w/2):(P="right",k=this.right)):P="right",{textAlign:P,x:k}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:n},left:c,top:h,width:p,height:f}=this;n&&(e.save(),e.fillStyle=n,e.fillRect(c,h,p,f),e.restore())}getLineWidthForValue(e){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const h=this.ticks.findIndex(p=>p.value===e);return h>=0?n.setContext(this.getContext(h)).lineWidth:0}drawGrid(e){const n=this.options.grid,c=this.ctx,h=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let p,f;const a=(w,P,k)=>{!k.width||!k.color||(c.save(),c.lineWidth=k.width,c.strokeStyle=k.color,c.setLineDash(k.borderDash||[]),c.lineDashOffset=k.borderDashOffset,c.beginPath(),c.moveTo(w.x,w.y),c.lineTo(P.x,P.y),c.stroke(),c.restore())};if(n.display)for(p=0,f=h.length;p<f;++p){const w=h[p];n.drawOnChartArea&&a({x:w.x1,y:w.y1},{x:w.x2,y:w.y2},w),n.drawTicks&&a({x:w.tx1,y:w.ty1},{x:w.tx2,y:w.ty2},{color:w.tickColor,width:w.tickWidth,borderDash:w.tickBorderDash,borderDashOffset:w.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:n,options:{border:c,grid:h}}=this,p=c.setContext(this.getContext()),f=c.display?p.width:0;if(!f)return;const a=h.setContext(this.getContext(0)).lineWidth,w=this._borderValue;let P,k,E,F;this.isHorizontal()?(P=Oa(e,this.left,f)-f/2,k=Oa(e,this.right,a)+a/2,E=F=w):(E=Oa(e,this.top,f)-f/2,F=Oa(e,this.bottom,a)+a/2,P=k=w),n.save(),n.lineWidth=p.width,n.strokeStyle=p.color,n.beginPath(),n.moveTo(P,E),n.lineTo(k,F),n.stroke(),n.restore()}drawLabels(e){if(!this.options.ticks.display)return;const c=this.ctx,h=this._computeLabelArea();h&&pp(c,h);const p=this.getLabelItems(e);for(const f of p){const a=f.options,w=f.font,P=f.label,k=f.textOffset;Ka(c,P,0,k,w,a)}h&&mp(c)}drawTitle(){const{ctx:e,options:{position:n,title:c,reverse:h}}=this;if(!c.display)return;const p=Is(c.font),f=Ys(c.padding),a=c.align;let w=p.lineHeight/2;n==="bottom"||n==="center"||ui(n)?(w+=f.bottom,is(c.text)&&(w+=p.lineHeight*(c.text.length-1))):w+=f.top;const{titleX:P,titleY:k,maxWidth:E,rotation:F}=PD(this,w,n,a);Ka(e,c.text,0,0,p,{color:c.color,maxWidth:E,rotation:F,textAlign:MD(a,n,h),textBaseline:"middle",translation:[P,k]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,n=e.ticks&&e.ticks.z||0,c=ti(e.grid&&e.grid.z,-1),h=ti(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Ja.prototype.draw?[{z:n,draw:p=>{this.draw(p)}}]:[{z:c,draw:p=>{this.drawBackground(),this.drawGrid(p),this.drawTitle()}},{z:h,draw:()=>{this.drawBorder()}},{z:n,draw:p=>{this.drawLabels(p)}}]}getMatchingVisibleMetas(e){const n=this.chart.getSortedVisibleDatasetMetas(),c=this.axis+"AxisID",h=[];let p,f;for(p=0,f=n.length;p<f;++p){const a=n[p];a[c]===this.id&&(!e||a.type===e)&&h.push(a)}return h}_resolveTickFontOptions(e){const n=this.options.ticks.setContext(this.getContext(e));return Is(n.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class pf{constructor(e,n,c){this.type=e,this.scope=n,this.override=c,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const n=Object.getPrototypeOf(e);let c;ID(n)&&(c=this.register(n));const h=this.items,p=e.id,f=this.scope+"."+p;if(!p)throw new Error("class does not have id: "+e);return p in h||(h[p]=e,CD(e,f,c),this.override&&ss.override(e.id,e.overrides)),f}get(e){return this.items[e]}unregister(e){const n=this.items,c=e.id,h=this.scope;c in n&&delete n[c],h&&c in ss[h]&&(delete ss[h][c],this.override&&delete Xa[c])}}function CD(s,e,n){const c=Tu(Object.create(null),[n?ss.get(n):{},ss.get(e),s.defaults]);ss.set(e,c),s.defaultRoutes&&kD(e,s.defaultRoutes),s.descriptors&&ss.describe(e,s.descriptors)}function kD(s,e){Object.keys(e).forEach(n=>{const c=n.split("."),h=c.pop(),p=[s].concat(c).join("."),f=e[n].split("."),a=f.pop(),w=f.join(".");ss.route(p,h,w,a)})}function ID(s){return"id"in s&&"defaults"in s}class DD{constructor(){this.controllers=new pf(rr,"datasets",!0),this.elements=new pf(co,"elements"),this.plugins=new pf(Object,"plugins"),this.scales=new pf(Ja,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,n,c){[...n].forEach(h=>{const p=c||this._getRegistryForType(h);c||p.isForType(h)||p===this.plugins&&h.id?this._exec(e,p,h):Ci(h,f=>{const a=c||this._getRegistryForType(f);this._exec(e,a,f)})})}_exec(e,n,c){const h=e_(e);Gi(c["before"+h],[],c),n[e](c),Gi(c["after"+h],[],c)}_getRegistryForType(e){for(let n=0;n<this._typedRegistries.length;n++){const c=this._typedRegistries[n];if(c.isForType(e))return c}return this.plugins}_get(e,n,c){const h=n.get(e);if(h===void 0)throw new Error('"'+e+'" is not a registered '+c+".");return h}}var br=new DD;class AD{constructor(){this._init=[]}notify(e,n,c,h){n==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const p=h?this._descriptors(e).filter(h):this._descriptors(e),f=this._notify(p,e,n,c);return n==="afterDestroy"&&(this._notify(p,e,"stop"),this._notify(this._init,e,"uninstall")),f}_notify(e,n,c,h){h=h||{};for(const p of e){const f=p.plugin,a=f[c],w=[n,h,p.options];if(Gi(a,w,f)===!1&&h.cancelable)return!1}return!0}invalidate(){pi(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),n}_createDescriptors(e,n){const c=e&&e.config,h=ti(c.options&&c.options.plugins,{}),p=ED(c);return h===!1&&!n?[]:RD(e,p,h,n)}_notifyStateChanges(e){const n=this._oldCache||[],c=this._cache,h=(p,f)=>p.filter(a=>!f.some(w=>a.plugin.id===w.plugin.id));this._notify(h(n,c),e,"stop"),this._notify(h(c,n),e,"start")}}function ED(s){const e={},n=[],c=Object.keys(br.plugins.items);for(let p=0;p<c.length;p++)n.push(br.getPlugin(c[p]));const h=s.plugins||[];for(let p=0;p<h.length;p++){const f=h[p];n.indexOf(f)===-1&&(n.push(f),e[f.id]=!0)}return{plugins:n,localIds:e}}function zD(s,e){return!e&&s===!1?null:s===!0?{}:s}function RD(s,{plugins:e,localIds:n},c,h){const p=[],f=s.getContext();for(const a of e){const w=a.id,P=zD(c[w],h);P!==null&&p.push({plugin:a,options:LD(s.config,{plugin:a,local:n[w]},P,f)})}return p}function LD(s,{plugin:e,local:n},c,h){const p=s.pluginScopeKeys(e),f=s.getOptionScopes(c,p);return n&&e.defaults&&f.push(e.defaults),s.createResolver(f,h,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function yg(s,e){const n=ss.datasets[s]||{};return((e.datasets||{})[s]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function FD(s,e){let n=s;return s==="_index_"?n=e:s==="_value_"&&(n=e==="x"?"y":"x"),n}function OD(s,e){return s===e?"_index_":"_value_"}function Rb(s){if(s==="x"||s==="y"||s==="r")return s}function BD(s){if(s==="top"||s==="bottom")return"x";if(s==="left"||s==="right")return"y"}function xg(s,...e){if(Rb(s))return s;for(const n of e){const c=n.axis||BD(n.position)||s.length>1&&Rb(s[0].toLowerCase());if(c)return c}throw new Error(`Cannot determine type of '${s}' axis. Please provide 'axis' or 'position' option.`)}function Lb(s,e,n){if(n[e+"AxisID"]===s)return{axis:e}}function jD(s,e){if(e.data&&e.data.datasets){const n=e.data.datasets.filter(c=>c.xAxisID===s||c.yAxisID===s);if(n.length)return Lb(s,"x",n[0])||Lb(s,"y",n[0])}return{}}function ND(s,e){const n=Xa[s.type]||{scales:{}},c=e.scales||{},h=yg(s.type,e),p=Object.create(null);return Object.keys(c).forEach(f=>{const a=c[f];if(!ui(a))return console.error(`Invalid scale configuration for scale: ${f}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${f}`);const w=xg(f,a,jD(f,s),ss.scales[a.type]),P=OD(w,h),k=n.scales||{};p[f]=hu(Object.create(null),[{axis:w},a,k[w],k[P]])}),s.data.datasets.forEach(f=>{const a=f.type||s.type,w=f.indexAxis||yg(a,e),k=(Xa[a]||{}).scales||{};Object.keys(k).forEach(E=>{const F=FD(E,w),R=f[F+"AxisID"]||F;p[R]=p[R]||Object.create(null),hu(p[R],[{axis:F},c[R],k[E]])})}),Object.keys(p).forEach(f=>{const a=p[f];hu(a,[ss.scales[a.type],ss.scale])}),p}function M1(s){const e=s.options||(s.options={});e.plugins=ti(e.plugins,{}),e.scales=ND(s,e)}function P1(s){return s=s||{},s.datasets=s.datasets||[],s.labels=s.labels||[],s}function VD(s){return s=s||{},s.data=P1(s.data),M1(s),s}const Fb=new Map,C1=new Set;function mf(s,e){let n=Fb.get(s);return n||(n=e(),Fb.set(s,n),C1.add(n)),n}const Gh=(s,e,n)=>{const c=Xo(e,n);c!==void 0&&s.add(c)};class $D{constructor(e){this._config=VD(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=P1(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),M1(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return mf(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,n){return mf(`${e}.transition.${n}`,()=>[[`datasets.${e}.transitions.${n}`,`transitions.${n}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,n){return mf(`${e}-${n}`,()=>[[`datasets.${e}.elements.${n}`,`datasets.${e}`,`elements.${n}`,""]])}pluginScopeKeys(e){const n=e.id,c=this.type;return mf(`${c}-plugin-${n}`,()=>[[`plugins.${n}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,n){const c=this._scopeCache;let h=c.get(e);return(!h||n)&&(h=new Map,c.set(e,h)),h}getOptionScopes(e,n,c){const{options:h,type:p}=this,f=this._cachedScopes(e,c),a=f.get(n);if(a)return a;const w=new Set;n.forEach(k=>{e&&(w.add(e),k.forEach(E=>Gh(w,e,E))),k.forEach(E=>Gh(w,h,E)),k.forEach(E=>Gh(w,Xa[p]||{},E)),k.forEach(E=>Gh(w,ss,E)),k.forEach(E=>Gh(w,mg,E))});const P=Array.from(w);return P.length===0&&P.push(Object.create(null)),C1.has(n)&&f.set(n,P),P}chartOptionScopes(){const{options:e,type:n}=this;return[e,Xa[n]||{},ss.datasets[n]||{},{type:n},ss,mg]}resolveNamedOptions(e,n,c,h=[""]){const p={$shared:!0},{resolver:f,subPrefixes:a}=Ob(this._resolverCache,e,h);let w=f;if(HD(f,n)){p.$shared=!1,c=Ko(c)?c():c;const P=this.createResolver(e,c,a);w=mc(f,c,P)}for(const P of n)p[P]=w[P];return p}createResolver(e,n,c=[""],h){const{resolver:p}=Ob(this._resolverCache,e,c);return ui(n)?mc(p,n,void 0,h):p}}function Ob(s,e,n){let c=s.get(e);c||(c=new Map,s.set(e,c));const h=n.join();let p=c.get(h);return p||(p={resolver:a_(e,n),subPrefixes:n.filter(a=>!a.toLowerCase().includes("hover"))},c.set(h,p)),p}const UD=s=>ui(s)&&Object.getOwnPropertyNames(s).some(e=>Ko(s[e]));function HD(s,e){const{isScriptable:n,isIndexable:c}=o1(s);for(const h of e){const p=n(h),f=c(h),a=(f||p)&&s[h];if(p&&(Ko(a)||UD(a))||f&&is(a))return!0}return!1}var ZD="4.4.7";const GD=["top","bottom","left","right","chartArea"];function Bb(s,e){return s==="top"||s==="bottom"||GD.indexOf(s)===-1&&e==="x"}function jb(s,e){return function(n,c){return n[s]===c[s]?n[e]-c[e]:n[s]-c[s]}}function Nb(s){const e=s.chart,n=e.options.animation;e.notifyPlugins("afterRender"),Gi(n&&n.onComplete,[s],e)}function qD(s){const e=s.chart,n=e.options.animation;Gi(n&&n.onProgress,[s],e)}function k1(s){return h_()&&typeof s=="string"?s=document.getElementById(s):s&&s.length&&(s=s[0]),s&&s.canvas&&(s=s.canvas),s}const Lf={},Vb=s=>{const e=k1(s);return Object.values(Lf).filter(n=>n.canvas===e).pop()};function WD(s,e,n){const c=Object.keys(s);for(const h of c){const p=+h;if(p>=e){const f=s[h];delete s[h],(n>0||p>e)&&(s[p+n]=f)}}}function XD(s,e,n,c){return!n||s.type==="mouseout"?null:c?e:s}function gf(s,e,n){return s.options.clip?s[n]:e[n]}function KD(s,e){const{xScale:n,yScale:c}=s;return n&&c?{left:gf(n,e,"left"),right:gf(n,e,"right"),top:gf(c,e,"top"),bottom:gf(c,e,"bottom")}:e}class Qr{static register(...e){br.add(...e),$b()}static unregister(...e){br.remove(...e),$b()}constructor(e,n){const c=this.config=new $D(n),h=k1(e),p=Vb(h);if(p)throw new Error("Canvas is already in use. Chart with ID '"+p.id+"' must be destroyed before the canvas with ID '"+p.canvas.id+"' can be reused.");const f=c.createResolver(c.chartOptionScopes(),this.getContext());this.platform=new(c.platform||fD(h)),this.platform.updateConfig(c);const a=this.platform.acquireContext(h,f.aspectRatio),w=a&&a.canvas,P=w&&w.height,k=w&&w.width;if(this.id=JC(),this.ctx=a,this.canvas=w,this.width=k,this.height=P,this._options=f,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new AD,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=pk(E=>this.update(E),f.resizeDelay||0),this._dataChanges=[],Lf[this.id]=this,!a||!w){console.error("Failed to create chart: can't acquire context from the given item");return}Wr.listen(this,"complete",Nb),Wr.listen(this,"progress",qD),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:n},width:c,height:h,_aspectRatio:p}=this;return pi(e)?n&&p?p:h?c/h:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return br}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():hb(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return ab(this.canvas,this.ctx),this}stop(){return Wr.stop(this),this}resize(e,n){Wr.running(this)?this._resizeBeforeDraw={width:e,height:n}:this._resize(e,n)}_resize(e,n){const c=this.options,h=this.canvas,p=c.maintainAspectRatio&&this.aspectRatio,f=this.platform.getMaximumSize(h,e,n,p),a=c.devicePixelRatio||this.platform.getDevicePixelRatio(),w=this.width?"resize":"attach";this.width=f.width,this.height=f.height,this._aspectRatio=this.aspectRatio,hb(this,a,!0)&&(this.notifyPlugins("resize",{size:f}),Gi(c.onResize,[this,f],this),this.attached&&this._doResize(w)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};Ci(n,(c,h)=>{c.id=h})}buildOrUpdateScales(){const e=this.options,n=e.scales,c=this.scales,h=Object.keys(c).reduce((f,a)=>(f[a]=!1,f),{});let p=[];n&&(p=p.concat(Object.keys(n).map(f=>{const a=n[f],w=xg(f,a),P=w==="r",k=w==="x";return{options:a,dposition:P?"chartArea":k?"bottom":"left",dtype:P?"radialLinear":k?"category":"linear"}}))),Ci(p,f=>{const a=f.options,w=a.id,P=xg(w,a),k=ti(a.type,f.dtype);(a.position===void 0||Bb(a.position,P)!==Bb(f.dposition))&&(a.position=f.dposition),h[w]=!0;let E=null;if(w in c&&c[w].type===k)E=c[w];else{const F=br.getScale(k);E=new F({id:w,type:k,ctx:this.ctx,chart:this}),c[E.id]=E}E.init(a,e)}),Ci(h,(f,a)=>{f||delete c[a]}),Ci(c,f=>{Ws.configure(this,f,f.options),Ws.addBox(this,f)})}_updateMetasets(){const e=this._metasets,n=this.data.datasets.length,c=e.length;if(e.sort((h,p)=>h.index-p.index),c>n){for(let h=n;h<c;++h)this._destroyDatasetMeta(h);e.splice(n,c-n)}this._sortedMetasets=e.slice(0).sort(jb("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:n}}=this;e.length>n.length&&delete this._stacks,e.forEach((c,h)=>{n.filter(p=>p===c._dataset).length===0&&this._destroyDatasetMeta(h)})}buildOrUpdateControllers(){const e=[],n=this.data.datasets;let c,h;for(this._removeUnreferencedMetasets(),c=0,h=n.length;c<h;c++){const p=n[c];let f=this.getDatasetMeta(c);const a=p.type||this.config.type;if(f.type&&f.type!==a&&(this._destroyDatasetMeta(c),f=this.getDatasetMeta(c)),f.type=a,f.indexAxis=p.indexAxis||yg(a,this.options),f.order=p.order||0,f.index=c,f.label=""+p.label,f.visible=this.isDatasetVisible(c),f.controller)f.controller.updateIndex(c),f.controller.linkScales();else{const w=br.getController(a),{datasetElementType:P,dataElementType:k}=ss.datasets[a];Object.assign(w,{dataElementType:br.getElement(k),datasetElementType:P&&br.getElement(P)}),f.controller=new w(this,c),e.push(f.controller)}}return this._updateMetasets(),e}_resetElements(){Ci(this.data.datasets,(e,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const n=this.config;n.update();const c=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),h=this._animationsDisabled=!c.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const p=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let f=0;for(let P=0,k=this.data.datasets.length;P<k;P++){const{controller:E}=this.getDatasetMeta(P),F=!h&&p.indexOf(E)===-1;E.buildOrUpdateElements(F),f=Math.max(+E.getMaxOverflow(),f)}f=this._minPadding=c.layout.autoPadding?f:0,this._updateLayout(f),h||Ci(p,P=>{P.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(jb("z","_idx"));const{_active:a,_lastEvent:w}=this;w?this._eventHandler(w,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){Ci(this.scales,e=>{Ws.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,n=new Set(Object.keys(this._listeners)),c=new Set(e.events);(!Jx(n,c)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,n=this._getUniformDataChanges()||[];for(const{method:c,start:h,count:p}of n){const f=c==="_removeElements"?-p:p;WD(e,h,f)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const n=this.data.datasets.length,c=p=>new Set(e.filter(f=>f[0]===p).map((f,a)=>a+","+f.splice(1).join(","))),h=c(0);for(let p=1;p<n;p++)if(!Jx(h,c(p)))return;return Array.from(h).map(p=>p.split(",")).map(p=>({method:p[1],start:+p[2],count:+p[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Ws.update(this,this.width,this.height,e);const n=this.chartArea,c=n.width<=0||n.height<=0;this._layers=[],Ci(this.boxes,h=>{c&&h.position==="chartArea"||(h.configure&&h.configure(),this._layers.push(...h._layers()))},this),this._layers.forEach((h,p)=>{h._idx=p}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let n=0,c=this.data.datasets.length;n<c;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,c=this.data.datasets.length;n<c;++n)this._updateDataset(n,Ko(e)?e({datasetIndex:n}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,n){const c=this.getDatasetMeta(e),h={meta:c,index:e,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",h)!==!1&&(c.controller._update(n),h.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",h))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Wr.has(this)?this.attached&&!Wr.running(this)&&Wr.start(this):(this.draw(),Nb({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:c,height:h}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(c,h)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(e=0;e<n.length&&n[e].z<=0;++e)n[e].draw(this.chartArea);for(this._drawDatasets();e<n.length;++e)n[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const n=this._sortedMetasets,c=[];let h,p;for(h=0,p=n.length;h<p;++h){const f=n[h];(!e||f.visible)&&c.push(f)}return c}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let n=e.length-1;n>=0;--n)this._drawDataset(e[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const n=this.ctx,c=e._clip,h=!c.disabled,p=KD(e,this.chartArea),f={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",f)!==!1&&(h&&pp(n,{left:c.left===!1?0:p.left-c.left,right:c.right===!1?this.width:p.right+c.right,top:c.top===!1?0:p.top-c.top,bottom:c.bottom===!1?this.height:p.bottom+c.bottom}),e.controller.draw(),h&&mp(n),f.cancelable=!1,this.notifyPlugins("afterDatasetDraw",f))}isPointInArea(e){return ro(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,n,c,h){const p=GI.modes[n];return typeof p=="function"?p(this,e,c,h):[]}getDatasetMeta(e){const n=this.data.datasets[e],c=this._metasets;let h=c.filter(p=>p&&p._dataset===n).pop();return h||(h={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:e,_dataset:n,_parsed:[],_sorted:!1},c.push(h)),h}getContext(){return this.$context||(this.$context=Qo(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const n=this.data.datasets[e];if(!n)return!1;const c=this.getDatasetMeta(e);return typeof c.hidden=="boolean"?!c.hidden:!n.hidden}setDatasetVisibility(e,n){const c=this.getDatasetMeta(e);c.hidden=!n}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,n,c){const h=c?"show":"hide",p=this.getDatasetMeta(e),f=p.controller._resolveAnimations(void 0,h);Mu(n)?(p.data[n].hidden=!c,this.update()):(this.setDatasetVisibility(e,c),f.update(p,{visible:c}),this.update(a=>a.datasetIndex===e?h:void 0))}hide(e,n){this._updateVisibility(e,n,!1)}show(e,n){this._updateVisibility(e,n,!0)}_destroyDatasetMeta(e){const n=this._metasets[e];n&&n.controller&&n.controller._destroy(),delete this._metasets[e]}_stop(){let e,n;for(this.stop(),Wr.remove(this),e=0,n=this.data.datasets.length;e<n;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:n}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),ab(e,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete Lf[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,n=this.platform,c=(p,f)=>{n.addEventListener(this,p,f),e[p]=f},h=(p,f,a)=>{p.offsetX=f,p.offsetY=a,this._eventHandler(p)};Ci(this.options.events,p=>c(p,h))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,n=this.platform,c=(w,P)=>{n.addEventListener(this,w,P),e[w]=P},h=(w,P)=>{e[w]&&(n.removeEventListener(this,w,P),delete e[w])},p=(w,P)=>{this.canvas&&this.resize(w,P)};let f;const a=()=>{h("attach",a),this.attached=!0,this.resize(),c("resize",p),c("detach",f)};f=()=>{this.attached=!1,h("resize",p),this._stop(),this._resize(0,0),c("attach",a)},n.isAttached(this.canvas)?a():f()}unbindEvents(){Ci(this._listeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._listeners={},Ci(this._responsiveListeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,n,c){const h=c?"set":"remove";let p,f,a,w;for(n==="dataset"&&(p=this.getDatasetMeta(e[0].datasetIndex),p.controller["_"+h+"DatasetHoverStyle"]()),a=0,w=e.length;a<w;++a){f=e[a];const P=f&&this.getDatasetMeta(f.datasetIndex).controller;P&&P[h+"HoverStyle"](f.element,f.datasetIndex,f.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const n=this._active||[],c=e.map(({datasetIndex:p,index:f})=>{const a=this.getDatasetMeta(p);if(!a)throw new Error("No dataset found at index "+p);return{datasetIndex:p,element:a.data[f],index:f}});!Gf(c,n)&&(this._active=c,this._lastEvent=null,this._updateHoverStyles(c,n))}notifyPlugins(e,n,c){return this._plugins.notify(this,e,n,c)}isPluginEnabled(e){return this._plugins._cache.filter(n=>n.plugin.id===e).length===1}_updateHoverStyles(e,n,c){const h=this.options.hover,p=(w,P)=>w.filter(k=>!P.some(E=>k.datasetIndex===E.datasetIndex&&k.index===E.index)),f=p(n,e),a=c?e:p(e,n);f.length&&this.updateHoverStyle(f,h.mode,!1),a.length&&h.mode&&this.updateHoverStyle(a,h.mode,!0)}_eventHandler(e,n){const c={event:e,replay:n,cancelable:!0,inChartArea:this.isPointInArea(e)},h=f=>(f.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",c,h)===!1)return;const p=this._handleEvent(e,n,c.inChartArea);return c.cancelable=!1,this.notifyPlugins("afterEvent",c,h),(p||c.changed)&&this.render(),this}_handleEvent(e,n,c){const{_active:h=[],options:p}=this,f=n,a=this._getActiveElements(e,h,c,f),w=nk(e),P=XD(e,this._lastEvent,c,w);c&&(this._lastEvent=null,Gi(p.onHover,[e,a,this],this),w&&Gi(p.onClick,[e,a,this],this));const k=!Gf(a,h);return(k||n)&&(this._active=a,this._updateHoverStyles(a,h,n)),this._lastEvent=P,k}_getActiveElements(e,n,c,h){if(e.type==="mouseout")return[];if(!c)return n;const p=this.options.hover;return this.getElementsAtEventForMode(e,p.mode,p,h)}}_e(Qr,"defaults",ss),_e(Qr,"instances",Lf),_e(Qr,"overrides",Xa),_e(Qr,"registry",br),_e(Qr,"version",ZD),_e(Qr,"getChart",Vb);function $b(){return Ci(Qr.instances,s=>s._plugins.invalidate())}function YD(s,e,n){const{startAngle:c,pixelMargin:h,x:p,y:f,outerRadius:a,innerRadius:w}=e;let P=h/a;s.beginPath(),s.arc(p,f,a,c-P,n+P),w>h?(P=h/w,s.arc(p,f,w,n+P,c-P,!0)):s.arc(p,f,h,n+ys,c-ys),s.closePath(),s.clip()}function JD(s){return o_(s,["outerStart","outerEnd","innerStart","innerEnd"])}function QD(s,e,n,c){const h=JD(s.options.borderRadius),p=(n-e)/2,f=Math.min(p,c*e/2),a=w=>{const P=(n-Math.min(p,w))*c/2;return Ls(w,0,Math.min(p,P))};return{outerStart:a(h.outerStart),outerEnd:a(h.outerEnd),innerStart:Ls(h.innerStart,0,f),innerEnd:Ls(h.innerEnd,0,f)}}function Ql(s,e,n,c){return{x:n+s*Math.cos(e),y:c+s*Math.sin(e)}}function Jf(s,e,n,c,h,p){const{x:f,y:a,startAngle:w,pixelMargin:P,innerRadius:k}=e,E=Math.max(e.outerRadius+c+n-P,0),F=k>0?k+c+n+P:0;let R=0;const J=h-w;if(c){const je=k>0?k-c:0,xe=E>0?E-c:0,De=(je+xe)/2,Oe=De!==0?J*De/(De+c):J;R=(J-Oe)/2}const rt=Math.max(.001,J*E-n/Ji)/E,mt=(J-rt)/2,xt=w+mt+R,Ct=h-mt-R,{outerStart:Lt,outerEnd:At,innerStart:Vt,innerEnd:Yt}=QD(e,F,E,Ct-xt),Gt=E-Lt,ie=E-At,be=xt+Lt/Gt,ze=Ct-At/ie,Me=F+Vt,Fe=F+Yt,Ve=xt+Vt/Me,He=Ct-Yt/Fe;if(s.beginPath(),p){const je=(be+ze)/2;if(s.arc(f,a,E,be,je),s.arc(f,a,E,je,ze),At>0){const qe=Ql(ie,ze,f,a);s.arc(qe.x,qe.y,At,ze,Ct+ys)}const xe=Ql(Fe,Ct,f,a);if(s.lineTo(xe.x,xe.y),Yt>0){const qe=Ql(Fe,He,f,a);s.arc(qe.x,qe.y,Yt,Ct+ys,He+Math.PI)}const De=(Ct-Yt/F+(xt+Vt/F))/2;if(s.arc(f,a,F,Ct-Yt/F,De,!0),s.arc(f,a,F,De,xt+Vt/F,!0),Vt>0){const qe=Ql(Me,Ve,f,a);s.arc(qe.x,qe.y,Vt,Ve+Math.PI,xt-ys)}const Oe=Ql(Gt,xt,f,a);if(s.lineTo(Oe.x,Oe.y),Lt>0){const qe=Ql(Gt,be,f,a);s.arc(qe.x,qe.y,Lt,xt-ys,be)}}else{s.moveTo(f,a);const je=Math.cos(be)*E+f,xe=Math.sin(be)*E+a;s.lineTo(je,xe);const De=Math.cos(ze)*E+f,Oe=Math.sin(ze)*E+a;s.lineTo(De,Oe)}s.closePath()}function tA(s,e,n,c,h){const{fullCircles:p,startAngle:f,circumference:a}=e;let w=e.endAngle;if(p){Jf(s,e,n,c,w,h);for(let P=0;P<p;++P)s.fill();isNaN(a)||(w=f+(a%Ki||Ki))}return Jf(s,e,n,c,w,h),s.fill(),w}function eA(s,e,n,c,h){const{fullCircles:p,startAngle:f,circumference:a,options:w}=e,{borderWidth:P,borderJoinStyle:k,borderDash:E,borderDashOffset:F}=w,R=w.borderAlign==="inner";if(!P)return;s.setLineDash(E||[]),s.lineDashOffset=F,R?(s.lineWidth=P*2,s.lineJoin=k||"round"):(s.lineWidth=P,s.lineJoin=k||"bevel");let J=e.endAngle;if(p){Jf(s,e,n,c,J,h);for(let rt=0;rt<p;++rt)s.stroke();isNaN(a)||(J=f+(a%Ki||Ki))}R&&YD(s,e,J),p||(Jf(s,e,n,c,J,h),s.stroke())}class Jh extends co{constructor(n){super();_e(this,"circumference");_e(this,"endAngle");_e(this,"fullCircles");_e(this,"innerRadius");_e(this,"outerRadius");_e(this,"pixelMargin");_e(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,c,h){const p=this.getProps(["x","y"],h),{angle:f,distance:a}=K0(p,{x:n,y:c}),{startAngle:w,endAngle:P,innerRadius:k,outerRadius:E,circumference:F}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],h),R=(this.options.spacing+this.options.borderWidth)/2,J=ti(F,P-w),rt=Pu(f,w,P)&&w!==P,mt=J>=Ki||rt,xt=so(a,k+R,E+R);return mt&&xt}getCenterPoint(n){const{x:c,y:h,startAngle:p,endAngle:f,innerRadius:a,outerRadius:w}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:P,spacing:k}=this.options,E=(p+f)/2,F=(a+w+k+P)/2;return{x:c+Math.cos(E)*F,y:h+Math.sin(E)*F}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:c,circumference:h}=this,p=(c.offset||0)/4,f=(c.spacing||0)/2,a=c.circular;if(this.pixelMargin=c.borderAlign==="inner"?.33:0,this.fullCircles=h>Ki?Math.floor(h/Ki):0,h===0||this.innerRadius<0||this.outerRadius<0)return;n.save();const w=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(w)*p,Math.sin(w)*p);const P=1-Math.sin(Math.min(Ji,h||0)),k=p*P;n.fillStyle=c.backgroundColor,n.strokeStyle=c.borderColor,tA(n,this,k,f,a),eA(n,this,k,f,a),n.restore()}}_e(Jh,"id","arc"),_e(Jh,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),_e(Jh,"defaultRoutes",{backgroundColor:"backgroundColor"}),_e(Jh,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"});function I1(s,e,n=e){s.lineCap=ti(n.borderCapStyle,e.borderCapStyle),s.setLineDash(ti(n.borderDash,e.borderDash)),s.lineDashOffset=ti(n.borderDashOffset,e.borderDashOffset),s.lineJoin=ti(n.borderJoinStyle,e.borderJoinStyle),s.lineWidth=ti(n.borderWidth,e.borderWidth),s.strokeStyle=ti(n.borderColor,e.borderColor)}function iA(s,e,n){s.lineTo(n.x,n.y)}function sA(s){return s.stepped?Pk:s.tension||s.cubicInterpolationMode==="monotone"?Ck:iA}function D1(s,e,n={}){const c=s.length,{start:h=0,end:p=c-1}=n,{start:f,end:a}=e,w=Math.max(h,f),P=Math.min(p,a),k=h<f&&p<f||h>a&&p>a;return{count:c,start:w,loop:e.loop,ilen:P<w&&!k?c+P-w:P-w}}function nA(s,e,n,c){const{points:h,options:p}=e,{count:f,start:a,loop:w,ilen:P}=D1(h,n,c),k=sA(p);let{move:E=!0,reverse:F}=c||{},R,J,rt;for(R=0;R<=P;++R)J=h[(a+(F?P-R:R))%f],!J.skip&&(E?(s.moveTo(J.x,J.y),E=!1):k(s,rt,J,F,p.stepped),rt=J);return w&&(J=h[(a+(F?P:0))%f],k(s,rt,J,F,p.stepped)),!!w}function rA(s,e,n,c){const h=e.points,{count:p,start:f,ilen:a}=D1(h,n,c),{move:w=!0,reverse:P}=c||{};let k=0,E=0,F,R,J,rt,mt,xt;const Ct=At=>(f+(P?a-At:At))%p,Lt=()=>{rt!==mt&&(s.lineTo(k,mt),s.lineTo(k,rt),s.lineTo(k,xt))};for(w&&(R=h[Ct(0)],s.moveTo(R.x,R.y)),F=0;F<=a;++F){if(R=h[Ct(F)],R.skip)continue;const At=R.x,Vt=R.y,Yt=At|0;Yt===J?(Vt<rt?rt=Vt:Vt>mt&&(mt=Vt),k=(E*k+At)/++E):(Lt(),s.lineTo(At,Vt),J=Yt,E=0,rt=mt=Vt),xt=Vt}Lt()}function bg(s){const e=s.options,n=e.borderDash&&e.borderDash.length;return!s._decimated&&!s._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!n?rA:nA}function oA(s){return s.stepped?rI:s.tension||s.cubicInterpolationMode==="monotone"?oI:$a}function aA(s,e,n,c){let h=e._path;h||(h=e._path=new Path2D,e.path(h,n,c)&&h.closePath()),I1(s,e.options),s.stroke(h)}function lA(s,e,n,c){const{segments:h,options:p}=e,f=bg(e);for(const a of h)I1(s,p,a.style),s.beginPath(),f(s,e,a,{start:n,end:n+c-1})&&s.closePath(),s.stroke()}const cA=typeof Path2D=="function";function hA(s,e,n,c){cA&&!e.options.segment?aA(s,e,n,c):lA(s,e,n,c)}class Ho extends co{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,n){const c=this.options;if((c.tension||c.cubicInterpolationMode==="monotone")&&!c.stepped&&!this._pointsUpdated){const h=c.spanGaps?this._loop:this._fullLoop;Yk(this._points,c,e,h,n),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=dI(this,this.options.segment))}first(){const e=this.segments,n=this.points;return e.length&&n[e[0].start]}last(){const e=this.segments,n=this.points,c=e.length;return c&&n[e[c-1].end]}interpolate(e,n){const c=this.options,h=e[n],p=this.points,f=g1(this,{property:n,start:h,end:h});if(!f.length)return;const a=[],w=oA(c);let P,k;for(P=0,k=f.length;P<k;++P){const{start:E,end:F}=f[P],R=p[E],J=p[F];if(R===J){a.push(R);continue}const rt=Math.abs((h-R[n])/(J[n]-R[n])),mt=w(R,J,rt,c.stepped);mt[n]=e[n],a.push(mt)}return a.length===1?a[0]:a}pathSegment(e,n,c){return bg(this)(e,this,n,c)}path(e,n,c){const h=this.segments,p=bg(this);let f=this._loop;n=n||0,c=c||this.points.length-n;for(const a of h)f&=p(e,this,a,{start:n,end:n+c-1});return!!f}draw(e,n,c,h){const p=this.options||{};(this.points||[]).length&&p.borderWidth&&(e.save(),hA(e,this,c,h),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}_e(Ho,"id","line"),_e(Ho,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),_e(Ho,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),_e(Ho,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function Ub(s,e,n,c){const h=s.options,{[n]:p}=s.getProps([n],c);return Math.abs(e-p)<h.radius+h.hitRadius}class Ff extends co{constructor(n){super();_e(this,"parsed");_e(this,"skip");_e(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,c,h){const p=this.options,{x:f,y:a}=this.getProps(["x","y"],h);return Math.pow(n-f,2)+Math.pow(c-a,2)<Math.pow(p.hitRadius+p.radius,2)}inXRange(n,c){return Ub(this,n,"x",c)}inYRange(n,c){return Ub(this,n,"y",c)}getCenterPoint(n){const{x:c,y:h}=this.getProps(["x","y"],n);return{x:c,y:h}}size(n){n=n||this.options||{};let c=n.radius||0;c=Math.max(c,c&&n.hoverRadius||0);const h=c&&n.borderWidth||0;return(c+h)*2}draw(n,c){const h=this.options;this.skip||h.radius<.1||!ro(this,c,this.size(h)/2)||(n.strokeStyle=h.borderColor,n.lineWidth=h.borderWidth,n.fillStyle=h.backgroundColor,gg(n,h,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}_e(Ff,"id","point"),_e(Ff,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),_e(Ff,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function A1(s,e){const{x:n,y:c,base:h,width:p,height:f}=s.getProps(["x","y","base","width","height"],e);let a,w,P,k,E;return s.horizontal?(E=f/2,a=Math.min(n,h),w=Math.max(n,h),P=c-E,k=c+E):(E=p/2,a=n-E,w=n+E,P=Math.min(c,h),k=Math.max(c,h)),{left:a,top:P,right:w,bottom:k}}function Zo(s,e,n,c){return s?0:Ls(e,n,c)}function uA(s,e,n){const c=s.options.borderWidth,h=s.borderSkipped,p=r1(c);return{t:Zo(h.top,p.top,0,n),r:Zo(h.right,p.right,0,e),b:Zo(h.bottom,p.bottom,0,n),l:Zo(h.left,p.left,0,e)}}function dA(s,e,n){const{enableBorderRadius:c}=s.getProps(["enableBorderRadius"]),h=s.options.borderRadius,p=Ga(h),f=Math.min(e,n),a=s.borderSkipped,w=c||ui(h);return{topLeft:Zo(!w||a.top||a.left,p.topLeft,0,f),topRight:Zo(!w||a.top||a.right,p.topRight,0,f),bottomLeft:Zo(!w||a.bottom||a.left,p.bottomLeft,0,f),bottomRight:Zo(!w||a.bottom||a.right,p.bottomRight,0,f)}}function fA(s){const e=A1(s),n=e.right-e.left,c=e.bottom-e.top,h=uA(s,n/2,c/2),p=dA(s,n/2,c/2);return{outer:{x:e.left,y:e.top,w:n,h:c,radius:p},inner:{x:e.left+h.l,y:e.top+h.t,w:n-h.l-h.r,h:c-h.t-h.b,radius:{topLeft:Math.max(0,p.topLeft-Math.max(h.t,h.l)),topRight:Math.max(0,p.topRight-Math.max(h.t,h.r)),bottomLeft:Math.max(0,p.bottomLeft-Math.max(h.b,h.l)),bottomRight:Math.max(0,p.bottomRight-Math.max(h.b,h.r))}}}}function Km(s,e,n,c){const h=e===null,p=n===null,a=s&&!(h&&p)&&A1(s,c);return a&&(h||so(e,a.left,a.right))&&(p||so(n,a.top,a.bottom))}function pA(s){return s.topLeft||s.topRight||s.bottomLeft||s.bottomRight}function mA(s,e){s.rect(e.x,e.y,e.w,e.h)}function Ym(s,e,n={}){const c=s.x!==n.x?-e:0,h=s.y!==n.y?-e:0,p=(s.x+s.w!==n.x+n.w?e:0)-c,f=(s.y+s.h!==n.y+n.h?e:0)-h;return{x:s.x+c,y:s.y+h,w:s.w+p,h:s.h+f,radius:s.radius}}class Of extends co{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:n,options:{borderColor:c,backgroundColor:h}}=this,{inner:p,outer:f}=fA(this),a=pA(f.radius)?Cu:mA;e.save(),(f.w!==p.w||f.h!==p.h)&&(e.beginPath(),a(e,Ym(f,n,p)),e.clip(),a(e,Ym(p,-n,f)),e.fillStyle=c,e.fill("evenodd")),e.beginPath(),a(e,Ym(p,n)),e.fillStyle=h,e.fill(),e.restore()}inRange(e,n,c){return Km(this,e,n,c)}inXRange(e,n){return Km(this,e,null,n)}inYRange(e,n){return Km(this,null,e,n)}getCenterPoint(e){const{x:n,y:c,base:h,horizontal:p}=this.getProps(["x","y","base","horizontal"],e);return{x:p?(n+h)/2:n,y:p?c:(c+h)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}_e(Of,"id","bar"),_e(Of,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),_e(Of,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var gA=Object.freeze({__proto__:null,ArcElement:Jh,BarElement:Of,LineElement:Ho,PointElement:Ff});const vg=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Hb=vg.map(s=>s.replace("rgb(","rgba(").replace(")",", 0.5)"));function E1(s){return vg[s%vg.length]}function z1(s){return Hb[s%Hb.length]}function _A(s,e){return s.borderColor=E1(e),s.backgroundColor=z1(e),++e}function yA(s,e){return s.backgroundColor=s.data.map(()=>E1(e++)),e}function xA(s,e){return s.backgroundColor=s.data.map(()=>z1(e++)),e}function bA(s){let e=0;return(n,c)=>{const h=s.getDatasetMeta(c).controller;h instanceof Ua?e=yA(n,e):h instanceof pu?e=xA(n,e):h&&(e=_A(n,e))}}function Zb(s){let e;for(e in s)if(s[e].borderColor||s[e].backgroundColor)return!0;return!1}function vA(s){return s&&(s.borderColor||s.backgroundColor)}function wA(){return ss.borderColor!=="rgba(0,0,0,0.1)"||ss.backgroundColor!=="rgba(0,0,0,0.1)"}var SA={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(s,e,n){if(!n.enabled)return;const{data:{datasets:c},options:h}=s.config,{elements:p}=h,f=Zb(c)||vA(h)||p&&Zb(p)||wA();if(!n.forceOverride&&f)return;const a=bA(s);c.forEach(a)}};function TA(s,e,n,c,h){const p=h.samples||c;if(p>=n)return s.slice(e,e+n);const f=[],a=(n-2)/(p-2);let w=0;const P=e+n-1;let k=e,E,F,R,J,rt;for(f[w++]=s[k],E=0;E<p-2;E++){let mt=0,xt=0,Ct;const Lt=Math.floor((E+1)*a)+1+e,At=Math.min(Math.floor((E+2)*a)+1,n)+e,Vt=At-Lt;for(Ct=Lt;Ct<At;Ct++)mt+=s[Ct].x,xt+=s[Ct].y;mt/=Vt,xt/=Vt;const Yt=Math.floor(E*a)+1+e,Gt=Math.min(Math.floor((E+1)*a)+1,n)+e,{x:ie,y:be}=s[k];for(R=J=-1,Ct=Yt;Ct<Gt;Ct++)J=.5*Math.abs((ie-mt)*(s[Ct].y-be)-(ie-s[Ct].x)*(xt-be)),J>R&&(R=J,F=s[Ct],rt=Ct);f[w++]=F,k=rt}return f[w++]=s[P],f}function MA(s,e,n,c){let h=0,p=0,f,a,w,P,k,E,F,R,J,rt;const mt=[],xt=e+n-1,Ct=s[e].x,At=s[xt].x-Ct;for(f=e;f<e+n;++f){a=s[f],w=(a.x-Ct)/At*c,P=a.y;const Vt=w|0;if(Vt===k)P<J?(J=P,E=f):P>rt&&(rt=P,F=f),h=(p*h+a.x)/++p;else{const Yt=f-1;if(!pi(E)&&!pi(F)){const Gt=Math.min(E,F),ie=Math.max(E,F);Gt!==R&&Gt!==Yt&&mt.push({...s[Gt],x:h}),ie!==R&&ie!==Yt&&mt.push({...s[ie],x:h})}f>0&&Yt!==R&&mt.push(s[Yt]),mt.push(a),k=Vt,p=0,J=rt=P,E=F=R=f}}return mt}function R1(s){if(s._decimated){const e=s._data;delete s._decimated,delete s._data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function Gb(s){s.data.datasets.forEach(e=>{R1(e)})}function PA(s,e){const n=e.length;let c=0,h;const{iScale:p}=s,{min:f,max:a,minDefined:w,maxDefined:P}=p.getUserBounds();return w&&(c=Ls(no(e,p.axis,f).lo,0,n-1)),P?h=Ls(no(e,p.axis,a).hi+1,c,n)-c:h=n-c,{start:c,count:h}}var CA={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(s,e,n)=>{if(!n.enabled){Gb(s);return}const c=s.width;s.data.datasets.forEach((h,p)=>{const{_data:f,indexAxis:a}=h,w=s.getDatasetMeta(p),P=f||h.data;if(Kh([a,s.options.indexAxis])==="y"||!w.controller.supportsDecimation)return;const k=s.scales[w.xAxisID];if(k.type!=="linear"&&k.type!=="time"||s.options.parsing)return;let{start:E,count:F}=PA(w,P);const R=n.threshold||4*c;if(F<=R){R1(h);return}pi(f)&&(h._data=P,delete h.data,Object.defineProperty(h,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(rt){this._data=rt}}));let J;switch(n.algorithm){case"lttb":J=TA(P,E,F,c,n);break;case"min-max":J=MA(P,E,F,c);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}h._decimated=J})},destroy(s){Gb(s)}};function kA(s,e,n){const c=s.segments,h=s.points,p=e.points,f=[];for(const a of c){let{start:w,end:P}=a;P=f_(w,P,h);const k=wg(n,h[w],h[P],a.loop);if(!e.segments){f.push({source:a,target:k,start:h[w],end:h[P]});continue}const E=g1(e,k);for(const F of E){const R=wg(n,p[F.start],p[F.end],F.loop),J=m1(a,h,R);for(const rt of J)f.push({source:rt,target:F,start:{[n]:qb(k,R,"start",Math.max)},end:{[n]:qb(k,R,"end",Math.min)}})}}return f}function wg(s,e,n,c){if(c)return;let h=e[s],p=n[s];return s==="angle"&&(h=An(h),p=An(p)),{property:s,start:h,end:p}}function IA(s,e){const{x:n=null,y:c=null}=s||{},h=e.points,p=[];return e.segments.forEach(({start:f,end:a})=>{a=f_(f,a,h);const w=h[f],P=h[a];c!==null?(p.push({x:w.x,y:c}),p.push({x:P.x,y:c})):n!==null&&(p.push({x:n,y:w.y}),p.push({x:n,y:P.y}))}),p}function f_(s,e,n){for(;e>s;e--){const c=n[e];if(!isNaN(c.x)&&!isNaN(c.y))break}return e}function qb(s,e,n,c){return s&&e?c(s[n],e[n]):s?s[n]:e?e[n]:0}function L1(s,e){let n=[],c=!1;return is(s)?(c=!0,n=s):n=IA(s,e),n.length?new Ho({points:n,options:{tension:0},_loop:c,_fullLoop:c}):null}function Wb(s){return s&&s.fill!==!1}function DA(s,e,n){let h=s[e].fill;const p=[e];let f;if(!n)return h;for(;h!==!1&&p.indexOf(h)===-1;){if(!us(h))return h;if(f=s[h],!f)return!1;if(f.visible)return h;p.push(h),h=f.fill}return!1}function AA(s,e,n){const c=LA(s);if(ui(c))return isNaN(c.value)?!1:c;let h=parseFloat(c);return us(h)&&Math.floor(h)===h?EA(c[0],e,h,n):["origin","start","end","stack","shape"].indexOf(c)>=0&&c}function EA(s,e,n,c){return(s==="-"||s==="+")&&(n=e+n),n===e||n<0||n>=c?!1:n}function zA(s,e){let n=null;return s==="start"?n=e.bottom:s==="end"?n=e.top:ui(s)?n=e.getPixelForValue(s.value):e.getBasePixel&&(n=e.getBasePixel()),n}function RA(s,e,n){let c;return s==="start"?c=n:s==="end"?c=e.options.reverse?e.min:e.max:ui(s)?c=s.value:c=e.getBaseValue(),c}function LA(s){const e=s.options,n=e.fill;let c=ti(n&&n.target,n);return c===void 0&&(c=!!e.backgroundColor),c===!1||c===null?!1:c===!0?"origin":c}function FA(s){const{scale:e,index:n,line:c}=s,h=[],p=c.segments,f=c.points,a=OA(e,n);a.push(L1({x:null,y:e.bottom},c));for(let w=0;w<p.length;w++){const P=p[w];for(let k=P.start;k<=P.end;k++)BA(h,f[k],a)}return new Ho({points:h,options:{}})}function OA(s,e){const n=[],c=s.getMatchingVisibleMetas("line");for(let h=0;h<c.length;h++){const p=c[h];if(p.index===e)break;p.hidden||n.unshift(p.dataset)}return n}function BA(s,e,n){const c=[];for(let h=0;h<n.length;h++){const p=n[h],{first:f,last:a,point:w}=jA(p,e,"x");if(!(!w||f&&a)){if(f)c.unshift(w);else if(s.push(w),!a)break}}s.push(...c)}function jA(s,e,n){const c=s.interpolate(e,n);if(!c)return{};const h=c[n],p=s.segments,f=s.points;let a=!1,w=!1;for(let P=0;P<p.length;P++){const k=p[P],E=f[k.start][n],F=f[k.end][n];if(so(h,E,F)){a=h===E,w=h===F;break}}return{first:a,last:w,point:c}}class F1{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,n,c){const{x:h,y:p,radius:f}=this;return n=n||{start:0,end:Ki},e.arc(h,p,f,n.end,n.start,!0),!c.bounds}interpolate(e){const{x:n,y:c,radius:h}=this,p=e.angle;return{x:n+Math.cos(p)*h,y:c+Math.sin(p)*h,angle:p}}}function NA(s){const{chart:e,fill:n,line:c}=s;if(us(n))return VA(e,n);if(n==="stack")return FA(s);if(n==="shape")return!0;const h=$A(s);return h instanceof F1?h:L1(h,c)}function VA(s,e){const n=s.getDatasetMeta(e);return n&&s.isDatasetVisible(e)?n.dataset:null}function $A(s){return(s.scale||{}).getPointPositionForValue?HA(s):UA(s)}function UA(s){const{scale:e={},fill:n}=s,c=zA(n,e);if(us(c)){const h=e.isHorizontal();return{x:h?c:null,y:h?null:c}}return null}function HA(s){const{scale:e,fill:n}=s,c=e.options,h=e.getLabels().length,p=c.reverse?e.max:e.min,f=RA(n,e,p),a=[];if(c.grid.circular){const w=e.getPointPositionForValue(0,p);return new F1({x:w.x,y:w.y,radius:e.getDistanceFromCenterForValue(f)})}for(let w=0;w<h;++w)a.push(e.getPointPositionForValue(w,f));return a}function Jm(s,e,n){const c=NA(e),{line:h,scale:p,axis:f}=e,a=h.options,w=a.fill,P=a.backgroundColor,{above:k=P,below:E=P}=w||{};c&&h.points.length&&(pp(s,n),ZA(s,{line:h,target:c,above:k,below:E,area:n,scale:p,axis:f}),mp(s))}function ZA(s,e){const{line:n,target:c,above:h,below:p,area:f,scale:a}=e,w=n._loop?"angle":e.axis;s.save(),w==="x"&&p!==h&&(Xb(s,c,f.top),Kb(s,{line:n,target:c,color:h,scale:a,property:w}),s.restore(),s.save(),Xb(s,c,f.bottom)),Kb(s,{line:n,target:c,color:p,scale:a,property:w}),s.restore()}function Xb(s,e,n){const{segments:c,points:h}=e;let p=!0,f=!1;s.beginPath();for(const a of c){const{start:w,end:P}=a,k=h[w],E=h[f_(w,P,h)];p?(s.moveTo(k.x,k.y),p=!1):(s.lineTo(k.x,n),s.lineTo(k.x,k.y)),f=!!e.pathSegment(s,a,{move:f}),f?s.closePath():s.lineTo(E.x,n)}s.lineTo(e.first().x,n),s.closePath(),s.clip()}function Kb(s,e){const{line:n,target:c,property:h,color:p,scale:f}=e,a=kA(n,c,h);for(const{source:w,target:P,start:k,end:E}of a){const{style:{backgroundColor:F=p}={}}=w,R=c!==!0;s.save(),s.fillStyle=F,GA(s,f,R&&wg(h,k,E)),s.beginPath();const J=!!n.pathSegment(s,w);let rt;if(R){J?s.closePath():Yb(s,c,E,h);const mt=!!c.pathSegment(s,P,{move:J,reverse:!0});rt=J&&mt,rt||Yb(s,c,k,h)}s.closePath(),s.fill(rt?"evenodd":"nonzero"),s.restore()}}function GA(s,e,n){const{top:c,bottom:h}=e.chart.chartArea,{property:p,start:f,end:a}=n||{};p==="x"&&(s.beginPath(),s.rect(f,c,a-f,h-c),s.clip())}function Yb(s,e,n,c){const h=e.interpolate(n,c);h&&s.lineTo(h.x,h.y)}var qA={id:"filler",afterDatasetsUpdate(s,e,n){const c=(s.data.datasets||[]).length,h=[];let p,f,a,w;for(f=0;f<c;++f)p=s.getDatasetMeta(f),a=p.dataset,w=null,a&&a.options&&a instanceof Ho&&(w={visible:s.isDatasetVisible(f),index:f,fill:AA(a,f,c),chart:s,axis:p.controller.options.indexAxis,scale:p.vScale,line:a}),p.$filler=w,h.push(w);for(f=0;f<c;++f)w=h[f],!(!w||w.fill===!1)&&(w.fill=DA(h,f,n.propagate))},beforeDraw(s,e,n){const c=n.drawTime==="beforeDraw",h=s.getSortedVisibleDatasetMetas(),p=s.chartArea;for(let f=h.length-1;f>=0;--f){const a=h[f].$filler;a&&(a.line.updateControlPoints(p,a.axis),c&&a.fill&&Jm(s.ctx,a,p))}},beforeDatasetsDraw(s,e,n){if(n.drawTime!=="beforeDatasetsDraw")return;const c=s.getSortedVisibleDatasetMetas();for(let h=c.length-1;h>=0;--h){const p=c[h].$filler;Wb(p)&&Jm(s.ctx,p,s.chartArea)}},beforeDatasetDraw(s,e,n){const c=e.meta.$filler;!Wb(c)||n.drawTime!=="beforeDatasetDraw"||Jm(s.ctx,c,s.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Jb=(s,e)=>{let{boxHeight:n=e,boxWidth:c=e}=s;return s.usePointStyle&&(n=Math.min(n,e),c=s.pointStyleWidth||Math.min(c,e)),{boxWidth:c,boxHeight:n,itemHeight:Math.max(e,n)}},WA=(s,e)=>s!==null&&e!==null&&s.datasetIndex===e.datasetIndex&&s.index===e.index;class Qb extends co{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n,c){this.maxWidth=e,this.maxHeight=n,this._margins=c,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let n=Gi(e.generateLabels,[this.chart],this)||[];e.filter&&(n=n.filter(c=>e.filter(c,this.chart.data))),e.sort&&(n=n.sort((c,h)=>e.sort(c,h,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:e,ctx:n}=this;if(!e.display){this.width=this.height=0;return}const c=e.labels,h=Is(c.font),p=h.size,f=this._computeTitleHeight(),{boxWidth:a,itemHeight:w}=Jb(c,p);let P,k;n.font=h.string,this.isHorizontal()?(P=this.maxWidth,k=this._fitRows(f,p,a,w)+10):(k=this.maxHeight,P=this._fitCols(f,h,a,w)+10),this.width=Math.min(P,e.maxWidth||this.maxWidth),this.height=Math.min(k,e.maxHeight||this.maxHeight)}_fitRows(e,n,c,h){const{ctx:p,maxWidth:f,options:{labels:{padding:a}}}=this,w=this.legendHitBoxes=[],P=this.lineWidths=[0],k=h+a;let E=e;p.textAlign="left",p.textBaseline="middle";let F=-1,R=-k;return this.legendItems.forEach((J,rt)=>{const mt=c+n/2+p.measureText(J.text).width;(rt===0||P[P.length-1]+mt+2*a>f)&&(E+=k,P[P.length-(rt>0?0:1)]=0,R+=k,F++),w[rt]={left:0,top:R,row:F,width:mt,height:h},P[P.length-1]+=mt+a}),E}_fitCols(e,n,c,h){const{ctx:p,maxHeight:f,options:{labels:{padding:a}}}=this,w=this.legendHitBoxes=[],P=this.columnSizes=[],k=f-e;let E=a,F=0,R=0,J=0,rt=0;return this.legendItems.forEach((mt,xt)=>{const{itemWidth:Ct,itemHeight:Lt}=XA(c,n,p,mt,h);xt>0&&R+Lt+2*a>k&&(E+=F+a,P.push({width:F,height:R}),J+=F+a,rt++,F=R=0),w[xt]={left:J,top:R,col:rt,width:Ct,height:Lt},F=Math.max(F,Ct),R+=Lt+a}),E+=F,P.push({width:F,height:R}),E}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:c,labels:{padding:h},rtl:p}}=this,f=cc(p,this.left,this.width);if(this.isHorizontal()){let a=0,w=Us(c,this.left+h,this.right-this.lineWidths[a]);for(const P of n)a!==P.row&&(a=P.row,w=Us(c,this.left+h,this.right-this.lineWidths[a])),P.top+=this.top+e+h,P.left=f.leftForLtr(f.x(w),P.width),w+=P.width+h}else{let a=0,w=Us(c,this.top+e+h,this.bottom-this.columnSizes[a].height);for(const P of n)P.col!==a&&(a=P.col,w=Us(c,this.top+e+h,this.bottom-this.columnSizes[a].height)),P.top=w,P.left+=this.left+h,P.left=f.leftForLtr(f.x(P.left),P.width),w+=P.height+h}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;pp(e,this),this._draw(),mp(e)}}_draw(){const{options:e,columnSizes:n,lineWidths:c,ctx:h}=this,{align:p,labels:f}=e,a=ss.color,w=cc(e.rtl,this.left,this.width),P=Is(f.font),{padding:k}=f,E=P.size,F=E/2;let R;this.drawTitle(),h.textAlign=w.textAlign("left"),h.textBaseline="middle",h.lineWidth=.5,h.font=P.string;const{boxWidth:J,boxHeight:rt,itemHeight:mt}=Jb(f,E),xt=function(Yt,Gt,ie){if(isNaN(J)||J<=0||isNaN(rt)||rt<0)return;h.save();const be=ti(ie.lineWidth,1);if(h.fillStyle=ti(ie.fillStyle,a),h.lineCap=ti(ie.lineCap,"butt"),h.lineDashOffset=ti(ie.lineDashOffset,0),h.lineJoin=ti(ie.lineJoin,"miter"),h.lineWidth=be,h.strokeStyle=ti(ie.strokeStyle,a),h.setLineDash(ti(ie.lineDash,[])),f.usePointStyle){const ze={radius:rt*Math.SQRT2/2,pointStyle:ie.pointStyle,rotation:ie.rotation,borderWidth:be},Me=w.xPlus(Yt,J/2),Fe=Gt+F;n1(h,ze,Me,Fe,f.pointStyleWidth&&J)}else{const ze=Gt+Math.max((E-rt)/2,0),Me=w.leftForLtr(Yt,J),Fe=Ga(ie.borderRadius);h.beginPath(),Object.values(Fe).some(Ve=>Ve!==0)?Cu(h,{x:Me,y:ze,w:J,h:rt,radius:Fe}):h.rect(Me,ze,J,rt),h.fill(),be!==0&&h.stroke()}h.restore()},Ct=function(Yt,Gt,ie){Ka(h,ie.text,Yt,Gt+mt/2,P,{strikethrough:ie.hidden,textAlign:w.textAlign(ie.textAlign)})},Lt=this.isHorizontal(),At=this._computeTitleHeight();Lt?R={x:Us(p,this.left+k,this.right-c[0]),y:this.top+k+At,line:0}:R={x:this.left+k,y:Us(p,this.top+At+k,this.bottom-n[0].height),line:0},d1(this.ctx,e.textDirection);const Vt=mt+k;this.legendItems.forEach((Yt,Gt)=>{h.strokeStyle=Yt.fontColor,h.fillStyle=Yt.fontColor;const ie=h.measureText(Yt.text).width,be=w.textAlign(Yt.textAlign||(Yt.textAlign=f.textAlign)),ze=J+F+ie;let Me=R.x,Fe=R.y;w.setWidth(this.width),Lt?Gt>0&&Me+ze+k>this.right&&(Fe=R.y+=Vt,R.line++,Me=R.x=Us(p,this.left+k,this.right-c[R.line])):Gt>0&&Fe+Vt>this.bottom&&(Me=R.x=Me+n[R.line].width+k,R.line++,Fe=R.y=Us(p,this.top+At+k,this.bottom-n[R.line].height));const Ve=w.x(Me);if(xt(Ve,Fe,Yt),Me=mk(be,Me+J+F,Lt?Me+ze:this.right,e.rtl),Ct(w.x(Me),Fe,Yt),Lt)R.x+=ze+k;else if(typeof Yt.text!="string"){const He=P.lineHeight;R.y+=O1(Yt,He)+k}else R.y+=Vt}),f1(this.ctx,e.textDirection)}drawTitle(){const e=this.options,n=e.title,c=Is(n.font),h=Ys(n.padding);if(!n.display)return;const p=cc(e.rtl,this.left,this.width),f=this.ctx,a=n.position,w=c.size/2,P=h.top+w;let k,E=this.left,F=this.width;if(this.isHorizontal())F=Math.max(...this.lineWidths),k=this.top+P,E=Us(e.align,E,this.right-F);else{const J=this.columnSizes.reduce((rt,mt)=>Math.max(rt,mt.height),0);k=P+Us(e.align,this.top,this.bottom-J-e.labels.padding-this._computeTitleHeight())}const R=Us(a,E,E+F);f.textAlign=p.textAlign(n_(a)),f.textBaseline="middle",f.strokeStyle=n.color,f.fillStyle=n.color,f.font=c.string,Ka(f,n.text,R,k,c)}_computeTitleHeight(){const e=this.options.title,n=Is(e.font),c=Ys(e.padding);return e.display?n.lineHeight+c.height:0}_getLegendItemAt(e,n){let c,h,p;if(so(e,this.left,this.right)&&so(n,this.top,this.bottom)){for(p=this.legendHitBoxes,c=0;c<p.length;++c)if(h=p[c],so(e,h.left,h.left+h.width)&&so(n,h.top,h.top+h.height))return this.legendItems[c]}return null}handleEvent(e){const n=this.options;if(!JA(e.type,n))return;const c=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const h=this._hoveredItem,p=WA(h,c);h&&!p&&Gi(n.onLeave,[e,h,this],this),this._hoveredItem=c,c&&!p&&Gi(n.onHover,[e,c,this],this)}else c&&Gi(n.onClick,[e,c,this],this)}}function XA(s,e,n,c,h){const p=KA(c,s,e,n),f=YA(h,c,e.lineHeight);return{itemWidth:p,itemHeight:f}}function KA(s,e,n,c){let h=s.text;return h&&typeof h!="string"&&(h=h.reduce((p,f)=>p.length>f.length?p:f)),e+n.size/2+c.measureText(h).width}function YA(s,e,n){let c=s;return typeof e.text!="string"&&(c=O1(e,n)),c}function O1(s,e){const n=s.text?s.text.length:0;return e*n}function JA(s,e){return!!((s==="mousemove"||s==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(s==="click"||s==="mouseup"))}var QA={id:"legend",_element:Qb,start(s,e,n){const c=s.legend=new Qb({ctx:s.ctx,options:n,chart:s});Ws.configure(s,c,n),Ws.addBox(s,c)},stop(s){Ws.removeBox(s,s.legend),delete s.legend},beforeUpdate(s,e,n){const c=s.legend;Ws.configure(s,c,n),c.options=n},afterUpdate(s){const e=s.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(s,e){e.replay||s.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(s,e,n){const c=e.datasetIndex,h=n.chart;h.isDatasetVisible(c)?(h.hide(c),e.hidden=!0):(h.show(c),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:s=>s.chart.options.color,boxWidth:40,padding:10,generateLabels(s){const e=s.data.datasets,{labels:{usePointStyle:n,pointStyle:c,textAlign:h,color:p,useBorderRadius:f,borderRadius:a}}=s.legend.options;return s._getSortedDatasetMetas().map(w=>{const P=w.controller.getStyle(n?0:void 0),k=Ys(P.borderWidth);return{text:e[w.index].label,fillStyle:P.backgroundColor,fontColor:p,hidden:!w.visible,lineCap:P.borderCapStyle,lineDash:P.borderDash,lineDashOffset:P.borderDashOffset,lineJoin:P.borderJoinStyle,lineWidth:(k.width+k.height)/4,strokeStyle:P.borderColor,pointStyle:c||P.pointStyle,rotation:P.rotation,textAlign:h||P.textAlign,borderRadius:f&&(a||P.borderRadius),datasetIndex:w.index}},this)}},title:{color:s=>s.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:s=>!s.startsWith("on"),labels:{_scriptable:s=>!["generateLabels","filter","sort"].includes(s)}}};class p_ extends co{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n){const c=this.options;if(this.left=0,this.top=0,!c.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=n;const h=is(c.text)?c.text.length:1;this._padding=Ys(c.padding);const p=h*Is(c.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=p:this.width=p}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:n,left:c,bottom:h,right:p,options:f}=this,a=f.align;let w=0,P,k,E;return this.isHorizontal()?(k=Us(a,c,p),E=n+e,P=p-c):(f.position==="left"?(k=c+e,E=Us(a,h,n),w=Ji*-.5):(k=p-e,E=Us(a,n,h),w=Ji*.5),P=h-n),{titleX:k,titleY:E,maxWidth:P,rotation:w}}draw(){const e=this.ctx,n=this.options;if(!n.display)return;const c=Is(n.font),p=c.lineHeight/2+this._padding.top,{titleX:f,titleY:a,maxWidth:w,rotation:P}=this._drawArgs(p);Ka(e,n.text,0,0,c,{color:n.color,maxWidth:w,rotation:P,textAlign:n_(n.align),textBaseline:"middle",translation:[f,a]})}}function tE(s,e){const n=new p_({ctx:s.ctx,options:e,chart:s});Ws.configure(s,n,e),Ws.addBox(s,n),s.titleBlock=n}var eE={id:"title",_element:p_,start(s,e,n){tE(s,n)},stop(s){const e=s.titleBlock;Ws.removeBox(s,e),delete s.titleBlock},beforeUpdate(s,e,n){const c=s.titleBlock;Ws.configure(s,c,n),c.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const _f=new WeakMap;var iE={id:"subtitle",start(s,e,n){const c=new p_({ctx:s.ctx,options:n,chart:s});Ws.configure(s,c,n),Ws.addBox(s,c),_f.set(s,c)},stop(s){Ws.removeBox(s,_f.get(s)),_f.delete(s)},beforeUpdate(s,e,n){const c=_f.get(s);Ws.configure(s,c,n),c.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Qh={average(s){if(!s.length)return!1;let e,n,c=new Set,h=0,p=0;for(e=0,n=s.length;e<n;++e){const a=s[e].element;if(a&&a.hasValue()){const w=a.tooltipPosition();c.add(w.x),h+=w.y,++p}}return p===0||c.size===0?!1:{x:[...c].reduce((a,w)=>a+w)/c.size,y:h/p}},nearest(s,e){if(!s.length)return!1;let n=e.x,c=e.y,h=Number.POSITIVE_INFINITY,p,f,a;for(p=0,f=s.length;p<f;++p){const w=s[p].element;if(w&&w.hasValue()){const P=w.getCenterPoint(),k=pg(e,P);k<h&&(h=k,a=w)}}if(a){const w=a.tooltipPosition();n=w.x,c=w.y}return{x:n,y:c}}};function yr(s,e){return e&&(is(e)?Array.prototype.push.apply(s,e):s.push(e)),s}function Xr(s){return(typeof s=="string"||s instanceof String)&&s.indexOf(`
`)>-1?s.split(`
`):s}function sE(s,e){const{element:n,datasetIndex:c,index:h}=e,p=s.getDatasetMeta(c).controller,{label:f,value:a}=p.getLabelAndValue(h);return{chart:s,label:f,parsed:p.getParsed(h),raw:s.data.datasets[c].data[h],formattedValue:a,dataset:p.getDataset(),dataIndex:h,datasetIndex:c,element:n}}function tv(s,e){const n=s.chart.ctx,{body:c,footer:h,title:p}=s,{boxWidth:f,boxHeight:a}=e,w=Is(e.bodyFont),P=Is(e.titleFont),k=Is(e.footerFont),E=p.length,F=h.length,R=c.length,J=Ys(e.padding);let rt=J.height,mt=0,xt=c.reduce((At,Vt)=>At+Vt.before.length+Vt.lines.length+Vt.after.length,0);if(xt+=s.beforeBody.length+s.afterBody.length,E&&(rt+=E*P.lineHeight+(E-1)*e.titleSpacing+e.titleMarginBottom),xt){const At=e.displayColors?Math.max(a,w.lineHeight):w.lineHeight;rt+=R*At+(xt-R)*w.lineHeight+(xt-1)*e.bodySpacing}F&&(rt+=e.footerMarginTop+F*k.lineHeight+(F-1)*e.footerSpacing);let Ct=0;const Lt=function(At){mt=Math.max(mt,n.measureText(At).width+Ct)};return n.save(),n.font=P.string,Ci(s.title,Lt),n.font=w.string,Ci(s.beforeBody.concat(s.afterBody),Lt),Ct=e.displayColors?f+2+e.boxPadding:0,Ci(c,At=>{Ci(At.before,Lt),Ci(At.lines,Lt),Ci(At.after,Lt)}),Ct=0,n.font=k.string,Ci(s.footer,Lt),n.restore(),mt+=J.width,{width:mt,height:rt}}function nE(s,e){const{y:n,height:c}=e;return n<c/2?"top":n>s.height-c/2?"bottom":"center"}function rE(s,e,n,c){const{x:h,width:p}=c,f=n.caretSize+n.caretPadding;if(s==="left"&&h+p+f>e.width||s==="right"&&h-p-f<0)return!0}function oE(s,e,n,c){const{x:h,width:p}=n,{width:f,chartArea:{left:a,right:w}}=s;let P="center";return c==="center"?P=h<=(a+w)/2?"left":"right":h<=p/2?P="left":h>=f-p/2&&(P="right"),rE(P,s,e,n)&&(P="center"),P}function ev(s,e,n){const c=n.yAlign||e.yAlign||nE(s,n);return{xAlign:n.xAlign||e.xAlign||oE(s,e,n,c),yAlign:c}}function aE(s,e){let{x:n,width:c}=s;return e==="right"?n-=c:e==="center"&&(n-=c/2),n}function lE(s,e,n){let{y:c,height:h}=s;return e==="top"?c+=n:e==="bottom"?c-=h+n:c-=h/2,c}function iv(s,e,n,c){const{caretSize:h,caretPadding:p,cornerRadius:f}=s,{xAlign:a,yAlign:w}=n,P=h+p,{topLeft:k,topRight:E,bottomLeft:F,bottomRight:R}=Ga(f);let J=aE(e,a);const rt=lE(e,w,P);return w==="center"?a==="left"?J+=P:a==="right"&&(J-=P):a==="left"?J-=Math.max(k,F)+h:a==="right"&&(J+=Math.max(E,R)+h),{x:Ls(J,0,c.width-e.width),y:Ls(rt,0,c.height-e.height)}}function yf(s,e,n){const c=Ys(n.padding);return e==="center"?s.x+s.width/2:e==="right"?s.x+s.width-c.right:s.x+c.left}function sv(s){return yr([],Xr(s))}function cE(s,e,n){return Qo(s,{tooltip:e,tooltipItems:n,type:"tooltip"})}function nv(s,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?s.override(n):s}const B1={beforeTitle:qr,title(s){if(s.length>0){const e=s[0],n=e.chart.data.labels,c=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(c>0&&e.dataIndex<c)return n[e.dataIndex]}return""},afterTitle:qr,beforeBody:qr,beforeLabel:qr,label(s){if(this&&this.options&&this.options.mode==="dataset")return s.label+": "+s.formattedValue||s.formattedValue;let e=s.dataset.label||"";e&&(e+=": ");const n=s.formattedValue;return pi(n)||(e+=n),e},labelColor(s){const n=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(s){const n=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:qr,afterBody:qr,beforeFooter:qr,footer:qr,afterFooter:qr};function _n(s,e,n,c){const h=s[e].call(n,c);return typeof h>"u"?B1[e].call(n,c):h}class Sg extends co{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const n=this.chart,c=this.options.setContext(this.getContext()),h=c.enabled&&n.options.animation&&c.animations,p=new _1(this.chart,h);return h._cacheable&&(this._cachedAnimations=Object.freeze(p)),p}getContext(){return this.$context||(this.$context=cE(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,n){const{callbacks:c}=n,h=_n(c,"beforeTitle",this,e),p=_n(c,"title",this,e),f=_n(c,"afterTitle",this,e);let a=[];return a=yr(a,Xr(h)),a=yr(a,Xr(p)),a=yr(a,Xr(f)),a}getBeforeBody(e,n){return sv(_n(n.callbacks,"beforeBody",this,e))}getBody(e,n){const{callbacks:c}=n,h=[];return Ci(e,p=>{const f={before:[],lines:[],after:[]},a=nv(c,p);yr(f.before,Xr(_n(a,"beforeLabel",this,p))),yr(f.lines,_n(a,"label",this,p)),yr(f.after,Xr(_n(a,"afterLabel",this,p))),h.push(f)}),h}getAfterBody(e,n){return sv(_n(n.callbacks,"afterBody",this,e))}getFooter(e,n){const{callbacks:c}=n,h=_n(c,"beforeFooter",this,e),p=_n(c,"footer",this,e),f=_n(c,"afterFooter",this,e);let a=[];return a=yr(a,Xr(h)),a=yr(a,Xr(p)),a=yr(a,Xr(f)),a}_createItems(e){const n=this._active,c=this.chart.data,h=[],p=[],f=[];let a=[],w,P;for(w=0,P=n.length;w<P;++w)a.push(sE(this.chart,n[w]));return e.filter&&(a=a.filter((k,E,F)=>e.filter(k,E,F,c))),e.itemSort&&(a=a.sort((k,E)=>e.itemSort(k,E,c))),Ci(a,k=>{const E=nv(e.callbacks,k);h.push(_n(E,"labelColor",this,k)),p.push(_n(E,"labelPointStyle",this,k)),f.push(_n(E,"labelTextColor",this,k))}),this.labelColors=h,this.labelPointStyles=p,this.labelTextColors=f,this.dataPoints=a,a}update(e,n){const c=this.options.setContext(this.getContext()),h=this._active;let p,f=[];if(!h.length)this.opacity!==0&&(p={opacity:0});else{const a=Qh[c.position].call(this,h,this._eventPosition);f=this._createItems(c),this.title=this.getTitle(f,c),this.beforeBody=this.getBeforeBody(f,c),this.body=this.getBody(f,c),this.afterBody=this.getAfterBody(f,c),this.footer=this.getFooter(f,c);const w=this._size=tv(this,c),P=Object.assign({},a,w),k=ev(this.chart,c,P),E=iv(c,P,k,this.chart);this.xAlign=k.xAlign,this.yAlign=k.yAlign,p={opacity:1,x:E.x,y:E.y,width:w.width,height:w.height,caretX:a.x,caretY:a.y}}this._tooltipItems=f,this.$context=void 0,p&&this._resolveAnimations().update(this,p),e&&c.external&&c.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(e,n,c,h){const p=this.getCaretPosition(e,c,h);n.lineTo(p.x1,p.y1),n.lineTo(p.x2,p.y2),n.lineTo(p.x3,p.y3)}getCaretPosition(e,n,c){const{xAlign:h,yAlign:p}=this,{caretSize:f,cornerRadius:a}=c,{topLeft:w,topRight:P,bottomLeft:k,bottomRight:E}=Ga(a),{x:F,y:R}=e,{width:J,height:rt}=n;let mt,xt,Ct,Lt,At,Vt;return p==="center"?(At=R+rt/2,h==="left"?(mt=F,xt=mt-f,Lt=At+f,Vt=At-f):(mt=F+J,xt=mt+f,Lt=At-f,Vt=At+f),Ct=mt):(h==="left"?xt=F+Math.max(w,k)+f:h==="right"?xt=F+J-Math.max(P,E)-f:xt=this.caretX,p==="top"?(Lt=R,At=Lt-f,mt=xt-f,Ct=xt+f):(Lt=R+rt,At=Lt+f,mt=xt+f,Ct=xt-f),Vt=Lt),{x1:mt,x2:xt,x3:Ct,y1:Lt,y2:At,y3:Vt}}drawTitle(e,n,c){const h=this.title,p=h.length;let f,a,w;if(p){const P=cc(c.rtl,this.x,this.width);for(e.x=yf(this,c.titleAlign,c),n.textAlign=P.textAlign(c.titleAlign),n.textBaseline="middle",f=Is(c.titleFont),a=c.titleSpacing,n.fillStyle=c.titleColor,n.font=f.string,w=0;w<p;++w)n.fillText(h[w],P.x(e.x),e.y+f.lineHeight/2),e.y+=f.lineHeight+a,w+1===p&&(e.y+=c.titleMarginBottom-a)}}_drawColorBox(e,n,c,h,p){const f=this.labelColors[c],a=this.labelPointStyles[c],{boxHeight:w,boxWidth:P}=p,k=Is(p.bodyFont),E=yf(this,"left",p),F=h.x(E),R=w<k.lineHeight?(k.lineHeight-w)/2:0,J=n.y+R;if(p.usePointStyle){const rt={radius:Math.min(P,w)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},mt=h.leftForLtr(F,P)+P/2,xt=J+w/2;e.strokeStyle=p.multiKeyBackground,e.fillStyle=p.multiKeyBackground,gg(e,rt,mt,xt),e.strokeStyle=f.borderColor,e.fillStyle=f.backgroundColor,gg(e,rt,mt,xt)}else{e.lineWidth=ui(f.borderWidth)?Math.max(...Object.values(f.borderWidth)):f.borderWidth||1,e.strokeStyle=f.borderColor,e.setLineDash(f.borderDash||[]),e.lineDashOffset=f.borderDashOffset||0;const rt=h.leftForLtr(F,P),mt=h.leftForLtr(h.xPlus(F,1),P-2),xt=Ga(f.borderRadius);Object.values(xt).some(Ct=>Ct!==0)?(e.beginPath(),e.fillStyle=p.multiKeyBackground,Cu(e,{x:rt,y:J,w:P,h:w,radius:xt}),e.fill(),e.stroke(),e.fillStyle=f.backgroundColor,e.beginPath(),Cu(e,{x:mt,y:J+1,w:P-2,h:w-2,radius:xt}),e.fill()):(e.fillStyle=p.multiKeyBackground,e.fillRect(rt,J,P,w),e.strokeRect(rt,J,P,w),e.fillStyle=f.backgroundColor,e.fillRect(mt,J+1,P-2,w-2))}e.fillStyle=this.labelTextColors[c]}drawBody(e,n,c){const{body:h}=this,{bodySpacing:p,bodyAlign:f,displayColors:a,boxHeight:w,boxWidth:P,boxPadding:k}=c,E=Is(c.bodyFont);let F=E.lineHeight,R=0;const J=cc(c.rtl,this.x,this.width),rt=function(ie){n.fillText(ie,J.x(e.x+R),e.y+F/2),e.y+=F+p},mt=J.textAlign(f);let xt,Ct,Lt,At,Vt,Yt,Gt;for(n.textAlign=f,n.textBaseline="middle",n.font=E.string,e.x=yf(this,mt,c),n.fillStyle=c.bodyColor,Ci(this.beforeBody,rt),R=a&&mt!=="right"?f==="center"?P/2+k:P+2+k:0,At=0,Yt=h.length;At<Yt;++At){for(xt=h[At],Ct=this.labelTextColors[At],n.fillStyle=Ct,Ci(xt.before,rt),Lt=xt.lines,a&&Lt.length&&(this._drawColorBox(n,e,At,J,c),F=Math.max(E.lineHeight,w)),Vt=0,Gt=Lt.length;Vt<Gt;++Vt)rt(Lt[Vt]),F=E.lineHeight;Ci(xt.after,rt)}R=0,F=E.lineHeight,Ci(this.afterBody,rt),e.y-=p}drawFooter(e,n,c){const h=this.footer,p=h.length;let f,a;if(p){const w=cc(c.rtl,this.x,this.width);for(e.x=yf(this,c.footerAlign,c),e.y+=c.footerMarginTop,n.textAlign=w.textAlign(c.footerAlign),n.textBaseline="middle",f=Is(c.footerFont),n.fillStyle=c.footerColor,n.font=f.string,a=0;a<p;++a)n.fillText(h[a],w.x(e.x),e.y+f.lineHeight/2),e.y+=f.lineHeight+c.footerSpacing}}drawBackground(e,n,c,h){const{xAlign:p,yAlign:f}=this,{x:a,y:w}=e,{width:P,height:k}=c,{topLeft:E,topRight:F,bottomLeft:R,bottomRight:J}=Ga(h.cornerRadius);n.fillStyle=h.backgroundColor,n.strokeStyle=h.borderColor,n.lineWidth=h.borderWidth,n.beginPath(),n.moveTo(a+E,w),f==="top"&&this.drawCaret(e,n,c,h),n.lineTo(a+P-F,w),n.quadraticCurveTo(a+P,w,a+P,w+F),f==="center"&&p==="right"&&this.drawCaret(e,n,c,h),n.lineTo(a+P,w+k-J),n.quadraticCurveTo(a+P,w+k,a+P-J,w+k),f==="bottom"&&this.drawCaret(e,n,c,h),n.lineTo(a+R,w+k),n.quadraticCurveTo(a,w+k,a,w+k-R),f==="center"&&p==="left"&&this.drawCaret(e,n,c,h),n.lineTo(a,w+E),n.quadraticCurveTo(a,w,a+E,w),n.closePath(),n.fill(),h.borderWidth>0&&n.stroke()}_updateAnimationTarget(e){const n=this.chart,c=this.$animations,h=c&&c.x,p=c&&c.y;if(h||p){const f=Qh[e.position].call(this,this._active,this._eventPosition);if(!f)return;const a=this._size=tv(this,e),w=Object.assign({},f,this._size),P=ev(n,e,w),k=iv(e,w,P,n);(h._to!==k.x||p._to!==k.y)&&(this.xAlign=P.xAlign,this.yAlign=P.yAlign,this.width=a.width,this.height=a.height,this.caretX=f.x,this.caretY=f.y,this._resolveAnimations().update(this,k))}}_willRender(){return!!this.opacity}draw(e){const n=this.options.setContext(this.getContext());let c=this.opacity;if(!c)return;this._updateAnimationTarget(n);const h={width:this.width,height:this.height},p={x:this.x,y:this.y};c=Math.abs(c)<.001?0:c;const f=Ys(n.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&a&&(e.save(),e.globalAlpha=c,this.drawBackground(p,e,h,n),d1(e,n.textDirection),p.y+=f.top,this.drawTitle(p,e,n),this.drawBody(p,e,n),this.drawFooter(p,e,n),f1(e,n.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,n){const c=this._active,h=e.map(({datasetIndex:a,index:w})=>{const P=this.chart.getDatasetMeta(a);if(!P)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:P.data[w],index:w}}),p=!Gf(c,h),f=this._positionChanged(h,n);(p||f)&&(this._active=h,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,n,c=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const h=this.options,p=this._active||[],f=this._getActiveElements(e,p,n,c),a=this._positionChanged(f,e),w=n||!Gf(f,p)||a;return w&&(this._active=f,(h.enabled||h.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,n))),w}_getActiveElements(e,n,c,h){const p=this.options;if(e.type==="mouseout")return[];if(!h)return n.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const f=this.chart.getElementsAtEventForMode(e,p.mode,p,c);return p.reverse&&f.reverse(),f}_positionChanged(e,n){const{caretX:c,caretY:h,options:p}=this,f=Qh[p.position].call(this,e,n);return f!==!1&&(c!==f.x||h!==f.y)}}_e(Sg,"positioners",Qh);var hE={id:"tooltip",_element:Sg,positioners:Qh,afterInit(s,e,n){n&&(s.tooltip=new Sg({chart:s,options:n}))},beforeUpdate(s,e,n){s.tooltip&&s.tooltip.initialize(n)},reset(s,e,n){s.tooltip&&s.tooltip.initialize(n)},afterDraw(s){const e=s.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(s.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;e.draw(s.ctx),s.notifyPlugins("afterTooltipDraw",n)}},afterEvent(s,e){if(s.tooltip){const n=e.replay;s.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(s,e)=>e.bodyFont.size,boxWidth:(s,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:B1},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:s=>s!=="filter"&&s!=="itemSort"&&s!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},uE=Object.freeze({__proto__:null,Colors:SA,Decimation:CA,Filler:qA,Legend:QA,SubTitle:iE,Title:eE,Tooltip:hE});const dE=(s,e,n,c)=>(typeof e=="string"?(n=s.push(e)-1,c.unshift({index:n,label:e})):isNaN(e)&&(n=null),n);function fE(s,e,n,c){const h=s.indexOf(e);if(h===-1)return dE(s,e,n,c);const p=s.lastIndexOf(e);return h!==p?n:h}const pE=(s,e)=>s===null?null:Ls(Math.round(s),0,e);function rv(s){const e=this.getLabels();return s>=0&&s<e.length?e[s]:s}class Tg extends Ja{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const n=this._addedLabels;if(n.length){const c=this.getLabels();for(const{index:h,label:p}of n)c[h]===p&&c.splice(h,1);this._addedLabels=[]}super.init(e)}parse(e,n){if(pi(e))return null;const c=this.getLabels();return n=isFinite(n)&&c[n]===e?n:fE(c,e,ti(n,e),this._addedLabels),pE(n,c.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:c,max:h}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(c=0),n||(h=this.getLabels().length-1)),this.min=c,this.max=h}buildTicks(){const e=this.min,n=this.max,c=this.options.offset,h=[];let p=this.getLabels();p=e===0&&n===p.length-1?p:p.slice(e,n+1),this._valueRange=Math.max(p.length-(c?0:1),1),this._startValue=this.min-(c?.5:0);for(let f=e;f<=n;f++)h.push({value:f});return h}getLabelForValue(e){return rv.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}_e(Tg,"id","category"),_e(Tg,"defaults",{ticks:{callback:rv}});function mE(s,e){const n=[],{bounds:h,step:p,min:f,max:a,precision:w,count:P,maxTicks:k,maxDigits:E,includeBounds:F}=s,R=p||1,J=k-1,{min:rt,max:mt}=e,xt=!pi(f),Ct=!pi(a),Lt=!pi(P),At=(mt-rt)/(E+1);let Vt=tb((mt-rt)/J/R)*R,Yt,Gt,ie,be;if(Vt<1e-14&&!xt&&!Ct)return[{value:rt},{value:mt}];be=Math.ceil(mt/Vt)-Math.floor(rt/Vt),be>J&&(Vt=tb(be*Vt/J/R)*R),pi(w)||(Yt=Math.pow(10,w),Vt=Math.ceil(Vt*Yt)/Yt),h==="ticks"?(Gt=Math.floor(rt/Vt)*Vt,ie=Math.ceil(mt/Vt)*Vt):(Gt=rt,ie=mt),xt&&Ct&&p&&lk((a-f)/p,Vt/1e3)?(be=Math.round(Math.min((a-f)/Vt,k)),Vt=(a-f)/be,Gt=f,ie=a):Lt?(Gt=xt?f:Gt,ie=Ct?a:ie,be=P-1,Vt=(ie-Gt)/be):(be=(ie-Gt)/Vt,uu(be,Math.round(be),Vt/1e3)?be=Math.round(be):be=Math.ceil(be));const ze=Math.max(eb(Vt),eb(Gt));Yt=Math.pow(10,pi(w)?ze:w),Gt=Math.round(Gt*Yt)/Yt,ie=Math.round(ie*Yt)/Yt;let Me=0;for(xt&&(F&&Gt!==f?(n.push({value:f}),Gt<f&&Me++,uu(Math.round((Gt+Me*Vt)*Yt)/Yt,f,ov(f,At,s))&&Me++):Gt<f&&Me++);Me<be;++Me){const Fe=Math.round((Gt+Me*Vt)*Yt)/Yt;if(Ct&&Fe>a)break;n.push({value:Fe})}return Ct&&F&&ie!==a?n.length&&uu(n[n.length-1].value,a,ov(a,At,s))?n[n.length-1].value=a:n.push({value:a}):(!Ct||ie===a)&&n.push({value:ie}),n}function ov(s,e,{horizontal:n,minRotation:c}){const h=ir(c),p=(n?Math.sin(h):Math.cos(h))||.001,f=.75*e*(""+s).length;return Math.min(e/p,f)}class Qf extends Ja{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,n){return pi(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:n,maxDefined:c}=this.getUserBounds();let{min:h,max:p}=this;const f=w=>h=n?h:w,a=w=>p=c?p:w;if(e){const w=Sr(h),P=Sr(p);w<0&&P<0?a(0):w>0&&P>0&&f(0)}if(h===p){let w=p===0?1:Math.abs(p*.05);a(p+w),e||f(h-w)}this.min=h,this.max=p}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:n,stepSize:c}=e,h;return c?(h=Math.ceil(this.max/c)-Math.floor(this.min/c)+1,h>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${c} would result generating up to ${h} ticks. Limiting to 1000.`),h=1e3)):(h=this.computeTickLimit(),n=n||11),n&&(h=Math.min(n,h)),h}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,n=e.ticks;let c=this.getTickLimit();c=Math.max(2,c);const h={maxTicks:c,bounds:e.bounds,min:e.min,max:e.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},p=this._range||this,f=mE(h,p);return e.bounds==="ticks"&&X0(f,this,"value"),e.reverse?(f.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),f}configure(){const e=this.ticks;let n=this.min,c=this.max;if(super.configure(),this.options.offset&&e.length){const h=(c-n)/Math.max(e.length-1,1)/2;n-=h,c+=h}this._startValue=n,this._endValue=c,this._valueRange=c-n}getLabelForValue(e){return Lu(e,this.chart.options.locale,this.options.ticks.format)}}class Mg extends Qf{determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=us(e)?e:0,this.max=us(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),n=e?this.width:this.height,c=ir(this.options.ticks.minRotation),h=(e?Math.sin(c):Math.cos(c))||.001,p=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,p.lineHeight/h))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}_e(Mg,"id","linear"),_e(Mg,"defaults",{ticks:{callback:fp.formatters.numeric}});const Iu=s=>Math.floor(Uo(s)),ja=(s,e)=>Math.pow(10,Iu(s)+e);function av(s){return s/Math.pow(10,Iu(s))===1}function lv(s,e,n){const c=Math.pow(10,n),h=Math.floor(s/c);return Math.ceil(e/c)-h}function gE(s,e){const n=e-s;let c=Iu(n);for(;lv(s,e,c)>10;)c++;for(;lv(s,e,c)<10;)c--;return Math.min(c,Iu(s))}function _E(s,{min:e,max:n}){e=In(s.min,e);const c=[],h=Iu(e);let p=gE(e,n),f=p<0?Math.pow(10,Math.abs(p)):1;const a=Math.pow(10,p),w=h>p?Math.pow(10,h):0,P=Math.round((e-w)*f)/f,k=Math.floor((e-w)/a/10)*a*10;let E=Math.floor((P-k)/Math.pow(10,p)),F=In(s.min,Math.round((w+k+E*Math.pow(10,p))*f)/f);for(;F<n;)c.push({value:F,major:av(F),significand:E}),E>=10?E=E<15?15:20:E++,E>=20&&(p++,E=2,f=p>=0?1:f),F=Math.round((w+k+E*Math.pow(10,p))*f)/f;const R=In(s.max,F);return c.push({value:R,major:av(R),significand:E}),c}class Pg extends Ja{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,n){const c=Qf.prototype.parse.apply(this,[e,n]);if(c===0){this._zero=!0;return}return us(c)&&c>0?c:null}determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=us(e)?Math.max(0,e):null,this.max=us(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!us(this._userMin)&&(this.min=e===ja(this.min,0)?ja(this.min,-1):ja(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let c=this.min,h=this.max;const p=a=>c=e?c:a,f=a=>h=n?h:a;c===h&&(c<=0?(p(1),f(10)):(p(ja(c,-1)),f(ja(h,1)))),c<=0&&p(ja(h,-1)),h<=0&&f(ja(c,1)),this.min=c,this.max=h}buildTicks(){const e=this.options,n={min:this._userMin,max:this._userMax},c=_E(n,this);return e.bounds==="ticks"&&X0(c,this,"value"),e.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}getLabelForValue(e){return e===void 0?"0":Lu(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=Uo(e),this._valueRange=Uo(this.max)-Uo(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(Uo(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const n=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+n*this._valueRange)}}_e(Pg,"id","logarithmic"),_e(Pg,"defaults",{ticks:{callback:fp.formatters.logarithmic,major:{enabled:!0}}});function Cg(s){const e=s.ticks;if(e.display&&s.display){const n=Ys(e.backdropPadding);return ti(e.font&&e.font.size,ss.font.size)+n.height}return 0}function yE(s,e,n){return n=is(n)?n:[n],{w:Mk(s,e.string,n),h:n.length*e.lineHeight}}function cv(s,e,n,c,h){return s===c||s===h?{start:e-n/2,end:e+n/2}:s<c||s>h?{start:e-n,end:e}:{start:e,end:e+n}}function xE(s){const e={l:s.left+s._padding.left,r:s.right-s._padding.right,t:s.top+s._padding.top,b:s.bottom-s._padding.bottom},n=Object.assign({},e),c=[],h=[],p=s._pointLabels.length,f=s.options.pointLabels,a=f.centerPointLabels?Ji/p:0;for(let w=0;w<p;w++){const P=f.setContext(s.getPointLabelContext(w));h[w]=P.padding;const k=s.getPointPosition(w,s.drawingArea+h[w],a),E=Is(P.font),F=yE(s.ctx,E,s._pointLabels[w]);c[w]=F;const R=An(s.getIndexAngle(w)+a),J=Math.round(i_(R)),rt=cv(J,k.x,F.w,0,180),mt=cv(J,k.y,F.h,90,270);bE(n,e,R,rt,mt)}s.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),s._pointLabelItems=SE(s,c,h)}function bE(s,e,n,c,h){const p=Math.abs(Math.sin(n)),f=Math.abs(Math.cos(n));let a=0,w=0;c.start<e.l?(a=(e.l-c.start)/p,s.l=Math.min(s.l,e.l-a)):c.end>e.r&&(a=(c.end-e.r)/p,s.r=Math.max(s.r,e.r+a)),h.start<e.t?(w=(e.t-h.start)/f,s.t=Math.min(s.t,e.t-w)):h.end>e.b&&(w=(h.end-e.b)/f,s.b=Math.max(s.b,e.b+w))}function vE(s,e,n){const c=s.drawingArea,{extra:h,additionalAngle:p,padding:f,size:a}=n,w=s.getPointPosition(e,c+h+f,p),P=Math.round(i_(An(w.angle+ys))),k=PE(w.y,a.h,P),E=TE(P),F=ME(w.x,a.w,E);return{visible:!0,x:w.x,y:k,textAlign:E,left:F,top:k,right:F+a.w,bottom:k+a.h}}function wE(s,e){if(!e)return!0;const{left:n,top:c,right:h,bottom:p}=s;return!(ro({x:n,y:c},e)||ro({x:n,y:p},e)||ro({x:h,y:c},e)||ro({x:h,y:p},e))}function SE(s,e,n){const c=[],h=s._pointLabels.length,p=s.options,{centerPointLabels:f,display:a}=p.pointLabels,w={extra:Cg(p)/2,additionalAngle:f?Ji/h:0};let P;for(let k=0;k<h;k++){w.padding=n[k],w.size=e[k];const E=vE(s,k,w);c.push(E),a==="auto"&&(E.visible=wE(E,P),E.visible&&(P=E))}return c}function TE(s){return s===0||s===180?"center":s<180?"left":"right"}function ME(s,e,n){return n==="right"?s-=e:n==="center"&&(s-=e/2),s}function PE(s,e,n){return n===90||n===270?s-=e/2:(n>270||n<90)&&(s-=e),s}function CE(s,e,n){const{left:c,top:h,right:p,bottom:f}=n,{backdropColor:a}=e;if(!pi(a)){const w=Ga(e.borderRadius),P=Ys(e.backdropPadding);s.fillStyle=a;const k=c-P.left,E=h-P.top,F=p-c+P.width,R=f-h+P.height;Object.values(w).some(J=>J!==0)?(s.beginPath(),Cu(s,{x:k,y:E,w:F,h:R,radius:w}),s.fill()):s.fillRect(k,E,F,R)}}function kE(s,e){const{ctx:n,options:{pointLabels:c}}=s;for(let h=e-1;h>=0;h--){const p=s._pointLabelItems[h];if(!p.visible)continue;const f=c.setContext(s.getPointLabelContext(h));CE(n,f,p);const a=Is(f.font),{x:w,y:P,textAlign:k}=p;Ka(n,s._pointLabels[h],w,P+a.lineHeight/2,a,{color:f.color,textAlign:k,textBaseline:"middle"})}}function j1(s,e,n,c){const{ctx:h}=s;if(n)h.arc(s.xCenter,s.yCenter,e,0,Ki);else{let p=s.getPointPosition(0,e);h.moveTo(p.x,p.y);for(let f=1;f<c;f++)p=s.getPointPosition(f,e),h.lineTo(p.x,p.y)}}function IE(s,e,n,c,h){const p=s.ctx,f=e.circular,{color:a,lineWidth:w}=e;!f&&!c||!a||!w||n<0||(p.save(),p.strokeStyle=a,p.lineWidth=w,p.setLineDash(h.dash||[]),p.lineDashOffset=h.dashOffset,p.beginPath(),j1(s,n,f,c),p.closePath(),p.stroke(),p.restore())}function DE(s,e,n){return Qo(s,{label:n,index:e,type:"pointLabel"})}class tu extends Qf{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=Ys(Cg(this.options)/2),n=this.width=this.maxWidth-e.width,c=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+n/2+e.left),this.yCenter=Math.floor(this.top+c/2+e.top),this.drawingArea=Math.floor(Math.min(n,c)/2)}determineDataLimits(){const{min:e,max:n}=this.getMinMax(!1);this.min=us(e)&&!isNaN(e)?e:0,this.max=us(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Cg(this.options))}generateTickLabels(e){Qf.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((n,c)=>{const h=Gi(this.options.pointLabels.callback,[n,c],this);return h||h===0?h:""}).filter((n,c)=>this.chart.getDataVisibility(c))}fit(){const e=this.options;e.display&&e.pointLabels.display?xE(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,n,c,h){this.xCenter+=Math.floor((e-n)/2),this.yCenter+=Math.floor((c-h)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,n,c,h))}getIndexAngle(e){const n=Ki/(this._pointLabels.length||1),c=this.options.startAngle||0;return An(e*n+ir(c))}getDistanceFromCenterForValue(e){if(pi(e))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*n:(e-this.min)*n}getValueForDistanceFromCenter(e){if(pi(e))return NaN;const n=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(e){const n=this._pointLabels||[];if(e>=0&&e<n.length){const c=n[e];return DE(this.getContext(),e,c)}}getPointPosition(e,n,c=0){const h=this.getIndexAngle(e)-ys+c;return{x:Math.cos(h)*n+this.xCenter,y:Math.sin(h)*n+this.yCenter,angle:h}}getPointPositionForValue(e,n){return this.getPointPosition(e,this.getDistanceFromCenterForValue(n))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:n,top:c,right:h,bottom:p}=this._pointLabelItems[e];return{left:n,top:c,right:h,bottom:p}}drawBackground(){const{backgroundColor:e,grid:{circular:n}}=this.options;if(e){const c=this.ctx;c.save(),c.beginPath(),j1(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),c.closePath(),c.fillStyle=e,c.fill(),c.restore()}}drawGrid(){const e=this.ctx,n=this.options,{angleLines:c,grid:h,border:p}=n,f=this._pointLabels.length;let a,w,P;if(n.pointLabels.display&&kE(this,f),h.display&&this.ticks.forEach((k,E)=>{if(E!==0||E===0&&this.min<0){w=this.getDistanceFromCenterForValue(k.value);const F=this.getContext(E),R=h.setContext(F),J=p.setContext(F);IE(this,R,w,f,J)}}),c.display){for(e.save(),a=f-1;a>=0;a--){const k=c.setContext(this.getPointLabelContext(a)),{color:E,lineWidth:F}=k;!F||!E||(e.lineWidth=F,e.strokeStyle=E,e.setLineDash(k.borderDash),e.lineDashOffset=k.borderDashOffset,w=this.getDistanceFromCenterForValue(n.reverse?this.min:this.max),P=this.getPointPosition(a,w),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(P.x,P.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,n=this.options,c=n.ticks;if(!c.display)return;const h=this.getIndexAngle(0);let p,f;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(h),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((a,w)=>{if(w===0&&this.min>=0&&!n.reverse)return;const P=c.setContext(this.getContext(w)),k=Is(P.font);if(p=this.getDistanceFromCenterForValue(this.ticks[w].value),P.showLabelBackdrop){e.font=k.string,f=e.measureText(a.label).width,e.fillStyle=P.backdropColor;const E=Ys(P.backdropPadding);e.fillRect(-f/2-E.left,-p-k.size/2-E.top,f+E.width,k.size+E.height)}Ka(e,a.label,0,-p,k,{color:P.color,strokeColor:P.textStrokeColor,strokeWidth:P.textStrokeWidth})}),e.restore()}drawTitle(){}}_e(tu,"id","radialLinear"),_e(tu,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:fp.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}}),_e(tu,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),_e(tu,"descriptors",{angleLines:{_fallback:"grid"}});const yp={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},yn=Object.keys(yp);function hv(s,e){return s-e}function uv(s,e){if(pi(e))return null;const n=s._adapter,{parser:c,round:h,isoWeekday:p}=s._parseOpts;let f=e;return typeof c=="function"&&(f=c(f)),us(f)||(f=typeof c=="string"?n.parse(f,c):n.parse(f)),f===null?null:(h&&(f=h==="week"&&(pc(p)||p===!0)?n.startOf(f,"isoWeek",p):n.startOf(f,h)),+f)}function dv(s,e,n,c){const h=yn.length;for(let p=yn.indexOf(s);p<h-1;++p){const f=yp[yn[p]],a=f.steps?f.steps:Number.MAX_SAFE_INTEGER;if(f.common&&Math.ceil((n-e)/(a*f.size))<=c)return yn[p]}return yn[h-1]}function AE(s,e,n,c,h){for(let p=yn.length-1;p>=yn.indexOf(n);p--){const f=yn[p];if(yp[f].common&&s._adapter.diff(h,c,f)>=e-1)return f}return yn[n?yn.indexOf(n):0]}function EE(s){for(let e=yn.indexOf(s)+1,n=yn.length;e<n;++e)if(yp[yn[e]].common)return yn[e]}function fv(s,e,n){if(!n)s[e]=!0;else if(n.length){const{lo:c,hi:h}=s_(n,e),p=n[c]>=e?n[c]:n[h];s[p]=!0}}function zE(s,e,n,c){const h=s._adapter,p=+h.startOf(e[0].value,c),f=e[e.length-1].value;let a,w;for(a=p;a<=f;a=+h.add(a,1,c))w=n[a],w>=0&&(e[w].major=!0);return e}function pv(s,e,n){const c=[],h={},p=e.length;let f,a;for(f=0;f<p;++f)a=e[f],h[a]=f,c.push({value:a,major:!1});return p===0||!n?c:zE(s,c,h,n)}class Du extends Ja{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,n={}){const c=e.time||(e.time={}),h=this._adapter=new VI._date(e.adapters.date);h.init(n),hu(c.displayFormats,h.formats()),this._parseOpts={parser:c.parser,round:c.round,isoWeekday:c.isoWeekday},super.init(e),this._normalized=n.normalized}parse(e,n){return e===void 0?null:uv(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,n=this._adapter,c=e.time.unit||"day";let{min:h,max:p,minDefined:f,maxDefined:a}=this.getUserBounds();function w(P){!f&&!isNaN(P.min)&&(h=Math.min(h,P.min)),!a&&!isNaN(P.max)&&(p=Math.max(p,P.max))}(!f||!a)&&(w(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&w(this.getMinMax(!1))),h=us(h)&&!isNaN(h)?h:+n.startOf(Date.now(),c),p=us(p)&&!isNaN(p)?p:+n.endOf(Date.now(),c)+1,this.min=Math.min(h,p-1),this.max=Math.max(h+1,p)}_getLabelBounds(){const e=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;return e.length&&(n=e[0],c=e[e.length-1]),{min:n,max:c}}buildTicks(){const e=this.options,n=e.time,c=e.ticks,h=c.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&h.length&&(this.min=this._userMin||h[0],this.max=this._userMax||h[h.length-1]);const p=this.min,f=this.max,a=dk(h,p,f);return this._unit=n.unit||(c.autoSkip?dv(n.minUnit,this.min,this.max,this._getLabelCapacity(p)):AE(this,a.length,n.minUnit,this.min,this.max)),this._majorUnit=!c.major.enabled||this._unit==="year"?void 0:EE(this._unit),this.initOffsets(h),e.reverse&&a.reverse(),pv(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let n=0,c=0,h,p;this.options.offset&&e.length&&(h=this.getDecimalForValue(e[0]),e.length===1?n=1-h:n=(this.getDecimalForValue(e[1])-h)/2,p=this.getDecimalForValue(e[e.length-1]),e.length===1?c=p:c=(p-this.getDecimalForValue(e[e.length-2]))/2);const f=e.length<3?.5:.25;n=Ls(n,0,f),c=Ls(c,0,f),this._offsets={start:n,end:c,factor:1/(n+1+c)}}_generate(){const e=this._adapter,n=this.min,c=this.max,h=this.options,p=h.time,f=p.unit||dv(p.minUnit,n,c,this._getLabelCapacity(n)),a=ti(h.ticks.stepSize,1),w=f==="week"?p.isoWeekday:!1,P=pc(w)||w===!0,k={};let E=n,F,R;if(P&&(E=+e.startOf(E,"isoWeek",w)),E=+e.startOf(E,P?"day":f),e.diff(c,n,f)>1e5*a)throw new Error(n+" and "+c+" are too far apart with stepSize of "+a+" "+f);const J=h.ticks.source==="data"&&this.getDataTimestamps();for(F=E,R=0;F<c;F=+e.add(F,a,f),R++)fv(k,F,J);return(F===c||h.bounds==="ticks"||R===1)&&fv(k,F,J),Object.keys(k).sort(hv).map(rt=>+rt)}getLabelForValue(e){const n=this._adapter,c=this.options.time;return c.tooltipFormat?n.format(e,c.tooltipFormat):n.format(e,c.displayFormats.datetime)}format(e,n){const h=this.options.time.displayFormats,p=this._unit,f=n||h[p];return this._adapter.format(e,f)}_tickFormatFunction(e,n,c,h){const p=this.options,f=p.ticks.callback;if(f)return Gi(f,[e,n,c],this);const a=p.time.displayFormats,w=this._unit,P=this._majorUnit,k=w&&a[w],E=P&&a[P],F=c[n],R=P&&E&&F&&F.major;return this._adapter.format(e,h||(R?E:k))}generateTickLabels(e){let n,c,h;for(n=0,c=e.length;n<c;++n)h=e[n],h.label=this._tickFormatFunction(h.value,n,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const n=this._offsets,c=this.getDecimalForValue(e);return this.getPixelForDecimal((n.start+c)*n.factor)}getValueForPixel(e){const n=this._offsets,c=this.getDecimalForPixel(e)/n.factor-n.end;return this.min+c*(this.max-this.min)}_getLabelSize(e){const n=this.options.ticks,c=this.ctx.measureText(e).width,h=ir(this.isHorizontal()?n.maxRotation:n.minRotation),p=Math.cos(h),f=Math.sin(h),a=this._resolveTickFontOptions(0).size;return{w:c*p+a*f,h:c*f+a*p}}_getLabelCapacity(e){const n=this.options.time,c=n.displayFormats,h=c[n.unit]||c.millisecond,p=this._tickFormatFunction(e,0,pv(this,[e],this._majorUnit),h),f=this._getLabelSize(p),a=Math.floor(this.isHorizontal()?this.width/f.w:this.height/f.h)-1;return a>0?a:1}getDataTimestamps(){let e=this._cache.data||[],n,c;if(e.length)return e;const h=this.getMatchingVisibleMetas();if(this._normalized&&h.length)return this._cache.data=h[0].controller.getAllParsedValues(this);for(n=0,c=h.length;n<c;++n)e=e.concat(h[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let n,c;if(e.length)return e;const h=this.getLabels();for(n=0,c=h.length;n<c;++n)e.push(uv(this,h[n]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return J0(e.sort(hv))}}_e(Du,"id","time"),_e(Du,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function xf(s,e,n){let c=0,h=s.length-1,p,f,a,w;n?(e>=s[c].pos&&e<=s[h].pos&&({lo:c,hi:h}=no(s,"pos",e)),{pos:p,time:a}=s[c],{pos:f,time:w}=s[h]):(e>=s[c].time&&e<=s[h].time&&({lo:c,hi:h}=no(s,"time",e)),{time:p,pos:a}=s[c],{time:f,pos:w}=s[h]);const P=f-p;return P?a+(w-a)*(e-p)/P:a}class kg extends Du{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(e);this._minPos=xf(n,this.min),this._tableRange=xf(n,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:n,max:c}=this,h=[],p=[];let f,a,w,P,k;for(f=0,a=e.length;f<a;++f)P=e[f],P>=n&&P<=c&&h.push(P);if(h.length<2)return[{time:n,pos:0},{time:c,pos:1}];for(f=0,a=h.length;f<a;++f)k=h[f+1],w=h[f-1],P=h[f],Math.round((k+w)/2)!==P&&p.push({time:P,pos:f/(a-1)});return p}_generate(){const e=this.min,n=this.max;let c=super.getDataTimestamps();return(!c.includes(e)||!c.length)&&c.splice(0,0,e),(!c.includes(n)||c.length===1)&&c.push(n),c.sort((h,p)=>h-p)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const n=this.getDataTimestamps(),c=this.getLabelTimestamps();return n.length&&c.length?e=this.normalize(n.concat(c)):e=n.length?n:c,e=this._cache.all=e,e}getDecimalForValue(e){return(xf(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const n=this._offsets,c=this.getDecimalForPixel(e)/n.factor-n.end;return xf(this._table,c*this._tableRange+this._minPos,!0)}}_e(kg,"id","timeseries"),_e(kg,"defaults",Du.defaults);var RE=Object.freeze({__proto__:null,CategoryScale:Tg,LinearScale:Mg,LogarithmicScale:Pg,RadialLinearScale:tu,TimeScale:Du,TimeSeriesScale:kg});const LE=[NI,gA,uE,RE];Qr.register(...LE);const FE={props:{sensorData:{type:Object,required:!0}},mounted(){this.drawChart()},methods:{drawChart(){const s=document.getElementById(this.sensorData.name);new Qr(s,{type:"line",data:{labels:this.sensorData.dates,datasets:[{label:this.sensorData.name,data:this.sensorData.val,borderWidth:1,backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)"}]},options:{scales:{y:{title:{display:!0,align:"center",text:`${this.sensorData.unit}`},beginAtZero:!1}}}})},getTimeLabel(){return this.sensorData.dates.map(s=>new Date(s).toLocaleTimeString("fr-FR",{timeStyle:"short"}))}}},OE={class:"SensorItem"},BE={class:"col d-flex align-items-start border-dark-subtle"},jE={class:"icon-square bg-body-secondary d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3"},NE={class:"fs-3 text-body-emphasis"},VE=["id"];function $E(s,e,n,c,h,p){return hi(),Yi("div",OE,[fe("div",BE,[fe("div",jE,[nu(s.$slots,"icon",{},void 0)]),fe("div",null,[fe("h3",NE,[nu(s.$slots,"title",{},void 0)])])]),fe("div",null,[fe("canvas",{id:n.sensorData.name},null,8,VE)])])}const UE=xn(FE,[["render",$E],["__scopeId","data-v-05050876"]]),HE={components:{MapBox:V0,ChartItem:UE},props:{sensorData:{type:Array,required:!0},location:{type:Object,required:!0}}},ZE={class:"box"},GE={class:"sensorBox"},qE=["src"],WE={class:"mapBox"};function XE(s,e,n,c,h,p){const f=ks("ChartItem"),a=ks("MapBox");return hi(),Yi("div",ZE,[fe("div",GE,[(hi(!0),Yi(Gs,null,Ug(n.sensorData,w=>(hi(),Yi("div",{key:w},[ki(f,{sensorData:w},{icon:oo(()=>[fe("img",{alt:"icon",class:"icon-square",src:w.url},null,8,qE)]),title:oo(()=>[io(Nn(w.name),1)]),_:2},1032,["sensorData"])]))),128))]),fe("div",WE,[ki(a,{location:n.location},null,8,["location"])])])}const KE=xn(HE,[["render",XE],["__scopeId","data-v-5cbcf9f4"]]);function YE(s,e){const n={};return s.forEach((h,p)=>{const a=new Date(h).toISOString().substring(0,13)+":00:00Z";e[p]&&(n[a]?(n[a].total+=e[p],n[a].count++):n[a]={total:e[p],count:1})}),Object.keys(n).map(h=>({date:new Date(h).toLocaleTimeString("fr-FR",{timeStyle:"short"}),value:n[h].total/n[h].count}))}function JE(s,e){const n={};return s.forEach((h,p)=>{const a=new Date(h).toISOString().substring(0,10);e[p]&&(n[a]?(n[a].total+=e[p],n[a].count++):n[a]={total:e[p],count:1})}),Object.keys(n).map(h=>({date:new Date(h).toLocaleDateString("fr-FR",{dateStyle:"short"}),value:n[h].total/n[h].count}))}function QE(s,e){const n={};return s.forEach((h,p)=>{const a=new Date(h).toISOString().substring(0,16)+":00Z";e[p]&&(n[a]?(n[a].total+=e[p],n[a].count++):n[a]={total:e[p],count:1})}),Object.keys(n).map(h=>({date:new Date(h).toLocaleTimeString("fr-FR",{timeStyle:"short"}),value:n[h].total/n[h].count}))}const tz=(s,e)=>{const n=Math.floor((e-s)/1e3),c=Math.floor(n/60),h=Math.floor(c/60);return{days:Math.floor(h/24),hours:h}};function ez(s,e,n,c){let h=new Date(s),p=e==="now"?new Date:new Date(e);const f=tz(h,p);return f.days===0&&f.hours>1?YE(n,c):f.days===0&&f.hours<=1?QE(n,c):JE(n,c)}const iz={components:{HeaderApp:Xg,InfoStation:Yg,MenuApp:j0,MenuDate:MC,DataHistoryBoard:KE,ErrorStation:$0,LoaderBoussole:IC},data(){return{sensorList:[],sensorData:[],dataHistory:{},timestamp:"",timerange:{start:"",stop:""},location:{lon:0,lat:0},stationName:"Pi 28",loading:!1,error:!1}},mounted(){this.get_date()},watch:{timestamp(s){new Date(s).getMinutes()%10===0&&console.log("time to fetch")},dataHistory(){const s=Object.keys(this.dataHistory.data),e=Zf();this.sensorData=this.sensorList.filter(n=>n!=="lat-lon").map(n=>{let c=s.map(p=>this.dataHistory.data[p][n]),h=ez(this.timerange.start,this.timerange.stop,s,c);return{name:e[n],dates:h.map(p=>p.date),unit:this.dataHistory.unit[n],val:h.map(p=>p.value),url:U0(n)}}),this.sensorList.includes("lat-lon")&&(this.location={lon:this.dataHistory.data[s[0]].lon,lat:this.dataHistory.data[s[0]].lat})}},methods:{maj_sensor(s){s.includes("all")?(this.sensorList=Object.keys(Zf()),this.sensorList.push("lat-lon")):this.sensorList=s.filter(e=>e!=="location"&&e!=="all"),s.includes("location")&&this.sensorList.push("lat-lon")},maj_station(s){this.stationName=s},maj_timeRange(s){this.sensorList.length===0?alert("Choose at least one sensor please"):this.timerange=s},validate(){this.timerange.start!==""&&this.timerange.stop!=""||this.sensorList.length!==0?(console.log(this.timerange),this.fetchDataLive()):alert("Choose sensor(s) and a timerange please")},get_date(){setInterval(()=>{this.timestamp=new Date().toISOString()},1e3)},diff2date(s,e){const n=Math.floor((e-s)/1e3),c=Math.floor(n/60),h=Math.floor(c/60);return{days:Math.floor(h/24),hours:h}},async fetchDataLive(){this.loading=!0;try{const s=`http://piensg0${this.stationName.split(" ")[1]}.ensg.eu:3000/sample`,e=`${this.timerange.start}/${this.timerange.stop}`,n=this.sensorList.join("-"),c=`${s}/${e}/${n}`,h=await fetch(c);if(h.ok)console.log(c),this.dataHistory=await h.json(),this.error=!1,this.loading=!1;else throw new Error("Failed to fetch data")}catch(s){this.error=!0,this.loading=!1,console.error("Error:",s)}}}},sz={class:"container"},nz={class:"row mb-4"},rz={class:"col"},oz={class:"row"},az={class:"col-2"},lz={class:"d-flex justify-content-center my-2"},cz={class:"col-10"},hz={key:0,class:"m-4 d-flex justify-content-center align-items-center"};function uz(s,e,n,c,h,p){const f=ks("HeaderApp"),a=ks("InfoStation"),w=ks("MenuApp"),P=ks("MenuDate"),k=ks("LoaderBoussole"),E=ks("ErrorStation"),F=ks("DataHistoryBoard");return hi(),Yi("div",sz,[fe("div",nz,[fe("div",rz,[ki(f,{onUpdateStationName:p.maj_station},null,8,["onUpdateStationName"]),ki(a,{stationName:h.stationName,timestamp:h.timestamp},null,8,["stationName","timestamp"])])]),fe("div",oz,[fe("div",az,[ki(w,{onUpdateSensor:p.maj_sensor},null,8,["onUpdateSensor"]),ki(P,{onUpdateTimeRange:p.maj_timeRange},null,8,["onUpdateTimeRange"]),fe("div",lz,[fe("button",{type:"button",class:"btn btn-success",onClick:e[0]||(e[0]=(...R)=>p.validate&&p.validate(...R))},"See Results")])]),fe("div",cz,[h.loading?(hi(),Yi("div",hz,[ki(k),e[1]||(e[1]=fe("h2",{class:"ms-5"},"Veuillez patienter...",-1))])):Vo("",!0),h.error?(hi(),nr(E,{key:1})):(hi(),nr(F,{key:2,sensorData:h.sensorData,location:h.location},null,8,["sensorData","location"]))])])])}const dz=xn(iz,[["render",uz]]),fz={components:{HeaderApp:Xg,InfoStation:Yg},data(){return{stationsInfos:{"Pi 28":{name:"Vanessa et Zijian",loc:null},"Pi 27":{name:"Romain et Jiongru",loc:null},"Pi 29":{name:"iamvdo et cedricici",loc:{lon:2.5871930932709,lat:48.84105713049722}},"Pi 30":{name:"Loïs et Jean-Baptiste",loc:null},"Pi 31":{name:"Vincent et Ibrahim",loc:null},"Pi 32":{name:"Thomas et Antonin",loc:null}},stationName:"Pi 28",timestamp:"",map:null,markers:[]}},async mounted(){await this.fetchAllStationData(),this.initializeMap(),this.get_date()},watch:{timestamp(s){new Date(s).getMinutes()%10===0&&console.log("time to fetch")}},methods:{maj_station(s){this.stationName=s;const e=this.stationsInfos[this.stationName].loc;this.map.flyTo({center:[e.lon,e.lat],zoom:10,essential:!0})},get_date(){setInterval(()=>{this.timestamp=new Date().toISOString()},1e3)},initializeMap(){this.map=new cu.Map({container:"map",style:"https://api.maptiler.com/maps/streets-v2/style.json?key=AJPmdudX9yJ2dZbT3iuM",center:[2,48],zoom:2,minZoom:2});for(let[s,e]of Object.entries(this.stationsInfos)){let n=e.loc;n&&-180<=n.lon&&n.lon<=180&&-90<=n.lat&&n.lat<=90&&this.addMarker(n.lon,n.lat,`Station ${s} : ${e.name}`)}},async fetchAllStationData(){const s=Object.keys(this.stationsInfos).map(e=>this.fetchDataLive(e));await Promise.all(s)},addMarker(s,e,n){const c=new cu.Popup({offset:25}).setText(n);this.markers.push(new cu.Marker().setLngLat([s,e]).setPopup(c).addTo(this.map))},async fetchDataLive(s){try{const e=await fetch(`http://piensg0${s.split(" ")[1]}.ensg.eu:3000/live/lat-lon`);if(e.ok){const n=await e.json();this.stationsInfos[s].loc={lon:n.data.lon,lat:n.data.lat}}else throw new Error("Failed to fetch data")}catch(e){console.error("Error:",e)}}}},pz={class:"container"},mz={class:"row mb-4"},gz={class:"col"};function _z(s,e,n,c,h,p){const f=ks("HeaderApp"),a=ks("InfoStation");return hi(),Yi("div",pz,[fe("div",mz,[fe("div",gz,[ki(f,{onUpdateStationName:p.maj_station},null,8,["onUpdateStationName"]),ki(a,{stationName:h.stationName,timestamp:h.timestamp},null,8,["stationName","timestamp"])])]),e[0]||(e[0]=fe("div",{class:"row-10"},[fe("div",{class:"box"},[fe("div",{id:"map"})])],-1))])}const yz=xn(fz,[["render",_z],["__scopeId","data-v-e24716b6"]]),xz=ZM({history:vM("/"),routes:[{path:"/",name:"home",component:aC},{path:"/history",name:"history",component:dz},{path:"/map",name:"map",component:yz}]}),N1=$T(qM);N1.use(xz);N1.mount("#app");
